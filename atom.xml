<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/atom.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>the website of jyn</title>
    <subtitle>i write about code, and things that bring me joy, and sometimes other things too</subtitle>
    <link rel="self" type="application/atom+xml" href="https://jyn.dev/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://jyn.dev"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2026-01-22T00:00:00+00:00</updated>
    <id>https://jyn.dev/atom.xml</id><entry xml:lang="en">
        <title>remotely unlocking an encrypted hard disk</title>
        <published>2026-01-22T00:00:00+00:00</published>
        <updated>2026-01-22T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/remotely-unlocking-an-encrypted-hard-disk/"/>
        <id>https://jyn.dev/remotely-unlocking-an-encrypted-hard-disk/</id>
        
        <summary type="html">what&#x27;s a few systemd services in initramfs between friends?</summary>
        
        <content type="html" xml:base="https://jyn.dev/remotely-unlocking-an-encrypted-hard-disk/">&lt;p&gt;Your mission, should you choose to accept it, is to sneak into the earliest parts of the boot process, swap the startup config without breaking anything, and leave without a trace.&lt;&#x2F;p&gt;
&lt;p&gt;Are you ready? Let&#x27;s begin.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-setup&quot;&gt;the setup&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-setup&quot; aria-label=&quot;Anchor link for: the-setup&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;em&gt;In which our heroes are introduced, and the scene is set.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;For a very long time I had a beat-up old ThinkPad that couldn’t hold a charge for the life of it, especially when running Windows. It tended to die a lot when I was traveling, and I travel a lot. To save battery when I’m away from home, I often ssh back into my home desktop, both so I have persistent state even if my laptop battery dies, and so I get much faster builds that don’t kill the battery.&lt;&#x2F;p&gt;
&lt;p&gt;This has two small problems:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Sometimes my home loses power and the desktop shuts off.&lt;&#x2F;li&gt;
&lt;li&gt;Sometimes when the power comes back on it has a new public IP.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;For a long time I solved 1. by enabling “Power On&quot; after &quot;Restore AC Power Loss” in the BIOS and 2. with &lt;a href=&quot;https:&#x2F;&#x2F;tailscale.com&#x2F;kb&#x2F;1151&#x2F;what-is-tailscale&quot;&gt;tailscale&lt;&#x2F;a&gt;. However, I recently installed Arch with an encrypted boot partition, which means that boot doesn’t finish until I type in the encryption password.&lt;&#x2F;p&gt;
&lt;p&gt;Well. Well. What if I Simply put tailscale in initramfs?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-plan&quot;&gt;the plan&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-plan&quot; aria-label=&quot;Anchor link for: the-plan&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;em&gt;In which our intrepid heroes chart the challenges to come.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;initramfs&quot;&gt;initramfs&lt;a class=&quot;zola-anchor&quot; href=&quot;#initramfs&quot; aria-label=&quot;Anchor link for: initramfs&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Oh, right. If you weren’t aware, early boot in a Linux operating system&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;  is just running a full second operating system that happens to be very small, lol. That’s loaded from a compressed archive file in &#x2F;boot&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; and run from memory, with no access to persistent storage. This OS running from memory is called &lt;strong&gt;initramfs&lt;&#x2F;strong&gt; (initial RAM filesystem).&lt;&#x2F;p&gt;
&lt;p&gt;So when you see a screen like this:
&lt;img src=&quot;&#x2F;assets&#x2F;Pasted%20image%2020260121044155.png&quot; alt=&quot;&quot; &#x2F;&gt;
That’s actually a whole-ass OS, with an &lt;code&gt;init&lt;&#x2F;code&gt; PID and service management and everything. This is how, for example, &lt;code&gt;systemd-analyze&lt;&#x2F;code&gt; can show you stats about early boot — there’s another copy of systemd running in initramfs, and it passes its state off to the one in the main OS.&lt;&#x2F;p&gt;
&lt;p&gt;Well. That implies we can install things on it ^^.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;constraints&quot;&gt;constraints&lt;a class=&quot;zola-anchor&quot; href=&quot;#constraints&quot; aria-label=&quot;Anchor link for: constraints&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;There’s three parts to this:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Networking in initramfs&lt;&#x2F;li&gt;
&lt;li&gt;Tailscale in initramfs&lt;&#x2F;li&gt;
&lt;li&gt;SSH in initramfs&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;We also want to make this as secure as possible, so there’s some more things to consider:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Putting tailscale in initramfs means that it has unencrypted keys lying around.&lt;&#x2F;li&gt;
&lt;li&gt;Tailscale keys expire (by default) after 90 days. At that point this will all break.&lt;&#x2F;li&gt;
&lt;li&gt;You really really don’t want people to get SSH access to your early boot environment.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We can solve this in a few ways:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Use Tailscale ACLs to only allow incoming connections to initramfs, not outgoing connections.&lt;&#x2F;li&gt;
&lt;li&gt;Set the key to never expire.&lt;&#x2F;li&gt;
&lt;li&gt;Set the SSH server to disallow all shells except the actual unlock command (&lt;code&gt;systemd-tty-ask-password-agent&lt;&#x2F;code&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;tailscale-acls&quot;&gt;tailscale ACLs&lt;a class=&quot;zola-anchor&quot; href=&quot;#tailscale-acls&quot; aria-label=&quot;Anchor link for: tailscale-acls&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Some background about Tailscale’s ACLs (“access control lists”). Tailscale’s users are tied to their specific login method: you can, for example, add a passkey, but that passkey counts as a fully separate user than your original account. Tailscale also has “groups” of users, which are what they sound like, “&lt;a href=&quot;https:&#x2F;&#x2F;tailscale.com&#x2F;kb&#x2F;1396&#x2F;targets#autogroups&quot;&gt;auto groups&lt;&#x2F;a&gt;”, which again are what they sound like, “hosts”, which are a machine connected to the network, and “tags”.&lt;&#x2F;p&gt;
&lt;p&gt;Tags are odd, I haven&#x27;t seen anything like them before. They group hosts, not users, and when you add a tag to a host, that &lt;em&gt;counts as its login method&lt;&#x2F;em&gt;, rather than the host being tied to a user account.&lt;&#x2F;p&gt;
&lt;p&gt;A consequence of this is that the group &lt;a href=&quot;https:&#x2F;&#x2F;tailscale.com&#x2F;kb&#x2F;1396&#x2F;targets#autogrouprole&quot;&gt;&lt;code&gt;autogroup:member&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; does &lt;em&gt;not&lt;&#x2F;em&gt; include tagged machines, because tagged machines aren’t tied to a user account. (A second consequence is that you can’t remove all tags from a machine without logging out and logging back in to associate it with your user account.)&lt;&#x2F;p&gt;
&lt;p&gt;So we can write a policy like this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;json&quot; class=&quot;language-json z-code&quot;&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-begin z-json&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;  &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Define the tags which can be applied to devices and by which users.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;tagOwners&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-begin z-json&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;tag:initrd&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;autogroup:admin&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-mapping z-end z-json&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;  &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Define access control lists for users, groups, autogroups, tags,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;  &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Tailscale IP addresses, and subnet ranges.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;acls&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;    &lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-begin z-json&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;action&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;accept&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;src&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;autogroup:member&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;dst&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;*:*&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-end z-json&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;  &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Test access rules every time they&amp;#39;re saved.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;tests&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;    &lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-begin z-json&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;      &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;src&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;100.76.34.8&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; outrageous-fortune
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;      &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;accept&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;100.102.101.127:22&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;100.101.55.73:10078&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; selene-initrd
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-mapping z-end z-json&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;    &lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-begin z-json&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;      &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;src&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;100.102.101.127&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; selene-initrd
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;      &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-json&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;deny&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-key-value z-json&quot;&gt;:&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-json&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;100.101.55.73:10078&lt;span class=&quot;z-punctuation z-definition z-string z-end z-json&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-js&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-json&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; selene
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-mapping z-end z-json&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-json&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-sequence z-end z-json&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-mapping z-pair z-json&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-json&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-json&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-mapping z-end z-json&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This says “allow devices tied to a user account to access any other device, and allow no permissions at all for devices tied to a tag”.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;selene&lt;&#x2F;code&gt; here is my desktop, and &lt;code&gt;selene-initrd&lt;&#x2F;code&gt; is its initramfs.  &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;systemd-before-boot&quot;&gt;systemd before boot&lt;a class=&quot;zola-anchor&quot; href=&quot;#systemd-before-boot&quot; aria-label=&quot;Anchor link for: systemd-before-boot&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Because initramfs is just a (mostly) normal Linux system, that means it has its own &lt;code&gt;init&lt;&#x2F;code&gt;
PID 1. On Arch, that PID is in fact just systemd. That means that we can add systemd
services to initramfs! There&#x27;s a whole collection of them in
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wolegis&#x2F;mkinitcpio-systemd-extras&quot;&gt;&lt;code&gt;mkinitcpio-systemd-extras&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;
(&lt;code&gt;mkinitcpio&lt;&#x2F;code&gt; is the tool Arch uses to regenerate initramfs).&lt;&#x2F;p&gt;
&lt;p&gt;We need two services: an SSH server (I went with
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wolegis&#x2F;mkinitcpio-systemd-extras&#x2F;wiki&#x2F;Dropbear-SSH-server&quot;&gt;&lt;code&gt;dropbear&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;)
and something to turn on networking, which this collection names &lt;code&gt;sd-network&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;It&#x27;s possible to run &lt;code&gt;tailscale ssh&lt;&#x2F;code&gt; directly, rather than having a separate SSH server, but
I didn&#x27;t find any way to configure tailscale&#x27;s SSH command, and I don&#x27;t want to let anyone
have a shell in my initramfs.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;h2 id=&quot;the-heist&quot;&gt;the heist&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-heist&quot; aria-label=&quot;Anchor link for: the-heist&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;em&gt;In which our heroes execute their plan flawlessly, sneaking in without a sound.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If you follow these steps on an Arch system, you should end up with roughly the same setup
as I have. Most of these commands assume you are running as root.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Install the dropbear SSH server:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;pacman&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;S&lt;&#x2F;span&gt; dropbear&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Install the systemd packages:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;yay&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;S&lt;&#x2F;span&gt; mkinitcpio-systemd-extras mkinitcpio-tailscale&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Add networking (&lt;code&gt;sd-network&lt;&#x2F;code&gt;), tailscale (&lt;code&gt;tailscale&lt;&#x2F;code&gt;), and dropbear (&lt;code&gt;sd-dropbear&lt;&#x2F;code&gt;) to
&lt;code&gt;&#x2F;etc&#x2F;mkinitcpio.conf&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;diff&quot; class=&quot;language-diff z-code&quot;&gt;&lt;code class=&quot;language-diff&quot; data-lang=&quot;diff&quot;&gt;&lt;span class=&quot;z-source z-diff&quot;&gt;&lt;span class=&quot;z-meta z-diff z-range z-normal&quot;&gt;&lt;span class=&quot;z-meta z-range z-normal z-diff&quot;&gt;1c1
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-diff&quot;&gt;&lt;span class=&quot;z-markup z-deleted z-diff&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-deleted z-diff&quot;&gt;&amp;lt;&lt;&#x2F;span&gt; HOOKS=(base systemd autodetect microcode kms modconf block keyboard sd-vconsole plymouth sd-encrypt filesystems)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-diff&quot;&gt;&lt;span class=&quot;z-meta z-separator z-diff&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-separator z-diff&quot;&gt;---&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-diff&quot;&gt;&lt;span class=&quot;z-markup z-inserted z-diff&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-inserted z-diff&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; HOOKS=(base systemd autodetect microcode kms modconf block keyboard sd-vconsole plymouth sd-network tailscale sd-dropbear sd-encrypt filesystems)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Set up the keys for your new tailscale device:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;setup-initcpio-tailscale&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;In &lt;a href=&quot;https:&#x2F;&#x2F;login.tailscale.com&#x2F;admin&#x2F;machines&quot;&gt;the tailscale web console&lt;&#x2F;a&gt;, mark your new
device with &lt;code&gt;tag:initrd&lt;&#x2F;code&gt;, and disable key expiry. It should look something like this:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;Pasted%20image%2020260121213235.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;In &lt;code&gt;&#x2F;etc&#x2F;mkinitcpio.conf&lt;&#x2F;code&gt;, configure dropbear to only allow running the unlock command and nothing else:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;SD_DROPBEAR_COMMAND&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;systemd-tty-ask-password-agent&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Tell systemd to wait forever for a decryption password. I use &lt;code&gt;systemd-boot&lt;&#x2F;code&gt;, so I edited
&lt;code&gt;&#x2F;boot&#x2F;loader&#x2F;entries&#x2F;linux-cachyos&lt;&#x2F;code&gt;. Under &lt;code&gt;options&lt;&#x2F;code&gt;, I extended the existing
&lt;code&gt;rootflags=subvol=&#x2F;@&lt;&#x2F;code&gt; to &lt;code&gt;rootflags=subvol=&#x2F;@,x-systemd.device-timeout=0&lt;&#x2F;code&gt;. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Copy your public keys into &lt;code&gt;&#x2F;root&#x2F;.ssh&#x2F;authorized_keys&lt;&#x2F;code&gt; so they get picked up by the
dropbear hook:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cp&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;.ssh&#x2F;authorized_keys &#x2F;root&#x2F;.ssh&#x2F;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Generate a new public&#x2F;private keypair for use by the dropbear server.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;dropbearkey&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;t&lt;&#x2F;span&gt; ed25519&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;f&lt;&#x2F;span&gt; &#x2F;etc&#x2F;dropbear&#x2F;dropbear_ed25519_host_key&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;Without this, the dropbear hook will try to load keys from openssh, which means they&#x27;ll be shared between early boot and your normal server. In particular that would mean your SSH server private keys would be stored unencrypted in initramfs.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Setup early networking.
(Note: these instructions are only for Ethernet connections. If you want WiFi in early
boot, good luck and godspeed.)&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Add the following config in &lt;code&gt;&#x2F;etc&#x2F;systemd&#x2F;network-initramfs&#x2F;10-wired.network&lt;&#x2F;code&gt;:&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;ini&quot; class=&quot;language-ini z-code&quot;&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span class=&quot;z-source z-genconfig&quot;&gt;&lt;span class=&quot;z-storage z-type z-genconfig&quot;&gt;[Match]
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-genconfig&quot;&gt;&lt;span class=&quot;z-meta z-param z-genconfig&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-genconfig&quot;&gt;Type&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-genconfig&quot;&gt;=&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;ether
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-genconfig&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-genconfig&quot;&gt;&lt;span class=&quot;z-storage z-type z-genconfig&quot;&gt;[Network]
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-genconfig&quot;&gt;&lt;span class=&quot;z-support z-constant z-genconfig&quot;&gt;DHCP&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-genconfig&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-language z-genconfig&quot;&gt;yes&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Register it in &lt;code&gt;&#x2F;etc&#x2F;mkinitcpio.conf&lt;&#x2F;code&gt; so it gets picked up by the &lt;code&gt;sd-network&lt;&#x2F;code&gt; hook:&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;SD_NETWORK_CONFIG&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&#x2F;etc&#x2F;systemd&#x2F;network-initramfs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;All this rigamarole is necessary because the OS doesn&#x27;t set the network interfaces to
predictable names until late boot, so it needs some way to know which interface to use.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Last but not least, rebuild your initramfs: &lt;code&gt;mkinitcpio -P&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Next time you reboot, you should be able to ssh into &lt;code&gt;$(hostname)-initrd&lt;&#x2F;code&gt; and get a prompt
that looks like this:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;Screenshot_20260121_222102.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-getaway&quot;&gt;the getaway&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-getaway&quot; aria-label=&quot;Anchor link for: the-getaway&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;em&gt;In which a moral is imparted, and our scene concluded.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The takeaway here is the same as in all my other posts: if you think something isn&#x27;t
possible to do with a computer, have you considered applying more violence?&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;and I believe in Windows, although I’m less sure about that &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;sometimes &#x2F;boot&#x2F;EFI &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;Here “initrd” stands for “initramdisk”, which is another word for our initramfs system. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wolegis&#x2F;mkinitcpio-systemd-extras&#x2F;wiki&#x2F;Dropbear-SSH-server#:~:text=systemd%2Edevice%2Dtimeout&quot;&gt;the &lt;code&gt;sd-dropbear&lt;&#x2F;code&gt;
docs&lt;&#x2F;a&gt; for more information about this. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>pre-commit hooks are fundamentally broken</title>
        <published>2025-12-26T00:00:00+00:00</published>
        <updated>2025-12-26T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/pre-commit-hooks-are-fundamentally-broken/"/>
        <id>https://jyn.dev/pre-commit-hooks-are-fundamentally-broken/</id>
        
        <summary type="html">use pre-push hooks instead</summary>
        
        <content type="html" xml:base="https://jyn.dev/pre-commit-hooks-are-fundamentally-broken/">&lt;p&gt;Let&#x27;s start a new Rust project.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;mkdir&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; best-fizzbuzz-ever&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-cd z-shell&quot;&gt;cd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; best-fizzbuzz-ever&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cat&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&amp;lt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; main.rs&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;fn main() { for i in 0.. {
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;    println (&amp;quot;fizzbuzz&amp;quot;);
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;}}
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; init&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Initialized empty Git repository in &#x2F;home&#x2F;jyn&#x2F;src&#x2F;third-website&#x2F;best-fizzbuzz-ever&#x2F;.git&#x2F;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; add main.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; fizzbuzz&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[main (root-commit) 661dc28] fizzbuzz
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; 1 file changed, 4 insertions(+)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; create mode 100644 main.rs
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Neat. Now let&#x27;s say I add this to some list of fizzbuzz projects in different languages.
Maybe .... &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;joshkunz&#x2F;fizzbuzz&quot;&gt;this one&lt;&#x2F;a&gt;.
They tell me I need to have &quot;proper formatting&quot; and &quot;use consistent style&quot;.
How rude.&lt;&#x2F;p&gt;
&lt;p&gt;Maybe I can write a pre-commit hook that checks that for me?&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cat&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&amp;lt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; pre-commit&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;#!&#x2F;bin&#x2F;sh
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;set -eu
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;for f in *.rs; do
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;  rustfmt --check &amp;quot;$f&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;done
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;chmod&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; +x pre-commit&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ln&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; ..&#x2F;..&#x2F;pre-commit .git&#x2F;hooks&#x2F;pre-commit&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; add pre-commit&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;add pre-commit hook&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Diff in &#x2F;home&#x2F;jyn&#x2F;src&#x2F;third-website&#x2F;best-fizzbuzz-ever&#x2F;src&#x2F;main.rs:1:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-fn main() { for i in 0.. {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-    println (&amp;quot;fizzbuzz&amp;quot;);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-}}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+fn main() {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+    for i in 0.. {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+        println(&amp;quot;fizzbuzz&amp;quot;);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+    }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Neat! Let&#x27;s commit that change.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;rustfmt&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; main.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;add pre-commit hook&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[main 3be7b87] add pre-commit hook
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; 1 file changed, 4 insertions(+)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; create mode 100755 pre-commit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; status&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;On branch main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Changes not staged for commit:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  (use &amp;quot;git add &amp;lt;file&amp;gt;...&amp;quot; to update what will be committed)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  (use &amp;quot;git restore &amp;lt;file&amp;gt;...&amp;quot; to discard changes in working directory)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;	modified:   main.rs
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Oh ... We fixed the formatting, but we didn&#x27;t actually stage the changes.
The pre-commit hook runs on the &lt;em&gt;working tree&lt;&#x2F;em&gt;, not on the &lt;em&gt;index&lt;&#x2F;em&gt;, so it didn&#x27;t catch the issue.
We can see that the version tracked by git still has the wrong formatting:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; show HEAD:main.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;fn main() { for i in 0.. {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;    println (&amp;quot;fizzbuzz&amp;quot;);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;}}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Maybe we can make the script smarter?
Let&#x27;s checkout all the files in the index into a temporary directory and run our pre-commit hook there. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cat&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&amp;lt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; pre-commit&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;#!&#x2F;bin&#x2F;sh
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;set -eu
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;tmpdir=$(mktemp -d --tmpdir &amp;quot;$(basename &amp;quot;$(realpath .)&amp;quot;)-pre-commit.XXXX&amp;quot;)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;trap &amp;#39;rm -r &amp;quot;$tmpdir&amp;quot;&amp;#39; EXIT
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;git checkout-index --all --prefix=&amp;quot;$tmpdir&#x2F;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;for f in $tmpdir&#x2F;*.rs; do
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;  rustfmt --check &amp;quot;$f&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;done
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; add pre-commit&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;make pre-commit hook smarter&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Diff in &#x2F;tmp&#x2F;best-fizzbuzz-ever-pre-commit.ZNyw&#x2F;main.rs:1:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-fn main() { for i in 0.. {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-    println (&amp;quot;fizzbuzz&amp;quot;);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-}}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+fn main() {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+    for i in 0.. {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+        println(&amp;quot;fizzbuzz&amp;quot;);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+    }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Yay! That caught the issue.
Now let&#x27;s add our rust program to that collection of fizzbuzz programs.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; add main.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;make pre-commit hook smarter&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[main 3cb40f6] make pre-commit hook smarter
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; 2 files changed, 11 insertions(+), 4 deletions(-)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; remote add upstream https:&#x2F;&#x2F;github.com&#x2F;joshkunz&#x2F;fizzbuzz&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; fetch upstream&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;remote: Enumerating objects: 222, done.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;remote: Total 222 (delta 0), reused 0 (delta 0), pack-reused 222 (from 1)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Receiving objects: 100% (222&#x2F;222), 29.08 KiB | 29.08 MiB&#x2F;s, done.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Resolving deltas: 100% (117&#x2F;117), done.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;From https:&#x2F;&#x2F;github.com&#x2F;joshkunz&#x2F;fizzbuzz
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; * [new branch]      master     -&amp;gt; upstream&#x2F;master
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; rebase upstream&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Successfully rebased and updated refs&#x2F;heads&#x2F;main.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Maybe we&#x27;ll make one last tweak...&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sed&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;1i &#x2F;&#x2F; Written by jyn&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; main.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit main.rs&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;mark who wrote fizzbuzz&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Diff in &#x2F;tmp&#x2F;best-fizzbuzz-ever-pre-commit.n1Pj&#x2F;fizzbuzz-traits.rs:4:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; use std::iter;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; struct FizzBuzz {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-    from : i32
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;-  , to : i32
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+    from: i32,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;+    to: i32,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; impl FizzBuzz {
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Uh. Huh. Right.
The code that was already here wasn&#x27;t formatted according to rustfmt.
Our script is running on every file in the git repo, so it won&#x27;t let us commit.&lt;&#x2F;p&gt;
&lt;p&gt;Maybe we can change it to only run on modified files?&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cat&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&amp;lt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; pre-commit&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;#!&#x2F;bin&#x2F;sh
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;set -eu
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;files=$(git diff --name-only --cached --no-ext-diff --diff-filter=d)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;tmpdir=$(mktemp -d --tmpdir &amp;quot;$(basename &amp;quot;$(realpath .)&amp;quot;)-pre-commit.XXXX&amp;quot;)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;trap &amp;#39;rm -r &amp;quot;$tmpdir&amp;quot;&amp;#39; EXIT
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;printf %s &amp;quot;$files&amp;quot; | tr &amp;#39;\n&amp;#39; &amp;#39;\0&amp;#39; | xargs -0 git checkout-index --prefix=&amp;quot;$tmpdir&#x2F;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;for f in $tmpdir&#x2F;*.rs; do
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;  rustfmt --check &amp;quot;$f&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;done
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-heredoc z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-heredoc-token z-shell&quot;&gt;EOF&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit main.rs pre-commit &lt;span class=&quot;z-punctuation z-separator z-continuation z-line z-shell&quot;&gt;\
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt;  --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;update main.rs; make pre-commit even smarter&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[main f2925bc] update main.rs; make pre-commit even smarter
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; 2 files changed, 5 insertions(+), 1 deletion(-)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Alright. Cool.&lt;&#x2F;p&gt;
&lt;p&gt;Let&#x27;s do one last thing.
Let&#x27;s say we had an existing PR to this repo and we need to rebase it.
Maybe it had a merge conflict, or maybe there was a fix on main that we need in order to implement our solution.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; checkout upstream&#x2F;HEAD  &lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; Simulate an old PR by checking out an old commit&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;HEAD is now at 56bf3ab Adds E to the README
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;fn main() { println!(&amp;quot;this counts as fizzbuzz, right?&amp;quot;); }&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; print.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; add print.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; commit&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;message&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Add print.rs&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[detached HEAD 3d1bbf7] Add print.rs
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; 1 file changed, 1 insertion(+)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt; create mode 100644 print.rs
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;And let&#x27;s also say that we want to edit the commit message.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; rebase&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; main  &lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; Rebase this whole branch over our main branch&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;reword 3d1bbf7 Add print.rs
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;#&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Rebase&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; f2925bc..3d1bbf7 onto f2925bc (1 command&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;now-we-really-have-a-problem&quot;&gt;Now, we &lt;em&gt;really&lt;&#x2F;em&gt; have a problem.&lt;a class=&quot;zola-anchor&quot; href=&quot;#now-we-really-have-a-problem&quot; aria-label=&quot;Anchor link for: now-we-really-have-a-problem&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Error: file `&#x2F;tmp&#x2F;best-fizzbuzz-ever-pre-commit.p3az&#x2F;*.rs` does not exist
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Could not apply 3d1bbf7... Add print.rs
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Two things went wrong here:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Our pre-commit hook can&#x27;t handle commits that don&#x27;t have any Rust files.&lt;&#x2F;li&gt;
&lt;li&gt;Our pre-commit hook &lt;em&gt;ran on a branch we were rebasing&lt;&#x2F;em&gt;. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Fixing the first thing doesn&#x27;t really help us, because we don&#x27;t control other people&#x27;s branches.
They might have used &lt;code&gt;git commit --no-verify&lt;&#x2F;code&gt;.
They might not even have a pre-commit hook installed.
They might have had a branch that passed the hook when they originally wrote it, but not after a rebase (e.g. if your hook is &lt;code&gt;cargo check&lt;&#x2F;code&gt; or something like that).
They might have had a branch that used an old version of the hook that didn&#x27;t have as many checks as a later version.&lt;&#x2F;p&gt;
&lt;p&gt;Our only real choice here is to pass &lt;code&gt;--no-verify&lt;&#x2F;code&gt; to &lt;code&gt;git rebase&lt;&#x2F;code&gt; every time we run it, and to &lt;code&gt;git commit&lt;&#x2F;code&gt; for every commit in the rebase we modify,
and possibly even to every &lt;code&gt;git merge&lt;&#x2F;code&gt; we run outside of a rebase.&lt;&#x2F;p&gt;
&lt;p&gt;This is because pre-commit hooks are a &lt;em&gt;fundamentally broken idea&lt;&#x2F;em&gt;.
Code does not exist in isolation.
Commits that are local to a developer machine do not ever go through CI.
Commits don&#x27;t even necessarily mean that that the code is ready to publish—pre-commit hooks don&#x27;t run on &lt;code&gt;git stash&lt;&#x2F;code&gt; for a reason!
I don&#x27;t use &lt;code&gt;git stash&lt;&#x2F;code&gt;, I use &lt;code&gt;git commit&lt;&#x2F;code&gt; so that my stashes are tied to a branch, and hooks completely break this workflow.&lt;&#x2F;p&gt;
&lt;p&gt;More than that, pre-commit hooks are &lt;em&gt;preventing you from saving your work&lt;&#x2F;em&gt;.
There should be a &lt;em&gt;really, really good reason&lt;&#x2F;em&gt; to prevent you from saving your work, and IMO &quot;doesn&#x27;t pass the test suite&quot; is not that.
I have similar feelings about format-on-save hooks.&lt;&#x2F;p&gt;
&lt;p&gt;There are a &lt;a href=&quot;https:&#x2F;&#x2F;blog.plover.com&#x2F;prog&#x2F;git&#x2F;hook-disaster.html&quot;&gt;bunch&lt;&#x2F;a&gt;
of &lt;a href=&quot;https:&#x2F;&#x2F;dev.to&#x2F;afl_ext&#x2F;are-pre-commit-git-hooks-a-good-idea-i-dont-think-so-38j6&quot;&gt;other&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;77620&quot;&gt;footguns&lt;&#x2F;a&gt; with pre-commit hooks.
This doesn&#x27;t even count the fact that nearly all pre-commit hooks are implemented in a broken way and just blindly run on the worktree, and are slow or unreliable or both.
Don&#x27;t get me started on pre-commit hooks that try to add things to the commit you&#x27;re about to make, or projects that try to automatically install a hook when you run the test suite.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;The &lt;a href=&quot;https:&#x2F;&#x2F;pre-commit.com&#x2F;&quot;&gt;&lt;code&gt;pre-commit&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; framework (or its cousin, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;lint-staged&#x2F;lint-staged&quot;&gt;lint-staged&lt;&#x2F;a&gt;) does &lt;em&gt;not&lt;&#x2F;em&gt; fix this.
It fixes the issues about running on the index by stashing your changes with
&lt;a href=&quot;https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;git-stash#Documentation&#x2F;git-stash.txt---keep-index&quot;&gt;&lt;code&gt;--keep-index&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;,
which works but modifies your git state.
It doesn&#x27;t fix the issues about running during a rebase, nor does it prevent hooks from trying to add things to the current commit. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-lint-staged-1&quot;&gt;&lt;a href=&quot;#fn-lint-staged&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&quot;Just don&#x27;t write bad hooks&quot; doesn&#x27;t work if I&#x27;m working on someone else&#x27;s project where I don&#x27;t control the hook.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;Please just don&#x27;t use &lt;code&gt;pre-commit&lt;&#x2F;code&gt; hooks. Use &lt;code&gt;pre-push&lt;&#x2F;code&gt; instead. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;
&lt;code&gt;pre-push&lt;&#x2F;code&gt; hooks nearly avoid all of these issues.&lt;&#x2F;p&gt;
&lt;p&gt;The only use case where I think pre-commit hooks are a good idea is for things that must &lt;em&gt;never&lt;&#x2F;em&gt; committed, that are worth interrupting a complicated rebase to prevent; namely: credentials.
Once credentials are committed they&#x27;re quite difficult to get out, and even harder to be sure you haven&#x27;t missed them.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;tips-for-writing-a-pre-push-hook&quot;&gt;Tips for writing a &lt;code&gt;pre-push&lt;&#x2F;code&gt; hook&lt;a class=&quot;zola-anchor&quot; href=&quot;#tips-for-writing-a-pre-push-hook&quot; aria-label=&quot;Anchor link for: tips-for-writing-a-pre-push-hook&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;Run on the index, not the working tree, as described above. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Only add checks that are fast and reliable. Checks that touch the network should never go in a hook. Checks that are slow and require an up-to-date build cache should never go in a hook. Checks that require credentials or a running local service should never go in a hook.&lt;&#x2F;li&gt;
&lt;li&gt;Be as quiet as possible. This hook is running buried inside a bunch of other commands, often without the developer knowing that the hook is going to run. Don&#x27;t hide other important output behind a wall of progress messages.&lt;&#x2F;li&gt;
&lt;li&gt;Don&#x27;t set the hook up automatically. Whatever tool you use that promises to make this reliable is wrong. There is not a way to do this reliably, and the number of times it&#x27;s broken on me is more than I can count. Please just add docs for how to set it up manually, prominently featured in your CONTRIBUTING docs. (You do have contributing docs, right?)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;If the hook does fail, and the changes affect an older commit than the most recent,
you can use a combination of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tummychow&#x2F;git-absorb&quot;&gt;&lt;code&gt;git-absorb&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;git-revise.readthedocs.io&#x2F;en&#x2F;latest&#x2F;man.html&quot;&gt;&lt;code&gt;git-revise&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;,
and &lt;a href=&quot;https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;git-rebase#Documentation&#x2F;git-rebase.txt---execcmd&quot;&gt;&lt;code&gt;git rebase -X ours --exec&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;
to put them in the appropriate commit before pushing again.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;And don&#x27;t write &lt;code&gt;pre-commit&lt;&#x2F;code&gt; hooks!&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;This is really quite slow on large enough repos, but there&#x27;s not any real alternative. &lt;code&gt;git stash --keep-index&lt;&#x2F;code&gt; messes with git index state and also with your stashes. The only VCS that exposes a FUSE filesystem of its commits is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;facebook&#x2F;sapling&#x2F;blob&#x2F;main&#x2F;eden&#x2F;fs&#x2F;docs&#x2F;Overview.md&quot;&gt;Sapling&lt;&#x2F;a&gt;, which is poorly supported outside Facebook. The best you can do is give up on looking at the whole working copy and only write hooks that read a single file at a time. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;By default this doesn&#x27;t happen when running bare &lt;code&gt;rebase&lt;&#x2F;code&gt;, but the second you add &lt;code&gt;--interactive&lt;&#x2F;code&gt;, nearly anything you do runs a hook. Hooks will also run when you attempt to resolve merge conflicts. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-lint-staged&quot;&gt;
&lt;p&gt;&lt;code&gt;lint-staged&lt;&#x2F;code&gt; does actually have a &lt;code&gt;--fail-on-changes&lt;&#x2F;code&gt; flag which aborts the commit, but that still modifies the working tree, and it&#x27;s not on by default. &lt;a href=&quot;#fr-lint-staged-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;For more info about the difference, and a full list of possible hooks, see &lt;a href=&quot;https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;githooks&quot;&gt;&lt;code&gt;man 5 githooks&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;Notice that I don&#x27;t say &quot;only run on changed files&quot;. That&#x27;s because it&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;lore.kernel.org&#x2F;git&#x2F;CAHnEOG2o784dk+OpkGt-1qjRJb34=sFMJvh-JRJ3v+GNBxFywQ@mail.gmail.com&#x2F;&quot;&gt;not actually possible to reliably determine which branch the current commit is based on&lt;&#x2F;a&gt;, the best you can do is pick a random branch that looks likely. &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>i'm just having fun</title>
        <published>2025-12-15T00:00:00+00:00</published>
        <updated>2025-12-15T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/i-m-just-having-fun/"/>
        <id>https://jyn.dev/i-m-just-having-fun/</id>
        
        <summary type="html">programming isn&#x27;t a competition</summary>
        
        <content type="html" xml:base="https://jyn.dev/i-m-just-having-fun/">&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;x.com&#x2F;reillywood&#x2F;status&#x2F;1370424931477954560&quot;&gt;
&lt;p&gt;IT IS ONLY COMPUTER&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;x.com&#x2F;reillywood&#x2F;status&#x2F;1370424931477954560&quot;&gt;Reilly Wood&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;p&gt;i work professionally on a compiler and write about build systems in my free time and as a result people often say things to me like &quot;reading your posts points to me how really smart you are&quot; or &quot;reading a lot of this shit makes me feel super small&quot;. this makes me quite uncomfortable and is not the reaction i&#x27;m seeking when i write blog posts.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;it-s-not-a-competition&quot;&gt;it&#x27;s not a competition&lt;a class=&quot;zola-anchor&quot; href=&quot;#it-s-not-a-competition&quot; aria-label=&quot;Anchor link for: it-s-not-a-competition&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;i mean, in some sense if you work as a professional programmer it is a competition, because the job market sucks right now. but i think usually when people say they feel dumb, it&#x27;s not in the sense of &quot;how am i supposed to get a job when jyn exists&quot; but more &quot;jyn can do things i can&#x27;t and that makes me feel bad&quot;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;you-can-do-hard-things&quot;&gt;you can do hard things&lt;a class=&quot;zola-anchor&quot; href=&quot;#you-can-do-hard-things&quot; aria-label=&quot;Anchor link for: you-can-do-hard-things&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;all the things i know i learned by experimenting with them, or by reading books or posts or man pages or really obscure error messages. sometimes &lt;a href=&quot;https:&#x2F;&#x2F;drmaciver.substack.com&#x2F;p&#x2F;how-to-do-everything&quot;&gt;there&#x27;s a trick to it&lt;&#x2F;a&gt; but sometimes &lt;a href=&quot;https:&#x2F;&#x2F;jordanstacey.substack.com&#x2F;p&#x2F;the-gen-z-resilience-drought&quot;&gt;it&#x27;s just hard work&lt;&#x2F;a&gt;. i am not magic. &lt;a href=&quot;&#x2F;theory-building-without-a-mentor&#x2F;&quot;&gt;you can learn these things too&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;everyone-has-their-own-area-of-specialization&quot;&gt;everyone has their own area of specialization&lt;a class=&quot;zola-anchor&quot; href=&quot;#everyone-has-their-own-area-of-specialization&quot; aria-label=&quot;Anchor link for: everyone-has-their-own-area-of-specialization&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;if you don&#x27;t want to spend a bunch of time learning about how computers work, you don&#x27;t have to! not knowing about gory computer internals does not make you dumb or computer illiterate or anything. everyone has their own specialty and mine is compilers and build systems. i don&#x27;t know jack shit about economics or medicine! having a different specialty than me doesn&#x27;t mean you&#x27;re dumb.&lt;&#x2F;p&gt;
&lt;p&gt;i really hate that computing and STEM have this mystique in our society. to the extent that engineering demonstrates intelligence, it&#x27;s by &lt;em&gt;repeatedly forcing you to confront the results of your own mistakes&lt;&#x2F;em&gt;, in such a way that errors can&#x27;t be ignored. there are lots of ways to do that which don&#x27;t involve programming or college-level math! performance art and carpentry and running your own business or household all force you to confront your own mistakes in this way and deserve no less respect than STEM.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;if-i-can-t-feminize-my-compiler-what-s-the-point&quot;&gt;if i can&#x27;t feminize my compiler, what&#x27;s the point?&lt;a class=&quot;zola-anchor&quot; href=&quot;#if-i-can-t-feminize-my-compiler-what-s-the-point&quot; aria-label=&quot;Anchor link for: if-i-can-t-feminize-my-compiler-what-s-the-point&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;by and large, when i learn new things about computers, it&#x27;s because i&#x27;m fucking around. the fucking around is the point. if all the writing helps people learn and come up with cool new ideas, that&#x27;s neat too.&lt;&#x2F;p&gt;
&lt;p&gt;half the time the fucking around is just to make people say &quot;jyn NO&quot;. half the time it&#x27;s because i want to make art with my code. i really, sincerely, believe that art is one of the most important uses for a computer.&lt;&#x2F;p&gt;
&lt;p&gt;i&#x27;m not doing this for the money. i happened to get very lucky that my passion pays very well, but i got into this industry before realizing how much programmers actually make, and now that i work for a european company i don&#x27;t make US tech salaries anyway. i do it for the love of the game.&lt;&#x2F;p&gt;
&lt;p&gt;some extracts from the jyn computer experience:&lt;&#x2F;p&gt;
&lt;a href=https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;118756&gt;
&lt;img src=&quot;&amp;#x2F;assets&amp;#x2F;Pasted image 20251215042122.png&quot;
	 alt=&quot;screenshot of a rust-lang PR titled &amp;#x27;use bold magenta instead of bold white for highlighting&amp;#x27;. the first sentence in the description is &amp;#x27;according to a poll of gay people in my phone, purple is the most popular color to use for highlighting&amp;#x27;&quot;
	
&gt;
&lt;&#x2F;a&gt;
&lt;br&gt;
&lt;br&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;Pasted%20image%2020251215042623.png&quot; alt=&quot;a series of quotes such as &amp;quot;jyn yeah you&amp;#39;re fucking insane&amp;quot; and &amp;quot;what the actual fuck. but also i love it&amp;quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;bsky.app&#x2F;profile&#x2F;jyn.dev&#x2F;post&#x2F;3klso625ibr26&quot;&gt;&lt;img src=&quot;&#x2F;assets&#x2F;Pasted%20image%2020251215043434.png&quot; alt=&quot;screenshot of a bluesky post by jyn that says &amp;quot;She is humming. She is dancing. She is beautiful.&amp;quot; below are three pictures, one J program, and a quote-tweet of A Ladder To by Jana H-S.&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;img src=&quot;&amp;#x2F;assets&amp;#x2F;Pasted%20image%2020251215053854.png&quot;
	 alt=&quot;screenshot of a discord conversation. it reads: jyn: for a while i had a custom build of rustc whose version string said “love you love you love you” in purple. jyn: i should bring that back now that i work on ferrocene. anon: You&amp;#x27;ve heard of cargo mommy now get ready for rustc tsundere&quot;
	
&gt;
&lt;br&gt;
&lt;br&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;Pasted%20image%2020251215043906.png&quot; alt=&quot;screenshot of a shell command showing the version of a custom-built rustc. it says &amp;quot;Ferrocene rolling love you love you love you&amp;quot;, with the &amp;quot;love you&amp;quot;s in purple.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;my-advice&quot;&gt;my advice&lt;a class=&quot;zola-anchor&quot; href=&quot;#my-advice&quot; aria-label=&quot;Anchor link for: my-advice&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;you really shouldn&#x27;t take advice from me lol &lt;img src=&quot;&#x2F;assets&#x2F;Pasted%20image%2020251215055218.png&quot; alt=&quot;the WWII survivorship bias plane, with red dots indicating bullet holes on the wings, tail, and central body&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;however! if you are determined to do so anyway, what i can do is point you towards:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;places-to-start-fucking-around-and-finding-out&quot;&gt;places to start fucking around and finding out&lt;a class=&quot;zola-anchor&quot; href=&quot;#places-to-start-fucking-around-and-finding-out&quot; aria-label=&quot;Anchor link for: places-to-start-fucking-around-and-finding-out&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;highest thing i can recommend is building a tool for yourself.
maybe it&#x27;s a spreadsheet that saves you an hour of work a week.
maybe it&#x27;s a little website you play around with.
maybe it&#x27;s something in RPGmaker.
the exact thing doesn&#x27;t matter, the important part is that it&#x27;s fun and you have something real at the end of it,
which motivates you to keep going even when the computer is breaking in three ways you didn&#x27;t even know were possible.&lt;&#x2F;p&gt;
&lt;p&gt;second thing i can recommend is looking at things other people have built.
you won&#x27;t understand all of it and that&#x27;s ok.
pick a part of it that looks interesting and do a deep dive on how it works.&lt;&#x2F;p&gt;
&lt;p&gt;i can recommend the following places to look when you&#x27;re getting started:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&quot;&gt;Mozilla Development Network&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;Main_page&quot;&gt;Arch Wiki&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;&quot;&gt;StackOverflow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.alicemaz.com&#x2F;writing&#x2F;program.html&quot;&gt;alice maz, &quot;how I think when I think about programming&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;most importantly, remember:
&lt;img src=&quot;&#x2F;assets&#x2F;it-is-only-computer.png&quot; alt=&quot;Practice Guide for Computer&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>what is a build system, anyway?</title>
        <published>2025-12-12T00:00:00+00:00</published>
        <updated>2025-12-12T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/what-is-a-build-system-anyway/"/>
        <id>https://jyn.dev/what-is-a-build-system-anyway/</id>
        
        <summary type="html">Some definitions and an overview of the world of build systems</summary>
        
        <content type="html" xml:base="https://jyn.dev/what-is-a-build-system-anyway/">&lt;p&gt;Andrew Nesbitt recently wrote a post titled &lt;a href=&quot;https:&#x2F;&#x2F;nesbitt.io&#x2F;2025&#x2F;12&#x2F;02&#x2F;what-is-a-package-manager.html&quot;&gt;What is a Package Manager&lt;&#x2F;a&gt;? This post attempts to do the same for build systems.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;big-picture&quot;&gt;big picture&lt;a class=&quot;zola-anchor&quot; href=&quot;#big-picture&quot; aria-label=&quot;Anchor link for: big-picture&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;At a high level, &lt;strong&gt;build systems&lt;&#x2F;strong&gt; are tools or libraries that provide a way to &lt;strong&gt;define&lt;&#x2F;strong&gt; and &lt;strong&gt;execute&lt;&#x2F;strong&gt; a series of transformations from &lt;strong&gt;input&lt;&#x2F;strong&gt; data to &lt;strong&gt;output&lt;&#x2F;strong&gt; data that are &lt;strong&gt;memoized&lt;&#x2F;strong&gt; by &lt;strong&gt;caching&lt;&#x2F;strong&gt; them in an &lt;strong&gt;object store&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Transformations are called &lt;strong&gt;steps&lt;&#x2F;strong&gt; or &lt;strong&gt;rules&lt;&#x2F;strong&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-14-1&quot;&gt;&lt;a href=&quot;#fn-14&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; and define how to execute a &lt;strong&gt;task&lt;&#x2F;strong&gt; that generates zero or more outputs from zero or more inputs.
A rule is usually the &lt;strong&gt;unit of caching&lt;&#x2F;strong&gt;; i.e. the &lt;strong&gt;cache points&lt;&#x2F;strong&gt; are the outputs of a rule, and &lt;strong&gt;cache invalidations&lt;&#x2F;strong&gt; must happen on the inputs of a rule.
Rules can have &lt;strong&gt;dependencies&lt;&#x2F;strong&gt; on previous outputs, forming a directed graph called a &lt;strong&gt;dependency graph&lt;&#x2F;strong&gt;.
Dependencies that form a cyclic graph are called &lt;strong&gt;circular dependencies&lt;&#x2F;strong&gt; and are usually banned.&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-5-1&quot;&gt;&lt;a href=&quot;#fn-5&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Outputs that are only used by other rules, but not “interesting” to the end-user, are called &lt;strong&gt;intermediate outputs&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;A output is &lt;strong&gt;outdated&lt;&#x2F;strong&gt;, &lt;strong&gt;dirty&lt;&#x2F;strong&gt;, or &lt;strong&gt;stale&lt;&#x2F;strong&gt; if one of its dependencies is modified, or, &lt;strong&gt;transitively&lt;&#x2F;strong&gt;, if one of its dependencies is outdated.
Stale outputs invalidate the cache and require the outputs to be &lt;strong&gt;rebuilt&lt;&#x2F;strong&gt;.
An output that is cached and not dirty is &lt;strong&gt;up-to-date&lt;&#x2F;strong&gt;.
Rules are outdated if any of their outputs are outdated.
If a rule has no outputs, it is always outdated.&lt;&#x2F;p&gt;
&lt;p&gt;Each invocation of the build tool is called a &lt;strong&gt;build&lt;&#x2F;strong&gt;.
A &lt;strong&gt;full build&lt;&#x2F;strong&gt; or &lt;strong&gt;clean build&lt;&#x2F;strong&gt; occurs when the cache is empty and all transformations are executed as a &lt;strong&gt;batch job&lt;&#x2F;strong&gt;.
A cache is &lt;strong&gt;full&lt;&#x2F;strong&gt; if all its rules are up-to-date.
An &lt;strong&gt;incremental build&lt;&#x2F;strong&gt; occurs when the cache is partially full but some outputs are outdated and need to be rebuilt.
Deleting the cache is called &lt;strong&gt;cleaning&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;A build is &lt;strong&gt;correct&lt;&#x2F;strong&gt; or &lt;strong&gt;sound&lt;&#x2F;strong&gt; if all possible incremental builds have the same result as a full build.&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;
A build is &lt;strong&gt;minimal&lt;&#x2F;strong&gt; (occasionally &lt;strong&gt;optimal&lt;&#x2F;strong&gt;) if rules are rerun at most once per build, and only run if necessary for soundness (&lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;03&#x2F;build-systems.pdf&quot;&gt;Build Systems à la Carte&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;www.mathematik.uni-marburg.de&#x2F;~seba&#x2F;publications&#x2F;pluto-incremental-build.pdf&quot;&gt;Pluto&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;In order for a build to be sound, all possible cache invalidations must be &lt;strong&gt;tracked&lt;&#x2F;strong&gt; as dependencies.&lt;&#x2F;p&gt;
&lt;p&gt;A build system without caching is called a &lt;strong&gt;task runner&lt;&#x2F;strong&gt; or &lt;strong&gt;batch compiler&lt;&#x2F;strong&gt;.
Note that task runners still often support dependencies even if they don&#x27;t support caching.
Build systems with caching can emulate a task runner by only defining tasks with zero outputs, but they are usually not designed for this use case. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-7-1&quot;&gt;&lt;a href=&quot;#fn-7&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Some examples of build systems: &lt;code&gt;make&lt;&#x2F;code&gt;, &lt;code&gt;docker build&lt;&#x2F;code&gt;, rustc.
Some examples of task runners: &lt;a href=&quot;https:&#x2F;&#x2F;just.systems&#x2F;man&#x2F;en&#x2F;&quot;&gt;&lt;code&gt;just&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, shell scripts, &lt;a href=&quot;https:&#x2F;&#x2F;fabiensanglard.net&#x2F;dc&#x2F;driver.php&quot;&gt;gcc&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;specifying-dependencies&quot;&gt;specifying dependencies&lt;a class=&quot;zola-anchor&quot; href=&quot;#specifying-dependencies&quot; aria-label=&quot;Anchor link for: specifying-dependencies&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;A build can be either &lt;strong&gt;inter-process&lt;&#x2F;strong&gt;, in which case the task is usually a single &lt;strong&gt;process execution&lt;&#x2F;strong&gt; and its input and output files, or &lt;strong&gt;intra-process&lt;&#x2F;strong&gt;, in which case a task is usually a single function call and its arguments and return values.&lt;&#x2F;p&gt;
&lt;p&gt;In order to track dependencies, either all inputs and outputs must be &lt;strong&gt;declared&lt;&#x2F;strong&gt; in source code ahead of time, or it must be possible to &lt;strong&gt;infer&lt;&#x2F;strong&gt; them from the execution of a task.&lt;&#x2F;p&gt;
&lt;p&gt;Build systems that track changes to a rule definition are called &lt;strong&gt;self-tracking&lt;&#x2F;strong&gt;. Past versions of the rule are called its &lt;strong&gt;history&lt;&#x2F;strong&gt; (&lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;03&#x2F;build-systems.pdf&quot;&gt;Build Systems à la Carte&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;The act of inferring dependencies from runtime behavior is called &lt;strong&gt;tracing&lt;&#x2F;strong&gt;.
If a traced rule depends on a dependency that hasn’t been built yet, the build system may either error, &lt;strong&gt;suspend&lt;&#x2F;strong&gt; the task and &lt;strong&gt;resume&lt;&#x2F;strong&gt; it later once the dependency is built, or &lt;strong&gt;abort&lt;&#x2F;strong&gt; the task and &lt;strong&gt;restart&lt;&#x2F;strong&gt; it later once the dependency is built (&lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;03&#x2F;build-systems.pdf&quot;&gt;Build Systems à la Carte&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Inter-process builds often declare their inputs and outputs, and intra-process builds often infer them, but this is not inherent to the definition. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-8-1&quot;&gt;&lt;a href=&quot;#fn-8&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Some example of intra-process builds include spreadsheets, the &lt;a href=&quot;https:&#x2F;&#x2F;davidlattimore.github.io&#x2F;posts&#x2F;2024&#x2F;11&#x2F;19&#x2F;designing-wilds-incremental-linking.html&quot;&gt;wild&lt;&#x2F;a&gt; linker, and memoization libraries such as python’s &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;functools.html#functools.cache&quot;&gt;&lt;code&gt;functools.cache&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;applicative-and-monadic-structure&quot;&gt;applicative and monadic structure&lt;a class=&quot;zola-anchor&quot; href=&quot;#applicative-and-monadic-structure&quot; aria-label=&quot;Anchor link for: applicative-and-monadic-structure&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;A build graph is &lt;strong&gt;applicative&lt;&#x2F;strong&gt; if all inputs, outputs, and rules are declared ahead of time.
We say in this case the graph is &lt;strong&gt;statically known&lt;&#x2F;strong&gt;.
Very few build systems are purely applicative, almost all have an escape hatch.&lt;&#x2F;p&gt;
&lt;p&gt;The graph is &lt;strong&gt;monadic&lt;&#x2F;strong&gt; if not all outputs are known ahead of time, or if rules can generate other rules dynamically at runtime. Inputs that aren’t known ahead of time are called &lt;strong&gt;dynamic dependencies&lt;&#x2F;strong&gt;. Dynamic dependencies are weaker than a fully monadic build system, in the sense that they can &lt;a href=&quot;https:&#x2F;&#x2F;buttondown.com&#x2F;hillelwayne&#x2F;archive&#x2F;the-capability-tractability-tradeoff&#x2F;&quot;&gt;express&lt;&#x2F;a&gt; fewer build graphs. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-15-1&quot;&gt;&lt;a href=&quot;#fn-15&quot;&gt;6&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Build systems that do not require declaring build rules are always monadic.&lt;&#x2F;p&gt;
&lt;p&gt;Some examples of monadic build systems include &lt;a href=&quot;https:&#x2F;&#x2F;shakebuild.com&#x2F;&quot;&gt;Shake&lt;&#x2F;a&gt;, ninja &lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;manual.html#ref_dyndep&quot;&gt;&lt;code&gt;dyndeps&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, and Cargo build scripts.&lt;&#x2F;p&gt;
&lt;p&gt;Some examples of applicative build systems include &lt;code&gt;make&lt;&#x2F;code&gt; (with &lt;a href=&quot;https:&#x2F;&#x2F;accu.org&#x2F;journals&#x2F;overload&#x2F;14&#x2F;71&#x2F;miller_2004&#x2F;&quot;&gt;recursive make&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;make&#x2F;manual&#x2F;html_node&#x2F;Remaking-Makefiles.html&quot;&gt;self-rebuilding Makefiles&lt;&#x2F;a&gt; disallowed), Bazel (excluding native rules), and map&#x2F;reduce libraries with memoization, such as &lt;a href=&quot;https:&#x2F;&#x2F;www.unison-lang.org&#x2F;articles&#x2F;distributed-datasets&#x2F;incremental-evaluation&#x2F;&quot;&gt;this unison program&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;early-cutoff&quot;&gt;early cutoff&lt;a class=&quot;zola-anchor&quot; href=&quot;#early-cutoff&quot; aria-label=&quot;Anchor link for: early-cutoff&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;If a dirty rule R has an outdated output, reruns, and creates a new output that matches the old one, the build system has an opportunity to avoid running later rules that depend on R.
Taking advantage of that opportunity is called &lt;strong&gt;early cutoff&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;See &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;queries&#x2F;incremental-compilation-in-detail.html&quot;&gt;the rustc-dev-guide&lt;&#x2F;a&gt; for much more information about early cutoff. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-9-1&quot;&gt;&lt;a href=&quot;#fn-9&quot;&gt;7&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;rebuild-detection&quot;&gt;rebuild detection&lt;a class=&quot;zola-anchor&quot; href=&quot;#rebuild-detection&quot; aria-label=&quot;Anchor link for: rebuild-detection&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;In unsound build systems, it’s possible that the build system does not accurately &lt;strong&gt;detect&lt;&#x2F;strong&gt; that it needs to rebuild.
Such systems sometimes offer a way to &lt;strong&gt;force-rerun&lt;&#x2F;strong&gt; a target: keeping the existing cache, but rerunning a single rule.
For inter-process build systems, this often involves &lt;code&gt;touch&lt;&#x2F;code&gt;ing a file to set its modification date to the current time.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-executor&quot;&gt;the executor&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-executor&quot; aria-label=&quot;Anchor link for: the-executor&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;A &lt;strong&gt;build executor&lt;&#x2F;strong&gt; runs tasks and is responsible for &lt;strong&gt;scheduling&lt;&#x2F;strong&gt; tasks in an order that respects all dependencies, often using heuristics such as dependency depth or the time taken by the task on the last run.
They also detect whether rule inputs have been modified, making the rule outdated; this is called &lt;strong&gt;rebuild detection&lt;&#x2F;strong&gt;.
The build executor is responsible for restarting or suspending tasks in build systems that support it.&lt;&#x2F;p&gt;
&lt;p&gt;Executors usually schedule many tasks in parallel, but this is not inherent to the definition.&lt;&#x2F;p&gt;
&lt;p&gt;Executors often provide &lt;strong&gt;progress reporting&lt;&#x2F;strong&gt;, and sometimes allow &lt;strong&gt;querying&lt;&#x2F;strong&gt; the dependency graph.
Occasionally they trace the inputs used by the task to enforce they match the declared dependencies, or to automatically add them to an internal dependency graph.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;inter-process-builds&quot;&gt;inter-process builds&lt;a class=&quot;zola-anchor&quot; href=&quot;#inter-process-builds&quot; aria-label=&quot;Anchor link for: inter-process-builds&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In the context of inter-process builds, an &lt;strong&gt;artifact&lt;&#x2F;strong&gt; is an output file generated by a rule.&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-6-1&quot;&gt;&lt;a href=&quot;#fn-6&quot;&gt;8&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;
A &lt;strong&gt;source file&lt;&#x2F;strong&gt; is an input file that is specific to the current &lt;strong&gt;project&lt;&#x2F;strong&gt;&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-11-1&quot;&gt;&lt;a href=&quot;#fn-11&quot;&gt;9&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; (sometimes &lt;strong&gt;repository&lt;&#x2F;strong&gt; or &lt;strong&gt;workspace&lt;&#x2F;strong&gt;) as opposed to a &lt;strong&gt;system dependency&lt;&#x2F;strong&gt; that is reused across multiple projects.
A project is loosely defined but generally refers to the set of all input and output files that the build system knows about, usually contained in a single directory.
Source files can be &lt;strong&gt;generated&lt;&#x2F;strong&gt;, which means they are an output of a previous rule.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Build files&lt;&#x2F;strong&gt; contain rule definitions, including (but not limited to) task definitions, input and output declarations, and metadata such as a human-readable description of the rule.
Inputs are usually split into &lt;strong&gt;explicit inputs&lt;&#x2F;strong&gt; passed to the spawned process, &lt;strong&gt;implicit inputs&lt;&#x2F;strong&gt; that are tracked by the build system but not used in the task definition, and &lt;strong&gt;order-only inputs&lt;&#x2F;strong&gt; that must exist before the rule can execute, but do not invalidate the cache when modified.&lt;&#x2F;p&gt;
&lt;p&gt;Process executions have more inputs than just files, such as the rule itself, environment variables, the current time, the current working directory, and occasionally network services or local daemons &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;10&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The set of all inputs that are not source files or command line arguments is called the &lt;strong&gt;environment&lt;&#x2F;strong&gt;.
Processes can be &lt;strong&gt;sandboxed&lt;&#x2F;strong&gt; to prevent them from depending on the network, a daemon, or occasionally system dependencies; this is sometimes called a &lt;strong&gt;sandboxed environment&lt;&#x2F;strong&gt; or &lt;strong&gt;isolated environment&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;System dependencies are more expansive than I think they are often understood to be.
They include compilers, linkers, programming language libraries &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;11&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;build-system-tradeoffs&#x2F;#dynamic-linking-and-platform-maintainers&quot;&gt;static and dynamically linked object files&lt;&#x2F;a&gt;, but also the dynamic loader, language runtime, and various system configuration files.
The subset of these dependencies needed for building a minimal program in a given language, along with various tools for inspecting and modifying the outputs at runtime, are called a &lt;strong&gt;toolchain&lt;&#x2F;strong&gt;.
Toolchains are inherently specific to a given language, but sometimes (e.g. in GCC) a single compiler will support multiple languages as inputs.&lt;&#x2F;p&gt;
&lt;p&gt;A build is &lt;strong&gt;hermetic&lt;&#x2F;strong&gt; (rarely, &lt;strong&gt;self-contained&lt;&#x2F;strong&gt; or &lt;strong&gt;isolated&lt;&#x2F;strong&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-16-1&quot;&gt;&lt;a href=&quot;#fn-16&quot;&gt;12&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;) if it uses no system dependencies and instead defines all its dependencies in the project (&lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;basics&#x2F;hermeticity&quot;&gt;Bazel&lt;&#x2F;a&gt;).
Sandboxing and hermeticity are orthogonal axes; neither one implies the other.
For example, docker builds are sandboxed but not hermetic, and nix shells are hermetic but not sandboxed.&lt;&#x2F;p&gt;
&lt;p&gt;Compiler or linkers sometimes have their own &lt;strong&gt;incremental caches&lt;&#x2F;strong&gt;.
Reusing the cache requires you to &lt;strong&gt;trust&lt;&#x2F;strong&gt; the compiler to be sound when incrementally rebuilding.
This is usually implicit, but hermetic or sandboxed builds require an opt-in to reuse the cache.
Bazel calls this kind of reuse a &lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;versions&#x2F;7.0.0&#x2F;remote&#x2F;persistent&quot;&gt;&lt;strong&gt;persistent worker&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;determinism&quot;&gt;determinism&lt;a class=&quot;zola-anchor&quot; href=&quot;#determinism&quot; aria-label=&quot;Anchor link for: determinism&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;A build is &lt;strong&gt;deterministic&lt;&#x2F;strong&gt; if it creates the same output every time in some specific environment.
A build is &lt;strong&gt;reproducible&lt;&#x2F;strong&gt; if it is deterministic and also has the same output in &lt;a href=&quot;https:&#x2F;&#x2F;reproducible-builds.org&#x2F;docs&#x2F;commandments&#x2F;&quot;&gt;any environment&lt;&#x2F;a&gt;, as long as the system dependencies remain the same.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;remote-caching&quot;&gt;remote caching&lt;a class=&quot;zola-anchor&quot; href=&quot;#remote-caching&quot; aria-label=&quot;Anchor link for: remote-caching&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Caching can be remote or local.
&lt;strong&gt;Remote caching&lt;&#x2F;strong&gt; is almost always unsound unless the build is both hermetic and reproducible (i.e. its only environment dependencies are controlled by the build system).&lt;&#x2F;p&gt;
&lt;p&gt;Downloading files from the remote cache is called &lt;strong&gt;materializing&lt;&#x2F;strong&gt; them.
Most build systems with remote caching &lt;strong&gt;defer materialization&lt;&#x2F;strong&gt; as long as possible, since in large build graphs the cache is often too large to fit on disk.
Builds where the cache is never fully materialized are called &lt;strong&gt;shallow builds&lt;&#x2F;strong&gt; (&lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;03&#x2F;build-systems.pdf&quot;&gt;Build Systems à la Carte&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Remote caching usually, but not necessarily, uses &lt;strong&gt;content addressed hashing&lt;&#x2F;strong&gt; in a &lt;strong&gt;key-value store&lt;&#x2F;strong&gt; to identify which artifact to download.&lt;&#x2F;p&gt;
&lt;p&gt;Some example build systems that use remote caching: Bazel, Buck2, nix, &lt;code&gt;docker build&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;interface&quot;&gt;interface&lt;a class=&quot;zola-anchor&quot; href=&quot;#interface&quot; aria-label=&quot;Anchor link for: interface&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Build systems usually have a way to run a subset of the build.
The identifier used to specify which part of the build you want to run is called a &lt;strong&gt;target&lt;&#x2F;strong&gt;.&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;13&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;
Targets are usually the filenames of an artifact, but can also be abstract names of one or more rules.
Bazel-descended build systems call these names &lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;concepts&#x2F;labels&quot;&gt;&lt;strong&gt;labels&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;.
Make-descended build systems call these &lt;a href=&quot;https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;make&#x2F;manual&#x2F;html_node&#x2F;Phony-Targets.html&quot;&gt;&lt;strong&gt;phony targets&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;.
Some build systems, such as cargo, do not use target identifiers but instead only have subcommands with arguments; the combination of arguments together specifies a set of targets.&lt;&#x2F;p&gt;
&lt;p&gt;Some example targets:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;make all&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;cargo build --test http_integration&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;buck2 build :main&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;meta-build-systems&quot;&gt;meta-build systems&lt;a class=&quot;zola-anchor&quot; href=&quot;#meta-build-systems&quot; aria-label=&quot;Anchor link for: meta-build-systems&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Inter-process build systems are often divided into a &lt;strong&gt;configuration&lt;&#x2F;strong&gt; step and a &lt;strong&gt;build&lt;&#x2F;strong&gt; step.
A build system that only runs the configuration step, and requires another tool for the build step, is called a &lt;strong&gt;meta-build system&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Usually this meta-build system &lt;strong&gt;discovers&lt;&#x2F;strong&gt; the rules that need to be executed (often through file globbing or some other programmatic way to describe dependencies), then &lt;strong&gt;serializes&lt;&#x2F;strong&gt; these rules into an &lt;a href=&quot;&#x2F;i-want-a-better-action-graph-serialization&#x2F;&quot;&gt;&lt;strong&gt;action graph&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;, which can be stored either in-memory or on-disk. On-disk serialized action graphs are usually themselves build files, in the sense that you can write them by hand but you wouldn&#x27;t want to.&lt;&#x2F;p&gt;
&lt;p&gt;Configuration steps usually allow the developer to choose a set of &lt;strong&gt;configuration flags&lt;&#x2F;strong&gt; (occasionally, &lt;strong&gt;build flags&lt;&#x2F;strong&gt;) that affect the generated rules.&lt;&#x2F;p&gt;
&lt;p&gt;Some build systems also integrate directly with the &lt;a href=&quot;https:&#x2F;&#x2F;nesbitt.io&#x2F;2025&#x2F;12&#x2F;02&#x2F;what-is-a-package-manager.html&quot;&gt;&lt;strong&gt;package manager&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;, but this is uncommon, and usually the build system expects all packages to be pre-downloaded into a known location.&lt;&#x2F;p&gt;
&lt;p&gt;Some examples of meta-build systems are CMake, meson, and autotools.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;vfs&quot;&gt;VFS&lt;a class=&quot;zola-anchor&quot; href=&quot;#vfs&quot; aria-label=&quot;Anchor link for: vfs&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Advanced build systems can integrate with a &lt;strong&gt;virtual file system&lt;&#x2F;strong&gt; (VFS) to check-out source control files on-demand, rather than eagerly (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;facebook&#x2F;sapling?tab=readme-ov-file#ejdenfs&quot;&gt;EdenFS&lt;&#x2F;a&gt;).
A VFS can also persistently store &lt;strong&gt;content hashes&lt;&#x2F;strong&gt; and provide efficient &lt;strong&gt;change detection&lt;&#x2F;strong&gt; for files, avoiding the need for file watching or constant re-hashing.&lt;&#x2F;p&gt;
&lt;!--
### orchestration
It is common, especially in build systems that have [grown organically](https:&#x2F;&#x2F;nothingisnttrivial.com&#x2F;vines.html), for build systems to wrap multiple other build systems. We call such a system, especially in the context of **continuous integration**, a **build orchestrator**.[^17] Usually orchestrators will have only a few “blessed” workflows, and not all features of the underlying tool will be exposed.

Some examples: [Rust’s bootstrap build system](https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;intro.html), Firefox’s [mach](https:&#x2F;&#x2F;firefox-source-docs.mozilla.org&#x2F;mach&#x2F;usage.html#)
--&gt;
&lt;h2 id=&quot;intra-process-builds&quot;&gt;intra-process builds&lt;a class=&quot;zola-anchor&quot; href=&quot;#intra-process-builds&quot; aria-label=&quot;Anchor link for: intra-process-builds&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The equivalent of system dependencies within a process is &lt;strong&gt;non-local state&lt;&#x2F;strong&gt;, including environment variables, globals, thread-locals, and class member fields (for languages where &lt;code&gt;this&lt;&#x2F;code&gt; is passed implicitly).
Especially tricky are function calls that do &lt;strong&gt;inter-process communication&lt;&#x2F;strong&gt; (IPC), which are basically never sound to cache.
Tracing intra-process builds is very very hard since it’s easy to call a function that depends on global state without you knowing. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-19-1&quot;&gt;&lt;a href=&quot;#fn-19&quot;&gt;14&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;In this intra-process context, most object stores are &lt;strong&gt;in-memory caches&lt;&#x2F;strong&gt;. A build system that supports saving (&lt;strong&gt;persisting&lt;&#x2F;strong&gt;) the cache to disk is said to have &lt;a href=&quot;&#x2F;complected-and-orthogonal-persistence&#x2F;&quot;&gt;&lt;strong&gt;persistence&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;. The system for persisting the cache is sometimes called a &lt;strong&gt;database&lt;&#x2F;strong&gt;, even if it is not a general-purpose database in the sense the term is normally used (&lt;a href=&quot;https:&#x2F;&#x2F;salsa-rs.netlify.app&#x2F;tutorial&#x2F;db&quot;&gt;Salsa&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;h3 id=&quot;tracing&quot;&gt;tracing&lt;a class=&quot;zola-anchor&quot; href=&quot;#tracing&quot; aria-label=&quot;Anchor link for: tracing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Tracing intra-process build systems are sometimes called a &lt;strong&gt;query system&lt;&#x2F;strong&gt;. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-18-1&quot;&gt;&lt;a href=&quot;#fn-18&quot;&gt;15&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; They work similarly to their inter-process equivalents: the interface looks like normal function calls, and the build system tracks which functions call which other functions, so it knows which to rerun later.&lt;&#x2F;p&gt;
&lt;p&gt;Some examples of tools with tracing intra-process build systems: &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;salsa&#x2F;latest&#x2F;salsa&#x2F;&quot;&gt;salsa&lt;&#x2F;a&gt;, the &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;query.html&quot;&gt;rustc query system&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;frp&quot;&gt;FRP&lt;a class=&quot;zola-anchor&quot; href=&quot;#frp&quot; aria-label=&quot;Anchor link for: frp&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Intra-process build systems that allow you to explicitly declare dependencies usually come from the background of &lt;a href=&quot;https:&#x2F;&#x2F;blog.janestreet.com&#x2F;breaking-down-frp&#x2F;&quot;&gt;&lt;strong&gt;functional reactive programming&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt; (FRP). FRP is most often used in UI and frontend design, but many of the ideas are the same as the build systems used for compiling programs.&lt;&#x2F;p&gt;
&lt;p&gt;Unlike any of the build systems we&#x27;ve talked about so far, FRP libraries let you look at &lt;em&gt;past versions&lt;&#x2F;em&gt; of your outputs, which is sometimes called &lt;strong&gt;remembering&lt;&#x2F;strong&gt; state (&lt;a href=&quot;https:&#x2F;&#x2F;react.dev&#x2F;learn&#x2F;state-a-components-memory&quot;&gt;React&lt;&#x2F;a&gt;). To make this easier to reason about, rules can be written as &lt;strong&gt;event handlers&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Some examples of libraries with dependency declarations: &lt;a href=&quot;https:&#x2F;&#x2F;react.dev&#x2F;learn&#x2F;adding-interactivity&quot;&gt;React&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;so-what-counts-as-a-build-system&quot;&gt;so, what counts as a build system?&lt;a class=&quot;zola-anchor&quot; href=&quot;#so-what-counts-as-a-build-system&quot; aria-label=&quot;Anchor link for: so-what-counts-as-a-build-system&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;A build system is pretty much anything that lets you specify dependencies on a previous artifact 😄 Some more weird examples of build systems:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Github Actions (jobs and workflows)&lt;&#x2F;li&gt;
&lt;li&gt;Static site generators&lt;&#x2F;li&gt;
&lt;li&gt;Docker-compose files&lt;&#x2F;li&gt;
&lt;li&gt;Systemd unit files&lt;&#x2F;li&gt;
&lt;li&gt;Excel&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Hopefully this post has given you both a vocabulary to talk about build systems and a context to compare them!&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bibliography&quot;&gt;bibliography&lt;a class=&quot;zola-anchor&quot; href=&quot;#bibliography&quot; aria-label=&quot;Anchor link for: bibliography&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nesbitt.io&#x2F;2025&#x2F;12&#x2F;02&#x2F;what-is-a-package-manager.html&quot;&gt;Andrew Nesbitt, “What is a Package Manager?”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;build-system-tradeoffs&#x2F;&quot;&gt;jyn, “build system tradeoffs”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;the-postmodern-build-system&#x2F;&quot;&gt;Jade Lovelace, “The postmodern build system”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;just.systems&#x2F;man&#x2F;en&#x2F;&quot;&gt;Casey Rodarmor, “Just Programmer&#x27;s Manual”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;fabiensanglard.net&#x2F;dc&#x2F;driver.php&quot;&gt;Fabien Sanglard, “Driving Compilers”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;queries&#x2F;incremental-compilation-in-detail.html&quot;&gt;The Rust Project Contributors, “Incremental compilation in detail”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;query.html&quot;&gt;The Rust Project Contributors, “Queries: demand-driven compilation”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;functools.html&quot;&gt;“functools — Higher-order functions and operations on callable objects — Python 3.14.2 documentation”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;buttondown.com&#x2F;hillelwayne&#x2F;archive&#x2F;the-capability-tractability-tradeoff&#x2F;&quot;&gt;Hillel Wayne, “The Capability-Tractability Tradeoff”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;shakebuild.com&#x2F;&quot;&gt;Neil Mitchell, “Shake Build System”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;manual.html&quot;&gt;“The Ninja build system”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;accu.org&#x2F;journals&#x2F;overload&#x2F;14&#x2F;71&#x2F;miller_2004&#x2F;&quot;&gt;Peter Miller, “Recursive Make Considered Harmful”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.unison-lang.org&#x2F;articles&#x2F;distributed-datasets&#x2F;incremental-evaluation&#x2F;&quot;&gt;Rebecca Mark and Paul Chiusano,  “Incremental evaluation via memoization · Unison programming language”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;basics&#x2F;hermeticity&quot;&gt;“Hermeticity  |  Bazel”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;versions&#x2F;7.0.0&#x2F;remote&#x2F;persistent&quot;&gt;“Persistent Workers  |  Bazel”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;concepts&#x2F;labels&quot;&gt;“Labels  |  Bazel”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;reproducible-builds.org&#x2F;docs&#x2F;commandments&#x2F;&quot;&gt;“Commandments of reproducible builds”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;03&#x2F;build-systems.pdf&quot;&gt;Mokhov et. al., Build Systems à la Carte&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;make&#x2F;manual&#x2F;html_node&#x2F;Phony-Targets.html&quot;&gt;“Phony Targets (GNU make)”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;facebook&#x2F;sapling?tab=readme-ov-file&quot;&gt;Facebook, “Sapling: A Scalable, User-Friendly Source Control System.”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.mathematik.uni-marburg.de&#x2F;~seba&#x2F;publications&#x2F;pluto-incremental-build.pdf&quot;&gt;Erdweg et. al., &quot;A Sound and Optimal Incremental Build System with Dynamic Dependencies&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;davidlattimore.github.io&#x2F;posts&#x2F;2024&#x2F;11&#x2F;19&#x2F;designing-wilds-incremental-linking.html&quot;&gt;David Lattimore, “Designing Wild&#x27;s incremental linking”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;lord.io&#x2F;spreadsheets&#x2F;&quot;&gt;Bo Lord, “How to Recalculate a Spreadsheet”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ninja-build&#x2F;ninja&#x2F;blob&#x2F;4b72b15aac766afe6a9a2c0dad535b0c2035a550&#x2F;src&#x2F;depfile_parser.in.cc&quot;&gt;“ninja—&lt;code&gt;depfile_parser&lt;&#x2F;code&gt;”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;salsa-rs.netlify.app&#x2F;&quot;&gt;“salsa - A generic framework for on-demand, incrementalized computation”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;salsa-rs.netlify.app&#x2F;tutorial&#x2F;db&quot;&gt;“Defining the database struct - Salsa”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;2021&#x2F;05&#x2F;10&#x2F;Rust-1.52.1&#x2F;&quot;&gt;Felix Klock and Mark Rousskov on behalf of the Rust compiler team, “Announcing Rust 1.52.1”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.janestreet.com&#x2F;breaking-down-frp&#x2F;&quot;&gt;Yaron Minsky, “Jane Street Blog - Breaking down FRP ”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;react.dev&#x2F;learn&#x2F;adding-interactivity&quot;&gt;“Adding Interactivity – React”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;react.dev&#x2F;learn&#x2F;state-a-components-memory&quot;&gt;“State: A Component&#x27;s Memory – React”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-14&quot;&gt;
&lt;p&gt;Nearly all build systems are inconsistent about whether a rule refers to an &lt;em&gt;abstract description&lt;&#x2F;em&gt; of how to build an output (i.e., can be reused for multiple sets of inputs and outputs), or a &lt;em&gt;concrete instantiation&lt;&#x2F;em&gt; of that description for a specific set of inputs and outputs. We have to live with the ambiguity, unfortunately. &lt;a href=&quot;#fr-14-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-5&quot;&gt;
&lt;p&gt;Weird things can happen here though; for example early cutoff can allow circular dependencies. This sometimes comes up for generated build.ninja files. &lt;a href=&quot;#fr-5-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;The &lt;a href=&quot;https:&#x2F;&#x2F;www.mathematik.uni-marburg.de&#x2F;~seba&#x2F;publications&#x2F;pluto-incremental-build.pdf&quot;&gt;pluto paper&lt;&#x2F;a&gt; defines this as “after a build, generated files consistently reflect the latest source files”. Neither my definition nor pluto&#x27;s definition are particularly well-defined if the build is non-deterministic. Defining this formally would probably require constructing an isomorphism between all programs with the same runtime behavior; but “runtime behavior” is not well-defined for a general-purpose build system that can output artifacts that are not programs. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-7&quot;&gt;
&lt;p&gt;As we&#x27;ll see later, the reverse is also true: a common design for build systems is to automatically inject cache points into an existing task runner, or to design the rule file to look as similar to a shell script or function call as possible. &lt;a href=&quot;#fr-7-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-8&quot;&gt;
&lt;p&gt;In particular, nearly all modern inter-process build systems have a limited form of tracing where they ask the compiler to generate &quot;dep-info&quot; files &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-13-1&quot;&gt;&lt;a href=&quot;#fn-13&quot;&gt;16&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; that show which files were used (usually through imports) by a given source file. Note that this dep-info is not available until after the first time a build has run, and that this only works if the compiler supports it. &lt;a href=&quot;#fr-8-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-15&quot;&gt;
&lt;p&gt;For more information about the spectrum of designs between applicative and monadic, see &lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;the-postmodern-build-system&#x2F;&quot;&gt;the post-modern build system&lt;&#x2F;a&gt;. &lt;a href=&quot;#fr-15-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-9&quot;&gt;
&lt;p&gt;Note that the dev-guide assumes that tasks are expensive relative to the cost of constructing the graph. This is true in the context of rustc, where LLVM codegen &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-10-1&quot;&gt;&lt;a href=&quot;#fn-10&quot;&gt;17&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; normally dominates compilation time, but it isn&#x27;t true for e.g. &lt;a href=&quot;https:&#x2F;&#x2F;lord.io&#x2F;spreadsheets&#x2F;&quot;&gt;spreadsheets&lt;&#x2F;a&gt;. &lt;a href=&quot;#fr-9-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-6&quot;&gt;
&lt;p&gt;It&#x27;s possible for tasks to create files that aren&#x27;t tracked by the build system, but these aren&#x27;t called artifacts. I don&#x27;t know a good word for these; &quot;byproducts&quot; is the closest but some build systems use that to mean &lt;em&gt;any&lt;&#x2F;em&gt; intermediate artifacts. &lt;a href=&quot;#fr-6-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-11&quot;&gt;
&lt;p&gt;I&#x27;m not super happy with this definition because it conflicts with how compilers use the term, but I do think it describes how most build systems think about files. &lt;a href=&quot;#fr-11-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;Poorly written rules can also depend on which other rules are executing at the same time, which is called a &lt;strong&gt;race condition&lt;&#x2F;strong&gt;. Note this does not require the rule to be unsound, only for it to use intermediate files the build system doesn’t know about. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;for C, header files; for other languages, usually source files or intermediate representations. &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-16&quot;&gt;
&lt;p&gt;Yes, this overlaps with the term for sandboxing. Try to avoid the word &quot;isolated&quot; if possible. &lt;a href=&quot;#fr-16-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;This has no relation to a &lt;strong&gt;target platfom&lt;&#x2F;strong&gt;, which is related to cross-compiling. I wish we had better names for these things. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-19&quot;&gt;
&lt;p&gt;I would actually describe this as much harder than tracing an inter-process build system, since &lt;a href=&quot;&#x2F;i-want-a-better-build-executor&#x2F;#environment-variables&quot;&gt;there aren&#x27;t very good systems for tracking memory access&lt;&#x2F;a&gt;. See &lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;2021&#x2F;05&#x2F;10&#x2F;Rust-1.52.1&#x2F;&quot;&gt;this post about unstable fingerprints&lt;&#x2F;a&gt; for an idea of what bugs this causes in practice. &lt;a href=&quot;#fr-19-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-18&quot;&gt;
&lt;p&gt;This actually has very strong analogies to the way &quot;query&quot; is used in a database context: just like a tracing query system, a database has to be able to restart a query&#x27;s transaction if the data it&#x27;s trying to access has been modified. &lt;a href=&quot;#fr-18-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-13&quot;&gt;
&lt;p&gt;What is a dep-info file? Good question! It&#x27;s a makefile. It&#x27;s literally a makefile. Don&#x27;t you just love &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ninja-build&#x2F;ninja&#x2F;blob&#x2F;4b72b15aac766afe6a9a2c0dad535b0c2035a550&#x2F;src&#x2F;depfile_parser.in.cc#L27-L47&quot;&gt;proving backslashes by induction&lt;&#x2F;a&gt;? &lt;a href=&quot;#fr-13-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-10&quot;&gt;
&lt;p&gt;Or, more rarely, type-checking, borrow-checking, or coherence checking. &lt;a href=&quot;#fr-10-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>I want a better build executor</title>
        <published>2025-12-05T00:00:00+00:00</published>
        <updated>2025-12-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/i-want-a-better-build-executor/"/>
        <id>https://jyn.dev/i-want-a-better-build-executor/</id>
        
        <summary type="html">I want a way to gradually transition existing builds to be hermetic.</summary>
        
        <content type="html" xml:base="https://jyn.dev/i-want-a-better-build-executor/">&lt;p&gt;This post is part 4&#x2F;4 of &lt;a href=&quot;&#x2F;four-posts-about-build-systems&#x2F;&quot;&gt;a series about build systems&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;steveklabnik.com&#x2F;writing&#x2F;i-see-a-future-in-jj&#x2F;&quot;&gt;
&lt;p&gt;The market fit is interesting. Git has clearly won, it has all of the mindshare, but since you can use jj to work on Git repositories, it can be adopted incrementally. This is, in my opinion, the only viable way to introduce a new VCS: it has to be able to be partially adopted.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;steveklabnik.com&#x2F;writing&#x2F;i-see-a-future-in-jj&#x2F;&quot;&gt;Steve Klabnik&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=72y2EC5fkcE&quot;&gt;
&lt;p&gt;If you&#x27;ve worked with other determinism-based systems, one thing they have in common is they feel really fragile, and you have to be careful that you don&#x27;t do something that breaks the determinism. But in our case, since we&#x27;ve created every level of the stack to support this, we can offload the determinism to the development environment and you can basically write whatever code you want without having to worry about whether it&#x27;s going to break something.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=72y2EC5fkcE&quot;&gt;Allan Blomquist&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;p&gt;In &lt;a href=&quot;&#x2F;i-want-a-better-action-graph-serialization&#x2F;&quot;&gt;my last post&lt;&#x2F;a&gt;, I describe an improved build graph serialization. In this post, I describe the build executor that reads those files.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-is-a-build-executor&quot;&gt;what is a build executor?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-is-a-build-executor&quot; aria-label=&quot;Anchor link for: what-is-a-build-executor&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Generally, there are three stages to a build:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Resolving and downloading dependencies. The tool that does this is called a &lt;a href=&quot;https:&#x2F;&#x2F;nesbitt.io&#x2F;2025&#x2F;12&#x2F;02&#x2F;what-is-a-package-manager.html&quot;&gt;&lt;strong&gt;package manager&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;. Common examples are &lt;code&gt;npm&lt;&#x2F;code&gt;, &lt;code&gt;pip&lt;&#x2F;code&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;docs.conan.io&#x2F;2&#x2F;index.html&quot;&gt;Conan&lt;&#x2F;a&gt;&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, and the &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;resolver.html&quot;&gt;&lt;code&gt;cargo&lt;&#x2F;code&gt; resolver&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Configuring the build based on the host environment and build targets. I am not aware of any common name for this, other than maybe &lt;strong&gt;configure script&lt;&#x2F;strong&gt; (but there exist many tools for this that are not just shell scripts). Common examples are CMake, Meson, autotools, and the Cargo CLI interface (e.g. &lt;code&gt;--feature&lt;&#x2F;code&gt; and &lt;code&gt;--target&lt;&#x2F;code&gt;).&lt;&#x2F;li&gt;
&lt;li&gt;Executing a bunch of processes and reporting on their progress. The tool that does this is called a &lt;strong&gt;build executor&lt;&#x2F;strong&gt;. Common examples are &lt;code&gt;make&lt;&#x2F;code&gt;, &lt;code&gt;ninja&lt;&#x2F;code&gt;,  &lt;code&gt;docker build&lt;&#x2F;code&gt;, and the &lt;code&gt;Compiling&lt;&#x2F;code&gt; phase of &lt;code&gt;cargo build&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;There are a lot more things an executor can do than just spawning processes and showing a progress report!
This post explores what those are and sketches a design for a tool that could improve on current executors.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;change-detection&quot;&gt;change detection&lt;a class=&quot;zola-anchor&quot; href=&quot;#change-detection&quot; aria-label=&quot;Anchor link for: change-detection&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Ninja depends on &lt;a href=&quot;https:&#x2F;&#x2F;apenwarr.ca&#x2F;log&#x2F;20181113&quot;&gt;mtimes, which have many issues&lt;&#x2F;a&gt;. Ideally, it would take notes from &lt;a href=&quot;https:&#x2F;&#x2F;apenwarr.ca&#x2F;log&#x2F;20181113#:~:text=redo:%20mtime%20dependencies&quot;&gt;&lt;code&gt;redo&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; and look at file attributes, not just the mtime, which eliminates many more false positives.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;querying&quot;&gt;querying&lt;a class=&quot;zola-anchor&quot; href=&quot;#querying&quot; aria-label=&quot;Anchor link for: querying&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I wrote earlier about &lt;a href=&quot;&#x2F;build-system-tradeoffs&#x2F;#reflection&quot;&gt;querying the build graph&lt;&#x2F;a&gt;.
There are two kinds of things you can query: The configuration graph (what bazel calls the &lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;query&#x2F;language&quot;&gt;target graph&lt;&#x2F;a&gt;), which shows dependencies between &quot;human meaningful&quot; packages; and the &lt;a href=&quot;https:&#x2F;&#x2F;bazel.build&#x2F;query&#x2F;aquery&quot;&gt;action graph&lt;&#x2F;a&gt;, which shows dependencies between files.&lt;&#x2F;p&gt;
&lt;p&gt;Queries on the action graph live in the executor; queries on the configuration graph live in the configure script. For example, &lt;code&gt;cargo metadata&lt;&#x2F;code&gt;&#x2F;&lt;code&gt;cargo tree&lt;&#x2F;code&gt;, &lt;code&gt;bazel query&lt;&#x2F;code&gt;, and &lt;code&gt;cmake --graphiz&lt;&#x2F;code&gt; query the configuration graph; &lt;code&gt;ninja -t inputs&lt;&#x2F;code&gt; and &lt;code&gt;bazel aquery&lt;&#x2F;code&gt; query the action graph. Cargo has no stable way to query the action graph.&lt;&#x2F;p&gt;
&lt;p&gt;Note that “querying the graph” is not a binary yes&#x2F;no. Ninja&#x27;s query language is much more restricted than Bazel&#x27;s. Compare Ninja&#x27;s syntax for querying “the command line for all C++ files used to build the target &lt;code&gt;&#x2F;&#x2F;:hello_world&lt;&#x2F;code&gt;” &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ninja&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;t&lt;&#x2F;span&gt; inputs hello_world&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;grep&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;\.c++$&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;xargs&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ninja&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;t&lt;&#x2F;span&gt; targets&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cut&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;d&lt;&#x2F;span&gt; :&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;f&lt;&#x2F;span&gt; 1&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;xargs&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ninja&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;t&lt;&#x2F;span&gt; commands&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;g++ -c -o my_lib.o my_lib.cpp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;g++ -o hello_world hello_world.cpp my_lib.o
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;to Bazel&#x27;s:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;bazel&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; aquery &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;inputs(&amp;quot;.*cpp&amp;quot;, deps(&#x2F;&#x2F;:hello_world))&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;action &amp;#39;Compiling hello_world.cpp&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Mnemonic: CppCompile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Target: &#x2F;&#x2F;:hello_world
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Configuration: k8-fastbuild
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Execution platform: @@platforms&#x2F;&#x2F;host:host
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  ActionKey: 155b2cdb875736efc8d218ea790d2ef9ce698f0b1b1700d58de3c135145b1d12
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Inputs: [external&#x2F;rules_cc++cc_configure_extension+local_config_cc&#x2F;builtin_include_directory_paths, external&#x2F;rules_cc++cc_configure_extension+local_config_cc&#x2F;cc_wrapper.sh, external&#x2F;rules_cc++cc_configure_extension+local_config_cc&#x2F;deps_scanner_wrapper.sh, external&#x2F;rules_cc++cc_configure_extension+local_config_cc&#x2F;validate_static_library.sh, hello_world.cpp, my_lib.h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Outputs: [bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;_objs&#x2F;hello_world&#x2F;hello_world.pic.d, bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;_objs&#x2F;hello_world&#x2F;hello_world.pic.o]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;  Command Line: (exec &#x2F;nix&#x2F;store&#x2F;vr15iyyykg9zai6fpgvhcgyw7gckl78w-gcc-wrapper-14.3.0&#x2F;bin&#x2F;gcc \
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;details&gt;&lt;summary&gt;full command line&lt;&#x2F;summary&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -U_FORTIFY_SOURCE \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -fstack-protector \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -Wall \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -Wunused-but-set-parameter \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -Wno-free-nonheap-object \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -fno-omit-frame-pointer \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;#39;-std=c++17&amp;#39; \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -MD \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -MF \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;_objs&#x2F;hello_world&#x2F;hello_world.pic.d \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;#39;-frandom-seed=bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;_objs&#x2F;hello_world&#x2F;hello_world.pic.o&amp;#39; \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -fPIC \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -iquote \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    . \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -iquote \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    bazel-out&#x2F;k8-fastbuild&#x2F;bin \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -iquote \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    external&#x2F;rules_cc+ \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -iquote \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;external&#x2F;rules_cc+ \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -iquote \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    external&#x2F;bazel_tools \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -iquote \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;external&#x2F;bazel_tools \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -c \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    hello_world.cpp \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -o \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    bazel-out&#x2F;k8-fastbuild&#x2F;bin&#x2F;_objs&#x2F;hello_world&#x2F;hello_world.pic.o \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -fno-canonical-system-headers \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    -Wno-builtin-macro-redefined \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;#39;-D__DATE__=&amp;quot;redacted&amp;quot;&amp;#39; \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;#39;-D__TIMESTAMP__=&amp;quot;redacted&amp;quot;&amp;#39; \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;#39;-D__TIME__=&amp;quot;redacted&amp;quot;&amp;#39;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;details&gt;
&lt;p&gt;Bazel’s language has graph operators, such as union, intersection, and filtering, that let you build up quite complex predicates. Ninja can only express one predicate at a time, with much more limited filtering—but unlike Bazel, allows you to filter to individual parts of the action, like the command line invocation, without needing a full protobuf parser or trying to do text post-processing.&lt;&#x2F;p&gt;
&lt;p&gt;I would like to see a query language that combines both these strengths: the same nested predicate structure of Bazel queries, but add a new &lt;code&gt;emit()&lt;&#x2F;code&gt; predicate that takes another predicate as an argument for complex output filtering:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;emit(commands, inputs(&amp;quot;.*cpp&amp;quot;, deps(.&#x2F;src&#x2F;hello_world)))
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We could even go so far as to give this a jq-like syntax:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;jq&quot; class=&quot;language-jq z-code&quot;&gt;&lt;code class=&quot;language-jq&quot; data-lang=&quot;jq&quot;&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;.&#x2F;src&#x2F;hello_world | deps | inputs &amp;quot;*.c++&amp;quot; | emit commands
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;For more complex predicates that have multiple sets as inputs, such as set union and intersection, we could introduce a &lt;code&gt;subquery&lt;&#x2F;code&gt; operator:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;glob &amp;quot;src&#x2F;**&amp;quot; | except subquery(glob(&amp;quot;src&#x2F;package&#x2F;**&amp;quot;) | executable)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;tracing&quot;&gt;tracing&lt;a class=&quot;zola-anchor&quot; href=&quot;#tracing&quot; aria-label=&quot;Anchor link for: tracing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In &lt;a href=&quot;&#x2F;build-system-tradeoffs&#x2F;&quot;&gt;my previous post&lt;&#x2F;a&gt;, I talked about two main uses for a tracing build system: first, to automatically add dependency edges for you; and second, to verify at runtime that no dependency edges are missing. This especially shines when the action graph has a way to express negative dependencies, because the tracing system &lt;em&gt;sees&lt;&#x2F;em&gt; every attempted file access and can add them to the graph automatically.&lt;&#x2F;p&gt;
&lt;p&gt;For prior art, see the &lt;a href=&quot;https:&#x2F;&#x2F;shakebuild.com&#x2F;&quot;&gt;Shake build system&lt;&#x2F;a&gt;. Shake is higher-level than an executor and doesn&#x27;t work on an action graph, but it has &lt;a href=&quot;https:&#x2F;&#x2F;neilmitchell.blogspot.com&#x2F;2020&#x2F;05&#x2F;file-tracing.html&quot;&gt;built-in support for file tracing&lt;&#x2F;a&gt; in all three of these modes: warning about incorrect edges; adding new edges to the graph when they&#x27;re detected at runtime; and finally, &lt;a href=&quot;https:&#x2F;&#x2F;blogs.ncl.ac.uk&#x2F;andreymokhov&#x2F;stroll&#x2F;&quot;&gt;fully inferring all edges from the nodes alone&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I would want my executor to only support linting and hard errors for missing edges. Inferring a full action graph is scary and IMO belongs in a higher-level tool, and adding dependency edges automatically can be done by a tool that wraps the executor and parses the lints.&lt;&#x2F;p&gt;
&lt;p&gt;What&#x27;s really cool about this linting system is that it allows you to gradually transition to a hermetic build over time, without frontloading all the work to when you switch to the tool.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;The main downside of tracing is that it&#x27;s highly non-portable, and in particular is very limited on macOS.&lt;&#x2F;p&gt;
&lt;p&gt;One possible alternative I&#x27;ve thought of is to do a buck2-style unsandboxed hermetic builds, where you copy exactly the specified inputs into a tempdir and run the build from the tempdir. If that fails, rerun the build from the main source directory. This can&#x27;t tell &lt;em&gt;which&lt;&#x2F;em&gt; dependency edges are missing, but it can tell you &lt;em&gt;a&lt;&#x2F;em&gt; dependency is missing without fully failing the build.&lt;&#x2F;p&gt;
&lt;p&gt;The downside to &lt;em&gt;that&lt;&#x2F;em&gt; is it assumes command spawning is a pure function, which of course it&#x27;s not; anything that talks to a socket is trouble because it might be stateful.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;environment-variables&quot;&gt;environment variables&lt;a class=&quot;zola-anchor&quot; href=&quot;#environment-variables&quot; aria-label=&quot;Anchor link for: environment-variables&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Tracing environment variable access is … hard. Traditionally access goes through the libc &lt;code&gt;getenv&lt;&#x2F;code&gt; function, but it’s also possible to take an &lt;code&gt;envp&lt;&#x2F;code&gt; in a main function, in which case accesses are just memory reads. That means we need to trace memory reads somehow.&lt;&#x2F;p&gt;
&lt;p&gt;On x86 machines, there’s something called &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;77056006&quot;&gt;PIN&lt;&#x2F;a&gt; that can do this directly in the CPU without needing compile time instrumentation. On ARM there’s &lt;a href=&quot;https:&#x2F;&#x2F;developer.arm.com&#x2F;community&#x2F;arm-community-blogs&#x2F;b&#x2F;architectures-and-processors-blog&#x2F;posts&#x2F;statistical-profile-extension&quot;&gt;SPE&lt;&#x2F;a&gt;, which is how &lt;a href=&quot;https:&#x2F;&#x2F;docs.redhat.com&#x2F;en&#x2F;documentation&#x2F;red_hat_enterprise_linux&#x2F;8&#x2F;html&#x2F;monitoring_and_managing_system_status_and_performance&#x2F;profiling-memory-accesses-with-perf-mem_monitoring-and-managing-system-status-and-performance&quot;&gt;&lt;code&gt;perf mem&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; works, but I’m not sure whether it can be configured to track 100% of memory accesses. I need to do more research here.&lt;&#x2F;p&gt;
&lt;p&gt;On Linux, this is all abstracted by &lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;perf_event_open.2.html&quot;&gt;&lt;code&gt;perf_event_open&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. I’m not sure if there’s equivalent wrappers on Windows and macOS.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;There’s also &lt;a href=&quot;https:&#x2F;&#x2F;dynamorio.org&#x2F;#autotoc_md180&quot;&gt;DynamicRIO&lt;&#x2F;a&gt;, which supports a bunch of platforms, but I believe it works in a similar way to QEMU, by interposing itself between the program and the CPU, which comes with a bunch of overhead. That could work as an opt-in.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;One last way to do this is with a &lt;a href=&quot;https:&#x2F;&#x2F;unix.stackexchange.com&#x2F;a&#x2F;532395&quot;&gt;SIGSEGV signal handler&lt;&#x2F;a&gt;, but that requires that environment variables are in their own page of memory and therefore a linker script. This doesn’t work for environment variables specifically, because they &lt;a href=&quot;https:&#x2F;&#x2F;www.owlfolio.org&#x2F;development&#x2F;thread-safe-environment-variable-mutation-working-draft-2022-15&#x2F;&quot;&gt;aren’t linker symbols in the normal sense, they get injected by the C runtime&lt;&#x2F;a&gt;. In general, injecting linker scripts means we’re modifying the binaries being run and might cause unexpected build or runtime failures.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;ronin-a-ninja-successor&quot;&gt;&lt;code&gt;ronin&lt;&#x2F;code&gt;: a ninja successor&lt;a class=&quot;zola-anchor&quot; href=&quot;#ronin-a-ninja-successor&quot; aria-label=&quot;Anchor link for: ronin-a-ninja-successor&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Here I describe more concretely the tool I want to build, which I’ve named &lt;code&gt;ronin&lt;&#x2F;code&gt;. It would read the &lt;a href=&quot;&#x2F;i-want-a-better-action-graph-serialization&#x2F;#designing-a-new-action-graph&quot;&gt;constrained clojure action graph serialization format&lt;&#x2F;a&gt; (Magma) that I describe in the previous post; perhaps with a way to automatically convert Ninja files to Magma.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;interface&quot;&gt;interface&lt;a class=&quot;zola-anchor&quot; href=&quot;#interface&quot; aria-label=&quot;Anchor link for: interface&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;capnproto&#x2F;ekam&#x2F;&quot;&gt;Ekam&lt;&#x2F;a&gt;, Ronin would have a &lt;code&gt;--watch&lt;&#x2F;code&gt; continuous rebuild mode (but unlike Bazel and Buck2, no background server). Like Shake, It would have runtime tracing, with all of &lt;code&gt;--tracing=never|warn|error&lt;&#x2F;code&gt; options, to allow gradually transitioning to a hermetic build. And it would have bazel-like querying for the action graph, both through CLI arguments with an jq syntax and through a programmatic API.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, it would have pluggable backends for file watching, tracing, stat-ing, progress reporting, and checksums, so that it can take advantage of systems that have more features while still being reasonably fast on systems that don’t. For example, on Windows stats are slow, so it would cache stat info; but on Linux stats are fast so it would just directly make a syscall.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;architecture&quot;&gt;architecture&lt;a class=&quot;zola-anchor&quot; href=&quot;#architecture&quot; aria-label=&quot;Anchor link for: architecture&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Like Ninja, Ronin would keep a command log with a history of past versions of the action graph. It would reuse the &lt;a href=&quot;https:&#x2F;&#x2F;neugierig.org&#x2F;software&#x2F;blog&#x2F;2020&#x2F;05&#x2F;ninja.html#:~:text=Some%20architecture%20notes&quot;&gt;bipartite graph structure&lt;&#x2F;a&gt;, with one half being files and the other being commands. It would parse depfiles and dyndeps files just after they’re built, while the cache is still hot.&lt;&#x2F;p&gt;
&lt;p&gt;Like &lt;a href=&quot;https:&#x2F;&#x2F;neugierig.org&#x2F;software&#x2F;blog&#x2F;2022&#x2F;03&#x2F;n2.html&quot;&gt;&lt;code&gt;n2&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, ronin would use a single-pass approach to support early cutoff. It would hash an &quot;input manifest&quot; to decide whether to rebuild. Unlike &lt;code&gt;n2&lt;&#x2F;code&gt;, it would store a mapping from that hash back to the original manifest so you can query why a rebuild happened.&lt;&#x2F;p&gt;
&lt;p&gt;Tracing would be built on top of a FUSE file system that tracked file access. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Unlike other build systems I know, state (such as manifest hashes, content hashes, and removed outputs) would be stored in an SQLite database, not in flat files.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;did-you-just-reinvent-buck2&quot;&gt;did you just reinvent buck2?&lt;a class=&quot;zola-anchor&quot; href=&quot;#did-you-just-reinvent-buck2&quot; aria-label=&quot;Anchor link for: did-you-just-reinvent-buck2&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Kinda. Ronin takes a lot of ideas from buck2. It differs in two major ways:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;It does not expect to be a top-level build system. It is perfectly happy to read (and encourages) generated files from a higher level configure tool. This allows systems like CMake and Meson to mechanically translate Ninja files into this new format, so builds for existing projects can get nice things.&lt;&#x2F;li&gt;
&lt;li&gt;It allows you to gradually transition from non-hermetic to hermetic builds, without forcing you to fix all your rules at once, and with tracing to help you find where you need to make your fixes. Buck2 doesn’t support tracing at all. It technically supports non-hermetic builds, but you don&#x27;t get many benefits compared to using a different build system, and it&#x27;s still high cost to switch build systems &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-buck-correction-1&quot;&gt;&lt;a href=&quot;#fn-buck-correction&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The main advantage of Ronin is that it can slot in underneath existing build systems people are already using—CMake and Meson—without needing changes to your build files at all.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;summary&quot;&gt;summary&lt;a class=&quot;zola-anchor&quot; href=&quot;#summary&quot; aria-label=&quot;Anchor link for: summary&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In this post I describe what a build executor does, some features I would like to see from an executor (with a special focus on tracing), and a design for a new executor called &lt;code&gt;ronin&lt;&#x2F;code&gt; that allows existing projects generating ninja files to gradually transition to hermetic builds over time, without a “flag day” that requires rewriting the whole build system.&lt;&#x2F;p&gt;
&lt;p&gt;I don’t know yet if I will actually build this tool, that seems like a lot of work &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; 😄 but it’s something I would like to exist in the world.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;In many ways Conan &lt;a href=&quot;https:&#x2F;&#x2F;docs.conan.io&#x2F;2&#x2F;tutorial&#x2F;consuming_packages&#x2F;build_simple_cmake_project.html&quot;&gt;profiles&lt;&#x2F;a&gt; are analogous to ninja files: profiles are the interface between Conan and CMake in the same way that ninja files are the interface between CMake and Ninja. Conan is the only tool I&#x27;m aware of where the split between the package manager and the configure step is explicit. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;This is not an apple to apples comparison; ideally we would name the target by the output file, not by its alias. Unfortunately output names are unpredictable and quite long in Bazel. &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;macOS does not have native support for FUSE. &lt;a href=&quot;https:&#x2F;&#x2F;macfuse.github.io&#x2F;&quot;&gt;MacFuse&lt;&#x2F;a&gt; exists but does not &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;macfuse&#x2F;macfuse&#x2F;wiki&#x2F;FUSE-Backends#limitations&quot;&gt;support getting the PID&lt;&#x2F;a&gt; of the calling process. A possible workaround would be to start a new FUSE server for each spawned process group. FUSE on Windows is possible through &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;billziss-gh&#x2F;winfsp&quot;&gt;winfsp&lt;&#x2F;a&gt;. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-buck-correction&quot;&gt;
&lt;p&gt;An earlier version of this post read &quot;Buck2 only supports non-hermetic builds for &lt;a href=&quot;https:&#x2F;&#x2F;buck2.build&#x2F;docs&#x2F;concepts&#x2F;toolchain&#x2F;&quot;&gt;system toolchains&lt;&#x2F;a&gt;, not anything else&quot;, which is not correct. &lt;a href=&quot;#fr-buck-correction-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;what if i simply took buck2 and hacked it to bits,,, &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>I want a better action graph serialization</title>
        <published>2025-12-04T00:00:00+00:00</published>
        <updated>2025-12-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/i-want-a-better-action-graph-serialization/"/>
        <id>https://jyn.dev/i-want-a-better-action-graph-serialization/</id>
        
        <summary type="html">Makefiles and Ninja files have limitations, separate from the implementing tool. How can we fix them?</summary>
        
        <content type="html" xml:base="https://jyn.dev/i-want-a-better-action-graph-serialization/">&lt;p&gt;This post is part 3&#x2F;4 of &lt;a href=&quot;&#x2F;four-posts-about-build-systems&#x2F;&quot;&gt;a series about build systems&lt;&#x2F;a&gt;.
The next post and last post is &lt;a href=&quot;&#x2F;i-want-a-better-build-executor&#x2F;&quot;&gt;I want a better build executor&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;lobste.rs&#x2F;s&#x2F;uwyfpy&#x2F;build_system_tradeoffs#c_ymm0ad&quot;&gt;
&lt;p&gt;As someone who ends up getting the ping on &quot;my build is weird&quot; &lt;em&gt;after&lt;&#x2F;em&gt; it has gone through a round of &quot;poke it with a stick&quot;, I would really appreciate the &lt;em&gt;mechanisms&lt;&#x2F;em&gt; for [correct dependency edges] rolling out sooner rather than later.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite class=username&gt;&lt;a href=&quot;https:&#x2F;&#x2F;lobste.rs&#x2F;s&#x2F;uwyfpy&#x2F;build_system_tradeoffs#c_ymm0ad&quot;&gt;mathstuf&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;h2 id=&quot;what-does-action-graph-mean&quot;&gt;what does &quot;action graph&quot; mean?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-action-graph-mean&quot; aria-label=&quot;Anchor link for: what-does-action-graph-mean&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;build-system-tradeoffs&#x2F;&quot;&gt;a previous post&lt;&#x2F;a&gt;, I talked about various approaches in the design space of build systems. In this post, I want to zero in on one particular area: action graphs.&lt;&#x2F;p&gt;
&lt;p&gt;First, let me define &quot;action graph&quot;. If you&#x27;ve ever used CMake, you may know that there are two steps involved: A &quot;configure&quot; step (&lt;code&gt;cmake -B build-dir&lt;&#x2F;code&gt;) and a build step (&lt;code&gt;make&lt;&#x2F;code&gt; or &lt;code&gt;cmake --build&lt;&#x2F;code&gt;). What I am interested here is what &lt;code&gt;cmake -B&lt;&#x2F;code&gt; &lt;em&gt;generates&lt;&#x2F;em&gt;, the Makefiles it has created. As &lt;a href=&quot;https:&#x2F;&#x2F;neugierig.org&#x2F;software&#x2F;blog&#x2F;2020&#x2F;05&#x2F;ninja.html#:~:text=Related%20work&quot;&gt;the creator of ninja writes&lt;&#x2F;a&gt;, this is a &lt;em&gt;serialization&lt;&#x2F;em&gt; of all build steps at a given moment in time, with the ability to regenerate the graph by rerunning the configure step.&lt;&#x2F;p&gt;
&lt;p&gt;This post explores that design space, with the goal of sketching a format that improves on the current state while also enabling incremental adoption. When I say &quot;design space&quot;, I mean a serialization format where files are machine-generated by a configure step, and have few enough and restricted enough features that it&#x27;s possible to make a fast &lt;a href=&quot;&#x2F;i-want-a-better-build-executor&#x2F;&quot;&gt;build executor&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;who-uses-an-action-graph&quot;&gt;who uses an action graph?&lt;a class=&quot;zola-anchor&quot; href=&quot;#who-uses-an-action-graph&quot; aria-label=&quot;Anchor link for: who-uses-an-action-graph&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Not all build systems serialize their action graph. &lt;code&gt;bazel&lt;&#x2F;code&gt; and &lt;code&gt;buck2&lt;&#x2F;code&gt; run persistent servers that store it in memory and allow querying it, but never serialize it to disk. For large graphs, this requires a lot of memory; &lt;code&gt;blaze&lt;&#x2F;code&gt; has actually started &lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;1A8LMZ21t6Y?si=FiQ6LGdBQ7Y-aQLY&quot;&gt;serializing parts of its graph to reduce memory usage and startup time&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The nix evaluator doesn’t allow querying its graph at all; nix has a very strange model where it never rebuilds because each change to your source files is a new “&lt;a href=&quot;https:&#x2F;&#x2F;nix.dev&#x2F;manual&#x2F;nix&#x2F;2.32&#x2F;store&#x2F;derivation&#x2F;index.html&quot;&gt;input-addressed derivation&lt;&#x2F;a&gt;” and therefore requires a reconfigure. This is the main reason it’s only used to package software, not as an “inner” build system, because that reconfigure can be very slow.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;I’ve talked to a couple Nix maintainers and they’ve considered caching parts of the &lt;em&gt;configure&lt;&#x2F;em&gt; step, without caching its outputs (because there are no outputs, other than derivation files!) in order to speed this up. This is much trickier because it requires serializing parts of the evaluator state.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;Tools that &lt;em&gt;do&lt;&#x2F;em&gt; serialize their graph include CMake, Meson, and the Chrome build system (&lt;a href=&quot;https:&#x2F;&#x2F;gn.googlesource.com&#x2F;gn&#x2F;&quot;&gt;GN&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Generally, serializing the graph comes in handy when:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;You don’t have a persistent server to store it in memory. When you don’t have a server, serializing makes your startup times much faster, because you don’t have to rerun the configure step each time.&lt;&#x2F;li&gt;
&lt;li&gt;You don’t have a remote build cache. When you have a remote cache, the rules for &lt;em&gt;loading&lt;&#x2F;em&gt; that cache can be rather complicated because they involve network queries &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-10-1&quot;&gt;&lt;a href=&quot;#fn-10&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. When you have a local cache, loading it doesn’t require special support because it’s just opening a file.&lt;&#x2F;li&gt;
&lt;li&gt;You want to support querying, process spawning, and progress updates without rewriting the logic yourself for every OS (i.e. you don&#x27;t want to write your own build executor).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;design-goals&quot;&gt;design goals&lt;a class=&quot;zola-anchor&quot; href=&quot;#design-goals&quot; aria-label=&quot;Anchor link for: design-goals&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;In the last post I talked about 4 things one might want from a build system:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;a &quot;real&quot; language in the configuration step&lt;&#x2F;li&gt;
&lt;li&gt;reflection (querying the build graph)&lt;&#x2F;li&gt;
&lt;li&gt;file watching&lt;&#x2F;li&gt;
&lt;li&gt;support for discovering incorrect dependency edges&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;For a serialization format, we have slightly different constraints.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;We care about it being simple and unambiguous to load the graph from the file, so we get fast incremental rebuild speed and graph queries. In particular, we want to touch the filesystem as little as possible while loading.&lt;&#x2F;li&gt;
&lt;li&gt;We care about supporting &quot;weird&quot; dependency edges, like &lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;03&#x2F;build-systems.pdf&quot;&gt;dynamic dependencies&lt;&#x2F;a&gt; and the depfiles emitted by a compiler after the first run, so that we&#x27;re able to support more kinds of builds.&lt;&#x2F;li&gt;
&lt;li&gt;And finally, we care about &lt;em&gt;minimizing reconfigurations&lt;&#x2F;em&gt;: we want to be able to express as many things as possible in the action graph so we don&#x27;t have the pay the cost of rerunning the configure step. This tends to be at odds with fast graph loading; adding features at this level of the stack is very expensive!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Throughout this post, I&#x27;ll dive into detail on how these 3 overarching goals apply to the serialization format, and how well various serializations achieve that goal.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;existing-serializations&quot;&gt;existing serializations&lt;a class=&quot;zola-anchor&quot; href=&quot;#existing-serializations&quot; aria-label=&quot;Anchor link for: existing-serializations&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The first one we&#x27;ll look at, because it&#x27;s the default for CMake, is &lt;code&gt;make&lt;&#x2F;code&gt; and Makefiles. Make is truly in the Unix spirit: easy to implement&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, very hard to use correctly.  Make is &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@adi.ashour&#x2F;stuff-i-learned-about-makefiles-part-2-66d87109b19b#:~:text=beware%20of%20ambiguity&quot;&gt;ambiguous&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@adi.ashour&#x2F;stuff-i-learned-about-makefiles-part-2-66d87109b19b#:~:text==%20vs%20:=&quot;&gt;complicated&lt;&#x2F;a&gt;, and makes it very easy to &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@adi.ashour&#x2F;stuff-i-learned-about-makefiles-part-1-9b85986d7c59#:~:text=pattern%20rules&quot;&gt;implicitly do a bunch of file system lookups&lt;&#x2F;a&gt;. It supports running shell commands at the top-level, which makes even loading the graph very expensive. It does do pretty well on minimizing reconfigurations, since the language is quite flexible.&lt;&#x2F;p&gt;
&lt;p&gt;Ninja is the other generator supported by CMake. Ninja is explicitly intended to work on a serialized action graph; it&#x27;s the only tool I&#x27;m aware of that is. It &lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;manual.html#_comparison_to_make&quot;&gt;solves a lot of the problems of Make&lt;&#x2F;a&gt;: it removes many of the ambiguities; it doesn&#x27;t have any form of globbing; and generally it&#x27;s a much simpler and smaller language. Unfortunately, Ninja&#x27;s build file format still has some limitations.&lt;&#x2F;p&gt;
&lt;p&gt;First, it has no support for checksums. It&#x27;s possible to work around that by using &lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;manual.html#:~:text=re-stat%20the%20command&quot;&gt;&lt;code&gt;restat = true&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; and having a wrapper script that doesn&#x27;t overwrite files unless they&#x27;ve changed, but that&#x27;s a lot of extra work and is annoying to make portable between operating systems.&lt;&#x2F;p&gt;
&lt;p&gt;Ninja files also have trouble expressing correct dependency edges. Let&#x27;s look at a few examples, one by one. In each of these cases, we either have to reconfigure more often than we wish, or we have no way at all of expressing the dependency edge.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;dependency-edge-issues-with-ninja&quot;&gt;dependency edge issues with ninja&lt;a class=&quot;zola-anchor&quot; href=&quot;#dependency-edge-issues-with-ninja&quot; aria-label=&quot;Anchor link for: dependency-edge-issues-with-ninja&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;negative-dependencies&quot;&gt;negative dependencies&lt;a class=&quot;zola-anchor&quot; href=&quot;#negative-dependencies&quot; aria-label=&quot;Anchor link for: negative-dependencies&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;See &lt;a href=&quot;&#x2F;negative-build-dependencies&#x2F;&quot;&gt;my previous post&lt;&#x2F;a&gt; about negative dependencies. The short version is that build files need to specify not just the files they expect to exist, but also the files they expect &lt;em&gt;not&lt;&#x2F;em&gt; to exist. There&#x27;s no way to express this in a ninja file, short of reconfiguring every time a directory that might contain a negative dependency is modified, which itself has a lot of downsides.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;renamed-files&quot;&gt;renamed files&lt;a class=&quot;zola-anchor&quot; href=&quot;#renamed-files&quot; aria-label=&quot;Anchor link for: renamed-files&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Say that you have a C project with just a &lt;code&gt;main.c&lt;&#x2F;code&gt;. You rename it to &lt;code&gt;project.c&lt;&#x2F;code&gt; and ninja gives you an error that main.c no longer exists. Annoyed of editing ninja files by hand, you decide to write a generator&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; :&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; build.py
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ninja_syntax&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;os&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sys&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;os&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;basename&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-import-list z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;splitext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ninja_syntax&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;stdout&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;rule&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;python&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;python $in &amp;gt; $out&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;build&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;build.ninja&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;python&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;build.py&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;implicit&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;.&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;rule&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cc&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cc $in -o $out&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-for z-python&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;path&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-for z-in z-python&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;os&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;listdir&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;.&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-loop z-for z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;base&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;splitext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-statement z-conditional z-if z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-if z-python&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;==&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;.c&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-conditional z-if z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;build&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;base&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cc&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note this that this registers an implicit dependency on the current directory. This should automatically detect that you renamed your file and rebuild for you.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;1] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;2] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;3] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;4] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;5] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;6] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;100] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ninja: error: manifest &amp;#39;build.ninja&amp;#39; still dirty after 100 tries, perhaps system time is not set
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Oh. Right. Generating build.ninja also modifies the current directory, which creates an infinite loop.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s possible to work around this by putting your C file in a source directory:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; build.py
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;build&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;build.ninja&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;python&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;build.py&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;implicit&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;src&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-for z-python&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;path&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-for z-in z-python&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;os&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;listdir&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;src&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-loop z-for z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;base&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;splitext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-statement z-conditional z-if z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-if z-python&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ext&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;==&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;.c&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-conditional z-if z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;writer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;build&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;src&#x2F;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;base&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cc&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;src&#x2F;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;tree&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;├── build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;├── build.py
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;├── main.c
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;├── ninja_syntax.py
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;└── src
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;    └── main.c
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ninja&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[1&#x2F;1] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[1&#x2F;2] cc src&#x2F;main.c -o src&#x2F;main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;mv&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; src&#x2F;&lt;span class=&quot;z-meta z-group z-expansion z-brace z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-separator z-shell&quot;&gt;,&lt;&#x2F;span&gt;project&lt;span class=&quot;z-punctuation z-section z-expansion z-brace z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;.c&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ninja&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[1&#x2F;1] python build.py &amp;gt; build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;[1&#x2F;2] cc src&#x2F;project.c -o src&#x2F;project
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There&#x27;s still a problem here, though—did you notice it?&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ ls src
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;main  project  project.c
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Our old &lt;code&gt;main&lt;&#x2F;code&gt; target is still lying around. Ninja actually has enough information recorded to fix this: &lt;code&gt;ninja -t cleandead&lt;&#x2F;code&gt;. But it&#x27;s not run automatically.&lt;&#x2F;p&gt;
&lt;p&gt;The other problem is that this approach rebuilds far too often. In this case, we wanted to support renames, so in Ninja&#x27;s model we need to depend on the whole directory. But that&#x27;s not what we really depended on—we only care about &lt;code&gt;.c&lt;&#x2F;code&gt; files. I would like to see a action graph format that has an event-based system, where it says &quot;this file was created, make any changes to the action graph necessary&quot;, and cuts the build short if the graph wasn&#x27;t changed.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;optional-file-dependencies&quot;&gt;optional file dependencies&lt;a class=&quot;zola-anchor&quot; href=&quot;#optional-file-dependencies&quot; aria-label=&quot;Anchor link for: optional-file-dependencies&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;For &lt;a href=&quot;https:&#x2F;&#x2F;flower.jyn.dev&#x2F;overlay.html&quot;&gt;flower&lt;&#x2F;a&gt;, I want to go further and support &lt;em&gt;deletions&lt;&#x2F;em&gt;: source files and targets that are optional, that should not fail the build if they aren&#x27;t present, but should cause a rebuild if they are created, modified, or deleted. Ninja has no way of expressing this.&lt;&#x2F;p&gt;
&lt;!--
## deleted depfiles
Ninja has a feature called &quot;depfiles&quot;, where dependency information is not fully known until after the first run of a build edge. It&#x27;s intended for C header files, but can be used for other things. The idea is that the dependency graph might depend on which things you dynamically require inside your source file. To support this, C compilers support `-M` [^5] to emit a `make`-compatible dependency graph for that source file, which ninja will read on the next run.

This can get us into a lot of trouble.

Consider the following C project:

--&gt;
&lt;h3 id=&quot;environment-variables&quot;&gt;environment variables&lt;a class=&quot;zola-anchor&quot; href=&quot;#environment-variables&quot; aria-label=&quot;Anchor link for: environment-variables&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Ninja has no way to express “this node becomes dirty when an environment variable changes”. The closest you can get is hacks with &lt;code&gt;set&lt;&#x2F;code&gt; and the checksum wrapper&#x2F;restat hack, but it’s a pain to express and it gets much worse if you want to depend on multiple variables.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;designing-a-new-action-graph&quot;&gt;designing a new action graph&lt;a class=&quot;zola-anchor&quot; href=&quot;#designing-a-new-action-graph&quot; aria-label=&quot;Anchor link for: designing-a-new-action-graph&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;!-- mention incremental switch, possible to mechanically translate ninja, not meant to be hand-edited --&gt;
&lt;p&gt;At this point, we have a list of constraints for our file format:&lt;&#x2F;p&gt;
&lt;!-- 1. Reflection on the action graph --&gt;
&lt;ol&gt;
&lt;li&gt;Negative dependencies&lt;&#x2F;li&gt;
&lt;li&gt;File rename dependencies&lt;&#x2F;li&gt;
&lt;li&gt;Optional file dependencies&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;!-- 4. Tracing (in both linting and hard error mode) to allow gradually transitioning to a hermetic build --&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;Optional checksums to reduce false positives&lt;&#x2F;li&gt;
&lt;li&gt;Environment variable dependencies&lt;&#x2F;li&gt;
&lt;li&gt;&quot;all the features of ninja&quot; (depfiles, &lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;uploads&#x2F;prod&#x2F;2018&#x2F;03&#x2F;build-systems-final.pdf&quot;&gt;monadic builds&lt;&#x2F;a&gt; through &lt;code&gt;dyndeps&lt;&#x2F;code&gt;&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-14-1&quot;&gt;&lt;a href=&quot;#fn-14&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, a &lt;code&gt;generator&lt;&#x2F;code&gt; statement, order-only dependencies)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;!--
I am not aware of any existing tool that meets these constraints. I&#x27;m considering building one on top of Shake. If anyone knows of prior art in this area, please [let me know](mailto:blog@jyn.dev) :)
--&gt;
&lt;p&gt;Ideally, it would even be possible to mechanically translate existing .ninja files to this new format.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;a-first-try&quot;&gt;a first try&lt;a class=&quot;zola-anchor&quot; href=&quot;#a-first-try&quot; aria-label=&quot;Anchor link for: a-first-try&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This sketches out a new format that could improve over Ninja files. It could look something like this:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;A very very small clojure subset (just &lt;code&gt;def&lt;&#x2F;code&gt;, &lt;code&gt;let&lt;&#x2F;code&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;edn-format&#x2F;edn&quot;&gt;EDN&lt;&#x2F;a&gt;, and function calls) for the text itself, no need to make loading the graph harder than necessary &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-6-1&quot;&gt;&lt;a href=&quot;#fn-6&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. If people really want an equivalent of &lt;code&gt;include&lt;&#x2F;code&gt; or &lt;code&gt;subninja&lt;&#x2F;code&gt; I suppose this could learn support for &lt;code&gt;ns&lt;&#x2F;code&gt; and &lt;code&gt;require&lt;&#x2F;code&gt;, but it would have much simpler rules than Clojure&#x27;s classpath. It would not have support for looping constructs, nor most of clojure&#x27;s standard library.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;redo&lt;&#x2F;code&gt;-inspired dependency edges: &lt;code&gt;ifwritten&lt;&#x2F;code&gt; (for changes in file attributes), &lt;code&gt;ifchanged&lt;&#x2F;code&gt; (for changes in the checksum), &lt;code&gt;ifcreate&lt;&#x2F;code&gt; (for optional dependencies), &lt;code&gt;always&lt;&#x2F;code&gt;; plus our new &lt;code&gt;ifdeleted&lt;&#x2F;code&gt; edge.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;!-- - Get rid of Ninja&#x27;s `rule` statement; it can be replaced with normal functions. --&gt;
&lt;ul&gt;
&lt;li&gt;A &lt;code&gt;dyndeps&lt;&#x2F;code&gt; input function that can be used anywhere a file path can (e.g. in calls to &lt;code&gt;ifwritten&lt;&#x2F;code&gt;) so that the kind of edge does not depend on whether the path is known in advance or not.&lt;&#x2F;li&gt;
&lt;li&gt;Runtime functions that determine whether the configure step needs to be re-run based on file watch events&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-7-1&quot;&gt;&lt;a href=&quot;#fn-7&quot;&gt;6&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. Whether there is actually a file watcher or the build system just calculates a diff on its next invocation is an implementation detail; ideally, one that&#x27;s easy to slot in and out.&lt;&#x2F;li&gt;
&lt;li&gt;“phony” targets would be replaced by a &lt;code&gt;group&lt;&#x2F;code&gt; statement. Groups are sets of targets. Groups cannot be used to avoid “input not found” errors; that niche is filled by &lt;code&gt;ifcreated&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I’d call this language Magma, since it’s the simplest kind of set with closure.&lt;&#x2F;p&gt;
&lt;p&gt;Here&#x27;s a sample action graph in Magma:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;clojure&quot; class=&quot;language-clojure z-code&quot;&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; In Magma, rules are simple functions.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; For each `action` that uses a rule, the function will be called with a list
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; of attributes for that action.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; It returns a description of how to execute the build.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Supported descriptions are:
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; - `:command` (process spawning)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; - `:write` (writes data directly from memory to disk), and
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; - `:read` (reads data directly from disk to memory), and
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; - `:transform` (runs a clojure function on data in memory).
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-def z-clojure&quot;&gt;defn&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-clojure&quot;&gt;cc&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;vars&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;command&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;cc&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;             &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;-MD&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;-MF&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;depfile&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;             &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;-o&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;out&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; `action`s define a build target (here, the file `main`).
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; They must have a `:rule` that states how to execute the build,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; a set  of `:inputs` that must be built before this action is run,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; and a list of `:outputs` that will be created by the `:rule`.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; They may declare a dependency on `:env`ironment variables.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Like in ninja, a `:depfile` may integrate with the compiler to lazily register
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; a dependency on header files.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;action&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;outputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;rule&lt;&#x2F;span&gt; cc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Unlike in ninja, all inputs must state under which conditions the input causes a rerun.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; `:ifwritten` means whenever the file metadata changes.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;ifwritten&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;main.c&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-comma z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-punctuation z-comma z-clojure&quot;&gt;,&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;helper.c&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Like in ninja, `:implicit` is exactly the same as `:inputs`,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; but allows the `:rule` to distinguish which files should be passed to the command.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;implicit&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;ifwritten&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;helper.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;env&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;LIBRARY_PATH&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-comma z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-punctuation z-comma z-clojure&quot;&gt;,&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;C_INCLUDE_PATH&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;depfile&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;main.c.d&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Actions that don&amp;#39;t create a file on disk are allowed.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; This is similar to a &amp;quot;Phony&amp;quot; target in Make, except that you can choose to not always rerun it.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Since there&amp;#39;s no output, we manually specify the name of the action so other actions can depend on it.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;action&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;name&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;docker-image&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;outputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Rules don&amp;#39;t have to be defined separately from actions.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;rule&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-fn z-clojure&quot;&gt;fn&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;_vars&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;command&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;docker&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;build&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;.&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; We choose to trust docker&amp;#39;s own caching here.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; We could instead use `:implicit {:ifwritten [...]}`, but we don&amp;#39;t.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;implicit&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;always&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; A function that filters out paths ending with a trailing slash.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-def z-clojure&quot;&gt;defn&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-clojure&quot;&gt;files&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;paths&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;filter&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-macro z-clojure&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;not&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;str&#x2F;ends-with?&lt;&#x2F;span&gt; % &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&#x2F;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt; paths&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Just a normal clojure variable. We&amp;#39;ll use this as an input later.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-def z-clojure&quot;&gt;def&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-clojure&quot;&gt;tarfile&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;ifwritten&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;example.tar&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; This rule lists all files (excluding directories) inside of a tarfile.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-def z-clojure&quot;&gt;defn&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-clojure&quot;&gt;list-tar-files&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;vars&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; `:rule` can be a list to run multiple rules in a row within the same action.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;command&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;tar&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;-tf&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; This is like a shell redirect, but saves the output to a string in memory instead of to a file.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; The string will be passed to the next rule in the list.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;stdout&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;string&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;   &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; This filters for files, then passes the string to the next rule.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;   &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;transformer&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-fn z-clojure&quot;&gt;fn&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;paths&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;str&#x2F;join&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-clojure&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;files&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;str&#x2F;split&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-macro z-clojure&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-regexp z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-regexp&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; paths&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;   &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Finally, write the transformed data out to disk.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;   &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;write&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;outputs&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Generate a list of all files that will be created by extracting the tarfile.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;action&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;outputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;example.tar.dd&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;rule&lt;&#x2F;span&gt; list-tar-files
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; tarfile&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; `dynout` returns a future which `action` will resolve.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-def z-clojure&quot;&gt;def&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-clojure&quot;&gt;tar-outputs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;dynout&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Recalculate the dependencies whenever our .dd file changes.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Note that unlike `ifwritten`, `ifchanged` calculates a checksum, it doesn&amp;#39;t use file metadata.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;ifchanged&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;example.tar.dd&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;    &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;rule&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-fn z-clojure&quot;&gt;fn&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;vars&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;read&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;                      &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Our future resolves to a list of file paths.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;                      &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;transformer&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-macro z-clojure&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;str&#x2F;split&lt;&#x2F;span&gt; % &lt;span class=&quot;z-keyword z-operator z-macro z-clojure&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-regexp z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-regexp&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Dynamically add the outputs from the tarfile to the action graph.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; This schedules the action to run only after the `dynout` future is resolved.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;action&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;outputs&lt;&#x2F;span&gt; tar-outputs
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; tarfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;rule&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-fn z-clojure&quot;&gt;fn&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;vars&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;command&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;tar&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;-xf&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; vars&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Group together many different actions.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; This can be called from the command line as if it were its own action.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;group&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;all&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;concat&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; docker-image&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt; tar-outputs&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Specify that the configure script shold rerun whenever a `.c` file is created or deleted.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-def z-clojure&quot;&gt;defn&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-clojure&quot;&gt;should-rerun&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;event&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;and&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;ends-with?&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;path&lt;&#x2F;span&gt; event&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;.c&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;       &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;not=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;modified&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;kind&lt;&#x2F;span&gt; event&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-clojure&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-function z-clojure&quot;&gt;action&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;outputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;build.magma&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;rule&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;command&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;python&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;configure.py&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Indicate that these outputs shouldn&amp;#39;t be deleted by `clean` rules.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;generator&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-clojure&quot;&gt;true&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;env&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-clojure&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;CFLAGS&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-comma z-clojure&quot;&gt;&lt;span class=&quot;z-comment z-punctuation z-comma z-clojure&quot;&gt;,&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;LDFLAGS&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-clojure&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; Register a function that will run on each change to the current directory
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-comment z-line z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment&quot;&gt;;&lt;&#x2F;span&gt; and instruct whether or not the input should cause a rebuild.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-clojure&quot;&gt;  &lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;inputs&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-keyword z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-keyword z-clojure&quot;&gt;:&lt;&#x2F;span&gt;watch&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-braces z-begin z-clojure&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-clojure&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;.&lt;span class=&quot;z-punctuation z-definition z-string z-end z-clojure&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; should-rerun&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-clojure&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-clojure&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note some things about Magma:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Command spawning is specified as an array &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-12-1&quot;&gt;&lt;a href=&quot;#fn-12&quot;&gt;7&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. No more dependency on shell quoting rules. If people want shell scripts they can put that in their configure script.&lt;&#x2F;li&gt;
&lt;li&gt;Redirecting stdout no longer requires bash syntax, it&#x27;s supported natively with the &lt;code&gt;:stdout&lt;&#x2F;code&gt; parameter of &lt;code&gt;:rule&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Build parameters can be referred to in rules through the &lt;code&gt;vars&lt;&#x2F;code&gt; argument.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;dynout&lt;&#x2F;code&gt; is a &lt;a href=&quot;https:&#x2F;&#x2F;wiki.haskell.org&#x2F;Thunk&quot;&gt;thunk&lt;&#x2F;a&gt;; it only registers an intent to add edges in the future, it does not eagerly require &lt;code&gt;example.tar.dd&lt;&#x2F;code&gt; to exist.&lt;&#x2F;li&gt;
&lt;li&gt;Our &lt;code&gt;watch&lt;&#x2F;code&gt; input edge is generalized and can apply to any rule, not just to the configure step. It executes when a file is modified (or if the tool doesn’t support file watching, on each file in the calculated diff in the next tool invocation).&lt;&#x2F;li&gt;
&lt;li&gt;Our &lt;code&gt;watch&lt;&#x2F;code&gt; edge provides the file event type, but not the file contents. This allows ronin to automatically map &lt;code&gt;true&lt;&#x2F;code&gt; results to one of the three edge kinds: &lt;code&gt;:ifwritten&lt;&#x2F;code&gt;, &lt;code&gt;:ifcreated&lt;&#x2F;code&gt;, &lt;code&gt;:ifdeleted&lt;&#x2F;code&gt;. &lt;code&gt;:always&lt;&#x2F;code&gt; and &lt;code&gt;:ifchanged&lt;&#x2F;code&gt; are not available through this API.&lt;&#x2F;li&gt;
&lt;li&gt;We naturally distinguish between “phony targets” and files because the former are &lt;code&gt;group&lt;&#x2F;code&gt;s and the latter are &lt;code&gt;action&lt;&#x2F;code&gt;s. No more accidentally failing to build if an &lt;code&gt;all&lt;&#x2F;code&gt; file is created. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-13-1&quot;&gt;&lt;a href=&quot;#fn-13&quot;&gt;8&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;li&gt;
&lt;li&gt;We naturally distinguish between “groups of targets” and “commands that always need to be rerun”; the latter just uses &lt;code&gt;:inputs :always&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Data can be transformed in memory using clojure functions without needing a separate process invocation. No more need to use &lt;code&gt;sed&lt;&#x2F;code&gt; in your build system.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;!--
- Our `group` cannot actually be used in a `:inputs` parameter because it doesn’t specify the kind of edge (created&#x2F;modified&#x2F;deleted). Our mini-clojure provides other abstractions, like variables; arrays; and `map`, that render this unnecessary.
--&gt;
&lt;h3 id=&quot;did-you-just-reinvent-starlark&quot;&gt;&quot;did you just reinvent &lt;a href=&quot;https:&#x2F;&#x2F;starlark-lang.org&#x2F;&quot;&gt;starlark&lt;&#x2F;a&gt;?&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#did-you-just-reinvent-starlark&quot; aria-label=&quot;Anchor link for: did-you-just-reinvent-starlark&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Kinda. Magma itself has a lot in common with Starlark: it&#x27;s deterministic, hermetic, immutable, and can be evaluated in parallel.&lt;&#x2F;p&gt;
&lt;p&gt;The main difference between the languages themselves is that Clojure has &lt;code&gt;:keywords&lt;&#x2F;code&gt; (equivalent to sympy symbolic variables) and Python doesn&#x27;t. Some of these could be rewritten to keyword arguments, and others could be rewritten to structs, or string keys for a hashmap, or enums; but I&#x27;m not sure how much benefit there is to literally using Starlark when these files are being generated by a configure step in any case. Probably it&#x27;s possible to make a 1-1 mapping between the two in any case.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;runners&quot;&gt;runners&lt;a class=&quot;zola-anchor&quot; href=&quot;#runners&quot; aria-label=&quot;Anchor link for: runners&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Buck2 has support for &lt;a href=&quot;https:&#x2F;&#x2F;buck2.build&#x2F;docs&#x2F;api&#x2F;build&#x2F;RunInfo&#x2F;&quot;&gt;&lt;code&gt;RunInfo&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; metadata that describes how to execute a built artifact. I think this is really interesting; &lt;code&gt;cargo run --bin xyz -- args&lt;&#x2F;code&gt; is a much nicer interface than &lt;code&gt;make ARGS=&#x27;args&#x27; xyz&lt;&#x2F;code&gt;, partly because of shell quoting and word splitting issues, and partly just because it&#x27;s more discoverable.&lt;&#x2F;p&gt;
&lt;p&gt;I don&#x27;t have a clean idea for how to fit this into a serialization layer. &quot;Don&#x27;t put it there and use a &lt;code&gt;Justfile&lt;&#x2F;code&gt; instead&quot; &lt;em&gt;works&lt;&#x2F;em&gt;, but makes it hard to do things like allow the build graph to say that an artifact needs &lt;code&gt;LD_LIBRARY_PATH&lt;&#x2F;code&gt; set or something like that, you end up duplicating the info in both files. Perhaps one option could be to attach a &lt;code&gt;:run&lt;&#x2F;code&gt; key&#x2F;value pair to &lt;code&gt;action&lt;&#x2F;code&gt;s.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;are-you-just-piling-a-bunch-of-features-on-top-of-ninja&quot;&gt;&quot;are you just piling a bunch of features on top of ninja?&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#are-you-just-piling-a-bunch-of-features-on-top-of-ninja&quot; aria-label=&quot;Anchor link for: are-you-just-piling-a-bunch-of-features-on-top-of-ninja&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Well, yes and no. Yes, in that this has basically all the features of ninja and then some.
But no, because the rules here are all carefully constrained to avoid needing to do expensive file I&#x2F;O to load the build graph.
The most expensive new feature is &lt;code&gt;watch&lt;&#x2F;code&gt;, and it&#x27;s intended to avoid an even more expensive step (rerunning the configuration step).
It&#x27;s also limited to changed files; it can&#x27;t do arbitrary globbing on the contents of the directory the way that Make pattern rules can.&lt;&#x2F;p&gt;
&lt;p&gt;Note that this also removes some features in ninja: shell commands are gone, process spawning is much less ambiguous, &lt;code&gt;dyndep&lt;&#x2F;code&gt; files are no longer parsed automatically.
And because this embeds a clojure interpreter, many things that were hard-coded in ninja can instead be library functions: &lt;code&gt;rule&lt;&#x2F;code&gt;, response files, &lt;code&gt;msvc_deps_prefix&lt;&#x2F;code&gt;, &lt;code&gt;in_newline&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;next-steps&quot;&gt;next steps&lt;a class=&quot;zola-anchor&quot; href=&quot;#next-steps&quot; aria-label=&quot;Anchor link for: next-steps&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In this post, we have learned some downsides of Make and Ninja&#x27;s build file formats, sketched out how they could possibly be fixed, and designed a language called Magma that has those characteristics. In the next post, I&#x27;ll describe the features and design of a tool that evaluates and queries this language.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-10&quot;&gt;
&lt;p&gt;see e.g. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;facebook&#x2F;buck2&#x2F;issues&#x2F;976#issuecomment-3007201092&quot;&gt;this description&lt;&#x2F;a&gt; of how it works in buck2 &lt;a href=&quot;#fr-10-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;at least a basic version—although several of the features of GNU Make get rather complicated. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;&lt;code&gt;ninja_syntax.py&lt;&#x2F;code&gt; is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ninja-build&#x2F;ninja&#x2F;blob&#x2F;231db65ccf5427b16ff85b3a390a663f3c8a479f&#x2F;misc&#x2F;ninja_syntax.py&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;ninja-build&#x2F;ninja&#x2F;blob&#x2F;231db65ccf5427b16ff85b3a390a663f3c8a479f&#x2F;misc&#x2F;ninja_syntax.py&lt;&#x2F;a&gt;. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-14&quot;&gt;
&lt;p&gt;technically these aren&#x27;t true monadic builds because they&#x27;re constrained a lot more than e.g. Shake rules, they can&#x27;t fabricate new rules from whole cloth. but they still allow you to add more outputs to the graph at runtime. &lt;a href=&quot;#fr-14-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-6&quot;&gt;
&lt;p&gt;This goes all the way around &lt;a href=&quot;https:&#x2F;&#x2F;mikehadlow.blogspot.com&#x2F;2012&#x2F;05&#x2F;configuration-complexity-clock.html&quot;&gt;the configuration complexity clock&lt;&#x2F;a&gt; and skips the &quot;DSL&quot; phase to simply give you a real language. &lt;a href=&quot;#fr-6-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-7&quot;&gt;
&lt;p&gt;This is totally based and not at all a terrible idea. &lt;a href=&quot;#fr-7-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-12&quot;&gt;
&lt;p&gt;This has a whole bunch of problems on Windows, where arguments are passed as a single string instead of an array, and each command has to reimplement its own parsing. But it will work “most” of the time, and at least avoids having to deal with Powershell or CMD quoting. &lt;a href=&quot;#fr-12-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-13&quot;&gt;
&lt;p&gt;To make it possible to distinguish the two on the command line, &lt;code&gt;:all&lt;&#x2F;code&gt; could unambiguously refer to the group, like in Bazel. &lt;a href=&quot;#fr-13-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>negative build dependencies</title>
        <published>2025-12-03T00:00:00+00:00</published>
        <updated>2025-12-03T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/negative-build-dependencies/"/>
        <id>https://jyn.dev/negative-build-dependencies/</id>
        
        <summary type="html">A build system needs to know not just which files exist, but which shouldn&#x27;t exist.</summary>
        
        <content type="html" xml:base="https://jyn.dev/negative-build-dependencies/">&lt;p&gt;This post is part 2&#x2F;4 of &lt;a href=&quot;&#x2F;four-posts-about-build-systems&#x2F;&quot;&gt;a series about build systems&lt;&#x2F;a&gt;.
The next post is &lt;a href=&quot;&#x2F;i-want-a-better-action-graph-serialization&#x2F;&quot;&gt;I want a better action graph serialization&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;This post is about a limitation of the dependencies you can express in a build file.
It uses Ninja just because it&#x27;s simple and I&#x27;m very familiar with it, but the problem exists in most build systems.&lt;&#x2F;p&gt;
&lt;p&gt;Say you have a C project with two different include paths: &lt;code&gt;dependency&#x2F;include&lt;&#x2F;code&gt; and &lt;code&gt;src&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;├── build.ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;├── dependency
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;│   └── include
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;│       └── interface.h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;└── src
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    └── main.c
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and the following build.ninja:&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-depfiles-1&quot;&gt;&lt;a href=&quot;#fn-depfiles&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ninja&quot; class=&quot;language-ninja z-code&quot;&gt;&lt;code class=&quot;language-ninja&quot; data-lang=&quot;ninja&quot;&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;rule cc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  command = cc -I dependency&#x2F;include -I src $in -o $out
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;build src&#x2F;main: cc src&#x2F;main.c | dependency&#x2F;include&#x2F;interface.h
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;In ninja, &lt;code&gt;| file&lt;&#x2F;code&gt; means an “implicit dependency”, i.e. it causes a rebuild but does not get bound to &lt;code&gt;$in&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;and some small implementations, just so we can see that it actually works:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; src&#x2F;main.c
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-include z-c&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-include z-c&quot;&gt;#include&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-other z-lt-gt z-include z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;stdio.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-include z-c&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-include z-c&quot;&gt;#include&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-include z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;interface.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;void&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-support z-function z-C99 z-c&quot;&gt;printf&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-c&quot;&gt;%d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-c&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; interface_version&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; dependency&#x2F;include&#x2F;interface.h
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-c&quot;&gt;const&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-c&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;short&lt;&#x2F;span&gt; interface_version &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This works ok on our first build, and when &lt;code&gt;dependency&#x2F;include&#x2F;interface.h&lt;&#x2F;code&gt; changes:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ ninja
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;1] cc -I dependency&#x2F;include -I src src&#x2F;main.c -o src&#x2F;main
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;But say now that we add our own &lt;code&gt;src&#x2F;interface.h&lt;&#x2F;code&gt; file:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cat&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; src&#x2F;interface.h&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;const static char *version = &amp;quot;1.0&amp;quot;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ninja&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;ninja: no work to do.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now we have a problem. If we remove our build artifacts, ninja &lt;em&gt;does&lt;&#x2F;em&gt; rerun, and shows us what that problem is:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[1&#x2F;1] cc -I dependency&#x2F;include -I src src&#x2F;main.c -o src&#x2F;main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;FAILED: [code=1] src&#x2F;main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cc -I dependency&#x2F;include -I src src&#x2F;main.c -o src&#x2F;main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;main.c: In function ‘main’:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;main.c:5:24: error: ‘interface_version’ undeclared (first use in this function)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    5 |         printf(&amp;quot;%d\n&amp;quot;, interface_version);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      |                        ^~~~~~~~~~~~~~~~~
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;main.c:5:24: note: each undeclared identifier is reported only once for each function it appears in
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ninja: build stopped: subcommand failed.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We switched out what &lt;code&gt;interface.h&lt;&#x2F;code&gt; resolved to, but ninja didn&#x27;t know about the changed dependency.&lt;&#x2F;p&gt;
&lt;p&gt;What we want is a way to tell it to rebuild if the file &lt;code&gt;src&#x2F;interface.h&lt;&#x2F;code&gt; is created. To my knowledge, ninja has no way of expressing this kind of negative dependency edge.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;One possibility is to depend on the &lt;em&gt;whole directory&lt;&#x2F;em&gt; of &lt;code&gt;src&lt;&#x2F;code&gt;. The semantics of this are that &lt;code&gt;src&lt;&#x2F;code&gt; gets marked dirty whenever a file is added, moved, or deleted. This has two problems:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;It rebuilds too often. We only want to rerun when &lt;code&gt;src&#x2F;interface.h&lt;&#x2F;code&gt; is added, not for any other file creation.&lt;&#x2F;li&gt;
&lt;li&gt;We don’t actually have a consistent way to find all directories that need to be marked in this way. Here we just hardcoded src, but in larger builds &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;negative-build-dependencies&#x2F;#fn-depfiles&quot;&gt;we would use depfiles&lt;&#x2F;a&gt;, and depfiles do not contain any information about negative dependencies. This matters a lot when there are a dozen+ directories in the search path!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;Another way to avoid needing negative dependencies is to simply have a &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;build-system-tradeoffs&#x2F;#hermetic-builds&quot;&gt;hermetic build&lt;&#x2F;a&gt;, so that our &lt;code&gt;cc src&#x2F;main.c | dependency&#x2F;interface.h&lt;&#x2F;code&gt; rule never even makes the &lt;code&gt;src&#x2F;interface.h&lt;&#x2F;code&gt; file available to the command. That works, but puts us firmly out of Ninja&#x27;s design space; hermetic builds come with severe tradeoffs.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;Yet another idea is to introduce an early-cutoff point:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;For each &lt;code&gt;.c&lt;&#x2F;code&gt; file, run &lt;code&gt;cc -M&lt;&#x2F;code&gt; to get a list of include files. Save that to disk.&lt;&#x2F;li&gt;
&lt;li&gt;Whenever a directory is changed, rerun &lt;code&gt;cc -M&lt;&#x2F;code&gt;. If our list has changed, rerun a full build for that file.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;style&gt;var { font-family: monospace; font-style: inherit; }&lt;&#x2F;style&gt;
&lt;p&gt;This has the problem that it&#x27;s &lt;var&gt;O(n&lt;sup&gt;3&lt;&#x2F;sup&gt;)&lt;&#x2F;var&gt;: For each file, for each include, for each directory in the search path, the preprocessor will try to &lt;code&gt;stat&lt;&#x2F;code&gt; that file to see whether it exists.&lt;&#x2F;p&gt;
&lt;p&gt;One possible workaround is to calculate the list of include files &lt;em&gt;in the build system&lt;&#x2F;em&gt;:
Look at the order of the search paths, list each path recursively, ignore filenames that are overridden by an include earlier in the search path.
Save that to disk.
Next time a directory is modified, check if the list of include files has changed. If so, only then rerun &lt;code&gt;cc -M&lt;&#x2F;code&gt; for all files.&lt;&#x2F;p&gt;
&lt;p&gt;This requires the build system to have some quite deep knowledge of how the language works, but I do think it would work today without changes to Ninja.&lt;&#x2F;p&gt;
&lt;p&gt;Thanks to &lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&quot;&gt;Jade Lovelace&lt;&#x2F;a&gt; for this suggestion.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;Thanks to David Chisnall and Ben Boeckel (&lt;strong&gt;@mathstuf&lt;&#x2F;strong&gt;) for making me aware of this issue.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-depfiles&quot;&gt;
&lt;p&gt;People familiar with ninja might say this looks odd and it should use a &lt;code&gt;depfile&lt;&#x2F;code&gt; with &lt;code&gt;cc -M&lt;&#x2F;code&gt; so dependencies are tracked automatically. That makes your files shorter and means you need to run the configure step less often, but it doesn&#x27;t actually solve the problem of negative dependencies. Ninja still doesn&#x27;t know when it needs to regenerate the depfile. &lt;a href=&quot;#fr-depfiles-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>brownouts reveal system boundaries</title>
        <published>2025-11-19T00:00:00+00:00</published>
        <updated>2025-11-19T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/brownouts-reveal-system-boundaries/"/>
        <id>https://jyn.dev/brownouts-reveal-system-boundaries/</id>
        
        <summary type="html">You have backups for your critical data. Do you have backups for your critical infrastructure?</summary>
        
        <content type="html" xml:base="https://jyn.dev/brownouts-reveal-system-boundaries/">&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;www.newyorkfed.org&#x2F;banking&#x2F;circulars&#x2F;10923.html&quot;&gt;
&lt;p&gt;One of the many basic tenets of internal control is that a banking organization ensure that employees in sensitive positions be absent from their duties for a minimum of two consecutive weeks. Such a requirement enhances the viability of a sound internal control environment because most frauds or embezzlements require the continual presence of the wrongdoer.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.newyorkfed.org&#x2F;banking&#x2F;circulars&#x2F;10923.html&quot;&gt;Federal Reserve Bank of New York&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;how.complexsystems.fail&#x2F;#18&quot;&gt;
&lt;p&gt;Failure free operations require experience with failure.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;how.complexsystems.fail&#x2F;#18&quot;&gt;How Complex Systems Fail&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;h2 id=&quot;uptime&quot;&gt;uptime&lt;a class=&quot;zola-anchor&quot; href=&quot;#uptime&quot; aria-label=&quot;Anchor link for: uptime&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Yesterday, &lt;a href=&quot;https:&#x2F;&#x2F;blog.cloudflare.com&#x2F;18-november-2025-outage&#x2F;&quot;&gt;Cloudflare&lt;&#x2F;a&gt;’s global edge network was down across the world. This post is not about why that happened or how to prevent it. It’s about the fact that this was inevitable. Infinite uptime &lt;a href=&quot;https:&#x2F;&#x2F;how.complexsystems.fail&#x2F;&quot;&gt;does not exist&lt;&#x2F;a&gt;. If your business relies on it, sooner or later, you will get burned.&lt;&#x2F;p&gt;
&lt;p&gt;Cloudflare’s &lt;a href=&quot;https:&#x2F;&#x2F;blog.cloudflare.com&#x2F;details-of-the-cloudflare-outage-on-july-2-2019&#x2F;&quot;&gt;last global edge outage&lt;&#x2F;a&gt; was on July 2, 2019. They were down yesterday for about 3 hours (with a long tail extending about another 2 and a half hours). That’s an uptime of 99.99995% over the last 6 years.&lt;&#x2F;p&gt;
&lt;p&gt;Hyperscalers like Cloudflare, AWS, and Google try very very hard to always be available, to never fail. This makes it easy to intertwine them in your architecture, so deeply you don’t even know where. This is great for their business. I used to work at Cloudflare, and being intertwined like this is one of their explicit goals.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;system-boundaries&quot;&gt;system boundaries&lt;a class=&quot;zola-anchor&quot; href=&quot;#system-boundaries&quot; aria-label=&quot;Anchor link for: system-boundaries&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;My company does consulting, and one of our SaaS tools is a time tracker. It was down yesterday because it relied on Cloudflare. I didn’t even know until it failed! Businesses certainly don’t publish their providers on their homepage. The downtime exposes dependencies that were previously hidden.&lt;&#x2F;p&gt;
&lt;p&gt;This is especially bad for “cascading” dependencies, where a partner of a partner of a partner has a dependency on a hyperscaler you didn’t know about. Failures like this really happen in real life; &lt;a href=&quot;https:&#x2F;&#x2F;www.bloomberg.com&#x2F;opinion&#x2F;articles&#x2F;2024-11-25&#x2F;synapse-still-can-t-find-its-money&quot;&gt;Matt Levine writes&lt;&#x2F;a&gt; about one such case where a spectacular failure in a fintech caused thousands of families to lose their life savings.&lt;&#x2F;p&gt;
&lt;p&gt;What I want to do here is make a case that cascading dependencies are bad for you, the business depending on them. Not just because you go down whenever everyone else goes down, but because depending on infinite uptime &lt;a href=&quot;https:&#x2F;&#x2F;danluu.com&#x2F;postmortem-lessons&quot;&gt;hides error handling issues in your own architecture&lt;&#x2F;a&gt;. By making failures frequent enough to be normal, organizations are forced to design and practice their backup plans.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;backup-plans&quot;&gt;backup plans&lt;a class=&quot;zola-anchor&quot; href=&quot;#backup-plans&quot; aria-label=&quot;Anchor link for: backup-plans&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Backup plans don’t require running your own local cloud. My blog is proxied through cloudflare; my backup plan could be “failover DNS from cloudflare to github when cloudflare is down”.&lt;&#x2F;p&gt;
&lt;p&gt;Backup plans don’t have to be complicated. A hospital ER could have a backup plan of “keep patient records for everyone currently in the hospital downloaded to an offline backup  sitting in a closet somewhere”, or even just “keep a printed copy next to the hospital bed”.&lt;&#x2F;p&gt;
&lt;p&gt;The important thing here is to have &lt;em&gt;a&lt;&#x2F;em&gt; backup plan, to not just blithely assume that “the internet” is a magic and reliable thing.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;testing-your-backups&quot;&gt;testing your backups&lt;a class=&quot;zola-anchor&quot; href=&quot;#testing-your-backups&quot; aria-label=&quot;Anchor link for: testing-your-backups&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;One way to avoid uptime reliance is brownouts, where services are down or only partially available for a predetermined amount of time. Google intentionally brownouts their internal infrastructure so that nothing relies on another service being up 100% at the time&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. This forces errors to be constantly tested, and exposes dependency cycles.&lt;&#x2F;p&gt;
&lt;p&gt;Another way is Chaos Monkey, pioneered at Netflix, where random things just break and you don’t know which ahead of time. This requires a lot of confidence in your infrastructure, but reveals kinds of failures you didn’t even think were possible.&lt;&#x2F;p&gt;
&lt;p&gt;I would like to see a model like this for the Internet, where all service providers are required to have at least 24 hours of outages in a year. This is a bit less than 3 nines of uptime (about 5 minutes a day): enough that the service is usually up, but not so much that you can depend on it to always be up.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;it-could-happen-here&quot;&gt;it could happen here&lt;a class=&quot;zola-anchor&quot; href=&quot;#it-could-happen-here&quot; aria-label=&quot;Anchor link for: it-could-happen-here&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In my experience, and &lt;a href=&quot;https:&#x2F;&#x2F;ferd.ca&#x2F;notes&#x2F;paper-the-failure-gap.html&quot;&gt;according to studies about failure reporting&lt;&#x2F;a&gt;, both people and organizations tend to chronically underestimate tail risks. Maybe you’re just a personal site and you don’t need 100% reliability. That’s ok. But if other people depend on you, and others depend on them, and again, eventually we end up with hospitals and fire stations and water treatment plants depending on the internet. The only way I see to prevent this is to make the internet &lt;em&gt;unreliable&lt;&#x2F;em&gt; enough that they need a backup plan.&lt;&#x2F;p&gt;
&lt;p&gt;People fail. Organizations fail. You can’t control them. What you can control is whether you make them a single point of failure.&lt;&#x2F;p&gt;
&lt;p&gt;You have backups for your critical data. Do you have backups for your critical infrastructure?&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;Of course, they don&#x27;t brown-out their external-facing infra. That would lose them customers. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>the terminal of the future</title>
        <published>2025-11-11T00:00:00+00:00</published>
        <updated>2025-11-11T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/the-terminal-of-the-future/"/>
        <id>https://jyn.dev/the-terminal-of-the-future/</id>
        
        <summary type="html">To redesign infrastructure, you have to allow incremental adoption, while simultaneously moving the whole design space at once.</summary>
        
        <content type="html" xml:base="https://jyn.dev/the-terminal-of-the-future/">&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;06&#x2F;24&#x2F;new-zine--the-secret-rules-of-the-terminal&#x2F;&quot;&gt;
&lt;p&gt;Terminal internals are a mess. A lot of it is just the way it is because someone made a decision in the 80s and now it’s impossible to change.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;06&#x2F;24&#x2F;new-zine--the-secret-rules-of-the-terminal&#x2F;&quot;&gt;Julia Evans&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;www.destroyallsoftware.com&#x2F;talks&#x2F;a-whole-new-world&quot;&gt;
&lt;p&gt;This is what you have to do to redesign infrastructure. Rich [Hickey] didn&#x27;t just pile some crap on top of Lisp [when building Clojure]. He took the entire Lisp and moved the whole design at once.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.destroyallsoftware.com&#x2F;talks&#x2F;a-whole-new-world&quot;&gt;Gary Bernhardt&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;h2 id=&quot;a-mental-model-of-a-terminal&quot;&gt;a mental model of a terminal&lt;a class=&quot;zola-anchor&quot; href=&quot;#a-mental-model-of-a-terminal&quot; aria-label=&quot;Anchor link for: a-mental-model-of-a-terminal&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;At a very very high level, a terminal has four parts:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;The &quot;&lt;a href=&quot;https:&#x2F;&#x2F;wizardzines.com&#x2F;comics&#x2F;meet-the-terminal-emulator&#x2F;&quot;&gt;terminal emulator&lt;&#x2F;a&gt;&quot;, which is a program that renders a grid-like structure to your graphical display.&lt;&#x2F;li&gt;
&lt;li&gt;The &quot;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2022&#x2F;07&#x2F;20&#x2F;pseudoterminals&#x2F;&quot;&gt;pseudo-terminal&lt;&#x2F;a&gt;&quot; (PTY), which is a connection between the terminal emulator and a &quot;process group&quot; which receives input. This is not a program. This is a piece of state in the kernel.&lt;&#x2F;li&gt;
&lt;li&gt;The &quot;shell&quot;, which is a program that leads the &quot;process group&quot;, reads and parses input, spawns processes, and generally acts as an event loop. Most environments use &lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2017&#x2F;03&#x2F;26&#x2F;bash-quirks&#x2F;&quot;&gt;bash&lt;&#x2F;a&gt; as the default shell.&lt;&#x2F;li&gt;
&lt;li&gt;The programs spawned by your shell, which interact with all of the above in order to receive input and send output.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;I lied a little bit above. &quot;input&quot; is not just text. It also includes &lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man7&#x2F;signal.7.html&quot;&gt;signals&lt;&#x2F;a&gt; that can be sent to the running process. Converting keystrokes to signals is the job of the PTY.&lt;&#x2F;p&gt;
&lt;p&gt;Similar, &quot;output&quot; is not just text. It&#x27;s a stream of &lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;fnky&#x2F;458719343aabd01cfb17a3a4f7296797&quot;&gt;ANSI Escape Sequences&lt;&#x2F;a&gt; that can be used by the terminal emulator to display rich formatting.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-does-a-better-terminal-look-like&quot;&gt;what does a better terminal look like?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-a-better-terminal-look-like&quot; aria-label=&quot;Anchor link for: what-does-a-better-terminal-look-like&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I do some &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;how-i-use-my-terminal&#x2F;&quot;&gt;weird things&lt;&#x2F;a&gt; with terminals. However, the amount of hacks I can get up to are pretty limited, because terminals are pretty limited. I won&#x27;t go into all the ways they&#x27;re limited, because it&#x27;s been rehashed &lt;a href=&quot;https:&#x2F;&#x2F;matklad.github.io&#x2F;2019&#x2F;11&#x2F;16&#x2F;a-better-shell.html&quot;&gt;many&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;withoutboats&#x2F;notty&quot;&gt;times&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;02&#x2F;05&#x2F;some-terminal-frustrations&#x2F;&quot;&gt;before&lt;&#x2F;a&gt;. What I want to do instead is imagine what a better terminal can look like.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;a-first-try-jupyter&quot;&gt;a first try: Jupyter&lt;a class=&quot;zola-anchor&quot; href=&quot;#a-first-try-jupyter&quot; aria-label=&quot;Anchor link for: a-first-try-jupyter&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;The closest thing to a terminal analog that most people are familiar with is &lt;a href=&quot;https:&#x2F;&#x2F;docs.jupyter.org&#x2F;en&#x2F;latest&#x2F;&quot;&gt;Jupyter Notebook&lt;&#x2F;a&gt;. This offers a lot of cool features that are not possible in a &quot;traditional&quot; VT100 emulator:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;high fidelity image rendering&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;jupyter%20bubble%20plot.png&quot; alt=&quot;screenshot of a JupyterLite notebook. It has some python code in a cell that generates a matplotlib chart. Beneath is the chart, rendered to raster graphics.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;a &quot;rerun from start&quot; button (or rerun the current command; or rerun only a single past command) that replaces past output instead of appending to it&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;jupyter%20run%20cells.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&quot;views&quot; of source code and output that can be rewritten in place (e.g. markdown can be viewed either as source or as rendered HTML)&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;jupyter%20markdown%20raw.png&quot; alt=&quot;&quot; &#x2F;&gt; &lt;img src=&quot;&#x2F;assets&#x2F;jupyter%20markdown%20rendered.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;a built-in editor with syntax highlighting, tabs, panes, mouse support, etc.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;jupyter%20window%20management.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;some-problems&quot;&gt;some problems&lt;a class=&quot;zola-anchor&quot; href=&quot;#some-problems&quot; aria-label=&quot;Anchor link for: some-problems&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Jupyter works by having a &quot;kernel&quot; (in this case, a python interpreter) and a &quot;renderer&quot; (in this case, a web application displayed by the browser). You could imagine using a Jupyter Notebook with a shell as the kernel, so that you get all the nice features of Jupyter when running shell commands. However, that quickly runs into some issues:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Your shell gets the commands all at once, not character-by-character, so tab-complete, syntax highlighting, and autosuggestions don&#x27;t work.&lt;&#x2F;li&gt;
&lt;li&gt;What do you do about long-lived processes? By default, Jupyter runs a cell until completion; you can cancel it, but you can&#x27;t suspend, resume, interact with, nor view a process while it&#x27;s running. Don&#x27;t even think about running &lt;code&gt;vi&lt;&#x2F;code&gt; or &lt;code&gt;top&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;The &quot;rerun cell&quot; buttons do horrible things to the state of your computer (normal Jupyter kernels have this problem too, but &quot;rerun all&quot; works better when the commands don&#x27;t usually include &lt;code&gt;rm -rf&lt;&#x2F;code&gt;).&lt;&#x2F;li&gt;
&lt;li&gt;Undo&#x2F;redo do &lt;em&gt;not&lt;&#x2F;em&gt; work. (They don&#x27;t work in a normal terminal either, but people attempt to use them more when it looks like they should be able to.)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;It turns out all these problems are solveable.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-does-that-work&quot;&gt;how does that work?&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-does-that-work&quot; aria-label=&quot;Anchor link for: how-does-that-work&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;shell-integration&quot;&gt;shell integration&lt;a class=&quot;zola-anchor&quot; href=&quot;#shell-integration&quot; aria-label=&quot;Anchor link for: shell-integration&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;There exists today a terminal called &lt;a href=&quot;https:&#x2F;&#x2F;www.warp.dev&#x2F;&quot;&gt;Warp&lt;&#x2F;a&gt;. Warp has built native integration between the terminal and the shell, where the terminal understands where each command starts and stops, what it outputs, and what is your own input. As a result, it can render things very prettily:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;warp%20terminal.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;It does this using (mostly) standard features built-in to the terminal and shell (a custom DCS): you can read their explanation &lt;a href=&quot;https:&#x2F;&#x2F;www.warp.dev&#x2F;blog&#x2F;how-warp-works#:~:text=the%20reason&quot;&gt;here&lt;&#x2F;a&gt;. It&#x27;s possible to do this less invasively using &lt;a href=&quot;https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-escape-codes.html#:~:text=shell%20integration&#x2F;&quot;&gt;OSC 133 escape codes&lt;&#x2F;a&gt;; I&#x27;m not sure why Warp didn&#x27;t do this, but that&#x27;s ok.&lt;&#x2F;p&gt;
&lt;p&gt;iTerm2 does a similar thing, and this allows it to enable &lt;a href=&quot;https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-shell-integration.html#:~:text=enables%20numerous%20features&quot;&gt;really quite a lot of features&lt;&#x2F;a&gt;: navigating between commands with a single hotkey; notifying you when a command finishes running, showing the current command as an &quot;overlay&quot; if the output goes off the screen.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;long-lived-processes&quot;&gt;long-lived processes&lt;a class=&quot;zola-anchor&quot; href=&quot;#long-lived-processes&quot; aria-label=&quot;Anchor link for: long-lived-processes&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This is really three different things. The first is &lt;em&gt;interacting&lt;&#x2F;em&gt; with a long-lived process. The second is &lt;em&gt;suspending&lt;&#x2F;em&gt; the process without killing it. The third is &lt;em&gt;disconnecting&lt;&#x2F;em&gt; from the process, in such a way that the process state is not disturbed and is still available if you want to reconnect.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;interacting&quot;&gt;interacting&lt;a class=&quot;zola-anchor&quot; href=&quot;#interacting&quot; aria-label=&quot;Anchor link for: interacting&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;To interact with a process, you need bidirectional communication, i.e. you need a &quot;cell output&quot; that is also an input. An example would be any TUI, like &lt;code&gt;top&lt;&#x2F;code&gt;, &lt;code&gt;gdb&lt;&#x2F;code&gt;, or &lt;code&gt;vim&lt;&#x2F;code&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.  Fortunately, Jupyter is really good at this!  The whole design is around having &lt;a href=&quot;https:&#x2F;&#x2F;ipywidgets.readthedocs.io&#x2F;en&#x2F;latest&#x2F;&quot;&gt;interactive outputs&lt;&#x2F;a&gt; that you can change and update.&lt;&#x2F;p&gt;
&lt;p&gt;Additionally, I would expect my terminal to always have a &quot;free input cell&quot;, as Matklad describes in &lt;a href=&quot;https:&#x2F;&#x2F;matklad.github.io&#x2F;2019&#x2F;11&#x2F;16&#x2F;a-better-shell.html&quot;&gt;A Better Shell&lt;&#x2F;a&gt;, where the interactive process runs in the top half of the window and an input cell is available in the bottom half. Jupyter can do this today, but &quot;add a cell&quot; is manual, not automatic.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;suspending&quot;&gt;suspending&lt;a class=&quot;zola-anchor&quot; href=&quot;#suspending&quot; aria-label=&quot;Anchor link for: suspending&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;&quot;Suspending&quot; a process is usually called &quot;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2024&#x2F;07&#x2F;03&#x2F;reasons-to-use-job-control&#x2F;&quot;&gt;job control&lt;&#x2F;a&gt;&quot;. There&#x27;s not too much to talk about here, except that I would expect a &quot;modern&quot; terminal to show me all suspended and background processes as a de-emphasized persistent visual, kinda like how Intellij will show you &quot;indexing ...&quot; in the bottom taskbar.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;intellij%20background%20tasks.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h4 id=&quot;disconnecting&quot;&gt;disconnecting&lt;a class=&quot;zola-anchor&quot; href=&quot;#disconnecting&quot; aria-label=&quot;Anchor link for: disconnecting&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;There are roughly three existing approaches for disconnecting and reconnecting to a terminal session (Well, four if you count &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nelhage&#x2F;reptyr&quot;&gt;reptyr&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Tmux &#x2F; Zellij &#x2F; Screen&lt;&#x2F;p&gt;
&lt;p&gt;These tools inject a whole extra terminal emulator between your terminal emulator and the program. They work by having a &quot;server&quot; which actually owns the PTY and renders the output, and a &quot;client&quot; that displays the output to your &quot;real&quot; terminal emulator. This model lets you detach clients, reattach them later, or even attach multiple clients at once. You can think of this as a &quot;batteries-included&quot; approach. It also has the benefit that you can &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;how-i-use-my-terminal&#x2F;&quot;&gt;program&lt;&#x2F;a&gt; both the client and the server (although many modern terminals, like &lt;a href=&quot;https:&#x2F;&#x2F;sw.kovidgoyal.net&#x2F;kitty&#x2F;&quot;&gt;Kitty&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;wezfurlong.org&#x2F;wezterm&#x2F;&quot;&gt;Wezterm&lt;&#x2F;a&gt; are programmable now); that you can organize your tabs and windows in the terminal (although many modern desktop environments have tiling and thorough keyboard shortcuts); and that you get street cred for looking like Hackerman.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;hackerman.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The downside is that, well, now you have an extra terminal emulator running in your terminal, with &lt;a href=&quot;https:&#x2F;&#x2F;sw.kovidgoyal.net&#x2F;kitty&#x2F;faq&#x2F;#i-am-using-tmux-zellij-and-have-a-problem&quot;&gt;all the bugs that implies&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;iTerm actually avoids this by &lt;a href=&quot;https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-tmux-integration.html&quot;&gt;bypassing the tmux client altogether and acting as its own client&lt;&#x2F;a&gt; that talks directly to the server. In this mode, &quot;tmux tabs&quot; are actually iTerm tabs, &quot;tmux panes&quot; are iTerm panes, and so on. This is a good model, and I would adopt it when writing a future terminal for integration with existing tmux setups.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mosh.org&#x2F;&quot;&gt;Mosh&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Mosh is a really interesting place in the design space. It is not a terminal emulator replacement; instead it is an &lt;em&gt;ssh&lt;&#x2F;em&gt; replacement. Its big draw is that it supports reconnecting to your terminal session after a network interruption. It does that by &lt;a href=&quot;https:&#x2F;&#x2F;mosh.org&#x2F;#:~:text=how%20mosh%20works&quot;&gt;running a state machine on the server and replaying an incremental diff of the viewport to the client&lt;&#x2F;a&gt;. This is a similar model to tmux, except that it doesn&#x27;t support the &quot;multiplexing&quot; part (it expects your terminal emulator to handle that), nor scrollback (ditto). Because it has its own renderer, it has &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mobile-shell&#x2F;mosh&#x2F;issues&#x2F;234&quot;&gt;a similar class of bugs to tmux&lt;&#x2F;a&gt;. One feature it &lt;em&gt;does&lt;&#x2F;em&gt; have, unlike tmux, is that the &quot;client&quot; is really running on your side of the network, so local line editing is instant.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ansuz.sooke.bc.ca&#x2F;entry&#x2F;389&quot;&gt;alden&lt;&#x2F;a&gt;&#x2F;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;shell-pool&#x2F;shpool&quot;&gt;shpool&lt;&#x2F;a&gt;&#x2F;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;crigler&#x2F;dtach&quot;&gt;dtach&lt;&#x2F;a&gt;&#x2F;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;martanne&#x2F;abduco&quot;&gt;abduco&lt;&#x2F;a&gt;&#x2F;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;yazgoo&#x2F;diss&quot;&gt;diss&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;These all occupy a similar place in the design space: they &lt;em&gt;only&lt;&#x2F;em&gt; handle session detach&#x2F;resume with a client&#x2F;server, not networking or scrollback, and do not include their own terminal emulator. Compared to tmux and mosh, they are highly decoupled.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;rerun-and-undo-redo&quot;&gt;rerun and undo&#x2F;redo&lt;a class=&quot;zola-anchor&quot; href=&quot;#rerun-and-undo-redo&quot; aria-label=&quot;Anchor link for: rerun-and-undo-redo&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;I&#x27;m going to treat these together because the solution is the same: dataflow tracking.&lt;&#x2F;p&gt;
&lt;p&gt;Take as an example &lt;a href=&quot;https:&#x2F;&#x2F;plutojl.org&#x2F;&quot;&gt;pluto.jl&lt;&#x2F;a&gt;, which does this &lt;em&gt;today&lt;&#x2F;em&gt; by hooking into the Julia compiler.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;pluto%20interactive%20ode.gif&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Note that this updates cells live in response to previous cells that they depend on. Not pictured is that it &lt;em&gt;doesn&#x27;t&lt;&#x2F;em&gt; update cells if their dependencies haven&#x27;t changed. You can think of this as a spreadsheet-like Jupyter, where code is only rerun when necessary.&lt;&#x2F;p&gt;
&lt;p&gt;You may say this is hard to generalize. The trick here is &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;complected-and-orthogonal-persistence&#x2F;#how-far-can-we-take-this&quot;&gt;orthogonal persistence&lt;&#x2F;a&gt;. If you sandbox the processes, track all IO, and prevent things that are &quot;too weird&quot; unless they&#x27;re talking to other processes in the sandbox (e.g. unix sockets and POST requests), you have really quite a lot of control over the process! This lets you treat it as a pure function of its inputs, where its inputs are &quot;the whole file system, all environment variables, and all process attributes&quot;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;derived-features&quot;&gt;derived features&lt;a class=&quot;zola-anchor&quot; href=&quot;#derived-features&quot; aria-label=&quot;Anchor link for: derived-features&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Once you have these primitives—Jupyter notebook frontends, undo&#x2F;redo, automatic rerun, persistence, and shell integration—you can build really quite a lot on top. And you can build it incrementally, piece-by-piece:&lt;&#x2F;p&gt;
&lt;h4 id=&quot;needs-a-jupyter-notebook-frontend&quot;&gt;needs a Jupyter notebook frontend&lt;a class=&quot;zola-anchor&quot; href=&quot;#needs-a-jupyter-notebook-frontend&quot; aria-label=&quot;Anchor link for: needs-a-jupyter-notebook-frontend&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.atuin.sh&#x2F;atuin-desktop-runbooks-that-run&#x2F;&quot;&gt;Runbooks&lt;&#x2F;a&gt; (actually, you can build these just with Jupyter and a PTY primitive).&lt;&#x2F;li&gt;
&lt;li&gt;Terminal customization that uses normal CSS, no weird custom languages or ANSI color codes.&lt;&#x2F;li&gt;
&lt;li&gt;Search for commands by output&#x2F;timestamp. Currently, you can search across output in the current session, or you can search across all command input history, but you don&#x27;t have any kind of smart filters, and the output doesn&#x27;t persist across sessions.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;needs-shell-integration&quot;&gt;needs shell integration&lt;a class=&quot;zola-anchor&quot; href=&quot;#needs-shell-integration&quot; aria-label=&quot;Anchor link for: needs-shell-integration&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;Timestamps and execution duration for each command.&lt;&#x2F;li&gt;
&lt;li&gt;Local line-editing, even across a network boundary.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.warp.dev&#x2F;terminal&#x2F;command-completions&#x2F;completions&quot;&gt;IntelliSense for shell commands&lt;&#x2F;a&gt;, without having to hit tab and with rendering that&#x27;s integrated into the terminal.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;needs-sandboxed-tracing&quot;&gt;needs sandboxed tracing&lt;a class=&quot;zola-anchor&quot; href=&quot;#needs-sandboxed-tracing&quot; aria-label=&quot;Anchor link for: needs-sandboxed-tracing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;&quot;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;complected-and-orthogonal-persistence&#x2F;#but-why&quot;&gt;All the features from sandboxed tracing&lt;&#x2F;a&gt;&quot;: collaborative terminals, querying files modified by a command, &quot;asciinema but you can edit it at runtime&quot;, tracing build systems.&lt;&#x2F;li&gt;
&lt;li&gt;Extend the smart search above to also search by disk state at the time the command was run.&lt;&#x2F;li&gt;
&lt;li&gt;Extending undo&#x2F;redo to a git-like branching model (something like this is already support by &lt;a href=&quot;https:&#x2F;&#x2F;elpa.gnu.org&#x2F;packages&#x2F;undo-tree.html#:~:text=undo%20systems&quot;&gt;emacs undo-tree&lt;&#x2F;a&gt;), where you have multiple &quot;views&quot; of the process tree.&lt;&#x2F;li&gt;
&lt;li&gt;Given the undo-tree model, and since we have sandboxing, we can give an LLM access to your project, and run many of them in parallel at the same time without overwriting each others state, and in such a way that you can see what they&#x27;re doing, edit it, and save it into a runbook for later use.&lt;&#x2F;li&gt;
&lt;li&gt;A terminal in a prod environment that can&#x27;t affect the state of the machine, only inspect the existing state.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;ok-but-how-do-you-build-this&quot;&gt;ok but how do you build this&lt;a class=&quot;zola-anchor&quot; href=&quot;#ok-but-how-do-you-build-this&quot; aria-label=&quot;Anchor link for: ok-but-how-do-you-build-this&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;jyn, you may say, &lt;a href=&quot;https:&#x2F;&#x2F;becca.ooo&#x2F;blog&#x2F;vertical-integration&#x2F;&quot;&gt;you can&#x27;t build vertical integration in open source&lt;&#x2F;a&gt;. &lt;a href=&quot;https:&#x2F;&#x2F;tech.lgbt&#x2F;@jyn&#x2F;112187088917827279&quot;&gt;you can&#x27;t make money off open source projects&lt;&#x2F;a&gt;. &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;you-are-in-a-box&#x2F;#switching-costs-and-growth&quot;&gt;the switching costs are too high&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;All these things are true. To talk about how this is possible, we have to talk about incremental adoption.&lt;&#x2F;p&gt;
&lt;p&gt;if I were building this, I would do it in stages, such that at each stage the thing is an improvement over its alternatives. This is how &lt;code&gt;jj&lt;&#x2F;code&gt; works and it works extremely well: it doesn&#x27;t require everyone on a team to switch at once because individual people can use &lt;code&gt;jj&lt;&#x2F;code&gt;, even for single commands, without a large impact on everyone else.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;stage-1-transactional-semantics&quot;&gt;stage 1: transactional semantics&lt;a class=&quot;zola-anchor&quot; href=&quot;#stage-1-transactional-semantics&quot; aria-label=&quot;Anchor link for: stage-1-transactional-semantics&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;When people think of redesigning the terminal, they always think of redesigning the terminal &lt;em&gt;emulator&lt;&#x2F;em&gt;. This is exactly the wrong place to start. People are attached to their emulators. They configure them, they make them look nice, they use their keybindings. There is a high switching cost to switching emulators because &lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;01&#x2F;11&#x2F;getting-a-modern-terminal-setup&#x2F;#everything-affects-everything-else&quot;&gt;everything affects everything else&lt;&#x2F;a&gt;. It&#x27;s not &lt;em&gt;so&lt;&#x2F;em&gt; terribly high, because it&#x27;s still individual and not shared across a team, but still high.&lt;&#x2F;p&gt;
&lt;p&gt;What I would do instead is start at the CLI layer. CLI programs are great because they&#x27;re easy to install and run and have very low switching costs: you can use them one-off without changing your whole workflow.&lt;&#x2F;p&gt;
&lt;p&gt;So, I would write a CLI that implements &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;complected-and-orthogonal-persistence&#x2F;#how-far-can-we-take-this&quot;&gt;transactional semantics for the terminal&lt;&#x2F;a&gt;. You can imagine an interface something like &lt;code&gt;transaction [start|rollback|commit]&lt;&#x2F;code&gt;, where everything run after &lt;code&gt;start&lt;&#x2F;code&gt; is undoable. There is a &lt;em&gt;lot&lt;&#x2F;em&gt; you can do with this alone, I think you could build a whole business off this.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;stage-2-persistent-sessions&quot;&gt;stage 2: persistent sessions&lt;a class=&quot;zola-anchor&quot; href=&quot;#stage-2-persistent-sessions&quot; aria-label=&quot;Anchor link for: stage-2-persistent-sessions&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Once I had transactional semantics, I would try to decouple persistence from tmux and mosh.&lt;&#x2F;p&gt;
&lt;p&gt;To get PTY persistence, you have to introduce a client&#x2F;server model, because the kernel &lt;em&gt;really really&lt;&#x2F;em&gt; &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;SIGHUP&quot;&gt;expects&lt;&#x2F;a&gt; both sides of a PTY to always be connected. Using commands like &lt;a href=&quot;https:&#x2F;&#x2F;ansuz.sooke.bc.ca&#x2F;entry&#x2F;389&quot;&gt;alden&lt;&#x2F;a&gt;, or a library like it (it&#x27;s not &lt;em&gt;that&lt;&#x2F;em&gt; complicated), lets you do this simply, without affecting the terminal emulator nor the programs running inside the PTY session.&lt;&#x2F;p&gt;
&lt;p&gt;To get scrollback, the server could save input and output indefinitely and replay them when the client reconnects. This gets you &quot;native&quot; scrollback—the terminal emulator you&#x27;re already using handles it exactly like any other output, because it looks exactly like any other output—while still being replayable and resumable from an arbitrary starting point. This requires some amount of parsing ANSI escape codes&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, but it&#x27;s doable with enough work.&lt;&#x2F;p&gt;
&lt;p&gt;To get network resumption like mosh, my custom server could use &lt;a href=&quot;https:&#x2F;&#x2F;eternalterminal.dev&#x2F;howitworks&#x2F;&quot;&gt;Eternal TCP&lt;&#x2F;a&gt; (possibly built on top of QUIC for efficiency). Notably, the persistence for the PTY is separate from the persistence for the network connection. Eternal TCP here is strictly an optimization: you could build this on top of a bash script that runs &lt;code&gt;ssh host eternal-pty attach&lt;&#x2F;code&gt; in a loop, it&#x27;s just not as nice an experience because of network delay and packet loss. Again, composable parts allow for incremental adoption.&lt;&#x2F;p&gt;
&lt;p&gt;At this point, you&#x27;re already able to connect multiple clients to a single terminal session, like tmux, but window management is still done by your terminal emulator, not by the client&#x2F;server. If you wanted to have window management integrated, the terminal emulator could speak the tmux -CC protocol, like iTerm.&lt;&#x2F;p&gt;
&lt;p&gt;All parts of this stage can be done independently and in parallel from the transactional semantics, but I don&#x27;t think you can build a business off them, it&#x27;s not enough of an improvement over the existing tools.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;stage-3-structured-rpc&quot;&gt;stage 3: structured RPC&lt;a class=&quot;zola-anchor&quot; href=&quot;#stage-3-structured-rpc&quot; aria-label=&quot;Anchor link for: stage-3-structured-rpc&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This bit depends on the client&#x2F;server model. Once you have a server interposed between the terminal emulator and the client, you can start doing really funny things like tagging I&#x2F;O with metadata. This lets all data be timestamped&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; and lets you distinguish input from output. &lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2022&#x2F;07&#x2F;20&#x2F;pseudoterminals&#x2F;&quot;&gt;xterm.js&lt;&#x2F;a&gt; works something like this. When combined with shell integration, this even lets you distinguish shell prompts from program output, at the &lt;em&gt;data&lt;&#x2F;em&gt; layer.&lt;&#x2F;p&gt;
&lt;p&gt;Now you can start doing really funny things, because you have a &lt;em&gt;structured log&lt;&#x2F;em&gt; of your terminal session. You can replay the log as a recording, like &lt;a href=&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;&quot;&gt;asciinema&lt;&#x2F;a&gt;&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;; you can transform the shell prompt without rerunning all the commands; you can import it into a Jupyter Notebook or &lt;a href=&quot;https:&#x2F;&#x2F;blog.atuin.sh&#x2F;atuin-desktop-runbooks-that-run&#x2F;&quot;&gt;Atuin Desktop&lt;&#x2F;a&gt;; you can save the commands and rerun them later as a script. Your terminal is data.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;stage-4-jupyter-like-frontend&quot;&gt;stage 4: jupyter-like frontend&lt;a class=&quot;zola-anchor&quot; href=&quot;#stage-4-jupyter-like-frontend&quot; aria-label=&quot;Anchor link for: stage-4-jupyter-like-frontend&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This is the very first time that we touch the terminal emulator, and it&#x27;s intentionally the last step because it has the highest switching costs. This makes use of all the nice features we&#x27;ve built to give you a nice UI. You don&#x27;t need our &lt;code&gt;transaction&lt;&#x2F;code&gt; CLI anymore unless you want nested transactions, because your whole terminal session starts in a transaction by default. You get all the features I mention &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;the-terminal-of-the-future&#x2F;#derived-features&quot;&gt;above&lt;&#x2F;a&gt;, because we&#x27;ve put all the pieces together.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;jyn-what-the-fuck&quot;&gt;jyn, what the fuck&lt;a class=&quot;zola-anchor&quot; href=&quot;#jyn-what-the-fuck&quot; aria-label=&quot;Anchor link for: jyn-what-the-fuck&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;This is bold and ambitious and I think building the whole thing would take about a decade. That&#x27;s ok. I&#x27;m patient.&lt;&#x2F;p&gt;
&lt;p&gt;You can help me by spreading the word :) Perhaps this post will inspire someone to start building this themselves.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;bibliography&quot;&gt;bibliography&lt;a class=&quot;zola-anchor&quot; href=&quot;#bibliography&quot; aria-label=&quot;Anchor link for: bibliography&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.destroyallsoftware.com&#x2F;talks&#x2F;a-whole-new-world&quot;&gt;Gary Bernhardt, “A Whole New World”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;matklad.github.io&#x2F;2019&#x2F;11&#x2F;16&#x2F;a-better-shell.html&quot;&gt;Alex Kladov, “A Better Shell”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;how-i-use-my-terminal&#x2F;&quot;&gt;jyn, “how i use my terminal”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;complected-and-orthogonal-persistence&#x2F;&quot;&gt;jyn, “Complected and Orthogonal Persistence”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;you-are-in-a-box&#x2F;&quot;&gt;jyn, “you are in a box”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tech.lgbt&#x2F;@jyn&#x2F;112187088917827279&quot;&gt;jyn, “there&#x27;s two costs to making money off an open source project…”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;becca.ooo&#x2F;blog&#x2F;vertical-integration&#x2F;&quot;&gt;Rebecca Turner, “Vertical Integration is the Only Thing That Matters”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;06&#x2F;24&#x2F;new-zine--the-secret-rules-of-the-terminal&#x2F;&quot;&gt;Julia Evans, “New zine: The Secret Rules of the Terminal”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wizardzines.com&#x2F;comics&#x2F;meet-the-terminal-emulator&#x2F;&quot;&gt;Julia Evans, “meet the terminal emulator”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2022&#x2F;07&#x2F;20&#x2F;pseudoterminals&#x2F;&quot;&gt;Julia Evans, “What happens when you press a key in your terminal?”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;01&#x2F;11&#x2F;getting-a-modern-terminal-setup&#x2F;&quot;&gt;Julia Evans, “What&#x27;s involved in getting a &quot;modern&quot; terminal setup?”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2017&#x2F;03&#x2F;26&#x2F;bash-quirks&#x2F;&quot;&gt;Julia Evans, “Bash scripting quirks &amp;amp; safety tips”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;02&#x2F;05&#x2F;some-terminal-frustrations&#x2F;&quot;&gt;Julia Evans, “Some terminal frustrations”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2024&#x2F;07&#x2F;03&#x2F;reasons-to-use-job-control&#x2F;&quot;&gt;Julia Evans, “Reasons to use your shell&#x27;s job control”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man7&#x2F;signal.7.html&quot;&gt;“signal(7) - Miscellaneous Information Manual”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;fnky&#x2F;458719343aabd01cfb17a3a4f7296797&quot;&gt;Christian Petersen, “ANSI Escape Codes”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;withoutboats&#x2F;notty&quot;&gt;saoirse, “withoutboats&#x2F;notty: A new kind of terminal”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.jupyter.org&#x2F;en&#x2F;latest&#x2F;&quot;&gt;Jupyter Team, “Project Jupyter Documentation”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.warp.dev&#x2F;&quot;&gt;“Warp: The Agentic Development Environment”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.warp.dev&#x2F;blog&#x2F;how-warp-works&quot;&gt;“Warp: How Warp Works”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.warp.dev&#x2F;terminal&#x2F;command-completions&#x2F;completions&quot;&gt;“Warp: Completions”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-escape-codes.html&quot;&gt;George Nachman, “iTerm2: Proprietary Escape Codes”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-shell-integration.html&quot;&gt;George Nachman, “iTerm2: Shell Integration”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-tmux-integration.html&quot;&gt;George Nachman, “iTerm2: tmux Integration”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ipywidgets.readthedocs.io&#x2F;en&#x2F;latest&#x2F;&quot;&gt;Project Jupyter, “Jupyter Widgets”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nelhage&#x2F;reptyr&quot;&gt;Nelson Elhage, “nelhage&#x2F;reptyr: Reparent a running program to a new terminal”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;sw.kovidgoyal.net&#x2F;kitty&#x2F;&quot;&gt;Kovid Goyal, “kitty”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;sw.kovidgoyal.net&#x2F;kitty&#x2F;faq&#x2F;&quot;&gt;Kovid Goyal, “kitty - Frequently Asked Questions”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wezfurlong.org&#x2F;wezterm&#x2F;&quot;&gt;Wez Furlong, “Wezterm”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mosh.org&#x2F;&quot;&gt;Keith Winstein, “Mosh: the mobile shell”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mobile-shell&#x2F;mosh&#x2F;issues&#x2F;234&quot;&gt;Keith Winstein, “Display errors with certain characters&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ansuz.sooke.bc.ca&#x2F;entry&#x2F;389&quot;&gt;Matthew Skala, “alden: detachable terminal sessions without breaking scrollback”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;shell-pool&#x2F;shpool&quot;&gt;Ethan Pailes, “shell-pool&#x2F;shpool: Think tmux, then aim... lower”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;crigler&#x2F;dtach&quot;&gt;Ned T. Crigler, “crigler&#x2F;dtach: A simple program that emulates the detach feature of screen”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;martanne&#x2F;abduco&quot;&gt;Marc André Tanner, “martanne&#x2F;abduco: abduco provides session management”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;yazgoo&#x2F;diss&quot;&gt;yazgoo, “yazgoo&#x2F;diss: dtach-like program &#x2F; crate in rust”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;plutojl.org&#x2F;&quot;&gt;Fons van der Plas, “Pluto.jl — interactive Julia programming environment”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.atuin.sh&#x2F;atuin-desktop-runbooks-that-run&#x2F;&quot;&gt;Ellie Huxtable, “Atuin Desktop: Runbooks that Run”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;elpa.gnu.org&#x2F;packages&#x2F;undo-tree.html&quot;&gt;Toby Cubitt, “undo-tree”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;SIGHUP&quot;&gt;“SIGHUP - Wikipedia”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;eternalterminal.dev&#x2F;howitworks&#x2F;&quot;&gt;Jason Gauci, “How Eternal Terminal Works”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;&quot;&gt;Marcin Kulik, “Record and share your terminal sessions, the simple way - asciinema.org”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ratatui.rs&#x2F;concepts&#x2F;backends&#x2F;alternate-screen&#x2F;&quot;&gt;“Alternate Screen | Ratatui”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;!--To talk about interacting with a process, we have to talk about [PTTYs](https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2022&#x2F;07&#x2F;20&#x2F;pseudoterminals&#x2F;).--&gt;
&lt;!--
My complaint about Warp is chiefly that they didn&#x27;t think big enough. Warp built a very cool tool, and then wrapped it in a product that mostly exists to make it easier to use LLMs in the terminal. There are [*so many* things](https:&#x2F;&#x2F;iterm2.com&#x2F;documentation-shell-integration.html#:~:text=enables%20numerous%20features) you could do with shell integration, and they don&#x27;t seem to have done very many of them.
--&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;there are a &lt;em&gt;lot&lt;&#x2F;em&gt; of complications here around &lt;a href=&quot;https:&#x2F;&#x2F;ratatui.rs&#x2F;concepts&#x2F;backends&#x2F;alternate-screen&#x2F;&quot;&gt;alternate mode&lt;&#x2F;a&gt;, but I&#x27;m just going to skip over those for now. A simple way to handle alternate mode (that doesn&#x27;t get you nice things) is just to embed a raw terminal in the output cell. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;otherwise you could start replaying output from inside an escape, which is &lt;a href=&quot;https:&#x2F;&#x2F;mosh.org&#x2F;#:~:text=evil%20escape%20sequences&quot;&gt;not good&lt;&#x2F;a&gt;. I had a detailed email exchange about this with the alden author which I have not yet had time to write up into a blog post; most of the complication comes when you want to avoid replaying the &lt;em&gt;entire&lt;&#x2F;em&gt; history and only want to replay the visible viewport. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;hey, this seems awfully like &lt;a href=&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;&quot;&gt;asciinema&lt;&#x2F;a&gt;! &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;oh, that&#x27;s why it seemed like asciinema. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>build system tradeoffs</title>
        <published>2025-11-02T00:00:00+00:00</published>
        <updated>2025-11-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/build-system-tradeoffs/"/>
        <id>https://jyn.dev/build-system-tradeoffs/</id>
        
        <summary type="html">an overview of what builds for complicated projects have to think about</summary>
        
        <content type="html" xml:base="https://jyn.dev/build-system-tradeoffs/">&lt;p&gt;This post is part 1&#x2F;4 of &lt;a href=&quot;&#x2F;four-posts-about-build-systems&#x2F;&quot;&gt;a series about build systems&lt;&#x2F;a&gt;.
The next post is &lt;a href=&quot;&#x2F;negative-build-dependencies&#x2F;&quot;&gt;negative build dependencies&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;chaos.social&#x2F;@Qyriad&#x2F;111349762684384063&quot;&gt;
&lt;p&gt;If I am even TEMPTED to use &lt;code&gt;sed&lt;&#x2F;code&gt;, in my goddamn build system, you have lost.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite class=username&gt;&lt;a href=&quot;https:&#x2F;&#x2F;chaos.social&#x2F;@Qyriad&#x2F;111349762684384063&quot;&gt;Qyriad&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;p&gt;I am currently employed to work on &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;intro.html&quot;&gt;the build system for the Rust compiler&lt;&#x2F;a&gt; (often called &lt;code&gt;x.py&lt;&#x2F;code&gt; or &lt;code&gt;bootstrap&lt;&#x2F;code&gt;). As a result, I think about a lot of build system weirdness that most people don&#x27;t have to. This post aims to give an overview of what builds for complicated projects have to think about, as well as vaguely gesture in the direction of build system ideas that I like.&lt;&#x2F;p&gt;
&lt;p&gt;This post is generally designed to be accessible to the working programmer, but I have a lot of expert blindness in this area, and sometimes assume that &lt;a href=&quot;https:&#x2F;&#x2F;xkcd.com&#x2F;2501&#x2F;&quot;&gt;&quot;of &lt;em&gt;course&lt;&#x2F;em&gt; people know what a feldspar is!&quot;&lt;&#x2F;a&gt;. Apologies in advance if it&#x27;s hard to follow.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;build-concerns&quot;&gt;build concerns&lt;a class=&quot;zola-anchor&quot; href=&quot;#build-concerns&quot; aria-label=&quot;Anchor link for: build-concerns&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;What makes a project’s build complicated?&lt;&#x2F;p&gt;
&lt;h3 id=&quot;running-generated-binaries&quot;&gt;running generated binaries&lt;a class=&quot;zola-anchor&quot; href=&quot;#running-generated-binaries&quot; aria-label=&quot;Anchor link for: running-generated-binaries&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;The first semi-complicated thing people usually want to do in their build is write an integration test. Here&#x27;s a rust program which does so:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; tests&#x2F;integration.rs
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;process&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Command&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;assert_success&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;cmd&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; Command&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;assert!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;cmd&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;status&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;success&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-annotation z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-annotation z-rust&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-annotation z-rust&quot;&gt;test&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;test_my_program&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-function z-rust&quot;&gt;assert_success&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;Command&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;cargo&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;arg&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;build&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-function z-rust&quot;&gt;assert_success&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;Command&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;target&#x2F;debug&#x2F;my-program&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;      &lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;arg&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;assets&#x2F;test-input.txt&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This instructs &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;&quot;&gt;cargo&lt;&#x2F;a&gt; to, when you run &lt;code&gt;cargo test&lt;&#x2F;code&gt;, compile &lt;code&gt;tests&#x2F;integration.rs&lt;&#x2F;code&gt; as a standalone program and run it, with &lt;code&gt;test_my_program&lt;&#x2F;code&gt; as the entrypoint.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ll come back to this program several times in this post. For now, notice that we are invoking &lt;code&gt;cargo build&lt;&#x2F;code&gt; inside of &lt;code&gt;cargo test&lt;&#x2F;code&gt;. &lt;!-- This isn&#x27;t something cargo-specific—there&#x27;s extensive literature about it under the name [&quot;recursive make&quot;](https:&#x2F;&#x2F;accu.org&#x2F;journals&#x2F;overload&#x2F;14&#x2F;71&#x2F;miller_2004&#x2F;).--&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;correct-dependency-tracking&quot;&gt;correct dependency tracking&lt;a class=&quot;zola-anchor&quot; href=&quot;#correct-dependency-tracking&quot; aria-label=&quot;Anchor link for: correct-dependency-tracking&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;I actually forgot this one in the first draft because Cargo solves this so well in the common case &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-14-1&quot;&gt;&lt;a href=&quot;#fn-14&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. In many hand-written builds (&lt;em&gt;cough&lt;&#x2F;em&gt; &lt;code&gt;make&lt;&#x2F;code&gt; &lt;em&gt;cough&lt;&#x2F;em&gt;), specifying dependencies by hand is very broken, &lt;code&gt;-j&lt;&#x2F;code&gt; for parallelism simply doesn&#x27;t work, and running &lt;code&gt;make clean&lt;&#x2F;code&gt; on errors is common. Needless to say, this is a bad experience.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;cross-compiling&quot;&gt;cross-compiling&lt;a class=&quot;zola-anchor&quot; href=&quot;#cross-compiling&quot; aria-label=&quot;Anchor link for: cross-compiling&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;The next step up in complexity is to cross-compile code. At this point, we already start to get some idea of how involved things get:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cargo test --target aarch64-unknown-linux-gnu
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   Compiling my-program v0.1.0 (&#x2F;home&#x2F;jyn&#x2F;src&#x2F;build-system-overview)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0463]: can&amp;#39;t find crate for `std`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  = note: the `aarch64-unknown-linux-gnu` target may not be installed
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  = help: consider downloading the target with `rustup target add aarch64-unknown-linux-gnu`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  = help: consider building the standard library from source with `cargo build -Zbuild-std`
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;How hard it is to cross-compile code depends greatly on not just the build system, but the language you&#x27;re using and the exact platform you&#x27;re targeting. The particular thing I want to point out is &lt;em&gt;your standard library has to come from somewhere&lt;&#x2F;em&gt;. In Rust, it&#x27;s usually downloaded from the same place as the compiler. In bytecode and interpreted languages, like Java, JavaScript, and Python, there&#x27;s no concept of cross-compilation because there is only one possible target. In C, you usually don&#x27;t install the library itself, but only the headers that record the API &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. That brings us to our next topic:&lt;&#x2F;p&gt;
&lt;h4 id=&quot;libc&quot;&gt;libc&lt;a class=&quot;zola-anchor&quot; href=&quot;#libc&quot; aria-label=&quot;Anchor link for: libc&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;Generally, people refer to one of two things when they say &quot;libc&quot;. Either they mean the C standard library, &lt;code&gt;libc.so&lt;&#x2F;code&gt;, or the C runtime, &lt;code&gt;crt1.o&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Libc matters a lot for two reasons. Firstly, &lt;a href=&quot;https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;c-isnt-a-language&#x2F;&quot;&gt;C is no longer a language&lt;&#x2F;a&gt;, so generally the first step to porting &lt;em&gt;any&lt;&#x2F;em&gt; language to a new platform is to make sure you have a C &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;69006179&quot;&gt;toolchain&lt;&#x2F;a&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. Secondly, because libc is effectively the interface to a platform, &lt;a href=&quot;https:&#x2F;&#x2F;j00ru.vexillium.org&#x2F;syscalls&#x2F;nt&#x2F;64&#x2F;&quot;&gt;Windows&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;developer.apple.com&#x2F;library&#x2F;archive&#x2F;qa&#x2F;qa1118&#x2F;_index.html&quot;&gt;macOS&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;marc.info&#x2F;?l=openbsd-tech&amp;amp;m=169841790407370&amp;amp;w=2&quot;&gt;OpenBSD&lt;&#x2F;a&gt; have no stable syscall boundary—you are only allowed to talk to the kernel through their stable libraries (libc, and in the case of Windows several others too).&lt;&#x2F;p&gt;
&lt;p&gt;To talk about &lt;em&gt;why&lt;&#x2F;em&gt; they&#x27;ve done this, we have to talk about:&lt;&#x2F;p&gt;
&lt;h4 id=&quot;dynamic-linking-and-platform-maintainers&quot;&gt;dynamic linking and platform maintainers&lt;a class=&quot;zola-anchor&quot; href=&quot;#dynamic-linking-and-platform-maintainers&quot; aria-label=&quot;Anchor link for: dynamic-linking-and-platform-maintainers&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clojure.org&#x2F;reference&#x2F;vars&quot;&gt;Many&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Dynamic_dispatch&quot;&gt;languages&lt;&#x2F;a&gt; have a concept of &quot;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Name_binding&quot;&gt;early binding&lt;&#x2F;a&gt;&quot;, where all variable and function references are resolved at compile time, and &quot;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Late_binding&quot;&gt;late binding&lt;&#x2F;a&gt;&quot;, where they are resolved at runtime. C has this concept too, but it calls it &quot;linking&quot; instead of &quot;binding&quot;. &quot;late binding&quot; is called &quot;dynamic linking&quot;&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. References to late-bound variables are resolved by the &lt;a href=&quot;https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;8&#x2F;ld.so&quot;&gt;&quot;dynamic loader&quot;&lt;&#x2F;a&gt; at program startup. Further binding can be done at runtime using &lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man3&#x2F;dlopen.3.html&quot;&gt;&lt;code&gt;dlopen&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; and friends.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wiki.debian.org&#x2F;SoftwarePackaging#External_libraries&quot;&gt;Platform maintainers&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;wiki.debian.org&#x2F;StaticLinking#Downsides&quot;&gt;really like dynamic linking&lt;&#x2F;a&gt;, for the same reason &lt;a href=&quot;https:&#x2F;&#x2F;blogs.gentoo.org&#x2F;mgorny&#x2F;2021&#x2F;02&#x2F;19&#x2F;the-modern-packagers-security-nightmare&#x2F;&quot;&gt;they dislike vendoring&lt;&#x2F;a&gt;: late-binding allows them to update a library for all applications on a system at once. This matters a lot for security disclosures, where there is a very short timeline between when a vulnerability is patched and announced and when attackers start exploiting it in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;Application developers &lt;a href=&quot;https:&#x2F;&#x2F;vagabond.github.io&#x2F;rants&#x2F;2013&#x2F;06&#x2F;21&#x2F;z_packagers-dont-know-best&quot;&gt;dislike dynamic linking&lt;&#x2F;a&gt; for basically the same reason: it requires them to trust the platform maintainers to do a good job packaging all their dependencies, and it results in their application being deployed in scenarios that &lt;a href=&quot;https:&#x2F;&#x2F;blog.yossarian.net&#x2F;2021&#x2F;02&#x2F;28&#x2F;Weird-architectures-werent-supported-to-begin-with&quot;&gt;they haven&#x27;t considered or tested&lt;&#x2F;a&gt;. For example, installing openssl on Windows is really quite hard. Actually, while I was writing this, a friend overheard me say &quot;dynamically linking openssl&quot; and said &quot;oh god you&#x27;re giving me nightmares&quot;.&lt;&#x2F;p&gt;
&lt;p&gt;Perhaps a good way to think about dynamically linking as commonly used is &lt;em&gt;a mechanism for devendoring libraries in a compiled program&lt;&#x2F;em&gt;. Dynamic linking has other use cases, but they are comparatively rare.&lt;&#x2F;p&gt;
&lt;p&gt;Whether a build system (or language) makes it easy or hard to dynamically link a program is one of the major things that distinguishes it. More about that later.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;toolchains&quot;&gt;toolchains&lt;a class=&quot;zola-anchor&quot; href=&quot;#toolchains&quot; aria-label=&quot;Anchor link for: toolchains&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Ok. So. Back to cross-compiling.&lt;&#x2F;p&gt;
&lt;p&gt;To cross-compile a program, you need:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;A compiler for that target. If you&#x27;re using clang or Rust, this is as simple as passing &lt;code&gt;--target&lt;&#x2F;code&gt;. If you&#x27;re using gcc, you need a &lt;a href=&quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc-15.2.0&#x2F;gcc.pdf#Invoking%20GCC&quot;&gt;whole-ass extra compiler installed&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;A standard library for that target. This is very language-specific, but at a minimum requires a working C toolchain &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;A linker for that target. This is usually shipped with the compiler, but I mention it specifically because it&#x27;s usually the most platform specific part. For example, &quot;not having the macOS linker&quot; is &lt;em&gt;the&lt;&#x2F;em&gt; reason that &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tpoechtrager&#x2F;osxcross?tab=readme-ov-file#how-it-works&quot;&gt;cross-compiling to macOS is hard&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Where does your toolchain come from? ...&lt;br &#x2F;&gt;
...&lt;br &#x2F;&gt;
...&lt;br &#x2F;&gt;
... It turns out &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#stages-of-bootstrapping&quot;&gt;this is a hard problem&lt;&#x2F;a&gt;. Most build systems sidestep it by &quot;not worrying about it&quot;; basically any Makefile you find is horribly broken if you update your compiler without running &lt;code&gt;make clean&lt;&#x2F;code&gt; afterwards. Cargo is a lot smarter—it caches output in &lt;code&gt;target&#x2F;.rustc_info.json&lt;&#x2F;code&gt;, and rebuilds if &lt;code&gt;rustc --version --verbose&lt;&#x2F;code&gt; changes. &quot;How do you deal with toolchain invalidations&quot; is another important things that distinguishes a build system, as we&#x27;ll see later.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;environments&quot;&gt;environments&lt;a class=&quot;zola-anchor&quot; href=&quot;#environments&quot; aria-label=&quot;Anchor link for: environments&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;toolchains are a special case of a more general problem: your build depends on your &lt;em&gt;whole build environment&lt;&#x2F;em&gt;, not just the files passed as inputs to your compiler. That means, for instance, that people can—and often do—download things off the internet, &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;rustdoc.html#multiple-runs-same-output-directory&quot;&gt;embed previous build artifacts in later ones&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;openssl&#x2F;latest&#x2F;openssl&#x2F;#vendored&quot;&gt;run entire nested compiler invocations&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;reproducible-builds&quot;&gt;reproducible builds&lt;a class=&quot;zola-anchor&quot; href=&quot;#reproducible-builds&quot; aria-label=&quot;Anchor link for: reproducible-builds&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Once we get towards these higher levels of complexity, people want to start doing quite complicated things with caching. In order for caching to be sound, we need the same invocation of the compiler to emit the same output every time, which is called a &lt;strong&gt;reproducible build&lt;&#x2F;strong&gt;. This is much harder than it sounds! There are many things programs do that cause non-determinism that programmers often don’t think about (for example, iterating a hashmap or a directory listing).&lt;&#x2F;p&gt;
&lt;p&gt;At the very highest end, people want to conduct builds across multiple machines, and combine those artifacts. At this point, we can’t even allow reading absolute paths, since those will be different between machines. The common tool for this is a compiler flag called &lt;code&gt;--remap-path-prefix&lt;&#x2F;code&gt;, and allows the build system to map an absolute path to a relative one. &lt;code&gt;--remap-path-prefix&lt;&#x2F;code&gt; is also how rustc is able to print the sources of the standard library when emitting diagnostics, even when running on a different machine than where it was built.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;tradeoffs&quot;&gt;tradeoffs&lt;a class=&quot;zola-anchor&quot; href=&quot;#tradeoffs&quot; aria-label=&quot;Anchor link for: tradeoffs&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;At this point, we have enough information to start talking about the space of tradeoffs for a build system.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;configuration-language&quot;&gt;configuration language&lt;a class=&quot;zola-anchor&quot; href=&quot;#configuration-language&quot; aria-label=&quot;Anchor link for: configuration-language&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Putting your config in a YAML file does not make it declarative! Limiting yourself to a Turing-incomplete language does not automatically make your code easier to read!
—&lt;a href=&quot;https:&#x2F;&#x2F;tech.lgbt&#x2F;@jyn&#x2F;112617315565817787&quot;&gt;jyn&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;The most common unforced error I see build systems making is forcing the build configuration to be written in a custom language&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-6-1&quot;&gt;&lt;a href=&quot;#fn-6&quot;&gt;6&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. There are basically two reasons they do this:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Programmers aren&#x27;t used to treating build system code as code. This is a culture issue that&#x27;s hard to change, but it&#x27;s worthwhile to try anyway.&lt;&#x2F;li&gt;
&lt;li&gt;There is some idea of making builds &quot;declarative&quot;. (In fact, observant readers may observe that this corresponds to the idea of &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;constrained-languages-are-easier-to-optimize&#x2F;&quot;&gt;&quot;constrained languages&quot;&lt;&#x2F;a&gt; I talk about in an earlier post.) This is not by itself a bad idea! The problem is it doesn&#x27;t give them the properties you might want. For example, one property you might want is &quot;another tool can reimplement the build algorithm&quot;. Unfortunately this quickly becomes &lt;a href=&quot;https:&#x2F;&#x2F;docs.jade.fyi&#x2F;gnu&#x2F;make.html#Features-of-GNU-make&quot;&gt;infeasible for complicated algorithms&lt;&#x2F;a&gt;. Another you might want is &quot;what will rebuild next time a build occurs?&quot;. You can&#x27;t get this from the configuration without—again—reimplementing the algorithm.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Right. So, given that making a build &quot;declarative&quot; is a lie, you may as well give programmers a real language. Some common choices are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;starlark-lang.org&#x2F;&quot;&gt;Starlark&lt;&#x2F;a&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-7-1&quot;&gt;&lt;a href=&quot;#fn-7&quot;&gt;7&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;groovy-lang.org&#x2F;&quot;&gt;Groovy&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;“the same language that the build system was written in” (examples: &lt;a href=&quot;https:&#x2F;&#x2F;boot-clj.github.io&#x2F;&quot;&gt;Clojure&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;ziglang.org&#x2F;learn&#x2F;build-system&#x2F;&quot;&gt;Zig&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;gruntjs.com&#x2F;sample-gruntfile&quot;&gt;JavaScript&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;reflection&quot;&gt;reflection&lt;a class=&quot;zola-anchor&quot; href=&quot;#reflection&quot; aria-label=&quot;Anchor link for: reflection&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&quot;But wait, jyn!&quot;, you may say. &quot;Surely you aren&#x27;t suggesting a build system where you have to run a whole program every time you figure out what to rebuild??&quot;&lt;&#x2F;p&gt;
&lt;p&gt;I mean ... people are doing it. But just because they&#x27;re doing it doesn&#x27;t mean it&#x27;s a good idea, so let&#x27;s look at the alternative, which is to &lt;em&gt;serialize your build graph&lt;&#x2F;em&gt;. This is easier to see than explain, so let&#x27;s look at an example using the &lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;&quot;&gt;Ninja build system&lt;&#x2F;a&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-8-1&quot;&gt;&lt;a href=&quot;#fn-8&quot;&gt;8&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ninja&quot; class=&quot;language-ninja z-code&quot;&gt;&lt;code class=&quot;language-ninja&quot; data-lang=&quot;ninja&quot;&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;rule svg2pdf
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  command = inkscape $in --export-text-to-path --export-pdf=$out
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  description = svg2pdf $in $out
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;build pdfs&#x2F;variables.pdf: svg2pdf variables.svg
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ninjafiles give you the absolute bare minimum necessary to express your build dependencies: You get &quot;rules&quot;, which explain &lt;em&gt;how&lt;&#x2F;em&gt; to build an output; &quot;build edges&quot;, which state &lt;em&gt;when&lt;&#x2F;em&gt; to build; and &quot;variables&quot;, which say &lt;em&gt;what&lt;&#x2F;em&gt; to build&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-12-1&quot;&gt;&lt;a href=&quot;#fn-12&quot;&gt;9&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. That&#x27;s basically it. There&#x27;s some subtleties about &quot;depfiles&quot; which can be used to dynamically add build edges while running the build rule.&lt;&#x2F;p&gt;
&lt;p&gt;Because the features are so minimal, the files are intended to be generated, using a configure script written in one of the languages we talked about earlier. The most common generators are CMake and &lt;a href=&quot;https:&#x2F;&#x2F;gn.googlesource.com&#x2F;gn&#x2F;#gn&quot;&gt;GN&lt;&#x2F;a&gt;, but you can use any language you like because the format is so simple.&lt;&#x2F;p&gt;
&lt;p&gt;What&#x27;s really cool about this is that it&#x27;s trivial to parse, which means that it&#x27;s very easy to write your own implementation of ninja if you want. It also means that you &lt;em&gt;can&lt;&#x2F;em&gt; get a lot of the properties we discussed before, i.e.:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&quot;Show me all commands that are run on a full build&quot; (&lt;code&gt;ninja -t commands&lt;&#x2F;code&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;&quot;Show me all commands that will be run the next time an incremental build is run&quot; (&lt;code&gt;ninja -n -d explain&lt;&#x2F;code&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;&quot;If this &lt;em&gt;particular&lt;&#x2F;em&gt; source file is changed, what will need to be rebuilt?&quot; (&lt;code&gt;ninja -t query variables.svg&lt;&#x2F;code&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;It turns out these properties are very useful.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;&quot;jyn, you&#x27;re taking too long to get to the point!&quot; look I’m getting there, I promise.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;The main downsides to this approach is that it has to be &lt;em&gt;possible&lt;&#x2F;em&gt; to serialize your build graph. In one sense, I see this as good, actually, because you have to think through everything your build does ahead of time. But on the other hand, if you have things like nested ninja invocations, or like our &lt;code&gt;cargo test&lt;&#x2F;code&gt; -&amp;gt; &lt;code&gt;cargo build&lt;&#x2F;code&gt; example &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;build-system-tradeoffs&#x2F;#running-generated-binaries&quot;&gt;from earlier&lt;&#x2F;a&gt; &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-9-1&quot;&gt;&lt;a href=&quot;#fn-9&quot;&gt;10&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, all the tools to query the build graph don&#x27;t include the information you expect.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;file-watching&quot;&gt;file watching&lt;a class=&quot;zola-anchor&quot; href=&quot;#file-watching&quot; aria-label=&quot;Anchor link for: file-watching&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Re-stat&#x27;ing all files in a source directory is expensive. It would be much nicer if we could have a pull model instead of a push model, where the build tool gets notified of file changes and rebuilds exactly the necessary files. There are some tools with native integration for this, like &lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;manual.html#:~:text=monitor&quot;&gt;Tup&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;capnproto&#x2F;ekam&#x2F;&quot;&gt;Ekam&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;jj-vcs.github.io&#x2F;jj&#x2F;latest&#x2F;config&#x2F;#filesystem-monitor&quot;&gt;jj&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;engineering.fb.com&#x2F;2023&#x2F;04&#x2F;06&#x2F;open-source&#x2F;buck2-open-source-large-scale-build-system&#x2F;#:~:text=integrate%20with%20virtual%20file&quot;&gt;Buck2&lt;&#x2F;a&gt;, but generally it&#x27;s pretty rare.&lt;&#x2F;p&gt;
&lt;p&gt;That&#x27;s ok if we have reflection, though! We can write our own file monitoring tool, ask the build system which files need to rebuilt for the changed inputs, and then tell it to rebuild only those files. That prevents it from having to recursively stat all files in the graph.&lt;&#x2F;p&gt;
&lt;p&gt;See &lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;build_system_rules_and_algorithms.pdf&quot;&gt;Tup&#x27;s paper&lt;&#x2F;a&gt; for more information about the big idea here.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;dependency-tracking&quot;&gt;dependency tracking&lt;a class=&quot;zola-anchor&quot; href=&quot;#dependency-tracking&quot; aria-label=&quot;Anchor link for: dependency-tracking&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Ok, let&#x27;s assume we have some build system that uses some programming language to generate a build graph, and it rebuilds exactly the necessary outputs on changes to our inputs. What exactly are our inputs?&lt;&#x2F;p&gt;
&lt;p&gt;There are basically four major approaches to dependency tracking in the build space.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;not-my-problem-lol&quot;&gt;&quot;not my problem, lol&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#not-my-problem-lol&quot; aria-label=&quot;Anchor link for: not-my-problem-lol&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;This kind of build system externalizes all concerns out to you, the programmer. When I say &quot;externalizes all concerns&quot;, I mean that you are required to write in all your dependencies by hand, and the tool doesn&#x27;t help you get them right. Some examples:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;make&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Github Actions &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;actions&#x2F;cache&quot;&gt;cache actions&lt;&#x2F;a&gt; (and in general, most CI caching I&#x27;m aware of requires you to manually write out the files your cache depends on)&lt;&#x2F;li&gt;
&lt;li&gt;Ansible playbooks&lt;&#x2F;li&gt;
&lt;li&gt;Basically most build systems, this is extremely common&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;A common problem with this category of build system is that people forget to mark &lt;em&gt;the build rule itself&lt;&#x2F;em&gt; as an input to the graph, resulting in dead artifacts left laying around, and as a result, &lt;a href=&quot;https:&#x2F;&#x2F;jacko.io&#x2F;safety_and_soundness.html&quot;&gt;unsound&lt;&#x2F;a&gt; builds.&lt;&#x2F;p&gt;
&lt;p&gt;In my humble opinion, this kind of tool is only useful as a serialization layer for a build graph, or if you have no other choice. Here&#x27;s a nickel, kid, &lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2016&#x2F;03&#x2F;hadrian.pdf&quot;&gt;get yourself a better build system&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;compiler-support&quot;&gt;compiler support&lt;a class=&quot;zola-anchor&quot; href=&quot;#compiler-support&quot; aria-label=&quot;Anchor link for: compiler-support&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h5&gt;
&lt;p&gt;Sometimes build systems (CMake, Cargo, maybe others I don&#x27;t know) do a little better and use the compiler&#x27;s built-in support for dependency tracking (e.g. &lt;a href=&quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc&#x2F;Preprocessor-Options.html#index-M&quot;&gt;&lt;code&gt;gcc -M&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustc&#x2F;command-line-arguments.html#--emit-specifies-the-types-of-output-files-to-generate&quot;&gt;&lt;code&gt;rustc --emit=dep-info&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;), and automatically add dependencies on the build rules themselves. This is a lot better than nothing, and much more reliable than tracking dependencies by hand. But it still fundamentally trusts the compiler to be correct, and doesn&#x27;t track environment dependencies.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;ephemeral-state&quot;&gt;ephemeral state&lt;a class=&quot;zola-anchor&quot; href=&quot;#ephemeral-state&quot; aria-label=&quot;Anchor link for: ephemeral-state&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;This kind of build system always does a full build, and lets you modify the environment in arbitrary ways as you do so. This is simple, always correct, and expensive. Some examples:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;make clean &amp;amp;&amp;amp; make&lt;&#x2F;code&gt; (kinda—assuming that &lt;code&gt;make clean&lt;&#x2F;code&gt; is reliable, which it often isn&#x27;t.)&lt;&#x2F;li&gt;
&lt;li&gt;Github Actions (&lt;code&gt;step:&lt;&#x2F;code&gt; rules)&lt;&#x2F;li&gt;
&lt;li&gt;Docker containers (time between startup and shutdown)&lt;&#x2F;li&gt;
&lt;li&gt;Initramfs (time between initial load and chroot into the full system)&lt;&#x2F;li&gt;
&lt;li&gt;Systemd service startup rules&lt;&#x2F;li&gt;
&lt;li&gt;Most compiler invocations (e.g. &lt;code&gt;cc file.c -o file&lt;&#x2F;code&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;These are ok if you can afford them. But they are expensive! Most people using Github Actions are only doing so because GHA is a hyperscaler giving away free CI time like there&#x27;s no tomorrow. I suspect we would see far less wasted CPU-hours if people had to consider the actual costs of using them.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;hermetic-builds&quot;&gt;hermetic builds&lt;a class=&quot;zola-anchor&quot; href=&quot;#hermetic-builds&quot; aria-label=&quot;Anchor link for: hermetic-builds&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;This is the kind of phrase that&#x27;s well-known to people who work on build systems and basically unheard of outside it, alongside &quot;monadic builds&quot;. &quot;hermetic&quot; means that &lt;em&gt;the only things in your environment are those you have explicitly put there&lt;&#x2F;em&gt;. This sometimes called &quot;sandboxing&quot;, although that has unfortunate connotations about security that don&#x27;t always apply here. Some examples of this:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Dockerfiles (more generally, OCI images)&lt;&#x2F;li&gt;
&lt;li&gt;nix&lt;&#x2F;li&gt;
&lt;li&gt;Bazel &#x2F; Buck2&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;bazelbuild&#x2F;remote-apis&quot;&gt;&quot;Bazel Remote Execution Protocol&quot;&lt;&#x2F;a&gt; (not actually tied to Bazel), which lets you run an arbitrary set of build commands on a remote worker&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This has a lot of benefits! It statically guarantees that you &lt;em&gt;cannot&lt;&#x2F;em&gt; forget any of your inputs; it is 100% reliable, assuming no issues with the network or with the implementing tool 🙃; and it gives you very very granular insight into what your dependencies actually are. Some things you can &lt;em&gt;do&lt;&#x2F;em&gt; with a hermetic build system:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;On a change to some source code, rerun only the affected tests. You know statically which those are, because the build tool forced you to write out the dependency edges.&lt;&#x2F;li&gt;
&lt;li&gt;Remote caching. If you have the same environment everywhere, you can upload your cache to the cloud, and download and reuse it again on another machine. You can do this in CI—but you can also do it locally! The time for a &quot;&quot;&quot;full build&quot;&quot;&quot; can be almost instantaneous because when a new engineer gets onboarded they can immediately reuse everyone else&#x27;s build cache.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The main downside is that you have to actually specify all those dependencies (if you don&#x27;t, you get a hard error instead of an unsound build graph, which is the main difference between hermetic systems and &quot;not my problem&quot;). Bazel and Buck2 give you starlark, so you have a ~real&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-10-1&quot;&gt;&lt;a href=&quot;#fn-10&quot;&gt;11&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; language in which to do it, but it&#x27;s still a ton of work. Both have an enormous &quot;prelude&quot; module that just defines where you get a compiler toolchain from&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-13-1&quot;&gt;&lt;a href=&quot;#fn-13&quot;&gt;12&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Nix can be thought of as taking this &quot;prelude&quot; idea all the way, by expanding the &quot;prelude&quot; (nixpkgs) to &quot;everything that&#x27;s ever been packaged for NixOS&quot;. When you write &lt;code&gt;import &amp;lt;nixpkgs&amp;gt;&lt;&#x2F;code&gt;, your nix build is logically in the same build graph as the nixpkgs monorepo; it just happens to have an enormous remote cache already pre-built.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;Bazel and Buck2 don’t have anything like nixpkgs, which is the main reason that using them requires a full time dedicated build engineer: that engineer has to keep writing build rules from scratch any time you add an external dependency. They also have to package any language toolchains that aren’t in the prelude.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;Nix has one more interesting property, which is that all its packages compose. You can install two different versions of the same package and that&#x27;s fine because they use different &lt;a href=&quot;https:&#x2F;&#x2F;nix.dev&#x2F;manual&#x2F;nix&#x2F;2.24&#x2F;store&#x2F;&quot;&gt;store&lt;&#x2F;a&gt; paths. They fit together like lesbians&#x27; fingers interlock.&lt;&#x2F;p&gt;
&lt;p&gt;Compare this to docker, which does &lt;em&gt;not&lt;&#x2F;em&gt; compose&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-11-1&quot;&gt;&lt;a href=&quot;#fn-11&quot;&gt;13&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. In docker, there is no way to say &quot;Inherit the build environment from multiple different source images&quot;. The closest you can get is a &quot;multi-stage build&quot;, where you explicitly copy over individual files from an earlier image to a later image. It can&#x27;t blindly copy over all the files because some of them might want to end up at the same path, and touching fingers would be gay.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;tracing&quot;&gt;tracing&lt;a class=&quot;zola-anchor&quot; href=&quot;#tracing&quot; aria-label=&quot;Anchor link for: tracing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;The last kind I&#x27;m aware of, and the rarest I&#x27;ve seen, is &lt;em&gt;tracing&lt;&#x2F;em&gt; build systems. These have the same goal as hermetic build systems: they still want 100% of your dependencies to be specified. But they go about it in a different way. Rather than sandboxing your code and only allowing access to the dependencies you specify, they &lt;em&gt;instrument&lt;&#x2F;em&gt; your code, tracing its file accesses, and record the dependencies of each build step. Some examples:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;ex_a_first_tupfile.html#:~:text=a%20program%20grows&quot;&gt;Tup&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rizsotto&#x2F;Bear&quot;&gt;Bear&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;curtsinger-lab&#x2F;riker&quot;&gt;Riker&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;capnproto&#x2F;ekam&#x2F;&quot;&gt;Ekam&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;query.html&quot;&gt;The rust compiler, actually&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&quot;A build system with orthogonal persistence&quot; (&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;complected-and-orthogonal-persistence&#x2F;#how-far-can-we-take-this&quot;&gt;previously&lt;&#x2F;a&gt;; &lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;the-postmodern-build-system&#x2F;#make-an-existing-architecture-and-os-deterministic&quot;&gt;previously&lt;&#x2F;a&gt;; &lt;a href=&quot;https:&#x2F;&#x2F;nlnet.nl&#x2F;project&#x2F;Ripple&#x2F;&quot;&gt;previously&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The advantage of these is that you get all the benefits of a hermetic build system without any of the cost of having to write out your dependencies.&lt;&#x2F;p&gt;
&lt;p&gt;The first main disadvantage is that they require the kernel to support syscall tracing, which essentially means they only work on Linux. I have Ideas™ for how to get this working on macOS without disabling SIP, but they&#x27;re still incomplete and not fully general; I may write a follow-up post about that. I don&#x27;t yet have ideas for how this could work on Windows, but &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;864839&#x2F;monitoring-certain-system-calls-done-by-a-process-in-windows&quot;&gt;it seems possible&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The second main disadvantage is that not knowing the graph up front causes many issues for the build system. In particular:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;If you change the graph, it doesn&#x27;t find out until the next time it reruns a build. This can lead to degenerate cases where the same rule has to be run multiple times until it doesn&#x27;t access any new inputs.&lt;&#x2F;li&gt;
&lt;li&gt;If you don&#x27;t cache the graph, you have that problem on &lt;em&gt;every edge in the graph&lt;&#x2F;em&gt;. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;capnproto&#x2F;ekam&#x2F;issues&#x2F;63&quot;&gt;This is the problem Ekam has&lt;&#x2F;a&gt;, and makes it very slow to run full builds. Its solution is to run in &quot;watch&quot; mode, where it caches the graph in-memory instead of on-disk.&lt;&#x2F;li&gt;
&lt;li&gt;If you do cache the graph, you can only do so for so long before it becomes prohibitively expensive to do that for all possible executions. For &quot;normal&quot; codebases this isn&#x27;t a problem, but if you&#x27;re Google or Facebook, this is actually a practical concern. I think it is still possible to do this with a tracing build system (by having your cache points look a lot more like many Bazel BUILD files than a single top-level Ninja file), but no one has ever tried it at that scale.&lt;&#x2F;li&gt;
&lt;li&gt;If the same file can come from many possible places, due to multiple search paths (e.g. a &lt;code&gt;&amp;lt;system&amp;gt;&lt;&#x2F;code&gt; include header in C, or any import really in a JVM language), then you have a very rough time specifying what your dependencies actually are. The best ninja can do is say “depend on the whole directory containing that file”, which sucks because it rebuilds &lt;em&gt;whenever&lt;&#x2F;em&gt; that directory changes, not just when your new file is added. It’s possible to work around this with a (theoretical) serialization format other than Ninja, but regardless, you’re adding lots of file &lt;code&gt;stat()&lt;&#x2F;code&gt;s to your hot path.&lt;&#x2F;li&gt;
&lt;li&gt;The build system does not know which dependencies are direct (specified by you, the owner of the module being compiled) and which are transient (specified by the modules you depend on). This makes error reporting worse, and generally lets you do fewer kinds of queries on the graph.&lt;&#x2F;li&gt;
&lt;li&gt;My friend Alexis Hunt, a build system expert, says &quot;there are deeper pathologies down that route of madness&quot;. So. That&#x27;s concerning.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I have been convinced that tracing is useful as a tool to &lt;em&gt;generate&lt;&#x2F;em&gt; your build graph, but not as a tool actually used when executing it. Compare also &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;bazel-contrib&#x2F;bazel-gazelle&quot;&gt;gazelle&lt;&#x2F;a&gt;, which is something like that for Bazel, but based on parsing source files rather than tracking syscalls.&lt;&#x2F;p&gt;
&lt;p&gt;Combining paradigms in this way also make it possible to verify your hermetic builds in ways that are hard to do with mere sandboxing. For example, a tracing build system can catch missing dependencies:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;emitting untracked &lt;em&gt;outputs&lt;&#x2F;em&gt;&lt;&#x2F;li&gt;
&lt;li&gt;overwriting source files (!),&lt;&#x2F;li&gt;
&lt;li&gt;using an input file that was registered for a different rule&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;and it can also detect non-reproducible builds:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;reading the current time, or absolute path to the current directory&lt;&#x2F;li&gt;
&lt;li&gt;iterating all files in a directory (this is non-deterministic)&lt;&#x2F;li&gt;
&lt;li&gt;machine and kernel-level sources of randomness.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;future-work&quot;&gt;future work&lt;a class=&quot;zola-anchor&quot; href=&quot;#future-work&quot; aria-label=&quot;Anchor link for: future-work&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;There&#x27;s more to talk about here—how build systems affect the dynamics between upstream maintainers and distro packagers; how .a files are &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@eyal.itkin&#x2F;the-a-file-is-a-relic-why-static-archives-were-a-bad-idea-all-along-8cd1cf6310c5&quot;&gt;bad file formats&lt;&#x2F;a&gt;; how &lt;a href=&quot;https:&#x2F;&#x2F;apenwarr.ca&#x2F;log&#x2F;20181113&quot;&gt;mtime comparisons are generally bad&lt;&#x2F;a&gt;; how configuration options make the tradeoffs much more complicated; how FUSE can let a build system integrate with a VCS to avoid downloading unnecessary files into a shallow checkout; but this post is quite long enough already.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;takeaways&quot;&gt;takeaways&lt;a class=&quot;zola-anchor&quot; href=&quot;#takeaways&quot; aria-label=&quot;Anchor link for: takeaways&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;Most build systems do not prioritize correctness.&lt;&#x2F;li&gt;
&lt;li&gt;Prioritizing correctness comes with severe, hard to avoid tradeoffs.&lt;&#x2F;li&gt;
&lt;li&gt;Tracing build systems show the potential to avoid some of those tradeoffs, but are highly platform specific and come with tradeoffs of their own at large enough scale. Combining a tracing build system with a hermetic build system seems like the best of both worlds.&lt;&#x2F;li&gt;
&lt;li&gt;Writing build rules in a &quot;normal&quot; (but constrained) programming language, then serializing them to a build graph, has surprisingly few tradeoffs. I&#x27;m not sure why more build systems don&#x27;t do this.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;bibliography&quot;&gt;bibliography&lt;a class=&quot;zola-anchor&quot; href=&quot;#bibliography&quot; aria-label=&quot;Anchor link for: bibliography&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;boot-clj.github.io&#x2F;&quot;&gt;Alan Dipert, Micha Niskin, Joshua Smith, “Boot: build tooling for Clojure”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;bazelbuild&#x2F;remote-apis&quot;&gt;Alexis Hunt, Ola Rozenfield, and Adrian Ludwin, “bazelbuild&#x2F;remote-apis: An API for caching and execution of actions on a remote system.”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;andrewkelley.me&#x2F;post&#x2F;zig-cc-powerful-drop-in-replacement-gcc-clang.html&quot;&gt;Andrew Kelley, “zig cc: a Powerful Drop-In Replacement for GCC&#x2F;Clang”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;vagabond.github.io&#x2F;rants&#x2F;2013&#x2F;06&#x2F;21&#x2F;z_packagers-dont-know-best&quot;&gt;Andrew Thompson, “Packagers don’t know best”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.microsoft.com&#x2F;en-us&#x2F;research&#x2F;wp-content&#x2F;uploads&#x2F;2016&#x2F;03&#x2F;hadrian.pdf&quot;&gt;Andrey Mokhov et. al., “Non-recursive Make Considered Harmful”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;apenwarr.ca&#x2F;log&#x2F;20181113&quot;&gt;apenwarr, “mtime comparison considered harmful”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developer.apple.com&#x2F;library&#x2F;archive&#x2F;qa&#x2F;qa1118&#x2F;_index.html&quot;&gt;Apple Inc., “Statically linked binaries on Mac OS X”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;c-isnt-a-language&#x2F;&quot;&gt;Aria Desires, “C Isn’t A Language Anymore”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;curtsinger-lab&#x2F;riker&quot;&gt;Charlie Curtsinger and Daniel W. Barowy, “curtsinger-lab&#x2F;riker: Always-Correct and Fast Incremental Builds from Simple Specifications”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;engineering.fb.com&#x2F;2023&#x2F;04&#x2F;06&#x2F;open-source&#x2F;buck2-open-source-large-scale-build-system&#x2F;&quot;&gt;Chris Hopman and Neil Mitchell, “Build faster with Buck2: Our open source build system”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wiki.debian.org&#x2F;SoftwarePackaging&quot;&gt;Debian, “Software Packaging”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;wiki.debian.org&#x2F;StaticLinking&quot;&gt;Debian, “Static Linking”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nix.dev&#x2F;manual&#x2F;nix&#x2F;2.24&#x2F;store&#x2F;&quot;&gt;Dolstra, E., &amp;amp; The CppNix contributors., “Nix Store”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@eyal.itkin&#x2F;the-a-file-is-a-relic-why-static-archives-were-a-bad-idea-all-along-8cd1cf6310c5&quot;&gt;Eyal Itkin, “The .a File is a Relic: Why Static Archives Were a Bad Idea All Along”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;2021&#x2F;05&#x2F;10&#x2F;Rust-1.52.1&#x2F;&quot;&gt;Felix Klock and Mark Rousskov on behalf of the Rust compiler team, “Announcing Rust 1.52.1”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.jade.fyi&#x2F;gnu&#x2F;make.html&quot;&gt;Free Software Foundation, Inc., “GNU make”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;actions&#x2F;cache&quot;&gt;GitHub, Inc., “actions&#x2F;cache: Cache dependencies and build outputs in GitHub Actions”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;bazel-contrib&#x2F;bazel-gazelle&quot;&gt;Google Inc., “bazel-contrib&#x2F;bazel-gazelle: a Bazel build file generator for Bazel projects”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jj-vcs.github.io&#x2F;jj&#x2F;latest&#x2F;config&#x2F;&quot;&gt;Google LLC, “Jujutsu docs”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;openssl&#x2F;latest&#x2F;openssl&#x2F;&quot;&gt;Jack Lloyd and Steven Fackler, “rust-openssl”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jacko.io&#x2F;safety_and_soundness.html&quot;&gt;Jack O’Connor, “Safety and Soundness in Rust”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;the-postmodern-build-system&#x2F;&quot;&gt;Jade Lovelace, “The postmodern build system”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2020&#x2F;10&#x2F;26&#x2F;ninja--a-simple-way-to-do-builds&#x2F;&quot;&gt;Julia Evans, “ninja: a simple way to do builds”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;complected-and-orthogonal-persistence&#x2F;&quot;&gt;jyn, “Complected and Orthogonal Persistence”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;constrained-languages-are-easier-to-optimize&#x2F;&quot;&gt;jyn, “Constrained Languages are Easier to Optimize”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tech.lgbt&#x2F;@jyn&#x2F;112617315565817787&quot;&gt;jyn, “i think i have identified what i dislike about ansible”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;capnproto&#x2F;ekam&#x2F;&quot;&gt;Kenton Varda, “Ekam Build System”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rizsotto&#x2F;Bear&quot;&gt;László Nagy, “rizsotto&#x2F;Bear: a tool that generates a compilation database for clang tooling”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;starlark-lang.org&#x2F;&quot;&gt;Laurent Le Brun, “Starlark Programming Language”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;j00ru.vexillium.org&#x2F;syscalls&#x2F;nt&#x2F;64&#x2F;&quot;&gt;Mateusz “j00ru” Jurczyk, “Windows X86-64 System Call Table (XP&#x2F;2003&#x2F;Vista&#x2F;7&#x2F;8&#x2F;10&#x2F;11 and Server)”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blogs.gentoo.org&#x2F;mgorny&#x2F;2021&#x2F;02&#x2F;19&#x2F;the-modern-packagers-security-nightmare&#x2F;&quot;&gt;Michał Górny, “The modern packager’s security nightmare”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;ex_a_first_tupfile.html&quot;&gt;Mike Shal, “A First Tupfile”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;build_system_rules_and_algorithms.pdf&quot;&gt;Mike Shal, “Build System Rules and Algorithms”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;manual.html&quot;&gt;Mike Shal, “tup”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;&quot;&gt;Nico Weber, “Ninja, a small build system with a focus on speed”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nlnet.nl&#x2F;project&#x2F;Ripple&#x2F;&quot;&gt;NLnet, “Ripple”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gruntjs.com&#x2F;sample-gruntfile&quot;&gt;OpenJS Foundation, “Grunt: The JavaScript Task Runner”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc&#x2F;Preprocessor-Options.html&quot;&gt;“Preprocessor Options (Using the GNU Compiler Collection (GCC))”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;xkcd.com&#x2F;2501&#x2F;&quot;&gt;Randall Munroe, “xkcd: Average Familiarity”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc-15.2.0&#x2F;gcc.pdf&quot;&gt;Richard M. Stallman and the GCC Developer Community, “Invoking GCC”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;clojure.org&#x2F;reference&#x2F;vars&quot;&gt;Rich Hickey, “Clojure - Vars and the Global Environment”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;langdev.stackexchange.com&#x2F;questions&#x2F;153&#x2F;what-are-the-advantages-of-requiring-forward-declaration-of-methods-fields-like&#x2F;&quot;&gt;Stack Exchange, “What are the advantages of requiring forward declaration of methods&#x2F;fields like C&#x2F;C++ does?”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;864839&#x2F;monitoring-certain-system-calls-done-by-a-process-in-windows&quot;&gt;Stack Overflow, “Monitoring certain system calls done by a process in Windows”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man3&#x2F;dlopen.3.html&quot;&gt;System Calls Manual, “dlopen(3)”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;8&#x2F;ld.so&quot;&gt;System Manager’s Manual, “ld.so(8)”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;groovy-lang.org&#x2F;&quot;&gt;The Apache Groovy project, “The Apache Groovy™ programming language”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gn.googlesource.com&#x2F;gn&#x2F;&quot;&gt;The Chromium Authors, “gn”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;marc.info&#x2F;?l=openbsd-tech&amp;amp;m=169841790407370&amp;amp;w=2&quot;&gt;Theo de Raadt, “Removing syscall(2) from libc and kernel”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;intro.html&quot;&gt;The Rust Project Contributors, “Bootstrapping the compiler”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;11937&quot;&gt;The Rust Project Contributors, “Link using the linker directly”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;rustdoc.html&quot;&gt;The Rust Project Contributors, “Rustdoc overview - Multiple runs, same output directory”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;&quot;&gt;The Rust Project Contributors, “The Cargo Book”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustc&#x2F;command-line-arguments.html&quot;&gt;The Rust Project Contributors, “Command-line Arguments - The rustc book”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;query.html&quot;&gt;The Rust Project Contributors, “Queries: demand-driven compilation”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html&quot;&gt;The Rust Project Contributors, “What Bootstrapping does”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tpoechtrager&#x2F;osxcross?tab=readme-ov-file&quot;&gt;Thomas Pöchtrager, “MacOS Cross-Toolchain for Linux and *BSD”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;69006179&quot;&gt;“What is a compiler toolchain? - Stack Overflow”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Dynamic_dispatch&quot;&gt;Wikipedia, “Dynamic dispatch”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Late_binding&quot;&gt;Wikipedia, “Late binding”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Name_binding&quot;&gt;Wikipedia, “Name binding”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.yossarian.net&#x2F;2021&#x2F;02&#x2F;28&#x2F;Weird-architectures-werent-supported-to-begin-with&quot;&gt;william woodruff, “Weird architectures weren’t supported to begin with”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ziglang.org&#x2F;learn&#x2F;build-system&#x2F;&quot;&gt;Zig contributors, “Zig Build System“&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-14&quot;&gt;
&lt;p&gt;the uncommon case mostly looks like &lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;2021&#x2F;05&#x2F;10&#x2F;Rust-1.52.1&#x2F;&quot;&gt;incremental bugs in rustc itself&lt;&#x2F;a&gt;, or issues around rerunning build scripts. &lt;a href=&quot;#fr-14-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;see &lt;a href=&quot;https:&#x2F;&#x2F;langdev.stackexchange.com&#x2F;questions&#x2F;153&#x2F;what-are-the-advantages-of-requiring-forward-declaration-of-methods-fields-like&#x2F;&quot;&gt;this stackexchange post&lt;&#x2F;a&gt; for more discussion about the tradeoffs between forward declarations and requiring full access to the source. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;even &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;11937&quot;&gt;Rust depends on crt1.o when linking&lt;&#x2F;a&gt;! &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;early binding is called &quot;static linking&quot;. &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;actually, Zig solved this in &lt;a href=&quot;https:&#x2F;&#x2F;andrewkelley.me&#x2F;post&#x2F;zig-cc-powerful-drop-in-replacement-gcc-clang.html&quot;&gt;the funniest way possible&lt;&#x2F;a&gt;, by bundling a C toolchain with their Zig compiler. This is a legitimately quite impressive feat. If there&#x27;s any Zig contributors reading—props to you, you did a great job. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-6&quot;&gt;
&lt;p&gt;almost every build system does this, so I don&#x27;t even feel compelled to name names. &lt;a href=&quot;#fr-6-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-7&quot;&gt;
&lt;p&gt;Starlark is &lt;em&gt;not&lt;&#x2F;em&gt; tied to hermetic build systems. The fact that the only common uses of it are in hermetic build systems is unfortunate. &lt;a href=&quot;#fr-7-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-8&quot;&gt;
&lt;p&gt;H.T. &lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2020&#x2F;10&#x2F;26&#x2F;ninja--a-simple-way-to-do-builds&#x2F;&quot;&gt;Julia Evans&lt;&#x2F;a&gt; &lt;a href=&quot;#fr-8-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-12&quot;&gt;
&lt;p&gt;actually variables are more general than this, but for $in and $out this is true. &lt;a href=&quot;#fr-12-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-9&quot;&gt;
&lt;p&gt;another example is  &quot;rebuilding build.ninja when the build graph changes&quot;. it&#x27;s more common than you think because the language is so limited that it&#x27;s easier to rerun the configure script than to try and fit the dependency info into the graph. &lt;a href=&quot;#fr-9-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-10&quot;&gt;
&lt;p&gt;not actually turing-complete &lt;a href=&quot;#fr-10-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-13&quot;&gt;
&lt;p&gt;I have been informed that the open-source version of Bazel is not actually hermetic-by-default inside of its prelude, and just uses system libraries. This is quite unfortunate; with this method of using Bazel you are getting a lot of the downsides and little of the upside. Most people I know using it are doing so in the hermetic mode. &lt;a href=&quot;#fr-13-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-11&quot;&gt;
&lt;p&gt;there&#x27;s something &lt;em&gt;called&lt;&#x2F;em&gt; &lt;code&gt;docker compose&lt;&#x2F;code&gt;, but it composes containers, not images. &lt;a href=&quot;#fr-11-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>the core of rust</title>
        <published>2025-08-21T00:00:00+00:00</published>
        <updated>2025-08-21T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/the-core-of-rust/"/>
        <id>https://jyn.dev/the-core-of-rust/</id>
        
        <summary type="html">within Rust is a smaller language struggling to get out</summary>
        
        <content type="html" xml:base="https://jyn.dev/the-core-of-rust/">&lt;p&gt;&lt;strong&gt;NOTE: this is not a rust tutorial.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;donsz.nl&#x2F;&quot;&gt;
&lt;p&gt;Every year it was an incredible challenge to fit teaching Rust into lectures since you basically need all the concepts right from the start to understand a lot of programs. I never knew how to order things. The flip side was that usually when you understand all the basic components in play lots of it just fits together. i.e. there&#x27;s some point where the interwovenness turns from a barrier into something incredibly valuable and helpful.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;donsz.nl&#x2F;&quot;&gt;Jana Dönszelmann&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;h2 id=&quot;vision&quot;&gt;Vision&lt;a class=&quot;zola-anchor&quot; href=&quot;#vision&quot; aria-label=&quot;Anchor link for: vision&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;One thing I admire in a language is a strong vision. &lt;a href=&quot;https:&#x2F;&#x2F;www.uiua.org&#x2F;&quot;&gt;Uiua&lt;&#x2F;a&gt;, for example, has a very strong vision: what does it take to eliminate all local named variables from a language? &lt;a href=&quot;https:&#x2F;&#x2F;ziglang.org&#x2F;&quot;&gt;Zig&lt;&#x2F;a&gt; similarly has a strong vision: explicit, simple language features, easy to cross compile, drop-in replacement for C.&lt;&#x2F;p&gt;
&lt;p&gt;Note that you don’t have to agree with a language’s vision to note that it &lt;em&gt;has&lt;&#x2F;em&gt; one. I expect most people to find Uiua unpleasant to program in. That’s fine. You are not the target audience.&lt;&#x2F;p&gt;
&lt;p&gt;There’s a famous quote by Bjarne Strousup that goes “Within C++, there is a much smaller and cleaner language struggling to get out.” Within Rust, too, there is a much smaller and cleaner language struggling to get out: one with a clear vision, goals, focus. One that is coherent, because its features &lt;em&gt;cohere&lt;&#x2F;em&gt;. This post is about that language.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;learning-rust-requires-learning-many-things-at-once&quot;&gt;Learning Rust requires learning many things at once&lt;a class=&quot;zola-anchor&quot; href=&quot;#learning-rust-requires-learning-many-things-at-once&quot; aria-label=&quot;Anchor link for: learning-rust-requires-learning-many-things-at-once&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Rust is hard to learn. Not for lack of trying—many, many people have spent person-years on improving the diagnostics, documentation, and APIs—but because it’s complex. When people first learn the language, they are learning many different interleaving concepts:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;first class functions&lt;&#x2F;li&gt;
&lt;li&gt;enums&lt;&#x2F;li&gt;
&lt;li&gt;pattern matching&lt;&#x2F;li&gt;
&lt;li&gt;generics&lt;&#x2F;li&gt;
&lt;li&gt;traits&lt;&#x2F;li&gt;
&lt;li&gt;references&lt;&#x2F;li&gt;
&lt;li&gt;the borrow checker&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Send&lt;&#x2F;code&gt;&#x2F;&lt;code&gt;Sync&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Iterator&lt;&#x2F;code&gt;s&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;These concepts interlock. It is very hard to learn them one at a time because they interact with each other, and each affects the design of the others. Additionally, the standard library uses all of them heavily.&lt;&#x2F;p&gt;
&lt;p&gt;Let’s look at a Rust program that does something non-trivial:&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-rust&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;usr&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;bin&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;env &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;S cargo &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;Zscript
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;package&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;edition &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;2024&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;dependencies&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;notify &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;=8.2.0&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;path&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Path&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;notify&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;RecursiveMode&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; Watcher&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;notify&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Error&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; paths &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;pages&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;templates&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;static&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; watcher &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;notify&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;recommended_watcher&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;result&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;notify&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Event, &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Ok&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;event&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; result &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;            &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; paths&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; event&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;paths
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;                &lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;into_iter&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;                &lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;map&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;path&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;path&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;display&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;to_string&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;                &lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;collect&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;            &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;:&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{:?}&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; event&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;kind&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; paths&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;join&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;?&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; path &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; paths &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        watcher&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;watch&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;Path&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;path&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;RecursiveMode&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Recursive&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;?&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;loop&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;thread&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;park&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; sleep forever
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I tried to make this program as simple as possible: I used only the simplest iterator combinators, I don&#x27;t touch &lt;code&gt;std::mpsc&lt;&#x2F;code&gt; at all, I don&#x27;t use async, and I don&#x27;t do any complicated error handling.&lt;&#x2F;p&gt;
&lt;p&gt;Already, this program has many interleaving concepts. I&#x27;ll ignore the module system and macros, which are mostly independent of the rest of the language. To understand this program, you need to know that:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;recommended_watcher&lt;&#x2F;code&gt; and &lt;code&gt;map&lt;&#x2F;code&gt; take a function as an argument. In our program, that function is constructed inline as an anonymous function (closure).&lt;&#x2F;li&gt;
&lt;li&gt;Errors are handled using something called &lt;code&gt;Result&lt;&#x2F;code&gt;, not with exceptions or error codes. I happened to use &lt;code&gt;fn main() -&amp;gt; Result&lt;&#x2F;code&gt; and &lt;code&gt;?&lt;&#x2F;code&gt;, but you would still need to understand Result even without that, because Rust does not let you access the value inside unless you check for an error condition first.&lt;&#x2F;li&gt;
&lt;li&gt;Result takes a generic error; in our case, &lt;code&gt;notify::Error&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Result is an data-holding enum that can be either Ok or Err, and you can check which variant it is using pattern matching.&lt;&#x2F;li&gt;
&lt;li&gt;Iterators can be traversed either with a &lt;code&gt;for&lt;&#x2F;code&gt; loop or with &lt;code&gt;into_iter()&lt;&#x2F;code&gt;. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; &lt;code&gt;for&lt;&#x2F;code&gt; is eager and &lt;code&gt;into_iter&lt;&#x2F;code&gt; is lazy. &lt;code&gt;iter&lt;&#x2F;code&gt; has different ownership semantics than &lt;code&gt;into_iter&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;If you want to modify this program, you need to know some additional things:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;println&lt;&#x2F;code&gt; can only print things that implement the traits &lt;code&gt;Display&lt;&#x2F;code&gt; or &lt;code&gt;Debug&lt;&#x2F;code&gt;. As a result, &lt;code&gt;Path&lt;&#x2F;code&gt;s cannot be printed directly.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;path.display()&lt;&#x2F;code&gt; returns a struct that borrows from the path. Sending it to another thread (e.g. through a channel) won&#x27;t work, because &lt;code&gt;event.paths&lt;&#x2F;code&gt; goes out of scope when the closure passed to &lt;code&gt;recommended_watcher&lt;&#x2F;code&gt; finishes running. You need to convert it to an owned value or pass &lt;code&gt;event.paths&lt;&#x2F;code&gt; as a whole.
&lt;ul&gt;
&lt;li&gt;As an aside, this kind of thing encourages people to break work into &quot;large&quot; chunks instead of &quot;small&quot; chunks, which I think is often good for performance in CPU-bound programs, although as always it depends.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;recommended_watcher&lt;&#x2F;code&gt; only accepts functions that are &lt;code&gt;Send + &#x27;static&lt;&#x2F;code&gt;. Small changes to this program, such as passing the current path into the closure, will give a compile error related to ownership. Fixing it requires learning the &lt;code&gt;move&lt;&#x2F;code&gt; keyword, knowing that closures borrow their arguments by default, and the meaning of &lt;code&gt;&#x27;static&lt;&#x2F;code&gt;.
&lt;ul&gt;
&lt;li&gt;If you are using &lt;code&gt;Rc&amp;lt;RefCell&amp;lt;String&amp;gt;&amp;gt;&lt;&#x2F;code&gt;, which is often recommended for beginners&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, your program will need to be rewritten from scratch (either to use Arc&#x2F;Mutex or to use exterior mutability). For example, if you wanted to print changes from the main thread instead of worker threads to avoid interleaving output, you couldn&#x27;t simply push to the end of an &lt;code&gt;all_changes&lt;&#x2F;code&gt; collection, you would have to use &lt;code&gt;Arc&amp;lt;Mutex&amp;lt;Vec&amp;lt;Path&amp;gt;&amp;gt;&amp;gt;&lt;&#x2F;code&gt; in order to communicate between threads.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This is a &lt;em&gt;lot&lt;&#x2F;em&gt; of concepts for a 20 line program. For comparison, here is an equivalent javascript program:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; class=&quot;language-javascript z-code&quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-var z-expr z-ts&quot;&gt;&lt;span class=&quot;z-storage z-type z-ts&quot;&gt;const&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-var-single-variable z-expr z-ts&quot;&gt;&lt;span class=&quot;z-meta z-definition z-variable z-ts&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-ts&quot;&gt;fs&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-ts&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-ts&quot;&gt;&lt;span class=&quot;z-support z-function z-ts&quot;&gt;require&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-single z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;fs&lt;span class=&quot;z-punctuation z-definition z-string z-end z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-ts&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-var z-expr z-ts&quot;&gt;&lt;span class=&quot;z-storage z-type z-ts&quot;&gt;const&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-var-single-variable z-expr z-ts&quot;&gt;&lt;span class=&quot;z-meta z-definition z-variable z-ts&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-ts&quot;&gt;paths&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-ts&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-array z-literal z-ts&quot;&gt; &lt;span class=&quot;z-meta z-brace z-square z-ts&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-single z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;pages&lt;span class=&quot;z-punctuation z-definition z-string z-end z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-ts&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;templates&lt;span class=&quot;z-punctuation z-definition z-string z-end z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-ts&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;static&lt;span class=&quot;z-punctuation z-definition z-string z-end z-ts&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-square z-ts&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-ts&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-ts&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-var z-expr z-ts&quot;&gt;&lt;span class=&quot;z-storage z-type z-ts&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-var-single-variable z-expr z-ts&quot;&gt;&lt;span class=&quot;z-meta z-definition z-variable z-ts&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-ts&quot;&gt;path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-expression z-of z-ts&quot;&gt;of&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-ts&quot;&gt;paths&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-ts&quot;&gt;&lt;span class=&quot;z-variable z-other z-object z-ts&quot;&gt;fs&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-ts&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-ts&quot;&gt;watch&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-ts&quot;&gt;path&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-ts&quot;&gt;,&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt; &lt;span class=&quot;z-meta z-parameters z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameters z-begin z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-ts&quot;&gt;eventType&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameter z-ts&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-ts&quot;&gt;filename&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-parameters z-end z-ts&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-arrow z-ts&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-ts&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-ts&quot;&gt;filename&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-ts&quot;&gt;!==&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-null z-ts&quot;&gt;null&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;      &lt;span class=&quot;z-meta z-function-call z-ts&quot;&gt;&lt;span class=&quot;z-support z-class z-console z-ts&quot;&gt;console&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-ts&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-console z-ts&quot;&gt;log&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-template z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-template z-begin z-ts&quot;&gt;`&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-template z-expression z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-template-expression z-begin z-ts&quot;&gt;${&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-template z-expression z-ts&quot;&gt;&lt;span class=&quot;z-meta z-embedded z-line z-ts&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-ts&quot;&gt;eventType&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-template-expression z-end z-ts&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-template z-expression z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-template-expression z-begin z-ts&quot;&gt;${&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-template z-expression z-ts&quot;&gt;&lt;span class=&quot;z-meta z-embedded z-line z-ts&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-ts&quot;&gt;filename&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-template-expression z-end z-ts&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-template z-end z-ts&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;    &lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;  &lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-ts&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-ts&quot;&gt;&lt;span class=&quot;z-keyword z-control z-flow z-ts&quot;&gt;await&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-new z-expr z-ts&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-new z-ts&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-type z-ts&quot;&gt;Promise&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-meta z-parameters z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameters z-begin z-ts&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-parameters z-end z-ts&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-arrow z-ts&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-arrow z-ts&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-block z-ts&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brace z-round z-ts&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-ts&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-ts&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-ts&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-ts&quot;&gt; sleep forever&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;For this JS program, you need to understand:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;first class functions&lt;&#x2F;li&gt;
&lt;li&gt;nullability&lt;&#x2F;li&gt;
&lt;li&gt;yeah that&#x27;s kinda it.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I&#x27;m cheating a little here because &lt;code&gt;notify&lt;&#x2F;code&gt; returns a list of paths and &lt;code&gt;node:fs&#x2F;watch&lt;&#x2F;code&gt; doesn&#x27;t. But only a little.&lt;&#x2F;p&gt;
&lt;p&gt;My point is not that JS is a simpler language; that&#x27;s debatable. My point is that you can do things in JS without understanding the whole language. It&#x27;s very hard to do non-trivial things in Rust without understanding the whole core.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;rust-s-core-is-interwoven-on-purpose&quot;&gt;Rust&#x27;s core is interwoven on purpose&lt;a class=&quot;zola-anchor&quot; href=&quot;#rust-s-core-is-interwoven-on-purpose&quot; aria-label=&quot;Anchor link for: rust-s-core-is-interwoven-on-purpose&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The previous section makes it out to seem like I&#x27;m saying all these concepts are bad. I&#x27;m not. Rather the opposite, actually. Because these language features were designed in tandem, they interplay very nicely:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Enums without pattern matching &lt;a href=&quot;https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;utility&#x2F;variant.html&quot;&gt;are very painful to work with&lt;&#x2F;a&gt; and pattern matching without enums &lt;a href=&quot;https:&#x2F;&#x2F;www.hillelwayne.com&#x2F;post&#x2F;python-abc&#x2F;&quot;&gt;has very odd semantics&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Result&lt;&#x2F;code&gt; and &lt;code&gt;Iterator&lt;&#x2F;code&gt;s are impossible to implement without generics (or duck-typing, which I think of as type-erased generics)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Send&lt;&#x2F;code&gt;&#x2F;&lt;code&gt;Sync&lt;&#x2F;code&gt;, and the preconditions to &lt;code&gt;println&lt;&#x2F;code&gt;, are impossible to encode without traits—and this often comes up in other languages, for example printing a function in clojure shows something like &lt;code&gt;#object[clojure.core$map 0x2e7de98a &quot;clojure.core$map@2e7de98a&quot;]&lt;&#x2F;code&gt;. In Rust it gives a compile error unless you opt-in with Debug.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;Send&lt;&#x2F;code&gt; &#x2F; &lt;code&gt;Sync&lt;&#x2F;code&gt; are only possible to enforce because the borrow checker does capture analysis for closures. Java, which is &lt;em&gt;wildly&lt;&#x2F;em&gt; committed to thread-safety by the standards of most languages, cannot verify this at compile time and so has to &lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;java&#x2F;javase&#x2F;24&#x2F;docs&#x2F;api&#x2F;java.base&#x2F;java&#x2F;text&#x2F;SimpleDateFormat.html#synchronization&quot;&gt;document synchronization concerns explicitly&lt;&#x2F;a&gt; instead.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;There are more interplays than I can easily describe in a post, and all of them are what make Rust what it is.&lt;&#x2F;p&gt;
&lt;p&gt;Rust has other excellent language features—for example the &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nightly&#x2F;reference&#x2F;inline-assembly.html&quot;&gt;inline assembly syntax&lt;&#x2F;a&gt; is a work of art, props to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;amanieu&quot;&gt;Amanieu&lt;&#x2F;a&gt;. But they are not interwoven into the standard library in the same way, and they do not affect the way people &lt;em&gt;think&lt;&#x2F;em&gt; about writing code in the same way.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;a-smaller-rust&quot;&gt;A smaller Rust&lt;a class=&quot;zola-anchor&quot; href=&quot;#a-smaller-rust&quot; aria-label=&quot;Anchor link for: a-smaller-rust&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;without.boats wrote a post in 2019 titled &lt;a href=&quot;https:&#x2F;&#x2F;without.boats&#x2F;blog&#x2F;notes-on-a-smaller-rust&#x2F;&quot;&gt;&quot;Notes on a smaller Rust&quot;&lt;&#x2F;a&gt; (and a follow-up &lt;a href=&quot;https:&#x2F;&#x2F;without.boats&#x2F;blog&#x2F;revisiting-a-smaller-rust&#x2F;&quot;&gt;revisiting&lt;&#x2F;a&gt; it). In a manner of speaking, that smaller Rust &lt;em&gt;is&lt;&#x2F;em&gt; the language I fell in love with when I first learned it in 2018. Rust is a lot bigger today, in many ways, and the smaller Rust is just a nostalgic rose-tinted memory. But I think it&#x27;s worth studying as an example of how well &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Orthogonality#Computer_science&quot;&gt;orthogonal&lt;&#x2F;a&gt; features can compose when they&#x27;re designed as one cohesive whole.&lt;&#x2F;p&gt;
&lt;p&gt;If you liked this post, consider reading &lt;a href=&quot;https:&#x2F;&#x2F;matklad.github.io&#x2F;2020&#x2F;07&#x2F;15&#x2F;two-beautiful-programs.html&quot;&gt;Two Beautiful Rust Programs&lt;&#x2F;a&gt; by matklad.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;This program intentionally uses a file watcher because file IO is not possible to implement efficiently with async on Linux (and also because I wrote a file watcher recently for &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;flower&#x2F;&quot;&gt;flower&lt;&#x2F;a&gt;, so it&#x27;s fresh in my mind). Tokio itself just uses a threadpool, alongside channels for notifying the future. I don’t want to get into async here; this just demonstrates Send&#x2F;Sync bounds and callbacks. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;Technically, &lt;code&gt;for&lt;&#x2F;code&gt; is syntax sugar around &lt;code&gt;into_iter()&lt;&#x2F;code&gt;, but you don&#x27;t need to know that for most rust programs. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;which is a terrible idea by the way, even more experienced Rust programmers often don&#x27;t understand the interior mutability very well; see &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;dtolnay&#x2F;latest&#x2F;dtolnay&#x2F;macro._02__reference_types.html&quot;&gt;this blog post by dtolnay&lt;&#x2F;a&gt; on the difference between mutability and uniqueness in reference types. It would be better to suggest using owned types with exterior mutability and cloning frequently. &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>how to communicate with intent</title>
        <published>2025-08-11T00:00:00+00:00</published>
        <updated>2025-08-11T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/how-to-communicate-with-intent/"/>
        <id>https://jyn.dev/how-to-communicate-with-intent/</id>
        
        <summary type="html">say what you mean to say, not just the first thing on your mind</summary>
        
        <content type="html" xml:base="https://jyn.dev/how-to-communicate-with-intent/">&lt;p&gt;As you can see from this blog, I like to talk (my friends will be the first to confirm this). Just as important as knowing how to talk, though, is knowing what to say and when to listen.&lt;&#x2F;p&gt;
&lt;p&gt;In this post I will give a few simple tips on how to improve your communication in various parts of your life. My goal is partly to help you to be a more effective communicator, and partly to reduce the number of people in my life who get on my nerves :P&lt;&#x2F;p&gt;
&lt;p&gt;You don&#x27;t always need these tips. In casual conversations and when brainstorming, it&#x27;s healthy to just say the first thing on your mind. But not all conversations are casual, and conversations can slip into seriousness faster than you expect. For those situations, you need to be intentional. Otherwise, it&#x27;s easy to end up with hurt feelings on both sides, or waste the time of everyone involved.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;adapt-to-your-audience&quot;&gt;adapt to your audience&lt;a class=&quot;zola-anchor&quot; href=&quot;#adapt-to-your-audience&quot; aria-label=&quot;Anchor link for: adapt-to-your-audience&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;First, think about your audience. Adapt your message to the person you’re speaking to. Someone learning Rust for the first time does not need an infodump about variance and type coercion, they need an introduction to enums, generics, and pattern matching. Similarly, if a barista asks you what the weird code on your screen is, don’t tell them you’re writing a &lt;a href=&quot;https:&#x2F;&#x2F;codeberg.org&#x2F;jyn514&#x2F;flower&#x2F;&quot;&gt;meta-Static Site Generator in Clojure&lt;&#x2F;a&gt;, tell them you’re building a tool to help people create websites.&lt;&#x2F;p&gt;
&lt;p&gt;If you are writing a promotion doc, a resume, or a tutorial, don&#x27;t just dump a list of everything that&#x27;s relevant. Think about the structure of your document: the questions your reader is likely to have, the amount of time they are likely going to spend reading, and the order they are likely to read in. You need to be &lt;em&gt;legible&lt;&#x2F;em&gt;, which means explaining concrete impacts in terms your audience understands. It&#x27;s not enough to say what&#x27;s true; you have to also say why it&#x27;s important.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;consider-your-purpose&quot;&gt;consider your purpose&lt;a class=&quot;zola-anchor&quot; href=&quot;#consider-your-purpose&quot; aria-label=&quot;Anchor link for: consider-your-purpose&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Consider your intended effect. If a teacher goes on Twitter saying she doesn’t understand why maths is important and we should just give out A’s like candy (real thing that happened on my feed!), dog piling on her is not going to change her mind. Show her a case in her life where maths would be useful, and don’t talk down to her. Self-righteousness feels good in the moment, but doesn’t actually achieve anything. If you just want to gloat about how other people are stupid, go play an FPS or something; Twitter has enough negativity.&lt;&#x2F;p&gt;
&lt;p&gt;If you are writing a blog post, know why you are writing it. If you are writing to practice the skill of writing, or to have a reference document, or to share with your friends, infodumping is fine. If you are writing with a goal in mind—say you want to &lt;a href=&quot;https:&#x2F;&#x2F;www.joelonsoftware.com&#x2F;2002&#x2F;11&#x2F;11&#x2F;the-law-of-leaky-abstractions&#x2F;&quot;&gt;give a name to an idea&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;oldnewthing&#x2F;20250808-00&#x2F;?p=111447&quot;&gt;communicate when software can fail&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;how-i-use-my-terminal&#x2F;&quot;&gt;enter an idea into the overton window&lt;&#x2F;a&gt;—be intentional. Consider your audience, and the background you expect them to start from. Posting the equivalent of a wikipedia article is rarely the most effective way to instill an idea.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;corollary-don-t-argue-for-argument-s-sake&quot;&gt;corollary: don&#x27;t argue for argument&#x27;s sake&lt;a class=&quot;zola-anchor&quot; href=&quot;#corollary-don-t-argue-for-argument-s-sake&quot; aria-label=&quot;Anchor link for: corollary-don-t-argue-for-argument-s-sake&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Don’t fight losing causes, &lt;a href=&quot;https:&#x2F;&#x2F;boardgamegeek.com&#x2F;blog&#x2F;5988&#x2F;blogpost&#x2F;76876&#x2F;if-youre-going-to-do-something-that-crazy&quot;&gt;unless the cause is really worth it&lt;&#x2F;a&gt;. Someone on hacker news saying &quot;language A Sucks and you Should use language B instead&quot; is not worth arguing with. Someone who says &quot;language A is good in scenario X, but has shortcomings in scenario Y compared to language B&quot; is much more serious and worth listening to. Arguing with someone who refuses to be convinced wastes everyone’s time.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;balance-conversational-effort&quot;&gt;balance conversational effort&lt;a class=&quot;zola-anchor&quot; href=&quot;#balance-conversational-effort&quot; aria-label=&quot;Anchor link for: balance-conversational-effort&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Be a good conversational partner. Ask directed probing questions: they show you are listening to the other person and invested in the topic. Saying “I don’t understand” puts the burden on them to figure out the source of the misunderstanding. If you really aren’t sure what to ask, because you’re confused or the other person was vague, I like “say more?” as a way to leave it open ended for the other person on how to elaborate.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;consider-implications&quot;&gt;consider implications&lt;a class=&quot;zola-anchor&quot; href=&quot;#consider-implications&quot; aria-label=&quot;Anchor link for: consider-implications&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Consider the implications of how you communicate. When you say things, you are not just communicating the words you speak, you are also affecting the person you&#x27;re talking to.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;not-everyone-wants-to-hear-an-infodump&quot;&gt;not everyone wants to hear an infodump&lt;a class=&quot;zola-anchor&quot; href=&quot;#not-everyone-wants-to-hear-an-infodump&quot; aria-label=&quot;Anchor link for: not-everyone-wants-to-hear-an-infodump&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;If the person you&#x27;re infodumping to isn&#x27;t interested in the topic, infodumping anyway puts them in an awkward situation where they either have to ask you to stop or sit through a long conversation they didn&#x27;t want to be in.&lt;&#x2F;p&gt;
&lt;p&gt;Another tricky scenario is when the other person is interested, but an infodump is not the right level of detail for them right now. Perhaps they are new to the topic, or perhaps they asked a direct question. If they&#x27;re still trying to get the &quot;big picture&quot;, zooming in to fine-grained details will often just confuse them further.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;apologies-are-not-the-time-to-infodump&quot;&gt;apologies are not the time to infodump&lt;a class=&quot;zola-anchor&quot; href=&quot;#apologies-are-not-the-time-to-infodump&quot; aria-label=&quot;Anchor link for: apologies-are-not-the-time-to-infodump&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Info-dumping during an apology—even if it’s related to the thing you&#x27;re apologizing for!—buries the apology. More than that, it implies that you expect &lt;em&gt;mitigated judgement&lt;&#x2F;em&gt;. If there is a power dynamic between you (say a wealth gap, or you are a manager and they are an employee), that expectation of mitigated judgment implies you &lt;em&gt;expect to be forgiven&lt;&#x2F;em&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;bsky.app&#x2F;profile&#x2F;did:plc:h2okxbr76w5522tailkxmidq&#x2F;post&#x2F;3lvrxmdvb3s2r&quot;&gt;an apology given in expectation of forgiveness is really just a request for absolution&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Instead, apologize directly. If you were in an altered mental state (angry, sleep-deprived, experiencing a trauma trigger), you can add at most 1-2 sentences of context asking the other person to mitigate judgement. Not all apologies need context; often &quot;i was wrong, i&#x27;m sorry&quot; is enough.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;infodumps-will-not-prevent-all-miscommunication&quot;&gt;infodumps will not prevent all miscommunication&lt;a class=&quot;zola-anchor&quot; href=&quot;#infodumps-will-not-prevent-all-miscommunication&quot; aria-label=&quot;Anchor link for: infodumps-will-not-prevent-all-miscommunication&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;As we&#x27;ve seen above, there are times when infodumps actively hurt you. Even when they don&#x27;t, though, there can be times when they aren&#x27;t helping. Everyone comes to a conversation with a different background, and you cannot perfectly predict how they will respond. Rather than trying to avoid every possible miscommunication by packing the maximum amount of information—Say what you mean to say. Then, address the actual miscommunication (or regular conversation!) that happens afterwards. This saves time and energy for both conversational partners.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;be-legible&quot;&gt;be legible&lt;a class=&quot;zola-anchor&quot; href=&quot;#be-legible&quot; aria-label=&quot;Anchor link for: be-legible&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The common theme of all of the above is to communicate &lt;em&gt;effectively&lt;&#x2F;em&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@ElizAyer&#x2F;dont-ask-forgiveness-radiate-intent-d36fd22393a3&quot;&gt;&lt;em&gt;radiate intent&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;. Making it easy for the other person to understand both what you&#x27;re saying and why you&#x27;re saying it incurs a lot of goodwill, and makes it possible to say more things more bluntly than you would otherwise.&lt;&#x2F;p&gt;
&lt;p&gt;A common trap I see people fall into is to say the first thing on their mind. This is fine for conversations between friends (although you should still consider how it affects your relationship!) but but is often counterproductive in other contexts. Slow down. Take your time. Say what you mean to say. If you don&#x27;t mean to say anything, don&#x27;t say anything at all.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>an engineer's perspective on hiring</title>
        <published>2025-08-08T00:00:00+00:00</published>
        <updated>2025-08-08T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/an-engineers-perspective-on-hiring/"/>
        <id>https://jyn.dev/an-engineers-perspective-on-hiring/</id>
        
        <summary type="html">hiring in tech is broken and everyone knows it. what can we do better?</summary>
        
        <content type="html" xml:base="https://jyn.dev/an-engineers-perspective-on-hiring/">&lt;p&gt;&lt;strong&gt;note for my friends: this post is targeted at companies and engineering managers. i know you know that hiring sucks and companies waste your time. this is a business case for why they shouldn&#x27;t do that.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;hiring-sucks&quot;&gt;hiring sucks&lt;a class=&quot;zola-anchor&quot; href=&quot;#hiring-sucks&quot; aria-label=&quot;Anchor link for: hiring-sucks&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;most companies suck at hiring. they waste everyone’s time (i once had a 9-round interview pipeline!), they &lt;a href=&quot;https:&#x2F;&#x2F;danluu.com&#x2F;programmer-moneyball&#x2F;&quot;&gt;chase the trendiest programmers&lt;&#x2F;a&gt;, and they &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@weswinham&#x2F;chatgpt-killed-the-tech-interview-i-tested-11-methods-and-heres-what-survived-5652a3e95190&quot;&gt;can’t even tell programmers apart from an LLM&lt;&#x2F;a&gt;. in short, &lt;a href=&quot;https:&#x2F;&#x2F;predr.ag&#x2F;blog&#x2F;mediocrity-can-be-a-sign-of-excellence&#x2F;&quot;&gt;they are not playing moneyball&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;things are bad for interviewees too. some of the best programmers i know (think people maintaining the rust compiler) can’t get jobs because &lt;a href=&quot;https:&#x2F;&#x2F;hadid.dev&#x2F;posts&#x2F;living-coding&#x2F;&quot;&gt;they interview poorly under stress&lt;&#x2F;a&gt;. one with 4 years of Haskell experience and 2 years of Rust experience was labeled as “non-technical” by a recruiter. and of course, companies repeatedly ghost people for weeks or months about whether they actually got a job.&lt;&#x2F;p&gt;
&lt;p&gt;this post explores why hiring is hard, how existing approaches fail, and what a better approach could look like. my goal, of course, is to get my friends hired. &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;reach out to me&lt;&#x2F;a&gt; if you like the ideas here.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-makes-a-good-interview&quot;&gt;what makes a good interview&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-makes-a-good-interview&quot; aria-label=&quot;Anchor link for: what-makes-a-good-interview&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;before i start talking about my preferred approach, let’s start by establishing some (hopefully uncontroversial) principles.&lt;&#x2F;p&gt;
&lt;p&gt;interviews should:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;differentiate&lt;&#x2F;strong&gt;. be able to tell the difference between a senior programmer and a marketer using chatgpt.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;be applicable&lt;&#x2F;strong&gt;. reflect the actual job duties.
&lt;ul&gt;
&lt;li&gt;this includes coding. but it also includes architecture design, PR review, documentation, on and on and on. all good senior software engineers are generalists.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;think long term&lt;&#x2F;strong&gt;. select for applicants who will be good employees for years to come, not just in the next quarter.
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;danluu.com&#x2F;people-matter&#x2F;&quot;&gt;people are not fungible&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;yosefk.com&#x2F;blog&#x2F;compensation-rationality-and-the-projectperson-fit.html&quot;&gt;there is a high cost to losing employees who are a good fit to the project&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;theory-building-without-a-mentor&#x2F;#theory-building&quot;&gt;there is a high cost to losing employees in general&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;companies often over-index on crystallized knowledge over fluid intelligence. spending an additional month to find people who specialize in your tech stack, when you could have onboarded them to that stack in a month, is an advanced form of self-sabotage.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;be time efficient&lt;&#x2F;strong&gt;. spend as little time as possible interviewing.
&lt;ul&gt;
&lt;li&gt;engineer time is expensive.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;be respectful&lt;&#x2F;strong&gt;. respect the applicant and their time.
&lt;ul&gt;
&lt;li&gt;if you don&#x27;t respect the applicant, you will select for people who don&#x27;t respect themselves, and drive away the best applicants.&lt;&#x2F;li&gt;
&lt;li&gt;&quot;but i want to select for people that don&#x27;t respect themselves so i can pay them less&quot;—get the hell off my site and don&#x27;t come back.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;there is also a 6th criteria that&#x27;s more controversial. let&#x27;s call it &lt;strong&gt;taste&lt;&#x2F;strong&gt;. an engineer with poor &lt;strong&gt;taste&lt;&#x2F;strong&gt; can ship things very quickly at the expense of leaving a giant mess for everyone else on the team to clean up. measuring this is very hard but also very important. conversely, &lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;4yleYA2giPE?si=6ukBDYiqAikWPKhp&amp;amp;t=1348&quot;&gt;someone who spends time empowering the rest of their team has a multiplicative effect on their team&#x27;s productivity&lt;&#x2F;a&gt; (c.f. &lt;a href=&quot;https:&#x2F;&#x2F;www.noidea.dog&#x2F;glue&quot;&gt;&quot;Being Glue&quot;&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;let&#x27;s look at some common interviews and how they fare.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;live-coding-often-called-leetcode-interviews&quot;&gt;live coding, often called &quot;leetcode interviews&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#live-coding-often-called-leetcode-interviews&quot; aria-label=&quot;Anchor link for: live-coding-often-called-leetcode-interviews&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;fails on &lt;strong&gt;differentiating, applicability, respect, taste&lt;&#x2F;strong&gt;. gives very little signal about &lt;strong&gt;long term value&lt;&#x2F;strong&gt;. live coding &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@weswinham&#x2F;chatgpt-killed-the-tech-interview-i-tested-11-methods-and-heres-what-survived-5652a3e95190&quot;&gt;cannot distinguish a senior programmer from a marketer using chatGPT&lt;&#x2F;a&gt;, and most interview questions have very little to do with day-to-day responsibilities. all good software engineers are generalist and live coding does not select for generalists.&lt;&#x2F;p&gt;
&lt;p&gt;you can augment live coding with multiple rounds of interviews, each of which tests one of the above responsibilities. but now you lose &lt;strong&gt;time efficiency&lt;&#x2F;strong&gt;; everything takes lots of engineer time. doing this despite the expense is a show of wealth, and now you are no longer playing moneyball.&lt;&#x2F;p&gt;
&lt;p&gt;additionally, people with lots of experience often find the experience demeaning, so you are filtering out the best applicants. a friend explicitly said &quot;I have 18 years of experience on GitHub; if you can&#x27;t tell I&#x27;m a competent programmer from that it&#x27;s not a good fit.&quot;&lt;&#x2F;p&gt;
&lt;p&gt;something not often thought about is that this also loses you &lt;strong&gt;taste&lt;&#x2F;strong&gt;. the code that someone puts together under pressure is not a reflection of how they normally work, and does not let you judge if your engineers will like working with them.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;take-home-interviews&quot;&gt;take-home interviews&lt;a class=&quot;zola-anchor&quot; href=&quot;#take-home-interviews&quot; aria-label=&quot;Anchor link for: take-home-interviews&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;fails on &lt;strong&gt;differentiating&lt;&#x2F;strong&gt; and &lt;strong&gt;respect&lt;&#x2F;strong&gt;, and partially on &lt;strong&gt;applicability&lt;&#x2F;strong&gt;. take home interviews are very easy for chatGPT to game and have all the other problems of live interviews, except that they remove the &quot;interview poorly under stress&quot; component. but they trade off a fundamental &lt;strong&gt;time asymmetry&lt;&#x2F;strong&gt; with the applicant, which again drives away the best people.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;architecture-design&quot;&gt;architecture design&lt;a class=&quot;zola-anchor&quot; href=&quot;#architecture-design&quot; aria-label=&quot;Anchor link for: architecture-design&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this does a lot better. you can&#x27;t use chatGPT to fake an architecture interview&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. it fails at &lt;strong&gt;applicability&lt;&#x2F;strong&gt; (you don&#x27;t ever see the applicant&#x27;s code). at first glance it appears to give you some insight into &lt;strong&gt;taste&lt;&#x2F;strong&gt;, but often it is measuring &quot;how well does the applicant know the problem domain&quot; instead of &quot;how does the applicant think about design problems&quot;, so you have to be careful about over-indexing on it.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;meet-the-team&quot;&gt;&quot;meet the team&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#meet-the-team&quot; aria-label=&quot;Anchor link for: meet-the-team&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;i haven&#x27;t seen this one a lot for external interviews, but i see it very commonly for internal transfers within a company. it has much of the same tradeoffs as architecture design interviews, except it usually isn&#x27;t trying to judge skills at all, mostly personality and &quot;fit&quot; (i.e. it fails on &lt;strong&gt;differentiating&lt;&#x2F;strong&gt; and partially on &lt;strong&gt;applicability&lt;&#x2F;strong&gt;). i think it makes sense in environments where the candidate has a very strong recommendation and there&#x27;s little competition for the position; or if you have some other reason to highly value their skills without a formal assessment.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;extended-essays-and-work-samples&quot;&gt;extended essays and work samples&lt;a class=&quot;zola-anchor&quot; href=&quot;#extended-essays-and-work-samples&quot; aria-label=&quot;Anchor link for: extended-essays-and-work-samples&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this is an interesting one. i&#x27;ve only ever seen it from &lt;a href=&quot;https:&#x2F;&#x2F;rfd.shared.oxide.computer&#x2F;rfd&#x2F;0003#_mechanics_of_evaluation&quot;&gt;Oxide Computer Company&lt;&#x2F;a&gt;. i like it really quite a lot. the process looks like this:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;the applicant submits samples of their existing work (or writes new documents specially for the interview)&lt;&#x2F;li&gt;
&lt;li&gt;the applicant writes detailed responses to 8 questions about their values, work, career, and goals.&lt;&#x2F;li&gt;
&lt;li&gt;the applicant goes through 9 hours of interviews with several oxide employees.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;this does really really well on nearly every criteria (including &lt;strong&gt;respect&lt;&#x2F;strong&gt;—note that the time spent here is symmetric, it takes a &lt;em&gt;long&lt;&#x2F;em&gt; time for Oxide&#x27;s engineers to read that much written material).&lt;&#x2F;p&gt;
&lt;p&gt;it fails on &lt;strong&gt;time efficiency&lt;&#x2F;strong&gt;. i have not gone through this process, but based on the questions and my knowledge of who gets hired at oxide, i would expect &lt;em&gt;just&lt;&#x2F;em&gt; the written work to take at around 5-15 hours of time for a single application. given oxide and their goals, and the sheer number of people who apply there, i suspect they are ok with that tradeoff (and indeed probably value that it drives away people who aren&#x27;t committed to the application). but most companies are not oxide and cannot afford this amount of time on both sides.&lt;&#x2F;p&gt;
&lt;p&gt;if i were to take ideas from the oxide process without sacrificing too much time, i’d keep &quot;you write the code ahead of time and discuss it in the interview&quot;. this keeps the advantage of take-home interviews—no time pressure, less stressful environment—while adding a &lt;strong&gt;symmetric time&lt;&#x2F;strong&gt; component that makes talented engineers less likely to dismiss the job posting out of hand, without an enormous up-front expenditure of time. and discussing the code live filters out people who just vibecoded the whole thing (they won&#x27;t be able to explain what it does!) while giving everyone else a chance to explain their thinking, helping with &lt;strong&gt;applicability&lt;&#x2F;strong&gt; and &lt;strong&gt;taste&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;this still has some &lt;strong&gt;time asymmetry&lt;&#x2F;strong&gt; if the applicant doesn’t have existing open source work they want to show to an interviewer, but it’s a lot less than 5-15 hours, and the company is forced to dedicate some of their own engineer time, so they have motivation not to “throw work over the wall”, showing respect for the applicant.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;code-review&quot;&gt;code review &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#code-review&quot; aria-label=&quot;Anchor link for: code-review&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this one i’ve also only ever seen once. the format is that the interviewer writes some mediocre code ahead of time and asks the applicant how they would improve it. i did very well on this format so i&#x27;m biased, but i like it a lot. it aces all our criteria:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;it reverses the &lt;strong&gt;time asymmetry&lt;&#x2F;strong&gt; and reduces the amount of &lt;strong&gt;time spent&lt;&#x2F;strong&gt;. the interviewer makes one up front time commitment, the applicant makes no up front commitment, and they spend the same amount of time per interview.&lt;&#x2F;li&gt;
&lt;li&gt;it’s &lt;strong&gt;applicable&lt;&#x2F;strong&gt;: you see how the applicant gives interpersonal feedback; discussions about the code naturally lead into discussions about design; and you get information about their sense of taste.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;imagining-a-better-interview-process&quot;&gt;imagining a better interview process&lt;a class=&quot;zola-anchor&quot; href=&quot;#imagining-a-better-interview-process&quot; aria-label=&quot;Anchor link for: imagining-a-better-interview-process&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;if i were a hiring manager, i would use a combo of a code review interview and a work sample discussed live, giving precedence to the code review and telling the applicant ahead of time that the work sample doesn’t have to be perfect.&lt;&#x2F;p&gt;
&lt;p&gt;programming is fundamentally a collaborative process. having the applicant collaborate on both sides (reviewing and authoring) shows you a lot about how they work, and signals to them that you care about more than the equivalent of their SAT score.&lt;&#x2F;p&gt;
&lt;p&gt;i also suggest there always be at least one interview between the applicant and their future manager (this seems to already be common practice—yay!). &quot;people don&#x27;t quit jobs, they quit bosses&quot;: letting them meet ahead of time saves everyone pain down the road.&lt;&#x2F;p&gt;
&lt;p&gt;thank you for reading! i hope this inspires you to change your own hiring processes, or at least to write a comment telling me why i&#x27;m wrong ^^. you can reach me by &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;email&lt;&#x2F;a&gt; if you want to comment privately.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;p-s-other-interview-processes&quot;&gt;P.S. other interview processes&lt;a class=&quot;zola-anchor&quot; href=&quot;#p-s-other-interview-processes&quot; aria-label=&quot;Anchor link for: p-s-other-interview-processes&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;pairing&quot;&gt;pairing&lt;a class=&quot;zola-anchor&quot; href=&quot;#pairing&quot; aria-label=&quot;Anchor link for: pairing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;a friend worked at a Pivotal Labs where the primary job responsibility was to pair with client developers. the interview process was for a candidate to pair with an existing employee for a whole day and &quot;shadow&quot; them. he points to &lt;a href=&quot;https:&#x2F;&#x2F;www.simplermachines.com&#x2F;notes-on-the-pivotal-interview-process&#x2F;&quot;&gt;Nat Bennett&#x27;s notes on the interview process&lt;&#x2F;a&gt; as a more detailed writeup.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;p-p-s-measuring-interview-effectiveness&quot;&gt;P.P.S. measuring interview effectiveness&lt;a class=&quot;zola-anchor&quot; href=&quot;#p-p-s-measuring-interview-effectiveness&quot; aria-label=&quot;Anchor link for: p-p-s-measuring-interview-effectiveness&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;the most interesting comment i got in response to this post was about &quot;red-teaming&quot; the interview to see how effective it is. for example:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;taking existing employees and putting them through the interview process and seeing whether it suggests hiring them again. if it doesn&#x27;t, it&#x27;s either horribly noisy or filtering out good candidates or both.&lt;&#x2F;li&gt;
&lt;li&gt;&quot;regret analysis&quot;: following the careers of rejected candidates to see who went on to do interesting things. if so, find out which part of the interview process failed and change it.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;the friend who suggested this said both ideas were categorically rejected by management and they continued to send him mediocre resumes for people he didn&#x27;t want to hire.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;update from after publishing: a friend said they’ve seen people successfully use chatgpt to game design interviews. oof. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;this section was added the day after publishing in response to feedback from senior engineers and hiring managers. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>you are in a box</title>
        <published>2025-07-14T00:00:00+00:00</published>
        <updated>2025-07-14T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/you-are-in-a-box/"/>
        <id>https://jyn.dev/you-are-in-a-box/</id>
        
        <summary type="html">your data is trapped inside the box that is your program. you can only see what the program author exposes.</summary>
        
        <content type="html" xml:base="https://jyn.dev/you-are-in-a-box/">&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;drmaciver.substack.com&#x2F;i&#x2F;145700143&#x2F;you-are-in-a-box&quot;&gt;
&lt;p&gt;&lt;strong&gt;You are trapped in a box. You have been for a long time.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;drmaciver.substack.com&#x2F;i&#x2F;145700143&#x2F;you-are-in-a-box&quot;&gt;D. R. MacIver&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Jamie_Zawinski#Zawinski&#x27;s_Law&quot;&gt;
&lt;p&gt;&lt;strong&gt;Every program attempts to expand until it can read mail. Those programs which cannot so expand are replaced by ones which can.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Jamie_Zawinski#Zawinski&#x27;s_Law&quot;&gt;Zawinski&#x27;s Law of Software Envelopment&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;h2 id=&quot;switching-costs-and-growth&quot;&gt;switching costs and growth&lt;a class=&quot;zola-anchor&quot; href=&quot;#switching-costs-and-growth&quot; aria-label=&quot;Anchor link for: switching-costs-and-growth&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;most tools simultaneously think too small and too big. “i will let you do anything!”, they promise, “as long as you give up your other tools and switch to me!”&lt;&#x2F;p&gt;
&lt;p&gt;this is true of languages too. any new programming language makes an implicit claim that “using this language will give you an advantage over any other language”, at least for your current problem.&lt;&#x2F;p&gt;
&lt;p&gt;once you start using a tool for one purpose, due to switching costs, you want to keep using that tool. so you start using it for things that wasn’t designed for, and as a result, tools tend to grow and grow and grow until they &lt;a href=&quot;&#x2F;technical-debt-is-different-from-technical-risk&#x2F;#what-to-do-about-risk&quot;&gt;stagnate&lt;&#x2F;a&gt;. in a sense, we have replicated the business boom-and-bust cycle in our own tools.&lt;&#x2F;p&gt;
&lt;!-- &#x2F;technical-debt-is-different-from-technical-risk&#x2F;#technical-risk-means-a-program-is-hard-to-modify --&gt;
&lt;!--## escaping the boom and bust cycle--&gt;
&lt;h2 id=&quot;interoperability&quot;&gt;interoperability&lt;a class=&quot;zola-anchor&quot; href=&quot;#interoperability&quot; aria-label=&quot;Anchor link for: interoperability&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;there are two possible ways to escape this trap. the first is to &lt;a href=&quot;https:&#x2F;&#x2F;graydon2.dreamwidth.org&#x2F;263429.html&quot;&gt;impose a limit on growth&lt;&#x2F;a&gt;, so that tools can’t grow until they bust. this makes a lot of people very unhappy and is generally regarded as a bad idea.&lt;&#x2F;p&gt;
&lt;p&gt;the second is to decrease switching costs. by making it easier to switch between tools, or to interoperate between multiple tools in the same system, there is not as much pressure to have “one big hammer” that gets used for every problem.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;back-compat&quot;&gt;back-compat&lt;a class=&quot;zola-anchor&quot; href=&quot;#back-compat&quot; aria-label=&quot;Anchor link for: back-compat&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;tools and languages can decrease switching costs by keeping backwards compatibility with older tools, or at least being close enough that they’re &lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;SxdOUGdseq4?si=X9OZ975hwwzZOxpo&amp;amp;t=346&quot;&gt;easy to learn&lt;&#x2F;a&gt; for people coming from those tools. for example, ripgrep has almost exactly the same syntax as GNU grep, and nearly every compiled language since C has kept the curly braces.&lt;&#x2F;p&gt;
&lt;!--note that you can think of different versions of a tool as having to interoperate with themselves, so you may see these techniques used even when the authors did not intend a clear interface boundary.--&gt;
&lt;h3 id=&quot;standardization&quot;&gt;standardization&lt;a class=&quot;zola-anchor&quot; href=&quot;#standardization&quot; aria-label=&quot;Anchor link for: standardization&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;tools can also collaborate on standards that make it easier to interoperate. this is the basis of nearly every network protocol, since there&#x27;s no guarantee that the same tool will be on the other side of the connection. to some extent this also happens for languages (most notably for C), where a language specification allows multiple different compilers to work on the same code.&lt;&#x2F;p&gt;
&lt;p&gt;this has limitations, however, because the tool itself has to want (or be forced) to interoperate. for example, the binary format for CUDA (a framework for compiling programs to the GPU) is undocumented, so you&#x27;re stuck with &lt;a href=&quot;https:&#x2F;&#x2F;blog.vivekpanyam.com&#x2F;parsing-an-undocumented-file-format&quot;&gt;reverse engineering&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;docs.vulkan.org&#x2F;guide&#x2F;latest&#x2F;what_is_spirv.html&quot;&gt;re-implementing&lt;&#x2F;a&gt; the toolchain if you want to modify it.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;ffi&quot;&gt;FFI&lt;a class=&quot;zola-anchor&quot; href=&quot;#ffi&quot; aria-label=&quot;Anchor link for: ffi&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;the last &quot;internal&quot; way to talk to languages is through a &quot;foreign function interface&quot;, where functions in the same process can call each other cheaply. this is hard because each language has to go &lt;a href=&quot;https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;c-isnt-a-language&#x2F;&quot;&gt;all the way down to the C ABI&lt;&#x2F;a&gt; before there&#x27;s something remotely resembling a standard, and because two languages may have incompatible runtime properties that make FFI &lt;a href=&quot;https:&#x2F;&#x2F;pkg.go.dev&#x2F;cmd&#x2F;cgo#hdr-Passing_pointers&quot;&gt;hard&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;words.filippo.io&#x2F;rustgo&#x2F;#why-not-cgo&quot;&gt;slow&lt;&#x2F;a&gt;. languages that do encourage FFI often require you to write separate bindings for each program: for example, Rust requires you to write &lt;code&gt;extern &quot;C&quot;&lt;&#x2F;code&gt; blocks for each declaration, and python requires you to do that and also write wrappers that translate C types into python objects.&lt;&#x2F;p&gt;
&lt;p&gt;i won&#x27;t talk too much more about this—the work i&#x27;m aware of in this area is mostly around &lt;a href=&quot;https:&#x2F;&#x2F;webassembly.org&#x2F;&quot;&gt;WASM&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;component-model.bytecodealliance.org&#x2F;&quot;&gt;WASM Components&lt;&#x2F;a&gt;, and there are also some efforts to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rfcs&#x2F;pull&#x2F;3470&quot;&gt;raise the baseline for ABI&lt;&#x2F;a&gt; above the C level.&lt;&#x2F;p&gt;
&lt;!--for instance, take the Go language. Go has many strengths—a performant green threads runtime, excellent devtools, static binaries. in exchange, you are locked into the Go ecosystem. unlike other languages (Python, Rust, JS), calls between Go and other languages are [hard](https:&#x2F;&#x2F;pkg.go.dev&#x2F;cmd&#x2F;cgo#hdr-Passing_pointers) and have a [high performance overhead](), which means that most libraries you might want to use have to be rewritten into Go. Compare this to, for example, Lua, which is intentionally designed to be easy to embed into larger applications due to its small language size and minimal runtime requirements.--&gt;
&lt;h3 id=&quot;ipc&quot;&gt;IPC&lt;a class=&quot;zola-anchor&quot; href=&quot;#ipc&quot; aria-label=&quot;Anchor link for: ipc&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;unix-shells&quot;&gt;Unix shells&lt;a class=&quot;zola-anchor&quot; href=&quot;#unix-shells&quot; aria-label=&quot;Anchor link for: unix-shells&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;another approach is to compose tools. the traditional way to do this is to have a shell that allows you to freely compose programs with IPC. this does unlock a lot of freedom! IPC allows programs to communicate across different languages, different ABIs, and different user-facing APIs. it also unlocks &#x27;ad-hoc&#x27; programs, which can be thought of as &lt;a href=&quot;https:&#x2F;&#x2F;gwern.net&#x2F;doc&#x2F;technology&#x2F;2004-03-30-shirky-situatedsoftware.html&quot;&gt;situated software&lt;&#x2F;a&gt; for developers themselves. consider for example the following shell pipeline:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; verify-pack&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;v&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-continuation z-line z-shell&quot;&gt;\
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;        &lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; rev-parse&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;git-common-dir&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;objects&#x2F;pack&#x2F;pack-&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;.idx &lt;span class=&quot;z-punctuation z-separator z-continuation z-line z-shell&quot;&gt;\
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sort&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;k3&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;n&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cut&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;f1&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;d&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-continuation z-line z-shell&quot;&gt;\
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-while z-shell&quot;&gt;while&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-read z-shell&quot;&gt;read&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; i&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-do z-shell&quot;&gt;do&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;git&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ls-tree&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt; HEAD&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;grep&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;i&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-end z-shell&quot;&gt;done&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-punctuation z-separator z-continuation z-line z-shell&quot;&gt;\
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;tail&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;this &lt;a href=&quot;https:&#x2F;&#x2F;askubuntu.com&#x2F;questions&#x2F;1259129&#x2F;&quot;&gt;shows the 10 largest files in the git history for the current repository&lt;&#x2F;a&gt;. let&#x27;s set aside the readability issues for now. there are a lot of good ideas here! note that programs are interacting freely in many ways:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;the output of &lt;code&gt;git rev-parse&lt;&#x2F;code&gt; is passed as a CLI argument to &lt;code&gt;git verify-pack&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;the output of &lt;code&gt;git verify-pack&lt;&#x2F;code&gt; is passed as stdin to &lt;code&gt;sort&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;the output of &lt;code&gt;cut&lt;&#x2F;code&gt; is interpreted as a list and programmatically manipulated by &lt;code&gt;while read&lt;&#x2F;code&gt;. this kind of meta-programming is common in shell and has concise (i won&#x27;t go as far as &quot;simple&quot;) syntax.&lt;&#x2F;li&gt;
&lt;li&gt;the output from the meta-programming loop is itself passed as stdin to the &lt;code&gt;tail&lt;&#x2F;code&gt; command&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;the equivalent in a programming language without spawning a subprocess would be very verbose; not only that, it would require a library for the git operations in each language, bringing back the FFI issues from before (not to mention the hard work designing &quot;cut points&quot; for the API interface&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;). this shell program can be written, concisely, using only tools that already exist.&lt;&#x2F;p&gt;
&lt;p&gt;note though that the data flow here is a DAG: pipes are one-way, and the CLI arguments are evaluated before the new program is ever spawned. as a result, it’s not possible to do any kind of content negotiation (other than the programmer hard-coding it with CLI args; for example tools commonly have &lt;code&gt;--format=json&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;the downside of this approach is that the interface is completely unstructured; programs work on raw bytes, and there is no common interface. it also doesn&#x27;t work if the program is interactive, unless the program deliberately exposes a way to query a running server (e.g. &lt;code&gt;tmux list-panes&lt;&#x2F;code&gt; or &lt;code&gt;nvim --remote&lt;&#x2F;code&gt;). let&#x27;s talk about both of those.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;structured-ipc&quot;&gt;structured IPC&lt;a class=&quot;zola-anchor&quot; href=&quot;#structured-ipc&quot; aria-label=&quot;Anchor link for: structured-ipc&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;scripting&#x2F;lang-spec&#x2F;chapter-04?view=powershell-7.5&quot;&gt;powershell&lt;&#x2F;a&gt;, and more recently, &lt;a href=&quot;https:&#x2F;&#x2F;www.nushell.sh&#x2F;book&#x2F;types_of_data.html&quot;&gt;nushell&lt;&#x2F;a&gt;, extend traditional unix pipelines with structured data and a typesystem. they have mechanisms for parsing arbitrary text into native types, and helper functions for common data formats.&lt;&#x2F;p&gt;
&lt;p&gt;this is really good! i think it is the first major innovation we have seen in the shell language in many decades, and i&#x27;m glad it exists. but it does have some limitations:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;there is no interop between powershell and nushell.&lt;&#x2F;li&gt;
&lt;li&gt;there is no protocol for programs to self-describe their output in a schema, so each program&#x27;s output has to be special-cased by each shell.
&lt;ul&gt;
&lt;li&gt;powershell side-steps this by &lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;scripting&#x2F;overview?view=powershell-7.5#scripting-language&quot;&gt;building on the .NET runtime&lt;&#x2F;a&gt;, and having native support for programs which emit .NET objects in their &lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;module&#x2F;microsoft.powershell.core&#x2F;about&#x2F;about_output_streams?view=powershell-7.5&quot;&gt;output stream&lt;&#x2F;a&gt;. but this doesn&#x27;t generalize to programs that don&#x27;t run on the &lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;dotnet&#x2F;standard&#x2F;clr&quot;&gt;CLR&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;there is no stability guarantee between versions of a program. even tools with semi-structured JSON output are free to change the structure of the JSON, breaking whatever code parses it.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;and it is very hard to fix these limitations because there is no &quot;out-of-band&quot; communication channel that programs could use to emit a schema; the closest you could get is a &quot;standardized file descriptor number&quot;, but that will lock out any program that happens to already be using that FD. we have limited kinds of reflection in the form of shell completion scripts, but they&#x27;re not standardized: there&#x27;s not a standard for the shell to query the program, and there&#x27;s not a standard for the format the program returns. the CLI framework inside the program often &lt;em&gt;does&lt;&#x2F;em&gt; have a schema and reflection capabilities, but they&#x27;re discarded the second you go over an IPC boundary.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;rpc&quot;&gt;RPC&lt;a class=&quot;zola-anchor&quot; href=&quot;#rpc&quot; aria-label=&quot;Anchor link for: rpc&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;how do you get a schema? well, you establish in-band communication. RPC is theoretically about &quot;remote&quot; procedure calls, but it&#x27;s just as often used for local calls. the thing that really distinguishes it is that it&#x27;s in-band: you have a defined interface that emits structured information.&lt;&#x2F;p&gt;
&lt;p&gt;RPC works really quite well! there are frameworks for &lt;a href=&quot;https:&#x2F;&#x2F;protobuf.dev&#x2F;&quot;&gt;forwards- and backwards-compatible RPC&lt;&#x2F;a&gt;; types and APIs are shared across languages; and interop for a new language only requires writing bindings between that language and the on-wire format, not solving a handshake problem between all pairs of languages nor dropping down to the C ABI.&lt;&#x2F;p&gt;
&lt;p&gt;the main downside is that it is a lot of work to add to your program. you have to extensively modify your code to fit it into the shape the framework expects, and to keep it performant you sometimes even have to modify the in-memory representation of your data structures so they can live in a contiguous buffer. you can avoid these problems, but only by giving up performance when deserializing (e.g. by parsing JSON at runtime).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;you-are-trapped-in-a-box&quot;&gt;you are trapped in a box&lt;a class=&quot;zola-anchor&quot; href=&quot;#you-are-trapped-in-a-box&quot; aria-label=&quot;Anchor link for: you-are-trapped-in-a-box&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;all these &lt;a href=&quot;&#x2F;operators-not-users-and-programmers#the-user-programmer-distinction&quot;&gt;limitations&lt;&#x2F;a&gt; are because &lt;a href=&quot;https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20210121181531&#x2F;https:&#x2F;&#x2F;djrobstep.com&#x2F;posts&#x2F;programs-are-a-prison&quot;&gt;programs are a prison&lt;&#x2F;a&gt;. your data is trapped inside the box that is your program. the commonality between all these limitations is that they require work from the program developer, and without that work you&#x27;re stuck. even the data that leaves the program has to go through the narrow entrances and exits of the box, and &lt;a href=&quot;https:&#x2F;&#x2F;siderea.dreamwidth.org&#x2F;1540620.html&quot;&gt;anything that doesn&#x27;t fit is discarded&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;some languages try to make the box bigger—interop between Java, Kotlin, and Clojure is comparatively quite easy because they all run on the JVM. but at the end of the day the JVM is another box; getting a non-JVM language to talk to it is hard.&lt;&#x2F;p&gt;
&lt;p&gt;some languages try to make the box extensible—LISPs, and especially Racket, try to make it very easy to build new languages inside the box. but getting non-LISPs inside the box is hard.&lt;&#x2F;p&gt;
&lt;p&gt;some tools try to give you individual features—smalltalk gets you orthogonal persistence; pluto.jl gets you a “terminal of the future”; rustc gets you sub-process incremental builds. but all those features are inside a box.&lt;&#x2F;p&gt;
&lt;p&gt;often, tools don’t even try. vendor lock in, subtle or otherwise, is everywhere around us. tools with this strategy tend to be the largest, since they have both the biggest budget and the greatest incentive to prevent you from switching tools.&lt;&#x2F;p&gt;
&lt;p&gt;and always, always, always, you are at the mercy of the program author.&lt;&#x2F;p&gt;
&lt;p&gt;in my next post, i will discuss how we can escape this box.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;bibliography&quot;&gt;bibliography&lt;a class=&quot;zola-anchor&quot; href=&quot;#bibliography&quot; aria-label=&quot;Anchor link for: bibliography&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;drmaciver.substack.com&#x2F;i&#x2F;145700143&#x2F;you-are-in-a-box&quot;&gt;D. R. MacIver, “This is important”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Jamie_Zawinski&quot;&gt;Wikipedia, “Zawinski’s Law of Software Envelopment”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;graydon2.dreamwidth.org&#x2F;263429.html&quot;&gt;Graydon Hoare, “Rust 2019 and beyond: limits to (some) growth.”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;SxdOUGdseq4?si=X9OZ975hwwzZOxpo&amp;amp;t=346&quot;&gt;Rich Hickey, “Simple Made Easy”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.vivekpanyam.com&#x2F;parsing-an-undocumented-file-format&quot;&gt;Vivek Panyam, “Parsing an undocumented file format”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.vulkan.org&#x2F;guide&#x2F;latest&#x2F;what_is_spirv.html&quot;&gt;The Khronos® Group Inc, “Vulcan Documentation: What is SPIR-V”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;c-isnt-a-language&#x2F;&quot;&gt;Aria Desires, “C Isn’t A Language Anymore”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pkg.go.dev&#x2F;cmd&#x2F;cgo&quot;&gt;Google LLC, “Standard library: cmd.cgo”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;words.filippo.io&#x2F;rustgo&#x2F;&quot;&gt;Filippo Valsorda, “rustgo: calling Rust from Go with near-zero overhead”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;webassembly.org&#x2F;&quot;&gt;WebAssembly Working Group, “WebAssembly”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;component-model.bytecodealliance.org&#x2F;&quot;&gt;The Bytecode Alliance, “The WebAssembly Component Model”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rfcs&#x2F;pull&#x2F;3470&quot;&gt;Josh Triplett, “crABI v1”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gwern.net&#x2F;doc&#x2F;technology&#x2F;2004-03-30-shirky-situatedsoftware.html&quot;&gt;Clay Shirky, &quot;Situated Software&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;scripting&#x2F;lang-spec&#x2F;chapter-04?view=powershell-7.5&quot;&gt;Microsoft, &quot;PowerShell 7.5: 4. Types&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;scripting&#x2F;overview?view=powershell-7.5&quot;&gt;Microsoft, &quot;PowerShell 7.5: What is PowerShell?&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;module&#x2F;microsoft.powershell.core&#x2F;about&#x2F;about_output_streams?view=powershell-7.5&quot;&gt;Microsoft, &quot;PowerShell 7.5: about_Output_Streams&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;dotnet&#x2F;standard&#x2F;clr&quot;&gt;Microsoft, &quot;.NET Execution model: Common Language Runtime (CLR) overview&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.nushell.sh&#x2F;book&#x2F;types_of_data.html&quot;&gt;Nushell Project, &quot;Nu Fundamentals: Types of Data&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;protobuf.dev&#x2F;&quot;&gt;Google LLC, “Protocol Buffers”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20210121181531&#x2F;https:&#x2F;&#x2F;djrobstep.com&#x2F;posts&#x2F;programs-are-a-prison&quot;&gt;Robert Lechte, “Programs are a prison: Rethinking the fundamental building blocks of computing interfaces”&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;siderea.dreamwidth.org&#x2F;1540620.html&quot;&gt;Siderea, &quot;Procrustean Epistemologies&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;blog post forthcoming &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>constrained languages are easier to optimize</title>
        <published>2025-07-12T00:00:00+00:00</published>
        <updated>2025-07-12T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/constrained-languages-are-easier-to-optimize/"/>
        <id>https://jyn.dev/constrained-languages-are-easier-to-optimize/</id>
        
        <summary type="html">exposing raw pointers make the optimizer’s job horribly hard. high level languages can constrain your program, making more optimizations sound.</summary>
        
        <content type="html" xml:base="https://jyn.dev/constrained-languages-are-easier-to-optimize/">&lt;h2 id=&quot;jyn-what-the-fuck-are-you-talking-about&quot;&gt;jyn, what the fuck are you talking about&lt;a class=&quot;zola-anchor&quot; href=&quot;#jyn-what-the-fuck-are-you-talking-about&quot; aria-label=&quot;Anchor link for: jyn-what-the-fuck-are-you-talking-about&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;a recurring problem in modern “low-level” languages&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; is that they are hard to optimize. they &lt;a href=&quot;https:&#x2F;&#x2F;queue.acm.org&#x2F;detail.cfm?id=3212479&quot;&gt;do not reflect the hardware&lt;&#x2F;a&gt;, they require doing &lt;a href=&quot;https:&#x2F;&#x2F;www.ralfj.de&#x2F;blog&#x2F;2018&#x2F;07&#x2F;24&#x2F;pointers-and-bytes.html&quot;&gt;complex alias analysis&lt;&#x2F;a&gt;, and they &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@jbyj&#x2F;my-javascript-is-faster-than-your-rust-5f98fe5db1bf&quot;&gt;constantly allocate and deallocate memory&lt;&#x2F;a&gt;. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; they looked at &lt;a href=&quot;https:&#x2F;&#x2F;buttondown.com&#x2F;hillelwayne&#x2F;archive&#x2F;the-capability-tractability-tradeoff&#x2F;&quot;&gt;the structure&#x2F;expressiveness tradeoff&lt;&#x2F;a&gt; and consistently chose expressiveness.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-does-a-faster-language-look-like&quot;&gt;what does a faster language look like&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-a-faster-language-look-like&quot; aria-label=&quot;Anchor link for: what-does-a-faster-language-look-like&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;consider this paper on &lt;a href=&quot;https:&#x2F;&#x2F;www.cs.tufts.edu&#x2F;~nr&#x2F;cs257&#x2F;archive&#x2F;duncan-coutts&#x2F;stream-fusion.pdf&quot;&gt;stream fusion in Haskell&lt;&#x2F;a&gt;. this takes a series of nested loops, each of which logically allocate an array equal in size to the input, and optimizes them down to constant space using unboxed integers. doing the same with C is inherently less general because the optimizing compiler must first prove that none of the pointers involved alias each other. in fact, optimizations are so much easier to get right in Haskell that &lt;a href=&quot;https:&#x2F;&#x2F;wiki.haskell.org&#x2F;GHC&#x2F;Using_rules&quot;&gt;GHC exposes a mechanism for users to define them&lt;&#x2F;a&gt;! these optimizations are possible because of &lt;a href=&quot;https:&#x2F;&#x2F;softwareengineering.stackexchange.com&#x2F;questions&#x2F;254304&#x2F;what-is-referential-transparency&quot;&gt;referential transparency&lt;&#x2F;a&gt;—the compiler statically knows whether an expression can have a side effect.&lt;&#x2F;p&gt;
&lt;p&gt;“haskell is known for performance problems, why are you using it as an example. also all GC languages constantly box and unbox values, you need raw pointers to avoid that.”&lt;&#x2F;p&gt;
&lt;p&gt;GC languages do constantly box and unbox &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, but you don’t need raw pointers to avoid that. consider &lt;a href=&quot;https:&#x2F;&#x2F;futhark-lang.org&quot;&gt;futhark&lt;&#x2F;a&gt;, a functional parallel language that compiles to the GPU. its benchmarks show it being &lt;a href=&quot;https:&#x2F;&#x2F;futhark-lang.org&#x2F;performance.html&quot;&gt;up to orders of magnitude faster than sequential C&lt;&#x2F;a&gt; on problems that fit well into its domain. it does so by having unboxed fixed-size integers, disallowing ragged arrays, and constraining many common operations on arrays to only work if the arrays are statically known to have the same size.&lt;&#x2F;p&gt;
&lt;p&gt;futhark is highly restrictive. consider instead SQL. SQL is a declarative language, which means the actual execution is determined by a query planner, it’s not constrained by the source code. SQL has also been around for decades, which means we can compare the performance of the same code over decades. it turns out &lt;a href=&quot;https:&#x2F;&#x2F;rmarcus.info&#x2F;blog&#x2F;2024&#x2F;04&#x2F;12&#x2F;pg-over-time.html&quot;&gt;common operations in postgres are twice as fast as they were a decade ago&lt;&#x2F;a&gt;. you can imagine writing SQL inline—wait no it turns out C# &lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;dotnet&#x2F;csharp&#x2F;linq&#x2F;&quot;&gt;already has that covered&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;SQL is not a general purpose language. but you don’t need it to be! your performance issues are not evenly distributed across your code; you can identify the hotspots and choose against a language with raw pointers in favor of one more structured and therefore more amenable to optimization.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;sometimes-you-need-raw-pointers&quot;&gt;sometimes you need raw pointers&lt;a class=&quot;zola-anchor&quot; href=&quot;#sometimes-you-need-raw-pointers&quot; aria-label=&quot;Anchor link for: sometimes-you-need-raw-pointers&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;there are various kinds of memory optimizations that are only possible if you have access to raw pointers; for example &lt;a href=&quot;https:&#x2F;&#x2F;piotrduperas.com&#x2F;posts&#x2F;nan-boxing&quot;&gt;NaN boxing&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;laurelmay&#x2F;xorlist&quot;&gt;XOR linked lists&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Tagged_pointer?wprov=sfti1&quot;&gt;tagged pointers&lt;&#x2F;a&gt;. sometimes you need them, which means you need a language that allows them. but these kinds of data structures are very rare! we should steer towards a general purpose language that does not expose raw pointers, and only drop down when we actually need to use them.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-does-a-faster-general-purpose-language-look-like&quot;&gt;what does a faster general purpose language look like&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-a-faster-general-purpose-language-look-like&quot; aria-label=&quot;Anchor link for: what-does-a-faster-general-purpose-language-look-like&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;well, Rust is a good step in the right direction: raw pointers are opt-in with &lt;code&gt;unsafe&lt;&#x2F;code&gt;; Iterators support functional paradigms that allow removing bounds checks and &lt;a href=&quot;https:&#x2F;&#x2F;ntietz.com&#x2F;blog&#x2F;rusts-iterators-optimize-footgun&#x2F;&quot;&gt;fusing stream-like operations&lt;&#x2F;a&gt;; and libraries like &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;rayon&#x2F;latest&#x2F;rayon&#x2F;&quot;&gt;rayon&lt;&#x2F;a&gt; make it much easier to do multi-threaded compilation.&lt;&#x2F;p&gt;
&lt;p&gt;but i think this is in some sense the wrong question. we should not be asking “what language can i use everywhere for every purpose”; we should build meta-languages that allow you to easily use the right tool for the job. this is already true for regular expressions and query languages; let’s go further. i want inline futhark; inline CSS selectors; inline datalog; ffi between python and C that’s trivially easy. the easier we make it to interop, the easier it becomes to pick the right tool for the job. &lt;!-- TODO: link to systems thinking post --&gt;  &lt;!-- TODO: link to composable compilers --&gt;&lt;&#x2F;p&gt;
&lt;p&gt;next time you hit a missed optimization, ask yourself: why was this hard for the compiler? can i imagine a language where optimizing this is easier?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-have-we-learned&quot;&gt;what have we learned?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-have-we-learned&quot; aria-label=&quot;Anchor link for: what-have-we-learned&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;languages that expose raw pointers are surprisingly hard to optimize&lt;&#x2F;li&gt;
&lt;li&gt;by constraining the language to require additional structure, the compiler has much more freedom to optimize&lt;&#x2F;li&gt;
&lt;li&gt;by making it easier to switch between languages, we make it easier to choose the right tool for the job, increasing the performance of our code&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;this is true for all of C, C++, and unsafe Rust (and to some extent Fortran, but Fortran &lt;a href=&quot;https:&#x2F;&#x2F;beza1e1.tuxen.de&#x2F;articles&#x2F;faster_than_C.html&quot;&gt;does not require alias analysis&lt;&#x2F;a&gt;). &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;also, they require doing PGO ahead of time instead of collecting info dynamically at runtime. but i haven’t found any benchmarks showing Java&#x2F;luaJIT programs that are faster than equivalent C, so i won’t claim that JIT is inherently faster. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;true in the general case, but not always in practice. in Go and Java, the compiler needs to do escape analysis to know whether a variable can be unboxed. in Haskell, the situation is more complicated because of lazy evaluation; see &lt;a href=&quot;https:&#x2F;&#x2F;youtu.be&#x2F;XiTO1EGKrhE?si=z1IqPD4KdEkqcYd9&quot;&gt;Alexis King on the GHC strictness analyzer&lt;&#x2F;a&gt; for more info. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>sorry for the rss screwup</title>
        <published>2025-07-06T00:00:00+00:00</published>
        <updated>2025-07-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/sorry-for-the-rss-screwup/"/>
        <id>https://jyn.dev/sorry-for-the-rss-screwup/</id>
        
        <content type="html" xml:base="https://jyn.dev/sorry-for-the-rss-screwup/">&lt;p&gt;a couple days ago i pushed about 10 empty posts at once to everyone subscribed to my RSS feed. oops. sorry about that.&lt;&#x2F;p&gt;
&lt;p&gt;i&#x27;ve since fixed it, but most RSS readers i&#x27;ve seen will cache the posts indefinitely once they&#x27;re published.
the workaround for my own client was to delete my page and then readd it, which will unfortunately discard all your read&#x2F;unread state.&lt;&#x2F;p&gt;
&lt;p&gt;the reason this happened is that i added a new kind of &quot;stub&quot; post, and handled that correctly on the main site, but not on the rss feed. you can see the intended layout of the stub posts &lt;a href=&quot;&#x2F;computer-of-the-future&quot;&gt;here&lt;&#x2F;a&gt; if you&#x27;re interested.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>operators, not users and programmers</title>
        <published>2025-07-05T00:00:00+00:00</published>
        <updated>2025-07-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/operators-not-users-and-programmers/"/>
        <id>https://jyn.dev/operators-not-users-and-programmers/</id>
        
        <summary type="html">writing programs should be no harder than writing a resume</summary>
        
        <content type="html" xml:base="https://jyn.dev/operators-not-users-and-programmers/">&lt;p&gt;&lt;strong&gt;the modern distinction between “programmers” and “users” is evil and destroys agency.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;consider-how-the-spreadsheets-grow&quot;&gt;consider how the spreadsheets grow&lt;a class=&quot;zola-anchor&quot; href=&quot;#consider-how-the-spreadsheets-grow&quot; aria-label=&quot;Anchor link for: consider-how-the-spreadsheets-grow&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;spreadsheets are hugely successful. Felienne Hermans, who has spent her career studying spreadsheets, &lt;a href=&quot;https:&#x2F;&#x2F;www.felienne.com&#x2F;archives&#x2F;2453&quot;&gt;attributes this success&lt;&#x2F;a&gt; to &quot;&lt;em&gt;their immediate feedback system and their continuous deployment model&lt;&#x2F;em&gt;&quot;: the spreadsheet shows you its result as soon as you open it, and it requires no steps to run other than to install Excel and double-click the file.&lt;&#x2F;p&gt;
&lt;p&gt;Rik calls Excel “malleable software” and the resulting programs &lt;a href=&quot;https:&#x2F;&#x2F;nothingisnttrivial.com&#x2F;vines.html&quot;&gt;“vine-like systems”&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;The dream of malleable software is that we can enlarge the space of possibilities, users can enjoy more freedom and get more out of their software, without having to rely on software developers to provide it for them.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;i would go one step further: the dream of malleable software is to unify users and programmers, such that there are just “operators” of a computer, and “writing a program” doesn’t sound any harder than “writing a resume”:&lt;&#x2F;p&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;http:&#x2F;&#x2F;www.loper-os.org&#x2F;?p=284&quot;&gt;
&lt;p&gt;the distinction between &quot;user&quot; and &quot;programmer&quot; is an artifact of our presently barely-programmable and barely-usable computing systems.  I would like to use the neutral word &quot;operator&quot; instead.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.loper-os.org&#x2F;?p=284&quot;&gt;Stanislav&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;p&gt;this is a relatively new distinction! if we look at the history of computing and of programming languages, we see very different patterns:&lt;&#x2F;p&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;www.barnesandnoble.com&#x2F;w&#x2F;the-as-400-ibm-i-rpg-rpgiv-programming-guide-brian-w-kelly&#x2F;1124946681&quot;&gt;
&lt;p&gt;In the 1960’s the supply of programmers was not very deep so IBM and other companies trying to gain a computer sale would often have to sell the business prospect on the idea of creating its own programmer(s). Sometimes it was the shipping clerk; sometimes it was the head order taker; sometimes it was a bookkeeper, and sometimes it was a woman or man packing items in the warehouse.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.barnesandnoble.com&#x2F;w&#x2F;the-as-400-ibm-i-rpg-rpgiv-programming-guide-brian-w-kelly&#x2F;1124946681&quot;&gt;Brian M. Kelly, The AS&#x2F;400 and IBM i RPG Programming Guide&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;p&gt;this is what i want: for programming to be easy and simple enough to pick up that people can do it without specialized training in the field, so that they can write &lt;a href=&quot;https:&#x2F;&#x2F;gwern.net&#x2F;doc&#x2F;technology&#x2F;2004-03-30-shirky-situatedsoftware.html&quot;&gt;situated software&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-user-programmer-distinction&quot;&gt;the “user&#x2F;programmer” distinction&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-user-programmer-distinction&quot; aria-label=&quot;Anchor link for: the-user-programmer-distinction&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;contrast malleable software to the systems that programmers often build:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Many, many technologists have taken one look at an existing workflow of spreadsheets, reacted with performative disgust, and proposed the trifecta of microservices, Kubernetes and something called a &quot;service mesh&quot;.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figure&gt;
&lt;blockquote cite=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html&quot;&gt;
&lt;p&gt;This kind of Big Enterprise technology however takes away that basic agency of those Excel users, who no longer understand the business process they run and now have to negotiate with &lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=y8OnoxKotPQ&quot;&gt;ludicrous technology dweebs&lt;&#x2F;a&gt; for each software change. The previous pliability of the spreadsheets has been completely lost.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;figcaption&gt;
&lt;cite &gt;&lt;a href=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html&quot;&gt;Cal Peterson&lt;&#x2F;a&gt;&lt;&#x2F;cite&gt;
&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
&lt;p&gt;now, this doesn’t happen because programmers are stupid and evil. it happens because the systems we build are amenable to all the features that programmers &lt;a href=&quot;https:&#x2F;&#x2F;www.hillelwayne.com&#x2F;post&#x2F;what-we-can-learn&#x2F;#version-control&quot;&gt;take for granted&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;distributed version control systems (VCS)&lt;&#x2F;li&gt;
&lt;li&gt;automated testing (when integrated with a VCS, often called &quot;continuous integration&quot;)&lt;&#x2F;li&gt;
&lt;li&gt;gradual controlled rollouts (when integrated with a VCS, often called &quot;continuous deployment&quot;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;what i want to imagine is what it would look like to build computing systems that have those features and are also malleable.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-could-a-malleable-system-with-low-technical-risk-look-like&quot;&gt;what could a malleable system with &lt;a href=&quot;https:&#x2F;&#x2F;nothingisnttrivial.com&#x2F;technical-functional.html&quot;&gt;low technical risk&lt;&#x2F;a&gt; look like?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-could-a-malleable-system-with-low-technical-risk-look-like&quot; aria-label=&quot;Anchor link for: what-could-a-malleable-system-with-low-technical-risk-look-like&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;let&#x27;s start by looking at what malleable systems already exist.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;malleable-languages&quot;&gt;malleable languages&lt;a class=&quot;zola-anchor&quot; href=&quot;#malleable-languages&quot; aria-label=&quot;Anchor link for: malleable-languages&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;spreadsheets, as previously discussed&lt;&#x2F;li&gt;
&lt;li&gt;WYSIWYG editors: Microsoft Word, Obsidian, Typst, Wordpress. In Word, and in Obsidian&#x27;s default view, the compile step is completely hidden and it appears to the user as if the source and rendered view are the same. in other editors, the rendered view updates quickly and frequently enough that they get immediate feedback, just like a spreadsheet.&lt;&#x2F;li&gt;
&lt;li&gt;browser devtools, where editing an element in the inspector immediately updates the rendered view&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;sonic-pi.net&#x2F;&quot;&gt;sonic-pi&lt;&#x2F;a&gt;, where editing code live-updates the sound played&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;how-i-write-blog-posts&#x2F;&quot;&gt;my blog&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;note these aren&#x27;t &lt;em&gt;just&lt;&#x2F;em&gt; hot-patching, where you edit a system while it&#x27;s running. hot-patching is certainly useful and i would like to see more of it, but it doesn&#x27;t unify the source and rendered version of a program, you still have to trip the condition in order to observe the change. malleable languages are a combination of:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;hot-patching&lt;&#x2F;li&gt;
&lt;li&gt;live previews that makes updates appear instant&lt;&#x2F;li&gt;
&lt;li&gt;undo&#x2F;redo for the whole system&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;malleable-version-control&quot;&gt;malleable version control&lt;a class=&quot;zola-anchor&quot; href=&quot;#malleable-version-control&quot; aria-label=&quot;Anchor link for: malleable-version-control&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;file shares: google drive; sharepoint; onedrive; etc. the tooling for diffing and reverting is very primitive compared to git or hg (in particular diffing is the responsibility of the application, not the VCS), but the primitives are there.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html#:~:text=barbara&quot;&gt;Bank Python&lt;&#x2F;a&gt;, where the distinction between local and persisted storage is smoothed over by the runtime&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;note a pattern here: these don&#x27;t require prior approval in order to use. anyone can throw a file into google drive and hit share without prior approval (sometimes this is frowned upon, in which case it gets called &quot;Shadow IT&quot;).&lt;&#x2F;p&gt;
&lt;h3 id=&quot;malleable-deployment&quot;&gt;malleable deployment&lt;a class=&quot;zola-anchor&quot; href=&quot;#malleable-deployment&quot; aria-label=&quot;Anchor link for: malleable-deployment&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;Bank Python&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html#:~:text=once%20described&quot;&gt;vouch system&lt;&#x2F;a&gt;, where hitting &quot;approve&quot; insta-deploys to prod. at a technical level this is basically the same as code review, but unlike normal CI systems it’s not configured to require tests to pass, because anything that’s too annoying will end up with people bypassing the system to build shadow IT.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;unfortunately i am not aware of a malleable testing system—if you know of one, please do &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;tell me&lt;&#x2F;a&gt;!&lt;&#x2F;p&gt;
&lt;h3 id=&quot;putting-it-together&quot;&gt;putting it together&lt;a class=&quot;zola-anchor&quot; href=&quot;#putting-it-together&quot; aria-label=&quot;Anchor link for: putting-it-together&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;so, we want the following from a malleable system:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;hot-reloading and live previews, like spreadsheets
&lt;ul&gt;
&lt;li&gt;in particular, we want the user to write in the representation that makes the most sense to them, whether that&#x27;s a spreadsheet or an SQL query or a text editor of markup&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;..&#x2F;complected-and-orthogonal-persistence&quot;&gt;automatic and continuous durability&lt;&#x2F;a&gt;, like autosave in microsoft office products.
&lt;ul&gt;
&lt;li&gt;in particular this undo&#x2F;redo capability works on the whole system including derived data, not just the source code itself, so you can try new things without fear of breaking everything. the closest programmers have to this today is &lt;code&gt;jj&lt;&#x2F;code&gt;, which &lt;a href=&quot;https:&#x2F;&#x2F;jj-vcs.github.io&#x2F;jj&#x2F;latest&#x2F;working-copy&#x2F;&quot;&gt;automatically snapshots the working tree&lt;&#x2F;a&gt;, but taking snapshots still requires a manual action, and you need to set up the system in advance.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;distributed version control++
&lt;ul&gt;
&lt;li&gt;with unrestricted &lt;em&gt;distribution&lt;&#x2F;em&gt; and an easy interface, like google drive and dropbox&lt;&#x2F;li&gt;
&lt;li&gt;with diffing&#x2F;merging&#x2F;reverting, like traditional VCS&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;automated and instantly triggered testing, like piper at google. this could run your tests in the background as you edit your program, with integrated build caching so that only the affected tests rerun.&lt;&#x2F;li&gt;
&lt;li&gt;continuous deployment
&lt;ul&gt;
&lt;li&gt;we want explicit approval and controlled rollout, like traditional CD, so we can separate &quot;upload the code&quot; from &quot;run the code in prod&quot;&lt;&#x2F;li&gt;
&lt;li&gt;but we want it to be trivially easy to give that approval, like double-clicking an email attachment or the vouch system. don&#x27;t confuse &quot;controlled rollout&quot; with access control—it&#x27;s useful even if you&#x27;re a solo programmer.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;and of course, performance.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;this is a tall order! the rest of this series is dedicated to ideas about how to make this possible.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;bibliography&quot;&gt;bibliography&lt;a class=&quot;zola-anchor&quot; href=&quot;#bibliography&quot; aria-label=&quot;Anchor link for: bibliography&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.felienne.com&#x2F;archives&#x2F;2453&quot;&gt;Felienne Hermans, &quot;Proposition #1&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nothingisnttrivial.com&#x2F;vines.html&quot;&gt;Rik de Kort, &quot;Vine-like Systems and Malleability&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nothingisnttrivial.com&#x2F;technical-functional.html&quot;&gt;Rik de Kort, &quot;Technical and functional risk&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.loper-os.org&#x2F;?p=284&quot;&gt;Stanislav Datskovskiy, &quot;Seven Laws of Sane Personal Computing&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.barnesandnoble.com&#x2F;w&#x2F;the-as-400-ibm-i-rpg-rpgiv-programming-guide-brian-w-kelly&#x2F;1124946681&quot;&gt;Brian M. Kelly, &lt;em&gt;The AS&#x2F;400 and IBM i RPG Programming Guide&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gwern.net&#x2F;doc&#x2F;technology&#x2F;2004-03-30-shirky-situatedsoftware.html&quot;&gt;Clay Shirky, &quot;Situated Software&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html&quot;&gt;Cal Peterson, &quot;An oral history of Bank Python&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.hillelwayne.com&#x2F;post&#x2F;what-we-can-learn&#x2F;#version-control&quot;&gt;Hillel Wayne, &quot;What engineering can teach (and learn from) us&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;sonic-pi.net&#x2F;&quot;&gt;Sonic Pi&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jj-vcs.github.io&#x2F;jj&#x2F;latest&#x2F;working-copy&#x2F;&quot;&gt;&quot;Jujutsu—a version control system&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;p-s-what-will-people-build-with-this-power&quot;&gt;P.S: what will people build with this power?&lt;a class=&quot;zola-anchor&quot; href=&quot;#p-s-what-will-people-build-with-this-power&quot; aria-label=&quot;Anchor link for: p-s-what-will-people-build-with-this-power&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;i consulted a local friend of mine, a polisci major, and asked him what he would build if he were able to program. he said a penguin that walks across the screen, followed by a puffin friend for him. so, here&#x27;s to penguins 🐧
&lt;img src=&quot;&#x2F;900.jpg&quot; alt=&quot;penguin&quot; &#x2F;&gt;
&lt;img src=&quot;&#x2F;Puffin_(Fratercula_arctica).jpg&quot; alt=&quot;puffin&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>complected and orthogonal persistence</title>
        <published>2025-06-30T00:00:00+00:00</published>
        <updated>2025-06-30T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/complected-and-orthogonal-persistence/"/>
        <id>https://jyn.dev/complected-and-orthogonal-persistence/</id>
        
        <summary type="html">how hard is it to save and restore program state?</summary>
        
        <content type="html" xml:base="https://jyn.dev/complected-and-orthogonal-persistence/">&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Everything Not Saved Will Be Lost&lt;&#x2F;strong&gt;&lt;&#x2F;em&gt;—Ancient Nintendo Proverb&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h2 id=&quot;persistence-is-hard&quot;&gt;persistence is hard&lt;a class=&quot;zola-anchor&quot; href=&quot;#persistence-is-hard&quot; aria-label=&quot;Anchor link for: persistence-is-hard&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;say that you are writing an editor. you don&#x27;t want to lose people&#x27;s work so you implement an &quot;autobackup&quot; feature, so that people can restore their unsaved changes if the program or whole computer crashes.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;danluu.com&#x2F;file-consistency&#x2F;&quot;&gt;implementing this is hard&lt;&#x2F;a&gt;! the way i would do it is to serialize the data structures using something like &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;bincode&#x2F;latest&#x2F;bincode&#x2F;&quot;&gt;bincode&lt;&#x2F;a&gt; and then write them to an SQLite database so that i get crash-consistency. there are other approaches with different tradeoffs.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;languages-with-persistence&quot;&gt;languages with persistence&lt;a class=&quot;zola-anchor&quot; href=&quot;#languages-with-persistence&quot; aria-label=&quot;Anchor link for: languages-with-persistence&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;this &lt;a href=&quot;https:&#x2F;&#x2F;archive.cs.st-andrews.ac.uk&#x2F;papers&#x2F;download&#x2F;ABC+83b.pdf&quot;&gt;1983 paper&lt;&#x2F;a&gt; asks: why are we spending so much time rewriting this in applications, instead of doing it once in the runtime? it then introduces a language called &quot;PS-algol&quot;, which supports exactly this through a library. note that arbitrary data types in the language are supported without the need for writing user code.&lt;&#x2F;p&gt;
&lt;p&gt;it turns out that this idea is already being used in production. not in that form—people don’t use Algol anymore—but the idea is the same. M (better known as &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;MUMPS&quot;&gt;MUMPS&lt;&#x2F;a&gt;), &lt;a href=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html&quot;&gt;Bank Python&lt;&#x2F;a&gt;, and the &lt;a href=&quot;https:&#x2F;&#x2F;www.devever.net&#x2F;~hl&#x2F;f&#x2F;as400guide.pdf&quot;&gt;IBM i&lt;&#x2F;a&gt;&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; are still used in healthcare, financial, and insurance systems, and they work exactly like this&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-5-1&quot;&gt;&lt;a href=&quot;#fn-5&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. here is a snippet of M that persists some data to a database:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;mumps&quot; class=&quot;language-mumps z-code&quot;&gt;&lt;code class=&quot;language-mumps&quot; data-lang=&quot;mumps&quot;&gt;&lt;span class=&quot;z-source z-mumps&quot;&gt; &lt;span class=&quot;z-keyword&quot;&gt;SET&lt;&#x2F;span&gt; ^table(&lt;span class=&quot;z-string z-quoted z-double z-mumps&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-mumps&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;column&lt;span class=&quot;z-punctuation z-definition z-string z-end z-mumps&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,&lt;span class=&quot;z-string z-quoted z-double z-mumps&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-mumps&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;primary key&lt;span class=&quot;z-punctuation z-definition z-string z-end z-mumps&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;)=&lt;span class=&quot;z-string z-quoted z-double z-mumps&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-mumps&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;value&lt;span class=&quot;z-punctuation z-definition z-string z-end z-mumps&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-mumps&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and here is some Bank Python that does the same:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;db&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&#x2F;my_table&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Table&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;  &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-tuple z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;etf&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-python&quot;&gt;str&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-tuple z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;shares&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-python&quot;&gt;float&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;  &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;SPY&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-float z-decimal z-python&quot;&gt;1200&lt;span class=&quot;z-punctuation z-separator z-decimal z-python&quot;&gt;.&lt;&#x2F;span&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and finally some COBOL: &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;COBOL&quot; class=&quot;language-COBOL z-code&quot;&gt;&lt;code class=&quot;language-COBOL&quot; data-lang=&quot;COBOL&quot;&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;IDENTIFICATION DIVISION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;&lt;span class=&quot;z-keyword z-verb z-cobol&quot;&gt;PROGRAM-ID&lt;&#x2F;span&gt;. &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;FILES&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;ENVIRONMENT DIVISION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;  &lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;INPUT-OUTPUT SECTION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;FILE-CONTROL&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	  &lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;SELECT&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTIONS&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;ASSIGN&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;TO&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-cobol&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-cobol&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;transactions.txt&lt;span class=&quot;z-punctuation z-definition z-string z-end z-cobol&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	  &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;ORGANIZATION&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;IS&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;SEQUENTIAL&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;DATA DIVISION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;  &lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;FILE SECTION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;FD&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTIONS&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	&lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;01&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTION-STRUCT&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	  &lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;02&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;UID&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-picture z-cobol&quot;&gt;PIC 9(5).&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	  &lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;02&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;DESC&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-picture z-cobol&quot;&gt;PIC X(25).&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;WORKING-STORAGE SECTION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	&lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;01&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTION-RECORD&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	  &lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;02&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;UID&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-picture z-cobol&quot;&gt;PIC 9(5)&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;VALUE&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;12345&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	  &lt;span class=&quot;z-constant z-numeric z-cobol&quot;&gt;02&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;DESC&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-picture z-cobol&quot;&gt;PIC X(25)&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;VALUE&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-cobol&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-cobol&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;TEST TRANSACTION&lt;span class=&quot;z-punctuation z-definition z-string z-end z-cobol&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;&lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;PROCEDURE DIVISION&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;  &lt;span class=&quot;z-keyword z-verbs z-cobol&quot;&gt;OPEN&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;OUTPUT&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTIONS&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;	&lt;span class=&quot;z-keyword z-verbs z-cobol&quot;&gt;WRITE&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTION-STRUCT&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-identifers z-cobol&quot;&gt;FROM&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTION-RECORD&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;  &lt;span class=&quot;z-keyword z-verbs z-cobol&quot;&gt;CLOSE&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-symbol z-cobol&quot;&gt;TRANSACTIONS&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-cobol&quot;&gt;  &lt;span class=&quot;z-keyword z-identifiers z-cobol&quot;&gt;STOP RUN&lt;&#x2F;span&gt;.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;note how in all of these, the syntax for persisting the data to disk is essentially the same as persisting it to memory (in MUMPS, persisting to memory is exactly the same, except you would write &lt;code&gt;SET table&lt;&#x2F;code&gt; instead of &lt;code&gt;SET ^table&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;if you don&#x27;t require the runtime to support all datatypes, there are frameworks for doing this as a library. &lt;a href=&quot;https:&#x2F;&#x2F;protobuf.dev&#x2F;&quot;&gt;protobuf&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;flatbuffers.dev&#x2F;&quot;&gt;flatbuffer&lt;&#x2F;a&gt; both autogenerate the code for a restricted set of data types, so that you only have to write the code invoking it.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;orthogonal-persistence&quot;&gt;orthogonal persistence&lt;a class=&quot;zola-anchor&quot; href=&quot;#orthogonal-persistence&quot; aria-label=&quot;Anchor link for: orthogonal-persistence&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;the thing these languages and frameworks have in common is that the persistence is part of the program source code; either you have to choose a language that already has this support, or you have to do extensive modifications to the source code to persist the data at the right points. i will call this kind of persistence &lt;em&gt;complected persistence&lt;&#x2F;em&gt; because they tie together the business logic and persistence logic (see &lt;a href=&quot;https:&#x2F;&#x2F;www.infoq.com&#x2F;presentations&#x2F;Simple-Made-Easy&#x2F;&quot;&gt;Simple Made Easy&lt;&#x2F;a&gt; by Rich Hickey for the history of the word &quot;complect&quot;).&lt;&#x2F;p&gt;
&lt;p&gt;there is also &lt;em&gt;orthogonal persistence&lt;&#x2F;em&gt;. &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Persistence_(computer_science)#Orthogonal_or_transparent_persistence&quot;&gt;&quot;orthogonal persistence&quot;&lt;&#x2F;a&gt; means your program&#x27;s state is saved automatically without special work from you the programmer. in particular, the serialization is managed by the OS, database, or language runtime. as a result, you don&#x27;t have to care about persistence, only about implementing business logic; the two concerns are &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Orthogonality#Computer_science&quot;&gt;orthogonal&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;orthogonal persistence is more common than you might think. some examples:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Hibernation_(computing)&quot;&gt;hibernation&lt;&#x2F;a&gt; (suspend to disk). first invented in 1992 for the Compaq &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Compaq_LTE#LTE_Lite&quot;&gt;LTE Lite&lt;&#x2F;a&gt;. Windows has this on by default since Windows 8 (2012). MacOS has had it on by default since OS X 10.4 (2005).&lt;&#x2F;li&gt;
&lt;li&gt;virtualized hibernation in hypervisors like VirtualBox and VMWare (usually labeled &quot;Save the machine state&quot; or something similar)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;how-far-can-we-take-this&quot;&gt;how far can we take this?&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-far-can-we-take-this&quot; aria-label=&quot;Anchor link for: how-far-can-we-take-this&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;these forms of orthogonal persistence work on the whole OS state. you could imagine a version that works on individual processes: swap the process to disk, restore it later. the kernel kinda already does this when it does scheduling. you can replicate it in userspace with &lt;a href=&quot;https:&#x2F;&#x2F;thume.ca&#x2F;2020&#x2F;04&#x2F;18&#x2F;telefork-forking-a-process-onto-a-different-computer&#x2F;&quot;&gt;telefork&lt;&#x2F;a&gt;, which even lets you spawn a process onto another machine.&lt;&#x2F;p&gt;
&lt;p&gt;but the rest of the OS moves on while the process is suspended: the files it accesses may have changed, the processes it was talking to over a socket may have exited. what we want is to snapshot the process state: whatever files on disk stay on disk, whatever processes it was talking to continue running. this allows you to rewind and replay the process, as if the whole thing were running in a database transaction.&lt;&#x2F;p&gt;
&lt;p&gt;what do we need in order to do that?&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;a filesystem that supports atomic accesses, snapshots, and transaction restarts, such as &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;ZFS#Snapshots_and_clones&quot;&gt;ZFS&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;a runtime that supports detailed tracking and replay of syscalls, such as &lt;a href=&quot;https:&#x2F;&#x2F;rr-project.org&#x2F;&quot;&gt;rr&lt;&#x2F;a&gt;. this works by intercepting syscalls with &lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;ptrace.2.html&quot;&gt;ptrace()&lt;&#x2F;a&gt;, among other mechanisms, and does not require any modifications to the program executable or source code.&lt;&#x2F;li&gt;
&lt;li&gt;a sandbox that prevents talking to processes that weren’t running when the target process was spawned (unless those processes are also in the sandbox and tracked with this mechanism), such as &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;containers&#x2F;bubblewrap&quot;&gt;bubblewrap&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;effectively, we are turning syscalls into &lt;a href=&quot;http:&#x2F;&#x2F;habitatchronicles.com&#x2F;2017&#x2F;05&#x2F;what-are-capabilities&#x2F;&quot;&gt;capabilities&lt;&#x2F;a&gt;, where the capabilities we give out are “exactly the syscalls the process made last time it spawned”.&lt;&#x2F;p&gt;
&lt;p&gt;note how this is possible to do today, with existing technology and kernel APIs! this doesn’t require building an OS from scratch, nor rewriting all code to be in a language with tracked effects or a capability system. instead, by working at the syscall interface&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-6-1&quot;&gt;&lt;a href=&quot;#fn-6&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; between the program and the kernel, we can build a highly general system that applies to all the programs you already use.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;but-why&quot;&gt;“but why?”&lt;a class=&quot;zola-anchor&quot; href=&quot;#but-why&quot; aria-label=&quot;Anchor link for: but-why&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;note that this involves 3 different levels of tracking, which we can think of in terms of progressive enhancement:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;features you can get just by recording and replaying the whole process (&quot;tracking between processes&quot;)&lt;&#x2F;li&gt;
&lt;li&gt;features you can get by replaying from a specific point in the process (&quot;tracking within a process&quot;)&lt;&#x2F;li&gt;
&lt;li&gt;features you can only get with source code changes, by allowing the process to choose where it should be restored to (&quot;tracking that needs source code changes&quot;)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;the editor example i gave at the beginning refers to 3; but you can get really quite a lot of things just with 1 (tracked record&#x2F;replay and transactional semantics). for example, here are some tools that would be easy to build on top:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;needs-tracking-between-processes&quot;&gt;needs tracking between processes&lt;a class=&quot;zola-anchor&quot; href=&quot;#needs-tracking-between-processes&quot; aria-label=&quot;Anchor link for: needs-tracking-between-processes&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;collaborative terminals, where you can “split” your terminal and hand a sandboxed environment of &lt;em&gt;your personal computer&lt;&#x2F;em&gt; to a colleague so they can help you debug an issue. this is more general than OCI containers because you don&#x27;t need to spend time creating a dockerfile that reproduces the problem. this is more general than &lt;a href=&quot;https:&#x2F;&#x2F;robert.ocallahan.org&#x2F;2017&#x2F;09&#x2F;rr-trace-portability.html&quot;&gt;&lt;code&gt;rr pack&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; because you can edit the program source to add printfs, or change the input you pass to it at runtime.&lt;&#x2F;li&gt;
&lt;li&gt;“save&#x2F;undo for your terminal”, where you don’t need to add a &lt;a href=&quot;https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;coreutils&#x2F;manual&#x2F;html_node&#x2F;Treating-_002f-specially.html&quot;&gt;&lt;code&gt;--no-preserve-root&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; flag to &lt;code&gt;rm&lt;&#x2F;code&gt;, because the underlying filesystem can just restore a snapshot. this generalizes to any command—for example, you can build an arbitrary &lt;code&gt;git undo&lt;&#x2F;code&gt; command that works even if installed after the data is lost, which is &lt;a href=&quot;https:&#x2F;&#x2F;blog.waleedkhan.name&#x2F;git-undo&#x2F;&quot;&gt;not possible today&lt;&#x2F;a&gt;. note that this can undo by-process, not just by point-in-time, so it is strictly more general than FS snapshots.&lt;&#x2F;li&gt;
&lt;li&gt;query which files on disk were modified the last time you ran a command. for example you could ask “where did this &lt;code&gt;curl | sh&lt;&#x2F;code&gt; command install its files?”. the closest we have to this today is &lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;dpkg.1.html#:~:text=listfiles&quot;&gt;&lt;code&gt;dpkg --listfiles&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, which only works for changes done by the package manager.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;needs-tracking-within-a-process&quot;&gt;needs tracking within a process&lt;a class=&quot;zola-anchor&quot; href=&quot;#needs-tracking-within-a-process&quot; aria-label=&quot;Anchor link for: needs-tracking-within-a-process&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;&quot;&gt;asciinema&lt;&#x2F;a&gt;, but you actually run the process instead of building your own terminal emulator. this also lets you edit the recording live instead of having to re-record from scratch.&lt;&#x2F;li&gt;
&lt;li&gt;the &lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;the-postmodern-build-system&#x2F;#limits-of-execve-memoization&quot;&gt;“post-modern build system”&lt;&#x2F;a&gt; (also needs a &lt;a href=&quot;https:&#x2F;&#x2F;salsa-rs.netlify.app&#x2F;&quot;&gt;salsa&lt;&#x2F;a&gt;-like &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;queries&#x2F;incremental-compilation-in-detail.html#improving-accuracy-the-red-green-algorithm&quot;&gt;red-green system&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;needs-source-code-changes&quot;&gt;needs source code changes&lt;a class=&quot;zola-anchor&quot; href=&quot;#needs-source-code-changes&quot; aria-label=&quot;Anchor link for: needs-source-code-changes&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;“save&#x2F;undo for your program”, where editors and games can take advantage of cheap snapshots to use the operating system&#x27;s restore mechanism instead of building their own.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;this is not an exhaustive list, just the first things on the top of my head after a couple days of thinking about it. what makes this orthogonal persistence system so useful is that all these tools are near-trivial to build on top: most of them could be done in shell scripts or a short python script, instead of needing a team of developers and a year.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;isn-t-this-horribly-slow&quot;&gt;isn’t this horribly slow?&lt;a class=&quot;zola-anchor&quot; href=&quot;#isn-t-this-horribly-slow&quot; aria-label=&quot;Anchor link for: isn-t-this-horribly-slow&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;not inherently. “turning your file system into a database“ is only as slow as submitting the query is&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;—and that can be quite fast when the database runs locally instead of over the network; see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;spacejam&#x2F;sled?tab=readme-ov-file#performance&quot;&gt;sled&lt;&#x2F;a&gt; for an example of such a DB that has had performance tuning. rr boasts &lt;a href=&quot;https:&#x2F;&#x2F;rr-project.org&#x2F;#:~:text=slowdown&quot;&gt;less than a 20% slowdown&lt;&#x2F;a&gt;. bubblewrap uses the kernel’s native namespacing and to my knowledge imposes no overhead.&lt;&#x2F;p&gt;
&lt;p&gt;now, the final system needs to be designed with performance in mind and then carefully optimized but, you know. that&#x27;s doable.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;does-this-work-across-versions-of-my-program&quot;&gt;does this work across versions of my program?&lt;a class=&quot;zola-anchor&quot; href=&quot;#does-this-work-across-versions-of-my-program&quot; aria-label=&quot;Anchor link for: does-this-work-across-versions-of-my-program&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;kinda. there are two possible ways to implement intra-process persistence (i.e. &quot;everything other than disk writes&quot;).&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;take a snapshot of the memory, registers, and kernel state (e.g. file descriptors). this is how &lt;a href=&quot;https:&#x2F;&#x2F;thume.ca&#x2F;2020&#x2F;04&#x2F;18&#x2F;telefork-forking-a-process-onto-a-different-computer&#x2F;&quot;&gt;telefork&lt;&#x2F;a&gt; works. this only works with a single version of the executable; any change, even LTO without changing source code, will break it.&lt;&#x2F;li&gt;
&lt;li&gt;replay all syscalls done by the process. this will work across versions, as long as the program makes the same syscalls in the same order.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;1 is cheap if you don&#x27;t have much memory usage compared to CPU time.
2 is cheap if you don&#x27;t have much CPU time compared to memory usage.
only 2 allows you to modify the binary between saving and restoring.
it&#x27;s possible to do both for the same process, just expensive.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;summary&quot;&gt;summary&lt;a class=&quot;zola-anchor&quot; href=&quot;#summary&quot; aria-label=&quot;Anchor link for: summary&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;persisting program state is hard and basically requires implementing a database&lt;&#x2F;li&gt;
&lt;li&gt;persistence that does not require action from the program is called “orthogonal persistence”&lt;&#x2F;li&gt;
&lt;li&gt;it is possible to build orthogonal persistence for individual processes with tools that exist today, with only moderate slowdowns depending on how granular you want to be&lt;&#x2F;li&gt;
&lt;li&gt;there are multiple possible ways to implement this system, with different perf&#x2F;generality tradeoffs&lt;&#x2F;li&gt;
&lt;li&gt;such a system unlocks many kinds of tools by making them orders of magnitude easier to build&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;many of the ideas in this post were developed in collaboration with edef. if you want to see them built, consider &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;sponsors&#x2F;edef1c&quot;&gt;sponsoring her&lt;&#x2F;a&gt; so she has time to work on them.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;bibliography&quot;&gt;bibliography&lt;a class=&quot;zola-anchor&quot; href=&quot;#bibliography&quot; aria-label=&quot;Anchor link for: bibliography&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;danluu.com&#x2F;file-consistency&#x2F;&quot;&gt;Dan Luu, &quot;Files are hard&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;bincode&#x2F;latest&#x2F;bincode&#x2F;&quot;&gt;Ty Overby, Zoey Riordan, Victor Koenders, &lt;em&gt;bincode&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;archive.cs.st-andrews.ac.uk&#x2F;papers&#x2F;download&#x2F;ABC+83b.pdf&quot;&gt;Atkinson, M.P., Bailey, P.J., Chisholm, K.J., Cockshott, W.P. &amp;amp; Morrison, R. “PS-algol: A
Language for Persistent Programming”. In Proc. 10th Australian National Computer
Conference, Melbourne, Australia (1983) pp 70-79.&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;calpaterson.com&#x2F;bank-python.html&quot;&gt;Cal Paterson, &quot;An oral history of Bank Python&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.devever.net&#x2F;~hl&#x2F;f&#x2F;as400guide.pdf&quot;&gt;Hugo Landau, &quot;IBM i: An Unofficial Introduction&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;protobuf.dev&#x2F;&quot;&gt;Google LLC, &quot;Protocol Buffers&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;flatbuffers.dev&#x2F;&quot;&gt;Google LLC, &quot;FlatBuffers Docs&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.infoq.com&#x2F;presentations&#x2F;Simple-Made-Easy&#x2F;&quot;&gt;Rich Hickey, &quot;Simple Made Easy&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;thume.ca&#x2F;2020&#x2F;04&#x2F;18&#x2F;telefork-forking-a-process-onto-a-different-computer&#x2F;&quot;&gt;Tristan Hume, &quot;Teleforking a process onto a different computer!&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rr-project.org&#x2F;&quot;&gt;Robert O’Callahan et al., &quot;RR&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;containers&#x2F;bubblewrap&quot;&gt;Simon McVittie et al., &quot;bubblewrap&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;habitatchronicles.com&#x2F;2017&#x2F;05&#x2F;what-are-capabilities&#x2F;&quot;&gt;Chip Morningstar and F. Randall Farmer, &quot;What Are Capabilities?&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;robert.ocallahan.org&#x2F;2017&#x2F;09&#x2F;rr-trace-portability.html&quot;&gt;Robert O&#x27;Callahan, &quot;rr Trace Portability&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;coreutils&#x2F;manual&#x2F;html_node&#x2F;Treating-_002f-specially.html&quot;&gt;Free Software Foundation, Inc., &quot;GNU Coreutils&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;blog.waleedkhan.name&#x2F;git-undo&#x2F;&quot;&gt;Waleed Khan, &quot;git undo: We can do better&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;&quot;&gt;Marcin Kulik, &quot;Record and share your terminal sessions, the simple way.&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;the-postmodern-build-system&#x2F;#limits-of-execve-memoization&quot;&gt;Jade Lovelace, &quot;The postmodern build system&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;salsa-rs.netlify.app&#x2F;&quot;&gt;Salsa developrs, &quot;About salsa&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;queries&#x2F;incremental-compilation-in-detail.html#improving-accuracy-the-red-green-algorithm&quot;&gt;The Rust Project contributors, &quot;Incremental compilation in detail&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;spacejam&#x2F;sled?tab=readme-ov-file#performance&quot;&gt;Tyler Neely, &quot;sled - it&#x27;s all downhill from here!!!&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;sponsors&#x2F;edef1c&quot;&gt;edef&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;wal-intro.html#WAL-INTRO&quot;&gt;The PostgreSQL Global Development Group, &quot;Reliability and the Write-Ahead Log: Write-Ahead Logging (WAL)&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@yvanscher&#x2F;7-cobol-examples-with-explanations-ae1784b4d576&quot;&gt;Yvan Scher, &quot;7 cobol examples with explanations.&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.cl.cam.ac.uk&#x2F;research&#x2F;security&#x2F;ctsrd&#x2F;&quot;&gt;Robert N. M. Watson et al., &quot;CTSRD – Rethinking the hardware-software interface for security&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;webassembly.org&#x2F;&quot;&gt;WebAssembly Working Group, &quot;WebAssembly&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.cat-v.org&#x2F;bell_labs&#x2F;utah2000&#x2F;utah2000.html&quot;&gt;Rob Pike, &quot;Systems Software Research is Irrelevant&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;ptrace.2.html&quot;&gt;System Calls Manual, &quot;ptrace(2)&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;dpkg.1.html#:~:text=listfiles&quot;&gt;dpkg suite, &quot;dpkg(1)&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;MUMPS&quot;&gt;Wikipedia, &quot;MUMPS&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Persistence_(computer_science)#Orthogonal_or_transparent_persistence&quot;&gt;Wikipedia, &quot;orthogonal persistence&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;IBM_i#Technology_Independent_Machine_Interface_(TIMI)&quot;&gt;Wikipedia, &quot;IBM i&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;ZFS#Snapshots_and_clones&quot;&gt;Wikipedia, &quot;ZFS&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Orthogonality#Computer_science&quot;&gt;Wikipedia, &quot;Orthogonality&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Hibernation_(computing)&quot;&gt;Wikipedia, &quot;Hibernation (computing)&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Compaq_LTE#LTE_Lite&quot;&gt;Wikipedia, &quot;Compaq LTE Lite&quot;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;the IBM i will be coming up many times in this series, particularly block terminals and the object capability model. i will glaze over parts of the system that cannot be intercepted at a syscall boundary; but that said i want to point out that &lt;a href=&quot;https:&#x2F;&#x2F;www.devever.net&#x2F;~hl&#x2F;f&#x2F;as400guide.pdf#page=13&quot;&gt;IBM POWER extensions&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;IBM_i#Technology_Independent_Machine_Interface_(TIMI)&quot;&gt;TIMI&lt;&#x2F;a&gt; correspond roughly to the modern ideas of the &lt;a href=&quot;https:&#x2F;&#x2F;www.cl.cam.ac.uk&#x2F;research&#x2F;security&#x2F;ctsrd&#x2F;&quot;&gt;CHERI&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;webassembly.org&#x2F;&quot;&gt;WASM&lt;&#x2F;a&gt; projects. &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-5&quot;&gt;
&lt;p&gt;jyn, you might ask, why are all these systems so old! why legacy systems? isn&#x27;t there any new code with these ideas? and the answer is no. &lt;a href=&quot;https:&#x2F;&#x2F;doc.cat-v.org&#x2F;bell_labs&#x2F;utah2000&#x2F;utah2000.html&quot;&gt;systems research is irrelevant&lt;&#x2F;a&gt; and its new ideas, such as they are, do not make it into industry. &lt;a href=&quot;#fr-5-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;credit &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@yvanscher&#x2F;7-cobol-examples-with-explanations-ae1784b4d576&quot;&gt;@yvanscher&lt;&#x2F;a&gt; &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-6&quot;&gt;
&lt;p&gt;on all OSes i know other than Linux, the syscall ABI is not stable and programs are expected to use libc bindings. you can do something similar by using LD_PRELOAD to intercept libc calls. &lt;a href=&quot;#fr-6-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;one might think that you have to flush each write to disk before returning from write() in order to preserve ACID semantics. not so; this is exactly the problem that a &lt;a href=&quot;https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;wal-intro.html#WAL-INTRO&quot;&gt;write-ahead-log&lt;&#x2F;a&gt; fixes. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>how i write blog posts</title>
        <published>2025-06-18T00:00:00+00:00</published>
        <updated>2025-06-18T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/how-i-write-blog-posts/"/>
        <id>https://jyn.dev/how-i-write-blog-posts/</id>
        
        <summary type="html">the trick is to make it as easy as possible</summary>
        
        <content type="html" xml:base="https://jyn.dev/how-i-write-blog-posts/">&lt;p&gt;this isn’t about about blogging engines, don’t worry. there’s already plenty of writing about those. i use zola, i am mildly dissatisfied with it, i don’t care enough to switch.&lt;&#x2F;p&gt;
&lt;p&gt;no, this is how i actually write. i have an um. &lt;em&gt;eccentric&lt;&#x2F;em&gt; setup. in particular, i can write draft posts from any of my devices—desktop, laptop, phone—and have them show up live on a hidden subdomain of jyn.dev without any special work on my part.&lt;&#x2F;p&gt;
&lt;p&gt;how does this work? i’m glad you asked.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;on my desktop, i have Caddy running a reverse proxy back to a live zola server. Caddy gives me nice things like https, and makes me less worried about having public ports on the internet.
&lt;ul&gt;
&lt;li&gt;to get live-reloading working, Caddy also reverse-proxies websockets.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;on my desktop, i have the zola content&#x2F; directory sym-linked to a subdirectory of my obsidian notes folder.&lt;&#x2F;li&gt;
&lt;li&gt;on all my devices, i run Obsidian Sync in the background, which automatically syncs my posts everywhere. it costs $5&#x2F;month and doesn’t cause me trouble, which is a lot more than i can say for most technology.&lt;&#x2F;li&gt;
&lt;li&gt;on laptop and mobile, i just write in obsidian, like i would for any other notes. i have a &quot;blog post&quot; template that inserts the zola header; otherwise i just write normal markdown.&lt;&#x2F;li&gt;
&lt;li&gt;when i’m ready to publish, i commit the changes to git on desktop or laptop and push to github, which updates the public facing blog.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;works great!&lt;&#x2F;p&gt;
&lt;p&gt;normally i write outlines and ideas down on mobile, and then clean them up into prose on desktop. when i edit on desktop, i sometimes use nvim (e.g. for posts like &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;how-i-use-my-terminal&#x2F;&quot;&gt;how i use my terminal&lt;&#x2F;a&gt; that have complicated html fragments). unlike obsidian, nvim doesn&#x27;t have autosave, so i &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;dotfiles&#x2F;blob&#x2F;45f6702de2608a972615cd877993a41521f76348&#x2F;config&#x2F;nvim.lua#L242-L268&quot;&gt;added it myself&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;lua&quot; class=&quot;language-lua z-code&quot;&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-comment z-line z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-lua&quot;&gt;--&lt;&#x2F;span&gt; autosave on cursor hold
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-lua&quot;&gt;local&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;timers&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-lua&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-lua&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-lua&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-lua&quot;&gt;function&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-name z-function&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-lua&quot;&gt;autosave_enable&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;  &lt;span class=&quot;z-storage z-modifier z-lua&quot;&gt;local&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-lua&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;api&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;nvim_get_current_buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;  &lt;span class=&quot;z-keyword z-control z-conditional z-lua&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;timers&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-lua&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-lua&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-lua&quot;&gt;then&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-return z-lua&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-end z-lua&quot;&gt;end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;  &lt;span class=&quot;z-storage z-modifier z-lua&quot;&gt;local&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf_name&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-lua&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;fn&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;expand&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;%&lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;  &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;notify&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;autosaving &lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-concatenation z-lua&quot;&gt;..&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf_name&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;  &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;timers&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-lua&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-lua&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-lua&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;api&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;nvim_create_autocmd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;CursorHold&lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-lua&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-lua&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-lua&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-key z-lua&quot;&gt;desc&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-lua&quot;&gt;=&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-lua&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Save &lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-concatenation z-lua&quot;&gt;..&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf_name&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-concatenation z-lua&quot;&gt;..&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt; on change&lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-field z-lua&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-lua&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-lua&quot;&gt;callback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-lua&quot;&gt;=&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-lua&quot;&gt; &lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-lua&quot;&gt;function&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;api&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;nvim_buf_call&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-lua&quot;&gt;buf&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-lua&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;      &lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-lua&quot;&gt;function&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;cmd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;silent update&lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-end z-lua&quot;&gt;end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-meta z-mapping z-value z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-end z-lua&quot;&gt;end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-lua&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function z-lua&quot;&gt;&lt;span class=&quot;z-meta z-block z-lua&quot;&gt;&lt;span class=&quot;z-keyword z-control z-end z-lua&quot;&gt;end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-variable z-other z-lua&quot;&gt;vim&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;api&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-lua&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-property z-lua&quot;&gt;&lt;span class=&quot;z-variable z-function z-lua&quot;&gt;nvim_create_user_command&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-lua&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-single z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;AutoSave&lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-lua&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-lua&quot;&gt;autosave_enable&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-lua&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-lua&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-lua&quot;&gt;&lt;span class=&quot;z-meta z-group z-lua&quot;&gt;	&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-lua&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-key z-lua&quot;&gt;&lt;span class=&quot;z-string z-unquoted z-key z-lua&quot;&gt;desc&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-lua&quot;&gt;=&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-value z-lua&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Start saving each second on change&lt;span class=&quot;z-punctuation z-definition z-string z-end z-lua&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-mapping z-lua&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-lua&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-lua&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;the Caddyfile is also quite simple:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;Caddyfile&quot; class=&quot;language-Caddyfile z-code&quot;&gt;&lt;code class=&quot;language-Caddyfile&quot; data-lang=&quot;Caddyfile&quot;&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-variable z-other z-Caddyfile&quot;&gt;subdomain.jyn.dev&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt; {&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;        &lt;span class=&quot;z-comment z-line z-Caddyfile&quot;&gt;# start with `zola serve --drafts --base-url &#x2F;`&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;        &lt;span class=&quot;z-support z-function z-Caddyfile&quot;&gt;reverse_proxy&lt;&#x2F;span&gt; localhost:1111&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt; {&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;                &lt;span class=&quot;z-keyword z-other z-Caddyfile&quot;&gt;fail_duration&lt;&#x2F;span&gt; 10s
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt;        }&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;        &lt;span class=&quot;z-support z-function z-Caddyfile&quot;&gt;handle_errors&lt;&#x2F;span&gt; 502 503&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt; {&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;                &lt;span class=&quot;z-keyword z-other z-Caddyfile&quot;&gt;header&lt;&#x2F;span&gt; Content-Type text&#x2F;html
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;                &lt;span class=&quot;z-keyword z-other z-Caddyfile&quot;&gt;respond&lt;&#x2F;span&gt; 503&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt; {&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;                        &lt;span class=&quot;z-keyword z-other z-Caddyfile&quot;&gt;body&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-Caddyfile&quot;&gt;&amp;quot;&amp;lt;!doctype html&amp;gt;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;subdomain.jyn.dev is down right n
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-Caddyfile&quot;&gt;ow; DM jyn to bring it back up. or just visit &amp;lt;a href=&amp;#39;https:&#x2F;&#x2F;jyn.dev&amp;#39;&amp;gt;jyn.dev&amp;lt;&#x2F;a&amp;gt;.&amp;lt;&#x2F;b
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-Caddyfile&quot;&gt;ody&amp;gt;&amp;lt;&#x2F;html&amp;gt;&amp;quot;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt;                }&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt;        }&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-comment z-line z-Caddyfile&quot;&gt;# websocket proxy&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-variable z-other z-Caddyfile&quot;&gt;subdomain.jyn.dev:1025&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt; {&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;        &lt;span class=&quot;z-support z-function z-Caddyfile&quot;&gt;reverse_proxy&lt;&#x2F;span&gt; localhost:1024 {}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-Caddyfile&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-bracket z-Caddyfile&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;the one downside of this is that i get very little visibility on mobile onto why things are not syncing to the desktop. to make up for this, my phone and desktop are on the same &lt;a href=&quot;https:&#x2F;&#x2F;tailscale.com&#x2F;kb&#x2F;1151&#x2F;what-is-tailscale&quot;&gt;tailnet&lt;&#x2F;a&gt;, which allows me to ssh in remotely to check up on the zola server (i’ve never had to check up on the Caddy server). i like &lt;a href=&quot;https:&#x2F;&#x2F;termius.com&#x2F;&quot;&gt;Termius&lt;&#x2F;a&gt; for this.&lt;&#x2F;p&gt;
&lt;p&gt;note some things about this setup:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;i have live reloading all the way through, regardless of the editor or device i am using to edit the post.&lt;&#x2F;li&gt;
&lt;li&gt;because it&#x27;s just a public url, it&#x27;s very easy to share with my friends and ask for feedback on early posts, without making the posts visible to random people on hacker news.&lt;&#x2F;li&gt;
&lt;li&gt;if i ever want to take down the site, i just kill the zola server. it defaults to off when i start my computer.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>how i use my terminal</title>
        <published>2025-06-16T00:00:00+00:00</published>
        <updated>2025-06-16T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/how-i-use-my-terminal/"/>
        <id>https://jyn.dev/how-i-use-my-terminal/</id>
        
        <summary type="html">i have gone a little above and beyond trying to get all the features of VSCode</summary>
        
        <content type="html" xml:base="https://jyn.dev/how-i-use-my-terminal/">&lt;p&gt;this is a whole blog post because it is &quot;outside the overton window&quot;; it usually takes at least a video before people even understand the thing i am trying to describe. so, here&#x27;s the video:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;video controls&gt;&lt;source src=&quot;&#x2F;assets&#x2F;terminal-recording.mp4&quot;&gt;&lt;&#x2F;video&gt;&lt;&#x2F;p&gt;
&lt;p&gt;the steps here that tend to surprise people are &lt;button class=timestamp&gt;0:11&lt;&#x2F;button&gt;
, &lt;button class=timestamp&gt;0:21&lt;&#x2F;button&gt;
, and &lt;button class=timestamp&gt;0:41&lt;&#x2F;button&gt;
. when i say &quot;surprise&quot; i don&#x27;t just mean that people are surprised that i&#x27;ve set this up, but they are surprised this is possible at all.&lt;&#x2F;p&gt;
&lt;p&gt;here&#x27;s what happens in that video:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:00&lt;&#x2F;button&gt;
 I start with Windows Terminal open on my laptop.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:02&lt;&#x2F;button&gt;
 I hit &lt;kbd&gt;ctrl + shift + 5&lt;&#x2F;kbd&gt;, which opens a new terminal tab which &lt;code&gt;ssh&lt;&#x2F;code&gt;&#x27;s to my home desktop and immediately launches tmux.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:03&lt;&#x2F;button&gt;
 tmux launches my default shell, &lt;code&gt;zsh&lt;&#x2F;code&gt;. zsh shows a prompt, while loading the full config asynchronously&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:08&lt;&#x2F;button&gt;
 i use &lt;code&gt;zoxide&lt;&#x2F;code&gt; to fuzzy find a recent directory&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:09&lt;&#x2F;button&gt;
 i start typing a ripgrep command. zsh autofills the command since i&#x27;ve typed it before and i accept it with &lt;kbd&gt;ctrl + f&lt;&#x2F;kbd&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:11&lt;&#x2F;button&gt;
 i hit &lt;kbd&gt;ctrl + k&lt;&#x2F;kbd&gt;&lt;kbd&gt;f&lt;&#x2F;kbd&gt;, which tells tmux to search all output in the scrollback for filenames. the filenames are highlighted in blue.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:12&lt;&#x2F;button&gt;
 i hold &lt;kbd&gt;n&lt;&#x2F;kbd&gt; to navigate through the files. there are a lot of them, so it takes me a bit to find the one i&#x27;m looking for.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:21&lt;&#x2F;button&gt;
 i press &lt;kbd&gt;o&lt;&#x2F;kbd&gt; to open the selected file in my default application (&lt;code&gt;nvim&lt;&#x2F;code&gt;). tmux launches it in a new pane. note that this is still running &lt;em&gt;on the remote server&lt;&#x2F;em&gt;; it is opening a remote file in a remote tmux pane. i do not need to have this codebase cloned locally on my laptop.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:26&lt;&#x2F;button&gt;
 i try to navigate to several references using rust-analyzer, which fails because RA doesn&#x27;t understand the macros in this file. at &lt;button class=timestamp&gt;0:32&lt;&#x2F;button&gt;
 i finally find one which works and navigate to it.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:38&lt;&#x2F;button&gt;
 i hit &lt;kbd&gt;ctrl + k&lt;&#x2F;kbd&gt;&lt;kbd&gt;h&lt;&#x2F;kbd&gt;, which tells tmux to switch focus back to the left pane.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:39&lt;&#x2F;button&gt;
 i hit &lt;kbd&gt;n&lt;&#x2F;kbd&gt; again. the pane is still in &quot;copy-mode&quot;, so all the files from before are still the focus of the search. they are highlighted again and tmux selects the next file in search order.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:41&lt;&#x2F;button&gt;
 i hit &lt;kbd&gt;o&lt;&#x2F;kbd&gt;, which opens a different file than before, but in the &lt;em&gt;same&lt;&#x2F;em&gt; instance of &lt;code&gt;nvim&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;button class=timestamp&gt;0:43&lt;&#x2F;button&gt;
 i hit &lt;kbd&gt;&lt;&#x2F;kbd&gt;&lt;kbd&gt;b&lt;&#x2F;kbd&gt;, which shows my open file buffers. in particular, this shows that the earlier file is still open. i switch back and forth between the two files a couple times before ending the stream.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;but-why&quot;&gt;but why??&lt;a class=&quot;zola-anchor&quot; href=&quot;#but-why&quot; aria-label=&quot;Anchor link for: but-why&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;i got annoyed at VSCode a while back for being laggy, especially when the vim plugin was running, and at having lots of keybind conflicts between the editor, vim plugin, terminal, and window management. i tried zed but at the time it was quite immature (and still had the problem of lots of keybind conflicts).&lt;&#x2F;p&gt;
&lt;p&gt;i switched to using nvim in the terminal, but quickly got annoyed at how much time i spent copy-pasting filenames into the editor; in particular i would often copy-paste files with columns from ripgrep, get a syntax error, and then have to edit them before actually opening the file. this was quite annoying. what i wanted was an equivalent of ctrl-click in vscode, where i could take an arbitrary file path and have it open as smoothly as i could navigate to it. so, i started using tmux and built it myself.&lt;&#x2F;p&gt;
&lt;p&gt;people sometimes ask me why i use tmux. this is why! this is the whole reason! (well, this and session persistence.) terminals are stupidly powerful and most of them expose almost none of it to you as the user. i like tmux, despite its age, bugs, and antiquated syntax, because it&#x27;s very extensible in this way.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-it-works&quot;&gt;how it works&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-it-works&quot; aria-label=&quot;Anchor link for: how-it-works&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;search-all-scrollback-for-filenames&quot;&gt;search all scrollback for filenames&lt;a class=&quot;zola-anchor&quot; href=&quot;#search-all-scrollback-for-filenames&quot; aria-label=&quot;Anchor link for: search-all-scrollback-for-filenames&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this is done purely with tmux config:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;tmux&quot; class=&quot;language-tmux z-code&quot;&gt;&lt;code class=&quot;language-tmux&quot; data-lang=&quot;tmux&quot;&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-tmux&quot;&gt;#&lt;&#x2F;span&gt; i am so sorry
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-tmux&quot;&gt;#&lt;&#x2F;span&gt; see `search-regex.sh` for wtf this means
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-tmux&quot;&gt;#&lt;&#x2F;span&gt; TODO: include shell variable names
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-support z-function z-tmux&quot;&gt;bind-key&lt;&#x2F;span&gt; f &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;copy-mode&lt;&#x2F;span&gt; \; &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;send-keys&lt;&#x2F;span&gt; -X search-backward \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;  &lt;span class=&quot;z-string z-quoted z-single z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-tmux&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;(^|&#x2F;|&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\&amp;lt;&lt;&#x2F;span&gt;|[[:space:]&amp;quot;])((&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;|&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;)|[[:alnum:]~_&amp;quot;-]*)((&#x2F;[][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+)+([&#x2F; &amp;quot;]|&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;([][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+(:[0-9]+)?(:[0-9]+)?)|[][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+(:[0-9]+)(:[0-9]+)?)|(&#x2F;[][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+){2,}([&#x2F; &amp;quot;]|&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;([][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+(:[0-9]+)?(:[0-9]+)?)|[][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+(:[0-9]+)(:[0-9]+)?)?|(&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;|&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-tmux&quot;&gt;\.&lt;&#x2F;span&gt;)&#x2F;([][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]+(:[0-9]+)?(:[0-9]+)?))&lt;span class=&quot;z-punctuation z-definition z-string z-end z-tmux&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and this is the contents of &lt;code&gt;search-regex.sh&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;start_delim&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;(^|&#x2F;|\&amp;lt;|[[:space:]&amp;quot;])&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;relative_path&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;(\.|\.\.)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;start_path&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;(&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;relative_path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;|[[:alnum:]~_&lt;span class=&quot;z-constant z-character z-escape z-shell&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;-]*)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;component&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;[][[:alnum:]_.#$%&amp;amp;+=@&amp;quot;-]&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;intermediate_paths&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;(&#x2F;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;component&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;+)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;line_no&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;(:[0-9]+)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;file_end&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;(&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;component&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;+&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;line_no&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;?&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;line_no&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;?)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;end&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;([&#x2F; &lt;span class=&quot;z-constant z-character z-escape z-shell&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;]|\.&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;file_end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;|&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;component&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;+&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;line_no&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;line_no&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;?)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;start_delim&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;start_path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;(&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;intermediate_paths&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;+&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;|&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;intermediate_paths&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;{2,}&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;?|&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;relative_path&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;file_end&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; test cases omitted for brevity&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;i will not go through the whole regex, but uh. there you go. i spent more time on this than i probably should have.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;open-selected-file-in-a-new-pane-running-nvim&quot;&gt;open selected file in a new pane running nvim&lt;a class=&quot;zola-anchor&quot; href=&quot;#open-selected-file-in-a-new-pane-running-nvim&quot; aria-label=&quot;Anchor link for: open-selected-file-in-a-new-pane-running-nvim&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this is actually a trick; there are many steps here.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;open-selected-file-in-default-application&quot;&gt;open selected file in default application&lt;a class=&quot;zola-anchor&quot; href=&quot;#open-selected-file-in-default-application&quot; aria-label=&quot;Anchor link for: open-selected-file-in-default-application&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;this part is not so bad. tmux again.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;tmux&quot; class=&quot;language-tmux z-code&quot;&gt;&lt;code class=&quot;language-tmux&quot; data-lang=&quot;tmux&quot;&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-tmux&quot;&gt;#&lt;&#x2F;span&gt; `cd` is important in case this is a relative path. `echo | bash` is to perform tilde expansion.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-support z-function z-tmux&quot;&gt;bind-key&lt;&#x2F;span&gt; -T &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;copy-mode&lt;&#x2F;span&gt;-vi o  &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;send-keys&lt;&#x2F;span&gt; -X copy-pipe \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;    &lt;span class=&quot;z-string z-quoted z-single z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-tmux&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;cd #{pane_current_path}; xargs -I {} echo &amp;quot;echo {}&amp;quot; | bash | xargs open&lt;span class=&quot;z-punctuation z-definition z-string z-end z-tmux&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; \; \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;  if -F &lt;span class=&quot;z-string z-quoted z-double z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-tmux&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;#{alternate_on}&lt;span class=&quot;z-punctuation z-definition z-string z-end z-tmux&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; { &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;send-keys&lt;&#x2F;span&gt; -X cancel }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;i also have a version that always opens an editor in the current pane, instead of launching in the default application. for example i use &lt;a href=&quot;https:&#x2F;&#x2F;fx.wtf&#x2F;&quot;&gt;&lt;code&gt;fx&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; by default to view json files, but &lt;code&gt;nvim&lt;&#x2F;code&gt; to edit them.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;tmux&quot; class=&quot;language-tmux z-code&quot;&gt;&lt;code class=&quot;language-tmux&quot; data-lang=&quot;tmux&quot;&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-tmux&quot;&gt;#&lt;&#x2F;span&gt; save the buffer, then open an editor in the current pane
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;&lt;span class=&quot;z-support z-function z-tmux&quot;&gt;bind-key&lt;&#x2F;span&gt; -T &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;copy-mode&lt;&#x2F;span&gt;-vi O &lt;span class=&quot;z-support z-function z-tmux&quot;&gt;send-keys&lt;&#x2F;span&gt; -X copy-pipe-and-cancel \
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-tmux&quot;&gt;    &lt;span class=&quot;z-string z-quoted z-single z-tmux&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-tmux&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;tmux send-keys &amp;quot;C-q&amp;quot;; xargs -I {} tmux send-keys &amp;quot;${EDITOR:-vi} {}&amp;quot;; tmux send-keys &amp;quot;C-m&amp;quot;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-tmux&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;open-a-new-pane-running-nvim&quot;&gt;open a new pane running nvim&lt;a class=&quot;zola-anchor&quot; href=&quot;#open-a-new-pane-running-nvim&quot; aria-label=&quot;Anchor link for: open-a-new-pane-running-nvim&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;here is the trick. i have created &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;dotfiles&#x2F;blob&#x2F;master&#x2F;bin&#x2F;hx-hax&quot;&gt;a shell script&lt;&#x2F;a&gt; (actually a perl script) that is the default application for all text files.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;setting up that many file associations by hand is a pain. i will write a separate blog post about the scripts that install my dotfiles onto a system. i don&#x27;t use Nix partly because all my friends who use Nix have &lt;em&gt;even weirder&lt;&#x2F;em&gt; bugs than they already had, and partly because i don&#x27;t like the philosophy of not being able to install things at runtime. i want to install things at runtime and &lt;em&gt;track&lt;&#x2F;em&gt; that i did so. that&#x27;s a separate post too.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;the relevant part is this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;perl&quot; class=&quot;language-perl z-code&quot;&gt;&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-comment z-perl&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-perl&quot;&gt;#&lt;&#x2F;span&gt; don&amp;#39;t use `` so that args can have embedded pipes
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;@&lt;&#x2F;span&gt;split&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;tmux&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;split-window&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;-h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;-P&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;-F&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&amp;quot;#{pane_id}&amp;quot;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;editor&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;@&lt;&#x2F;span&gt;args&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;open&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;fd&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;-|&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;@&lt;&#x2F;span&gt;split&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;||&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-flow z-die z-perl&quot;&gt;die&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;can&amp;#39;t open pipeline: &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-language z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;!&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;this bounces &lt;em&gt;back&lt;&#x2F;em&gt; to tmux. in particular, this is being very dumb and assuming that tmux is running on the machine where the file is, which happens to be the case here. this is not too bad to ensure - i just use a separate terminal &lt;em&gt;emulator&lt;&#x2F;em&gt; tab for each instance of tmux i care about; for example i will often have open one Windows Terminal tab for WSL on my local laptop, one for my desktop, and one for a remote work machine via a VPN.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;there&#x27;s actually even more going on here—for example i am translating the &lt;code&gt;file:line:column&lt;&#x2F;code&gt; syntax to something vim understands, and overriding &lt;code&gt;xdg-open&lt;&#x2F;code&gt; so that it doesn&#x27;t error out on the &lt;code&gt;:line&lt;&#x2F;code&gt;—but for the most part it&#x27;s straightforward and not that interesting.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;open-a-file-in-a-running-instance-of-nvim&quot;&gt;open a file in a running instance of nvim&lt;a class=&quot;zola-anchor&quot; href=&quot;#open-a-file-in-a-running-instance-of-nvim&quot; aria-label=&quot;Anchor link for: open-a-file-in-a-running-instance-of-nvim&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this is a perl script that scripts tmux to send keys to a running instance of nvim (actually the same perl script as before, so that both of these can be bound to the same keybind regardless of whether nvim is already open or not):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;perl&quot; class=&quot;language-perl z-code&quot;&gt;&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;current_window&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-perl&quot;&gt;trim&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;`&lt;&#x2F;span&gt;tmux display-message -p &amp;quot;#{window_id}&amp;quot;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;pane&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-perl&quot;&gt;trim&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;`&lt;&#x2F;span&gt;tmux list-panes -a &lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\\&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;  -f &amp;#39;#{&amp;amp;&amp;amp;:#{==:#{window_id},&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;current_window&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;},#{==:#{pane_current_command},&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;editor&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;}}&amp;#39; &lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\\&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;  -F &amp;#39;#{pane_id}&amp;#39;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-comment z-perl&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-perl&quot;&gt;#&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-comment z-perl&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-perl&quot;&gt;#&lt;&#x2F;span&gt; exit copy mode so we don&amp;#39;t send these commands directly to tmux
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;`&lt;&#x2F;span&gt;tmux send-keys -t &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;pane&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt; -X cancel 2&amp;gt;&#x2F;dev&#x2F;null&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-comment z-perl&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-perl&quot;&gt;#&lt;&#x2F;span&gt; Escape for some reason doesn&amp;#39;t get sent as the escape key if it shows up next to any other keys???
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;`&lt;&#x2F;span&gt;tmux send-keys -t &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;pane&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt; Escape&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;args&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;join&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;@&lt;&#x2F;span&gt;args&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;cmd&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;editor&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;eq&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;nvim&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;?&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;drop&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;open&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;`&lt;&#x2F;span&gt;tmux send-keys -t &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;pane&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt; &amp;quot;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;cmd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;args&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&amp;quot; Enter&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;`&lt;&#x2F;span&gt;tmux select-pane -t &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;pane&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-backtick z-perl&quot;&gt; -Z&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;consequences-of-this-setup&quot;&gt;consequences of this setup&lt;a class=&quot;zola-anchor&quot; href=&quot;#consequences-of-this-setup&quot; aria-label=&quot;Anchor link for: consequences-of-this-setup&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;i don&#x27;t need a fancy terminal locally; something with nice fonts is enough. all the fancy things are done through tmux, which is good because it means they work on Windows too without needing to install a separate terminal.&lt;&#x2F;li&gt;
&lt;li&gt;the editor thing works even if the editor doesn&#x27;t support remote scripting. nvim &lt;em&gt;does&lt;&#x2F;em&gt; support RPC, but this setup also worked back when i used &lt;code&gt;helix&lt;&#x2F;code&gt; and &lt;code&gt;kakoune&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;i &lt;em&gt;could&lt;&#x2F;em&gt; have written this such that the fancy terminal emulator scripts were in my editor, not in tmux (e.g. &lt;code&gt;:terminal&lt;&#x2F;code&gt; in nvim). but again this locks me into the editor; and the built-in terminals in editors are usually not very good.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;ok-but-do-you-really-want-to-use-tmux&quot;&gt;ok, but do you really want to use tmux&lt;a class=&quot;zola-anchor&quot; href=&quot;#ok-but-do-you-really-want-to-use-tmux&quot; aria-label=&quot;Anchor link for: ok-but-do-you-really-want-to-use-tmux&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;well. well. now that you mention it. the last thing keeping me on tmux was session persistence and &lt;a href=&quot;https:&#x2F;&#x2F;ansuz.sooke.bc.ca&#x2F;entry&#x2F;389&quot;&gt;Ansuz has just released a standalone tool that does persistence and nothing else&lt;&#x2F;a&gt;. so. i plan to switch to &lt;a href=&quot;https:&#x2F;&#x2F;sw.kovidgoyal.net&#x2F;kitty&#x2F;&quot;&gt;kitty&lt;&#x2F;a&gt; in the near future, which lets me keep all these scripts and does not require shoving a whole second terminal emulator inside my terminal emulator, which hopefully will reduce the number of weird mysterious bugs i encounter on a regular basis.&lt;&#x2F;p&gt;
&lt;p&gt;the reason i picked kitty over &lt;a href=&quot;https:&#x2F;&#x2F;wezterm.org&#x2F;&quot;&gt;wezterm&lt;&#x2F;a&gt; is that ssh integration works by integrating with the shell, not by launching a server process, so it doesn&#x27;t need to be installed on the remote. this mattered less for tmux because tmux is everywhere, but hardly anywhere has wezterm installed by default.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;was-it-worth-it&quot;&gt;... was it worth it?&lt;a class=&quot;zola-anchor&quot; href=&quot;#was-it-worth-it&quot; aria-label=&quot;Anchor link for: was-it-worth-it&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;honestly, yeah. i spend quite a lot less time fighting my editor these days.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;it&#x27;s &lt;em&gt;much&lt;&#x2F;em&gt; easier to debug when something goes wrong (vscode&#x27;s debugging tools are mostly for plugin extension authors and running them is non-trivial). with vim plugins i can just add &lt;code&gt;print&lt;&#x2F;code&gt; statements to the lua source and see what&#x27;s happening.&lt;&#x2F;li&gt;
&lt;li&gt;all my keybinds make sense to me!&lt;&#x2F;li&gt;
&lt;li&gt;my editor is less laggy.&lt;&#x2F;li&gt;
&lt;li&gt;my terminal is much easier to script through tmux than through writing a VSCode plugin, which usually involves setting up a whole typescript toolchain and context-switching into a new project&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;that said, i cannot in good conscience recommend this to anyone else. all my scripts are fragile and will probably break if you look at them wrong, which is not ideal if you haven&#x27;t written them yourself and don&#x27;t know where to start debugging them.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;ok-but-this-looks-nice-i-want-this&quot;&gt;ok but this looks nice i want this&lt;a class=&quot;zola-anchor&quot; href=&quot;#ok-but-this-looks-nice-i-want-this&quot; aria-label=&quot;Anchor link for: ok-but-this-looks-nice-i-want-this&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;if you do want something similar without writing your own tools, i can recommend:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;fishshell.com&#x2F;&quot;&gt;fish&lt;&#x2F;a&gt; + &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ajeetdsouza&#x2F;zoxide&#x2F;&quot;&gt;zoxide&lt;&#x2F;a&gt; + &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;junegunn&#x2F;fzf&quot;&gt;fzf&lt;&#x2F;a&gt;. that gets you steps 4, 5, and kinda sorta-ish 6.&lt;&#x2F;li&gt;
&lt;li&gt;&quot;builtin functionality in your editor&quot; - fuzzy find, full text search, tabs and windows, and &quot;open recent file&quot; are all commonly supported.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;git.causal.agency&#x2F;src&#x2F;tree&#x2F;bin&#x2F;qf.c&quot;&gt;qf&lt;&#x2F;a&gt;, which gets you the &quot;select files in terminal output&quot; part of 6, kinda. you have to remember to pipe your output to it though, so it doesn&#x27;t work after the fact and it doesn&#x27;t work if your tool is interactive. note that it hard-codes a vi-like CLI (&lt;code&gt;vi +line file.ext&lt;&#x2F;code&gt;), so you may need to fork it or still add a script that takes the place of $EDITOR. see &lt;a href=&quot;https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2025&#x2F;06&#x2F;10&#x2F;how-to-compile-a-c-program&#x2F;&quot;&gt;julia evans&#x27; most recent post&lt;&#x2F;a&gt; for more info.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;kilobyte&#x2F;e&quot;&gt;e&lt;&#x2F;a&gt;, which gets you the &quot;translate &lt;code&gt;file:line&lt;&#x2F;code&gt; into something your editor recognizes&quot; part of 8, kinda. i had never heard of this tool until i wrote my own with literally the exactly the same name that did literally exactly the same thing, forgot to put it in PATH, and got a suggestion from &lt;code&gt;command-not-found&lt;&#x2F;code&gt; asking if i wanted to install it, lol.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;vim --remote filename&lt;&#x2F;code&gt; or &lt;code&gt;code filename&lt;&#x2F;code&gt; or &lt;code&gt;emacsclient filename&lt;&#x2F;code&gt;, all of which get you 12, kinda. the problem with this is that they don&#x27;t all support &lt;code&gt;file:line&lt;&#x2F;code&gt;, and it means you have to modify this whenever you switch editors. admittedly most people don&#x27;t switch editors that often, lol.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;what-have-we-learned&quot;&gt;what have we learned?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-have-we-learned&quot; aria-label=&quot;Anchor link for: what-have-we-learned&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;terminals are a lot more powerful than people think! by using terminals that let you script them, you can do quite a lot of things.&lt;&#x2F;li&gt;
&lt;li&gt;you can kinda sorta replicate most of these features without scripting your terminal, as long as you don&#x27;t mind tying yourself to an editor.&lt;&#x2F;li&gt;
&lt;li&gt;doing this requires quite a lot of work, because no one who builds these tools thought of these features ahead of time.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;hopefully this was interesting! i am always curious what tools people use and how - feel free to &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;email me&lt;&#x2F;a&gt; about your own setup :)&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>theory building without a mentor</title>
        <published>2025-05-24T00:00:00+00:00</published>
        <updated>2025-05-24T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/theory-building-without-a-mentor/"/>
        <id>https://jyn.dev/theory-building-without-a-mentor/</id>
        
        <summary type="html">learning how a program is intended to work is hard. here&#x27;s how to do it.</summary>
        
        <content type="html" xml:base="https://jyn.dev/theory-building-without-a-mentor/">&lt;p&gt;&lt;strong&gt;NOTE: if you are just here for the how-to guide, &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;theory-building-without-a-mentor&#x2F;#recreating-a-theory&quot;&gt;click here&lt;&#x2F;a&gt; to skip the philosophizing.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;theory-building&quot;&gt;theory building&lt;a class=&quot;zola-anchor&quot; href=&quot;#theory-building&quot; aria-label=&quot;Anchor link for: theory-building&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Peter Naur wrote a famous article in 1985 called &lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;onlurking&#x2F;fc5c81d18cfce9ff81bc968a7f342fb1&quot;&gt;Programming as Theory Building&lt;&#x2F;a&gt;. it has some excellent ideas, such as:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;programming must be the programmers’ building up knowledge of a certain kind, knowledge taken to be basically the programmers’ immediate possession, any documentation being an auxiliary product.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;solutions suggested by group B [who did not possess a theory of the program] […] effectively destroyed its power and simplicity. The members of group A [who did possess a theory] were able to spot these cases instantly and could propose simple and effective solutions, framed entirely within the existing structure.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;the program text and its documentation proved insufficient as a carrier of the most important design ideas&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;i think this article is excellent, and highly recommend reading it in full. however, i want to discuss one particular idea Naur mentions:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;For a new programmer to come to possess an existing theory of a program it is insufficient that he or she has the opportunity to become familiar with the program text and other documentation. What is required is that the new programmer has the opportunity to work in close contact with the programmers who already possess the theory [...] program revival, that is reestablishing the theory of a program merely from the documentation, is strictly impossible.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;i do not think it is true that it is impossible to recover a theory of the program merely from the code and docs. my day job, and indeed one of my most prized skills when i interview for jobs, is creating a theory of programs from their text and documentation alone. this blog post is about how i do that, and how you can too.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;theory-modification&quot;&gt;theory modification&lt;a class=&quot;zola-anchor&quot; href=&quot;#theory-modification&quot; aria-label=&quot;Anchor link for: theory-modification&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Naur also says in the article:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;“in a certain sense there can be no question of theory modification, only program modification”&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;i think this is wrong: theory modification is exactly what Ward Cunningham describes as &quot;consolidation&quot; in his 1992 article on &lt;a href=&quot;https:&#x2F;&#x2F;c2.com&#x2F;doc&#x2F;oopsla92.html&quot;&gt;Technical Debt&lt;&#x2F;a&gt;. i highly recommend the original article, but the basic idea is that over time, your understanding of how the program &lt;em&gt;should&lt;&#x2F;em&gt; behave changes, and you modify and refactor your program to match that idea. this happens in all programs, but the modification is easier in programs with little &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;technical-debt-is-different-from-technical-risk&#x2F;&quot;&gt;technical risk&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;furthermore, this theory modification often happens unintentionally over time as people are added and removed from teams. as &lt;a href=&quot;https:&#x2F;&#x2F;blog.ceejbot.com&#x2F;posts&#x2F;dysfunction-junction&#x2F;#fn:1&quot;&gt;ceejbot puts it&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;This is Conway’s Law over time. Teams are immutable: adding or removing a person to a team produces a different team. After enough change, the team is different enough that it no longer recognizes itself in the software system it produces. The result is people being vaguely unhappy about software that might be working perfectly well.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;i bring this up to note that you will never recover the &lt;em&gt;same&lt;&#x2F;em&gt; theory as the original programmers (at least, not without talking to them directly). the most you can do is to recover one similar enough that it does not require large changes to the program. in other words, you are creating a new theory of the program, and may end up having to adapt the program to your new theory.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;recreating-a-theory&quot;&gt;recreating a theory&lt;a class=&quot;zola-anchor&quot; href=&quot;#recreating-a-theory&quot; aria-label=&quot;Anchor link for: recreating-a-theory&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;this is useful both when fixing bugs and when adding new features; i will focus on new features because i want to emphasize that these skills are useful any time you modify a program. for a focus on debugging, see Julia Evans&#x27; &lt;a href=&quot;https:&#x2F;&#x2F;wizardzines.com&#x2F;zines&#x2F;debugging-guide&#x2F;&quot;&gt;Pocket Guide to Debugging&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;this post is about creating theories at the &quot;micro&quot; level, for small portions of the program. i hope to make a post about the &quot;macro&quot; level in the future, since that&#x27;s what really lets you start making design decisions about a program.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;i recently made a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;neovim&#x2F;neovim&#x2F;pull&#x2F;33339&#x2F;&quot;&gt;PR to neovim&lt;&#x2F;a&gt;, having never worked on neovim before; i&#x27;ll use that as an example going forward.
i highly recommend following along with a piece of code you want to learn more about. if you don&#x27;t have one in mind, i have hidden all the examples behind a drop-down menu, so you can try to apply the ideas on your own before seeing how i use them.&lt;&#x2F;p&gt;
&lt;p&gt;the investigation i did in this blog post was based off &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;neovim&#x2F;neovim&#x2F;tree&#x2F;57d99a515f57454370b6c122545ea53685d22d1b&quot;&gt;neovim commit 57d99a5&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;button id=expandAll&gt;Click here to open all notes.&lt;&#x2F;button&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;where-to-start&quot;&gt;where to start&lt;a class=&quot;zola-anchor&quot; href=&quot;#where-to-start&quot; aria-label=&quot;Anchor link for: where-to-start&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;to start off, you need an idea of what change you want to make to the program. almost always, programs are too large for you to get an idea of the whole program at once. instead, you need to focus on theory-building for the parts you care about, and only understand the rest of the program to the extent that the parts you care about interact with it.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;div class=note-content&gt;
&lt;p&gt;in my neovim PR, i cared about the &lt;a href=&quot;https:&#x2F;&#x2F;neovim.io&#x2F;doc&#x2F;user&#x2F;windows.html#%3Adrop&quot;&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; command, which opens a file if it isn&#x27;t loaded, or switches to the relevant buffer if it is. specifically i wanted to extend the &quot;switch to the relevant buffer&quot; part to also respect &lt;a href=&quot;https:&#x2F;&#x2F;neovim.io&#x2F;doc&#x2F;user&#x2F;editing.html#%2Bcmd&quot;&gt;&lt;code&gt;+cmd&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, so that i could pass it a line number.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;finding-the-parts-you-care-about&quot;&gt;finding the parts you care about&lt;a class=&quot;zola-anchor&quot; href=&quot;#finding-the-parts-you-care-about&quot; aria-label=&quot;Anchor link for: finding-the-parts-you-care-about&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;there are several ways to get started here. the simplest is just finding the relevant part of the code or docs—if you can provoke an error that&#x27;s related to the part of the code you&#x27;re changing, you can search for that error directly. often, knowing &lt;em&gt;how&lt;&#x2F;em&gt; execution reaches that state is very helpful, which you can do by getting a backtrace. you can get backtraces for output from arbitrary programs with &lt;a href=&quot;https:&#x2F;&#x2F;jade.fyi&#x2F;blog&#x2F;debugging-rr-children&#x2F;&quot;&gt;liberal use of rr&lt;&#x2F;a&gt;, but if you&#x27;re debugging rustc specifically, there&#x27;s actually a built-in flag for this, so you can just use &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;compiler-debugging.html#getting-a-backtrace-for-errors&quot;&gt;&lt;code&gt;rustc file.rs -Z treat-err-as-bug&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;details class=note-content&gt;&lt;summary&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;summary&gt;
&lt;p&gt;for &lt;code&gt;:drop&lt;&#x2F;code&gt;, this didn&#x27;t work: it was documented on &lt;a href=&quot;https:&#x2F;&#x2F;neovim.io&#x2F;doc&#x2F;user&#x2F;windows.html#%3Adrop&quot;&gt;neovim&#x27;s site&lt;&#x2F;a&gt;, but i didn&#x27;t know a &lt;code&gt;:drop&lt;&#x2F;code&gt;-specific error to search for.&lt;&#x2F;p&gt;
&lt;&#x2F;details&gt;&lt;&#x2F;aside&gt;
&lt;p&gt;if this doesn&#x27;t print an error message, or if it&#x27;s not possible to get a recording of the program, things are harder. you want to look for something you already know the name of; search for literal strings with that name, or substrings that might form part of a template.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;details class=note-content&gt;&lt;summary&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;summary&gt;
&lt;p&gt;for &lt;code&gt;:drop&lt;&#x2F;code&gt; i searched for the literal string &lt;code&gt;&quot;drop&quot;&lt;&#x2F;code&gt;, since &lt;em&gt;something&lt;&#x2F;em&gt; needs to parse commands and it&#x27;s not super common for it to be on its own in a string. that pulled up the following hits:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ rg &amp;#39;&amp;quot;drop&amp;quot;&amp;#39; src
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;nvim&#x2F;ex_docmd.c:4196:  } else if (STRICMP(p, &amp;quot;drop&amp;quot;) == 0) {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;nvim&#x2F;ex_docmd.c:4213:    &amp;quot;drop&amp;quot;,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;nvim&#x2F;ex_docmd.c:4302:    &#x2F;&#x2F; &amp;quot;drop&amp;quot;.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;src&#x2F;nvim&#x2F;eval.c:7146:    len += 7 + 4;  &#x2F;&#x2F; &amp;quot; ++bad=&amp;quot; + &amp;quot;keep&amp;quot; or &amp;quot;drop&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;ex_docmd.c&lt;&#x2F;code&gt; looked promising, so i read the code around there.&lt;&#x2F;p&gt;
&lt;&#x2F;details&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;reading-source-code&quot;&gt;reading source code&lt;a class=&quot;zola-anchor&quot; href=&quot;#reading-source-code&quot; aria-label=&quot;Anchor link for: reading-source-code&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;sometimes triggering the condition is hard, so instead i read the source code to reverse-engineer the stack trace. seeing all possible call sites of a function is instructive in itself, and you can usually narrow it down to only a few callers by skimming what the callers are doing. i highly recommend using an LSP for this part since the advantage comes from seeing &lt;em&gt;all&lt;&#x2F;em&gt; possible callers, not just most, and regex is less reliable than proper name resolution.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;details class=note-content&gt;&lt;summary&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;summary&gt;
&lt;p&gt;it turned out that none of the code i found in my search was for &lt;code&gt;:drop&lt;&#x2F;code&gt; itself, but i did find it was in a function named &lt;code&gt;get_bad_opt&lt;&#x2F;code&gt;. &lt;code&gt;get_bad_opt&lt;&#x2F;code&gt; had only one caller, &lt;code&gt;getargopt&lt;&#x2F;code&gt;. that was called by &lt;code&gt;do_one_cmd&lt;&#x2F;code&gt;. the doc-comment on &lt;code&gt;do_one_cmd&lt;&#x2F;code&gt; mentions that it parses the string, but i am not used to having documentation so i went up one level too far to &lt;code&gt;do_cmdline&lt;&#x2F;code&gt;. at that point, looking at the call site of &lt;code&gt;do_one_cmd&lt;&#x2F;code&gt;, i realized i had gone too far because it was passing in the whole string of the Ex command line. i found a more relevant part of the code by looking at the uses of &lt;code&gt;cmdlinep&lt;&#x2F;code&gt; in &lt;code&gt;do_one_cmd&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;      &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;cmdname &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; after_modifier &lt;span class=&quot;z-keyword z-operator z-ternary z-c&quot;&gt;?&lt;&#x2F;span&gt; after_modifier &lt;span class=&quot;z-keyword z-operator z-ternary z-c&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;cmdlinep&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;i got lucky - this was not actually the code i cared about, but the bit i did care about had a similar name, so i found it by searching for &lt;code&gt;cmdname&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;  &lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; 6. Parse arguments.  Then check for errors.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;  &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;IS_USER_CMDIDX&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;ea&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmdidx&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    ea&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;argt&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; cmdnames&lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;ea&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmdidx&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmd_argt&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;from there i went to the definition of &lt;code&gt;cmdnames&lt;&#x2F;code&gt; (in &lt;code&gt;build&#x2F;src&#x2F;nvim&#x2F;auto&#x2F;ex_cmds_defs.generated.h&lt;&#x2F;code&gt;) and found &lt;code&gt;&quot;drop&quot;&lt;&#x2F;code&gt; in that file:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;  &lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;CMD_drop&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmd_name&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;drop&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmd_func&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;ex_func_T&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;ex_drop&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmd_preview_func&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;NULL&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmd_argt&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;147854&lt;span class=&quot;z-storage z-type z-numeric z-c&quot;&gt;L&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;cmd_addr_type&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; ADDR_NONE
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and from there found that the function i cared about was called &lt;code&gt;ex_drop&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;if i had been a little more careful, i could have found &lt;code&gt;CMD_drop&lt;&#x2F;code&gt; sooner with &lt;code&gt;rg -ul &#x27;&quot;drop&quot;&#x27;&lt;&#x2F;code&gt; (this time without filtering out hidden files or limiting to the source directory). but this way worked fine as well.&lt;&#x2F;p&gt;
&lt;&#x2F;details&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;verifying-your-understanding&quot;&gt;verifying your understanding&lt;a class=&quot;zola-anchor&quot; href=&quot;#verifying-your-understanding&quot; aria-label=&quot;Anchor link for: verifying-your-understanding&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;do mini experiments: if you see an error emitted in nearby code, try to trigger it so that you verify you&#x27;re looking in the right place. when debugging, i often use process of elimination to narrow down callers: if an error would have been emitted if a certain code path was taken, or if there would have been more or less logging, i can be sure that code i am looking at was not run.&lt;&#x2F;p&gt;
&lt;p&gt;the simplest experiment is just &lt;code&gt;exit(1)&lt;&#x2F;code&gt;; it&#x27;s easy to notice and doesn&#x27;t change the state of the program, and it can&#x27;t fail. other experiments could include &quot;adding custom logging&quot; or &quot;change the behavior of the function&quot;, which let you perform multiple experiments at once and understand how the function impacts its callers.&lt;&#x2F;p&gt;
&lt;p&gt;for more complicated code, i like to use a debugger, which lets you see much more of the state at once. if possible, in-editor debuggers are really nice—vscode, and &lt;a href=&quot;https:&#x2F;&#x2F;zed.dev&#x2F;debugger&quot;&gt;since recently, zed&lt;&#x2F;a&gt;, have one built-in; for nvim i use &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rcarriga&#x2F;nvim-dap-ui&quot;&gt;nvim-dap-ui&lt;&#x2F;a&gt;. you can also just use a debugger in a terminal. some experiments i like to try:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;breaking at a function to make sure it is executed&lt;&#x2F;li&gt;
&lt;li&gt;printing local variables&lt;&#x2F;li&gt;
&lt;li&gt;setting hardware watchpoints on memory to see where something is modified (this especially shines &lt;a href=&quot;https:&#x2F;&#x2F;rr-project.org&#x2F;#:~:text=more%20powerful%20is%20reverse%20execution&quot;&gt;in combination with a time-travel debugger&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;aside role=note class=note-container&gt;&lt;details class=note-content&gt;&lt;summary&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;summary&gt;
&lt;p&gt;for &lt;code&gt;:drop&lt;&#x2F;code&gt;, i was quite confident i had found the right code, so i didn&#x27;t bother with any experiments. there are other cases where it&#x27;s more useful; i made an earlier &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tmux&#x2F;tmux&#x2F;pull&#x2F;4399&quot;&gt;PR to tmux&lt;&#x2F;a&gt; where there were many different places search happened, so verifying i was looking at the right one was very helpful. specifically i added &lt;code&gt;exit(1)&lt;&#x2F;code&gt; to the function i thought was the right place, since debug logging in tmux is non-trivial to access.&lt;&#x2F;p&gt;
&lt;p&gt;i rarely use a debugger for adding new code; mostly i use it for debugging existing code. programs complicated enough that i need a debugger just to understand control flow usually have a client&#x2F;server model that also makes them harder to debug, so i don&#x27;t bother and just read the source code.&lt;&#x2F;p&gt;
&lt;&#x2F;details&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;writing-new-code&quot;&gt;writing new code&lt;a class=&quot;zola-anchor&quot; href=&quot;#writing-new-code&quot; aria-label=&quot;Anchor link for: writing-new-code&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;reading source code is also useful for finding examples of how to use an API. often it handles edge cases you wouldn&#x27;t know about by skimming, and uses helper functions that make your life simpler. your goal is to make your change as similar to the existing codebase as possible, both to reduce the risk of bugs and to increase the chance the maintainer likes your change.&lt;&#x2F;p&gt;
&lt;p&gt;when i write new code, i will usually copy a small snippet from elsewhere in the codebase and modify it to my needs. i try to copy at most 10-15 lines; more than that indicates that i should try to reuse or create a higher-level API.&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;details class=note-content&gt;&lt;summary&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;summary&gt;
&lt;p&gt;once in &lt;code&gt;ex_drop&lt;&#x2F;code&gt;, i skimmed the code and found a snippet looked like it was handling existing files:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;FOR_ALL_TAB_WINDOWS&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;tp&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; wp&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;wp&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;w_buffer &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;==&lt;&#x2F;span&gt; buf&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;goto_tabpage_win&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;tp&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; wp&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      curwin&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;w_arg_idx &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;bufIsChanged&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;curbuf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        &lt;span class=&quot;z-storage z-modifier z-c&quot;&gt;const&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; save_ar &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; curbuf&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;b_p_ar&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        &lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; reload the file if it is newer
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        curbuf&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;b_p_ar &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;true&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;buf_check_timestamp&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;curbuf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        curbuf&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;b_p_ar &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; save_ar&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;curbuf&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;b_ml&lt;span class=&quot;z-punctuation z-accessor z-c&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-member z-c&quot;&gt;ml_flags&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;&amp;amp;&lt;&#x2F;span&gt; ML_EMPTY&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;ex_rewind&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;eap&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-keyword z-control z-flow z-return z-c&quot;&gt;return&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;the bug here is not any code that is present; instead it&#x27;s code that&#x27;s missing. i had to figure out where &lt;code&gt;+cmd&lt;&#x2F;code&gt; was stored and how to process it.
so, i repeated a similar process for &lt;code&gt;+cmd&lt;&#x2F;code&gt;. this time i had something more to start with - i knew the command structure was named &lt;code&gt;eap&lt;&#x2F;code&gt; and had type &lt;code&gt;exarg_t&lt;&#x2F;code&gt;.
looking at the definition of &lt;code&gt;struct exarg&lt;&#x2F;code&gt; showed me what i wanted:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;char&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;do_ecmd_cmd&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;            &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&#x2F;&#x2F;&#x2F;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&lt;&#x2F;span&gt; +command arg to be used in edited file&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;looking for &lt;code&gt;do_ecmd_cmd&lt;&#x2F;code&gt;, i found &lt;code&gt;do_exbuffer&lt;&#x2F;code&gt; (with a helpful comment saying it was responsible for &lt;code&gt;:buffer&lt;&#x2F;code&gt;) which called &lt;code&gt;do_cmdline_cmd&lt;&#x2F;code&gt;, and in turn &lt;code&gt;do_cmdline&lt;&#x2F;code&gt;.
looking at the callers of &lt;code&gt;do_cmdline&lt;&#x2F;code&gt; i found &lt;code&gt;do_ecmd&lt;&#x2F;code&gt;, which handles &lt;code&gt;:edit&lt;&#x2F;code&gt;. &lt;code&gt;:edit&lt;&#x2F;code&gt; has exactly the behavior i wanted for &lt;code&gt;:drop&lt;&#x2F;code&gt;, so i copied its behavior:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;do_cmdline&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;command&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;NULL&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;NULL&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; DOCMD_VERBOSE&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;out of caution, i also looked at the other places in the function that handled &lt;code&gt;command&lt;&#x2F;code&gt;, and it&#x27;s a good thing i did, because i found this wild snippet above:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;  &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;command &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;!=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;NULL&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;||&lt;&#x2F;span&gt; newlnum &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;      &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;&amp;amp;&amp;amp;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;get_vim_var_str&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;VV_SWAPCOMMAND&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;==&lt;&#x2F;span&gt; NUL&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Set v:swapcommand for the SwapExists autocommands.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-c&quot;&gt;const&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-sys-types z-c&quot;&gt;size_t&lt;&#x2F;span&gt; len &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;command &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;!=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;NULL&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-ternary z-c&quot;&gt;?&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-support z-function z-C99 z-c&quot;&gt;strlen&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;command&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;3&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-ternary z-c&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;30&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-c&quot;&gt;const&lt;&#x2F;span&gt; p &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;xmalloc&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;command &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;!=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;NULL&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;vim_snprintf&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;p&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; len&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;:&lt;span class=&quot;z-constant z-other z-placeholder z-c&quot;&gt;%s&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-c&quot;&gt;\r&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; command&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-c&quot;&gt;else&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;      &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;vim_snprintf&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;p&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; len&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;%&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; PRId64 &lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;G&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-type z-stdint z-c&quot;&gt;int64_t&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;newlnum&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;set_vim_var_string&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;VV_SWAPCOMMAND&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; p&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    did_set_swapcommand &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-c&quot;&gt;true&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-variable z-function z-c&quot;&gt;xfree&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;i refactored this into a helper function and then called it from both the original &lt;code&gt;:edit&lt;&#x2F;code&gt; command and my new code in &lt;code&gt;:drop&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;details&gt;&lt;&#x2F;aside&gt;
&lt;h3 id=&quot;testing-new-code&quot;&gt;testing new code&lt;a class=&quot;zola-anchor&quot; href=&quot;#testing-new-code&quot; aria-label=&quot;Anchor link for: testing-new-code&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;this works in much the same way. try to find existing tests by using &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;theory-building-without-a-mentor&#x2F;#finding-the-parts-you-care-about&quot;&gt;the same techniques as finding the code you care about&lt;&#x2F;a&gt;. read them; write them using existing examples. tests are also code, after all.&lt;&#x2F;p&gt;
&lt;p&gt;test suites usually have better documentation than the code itself, since adding new tests is much more common than modifying any particular section of code; see if you can find the docs. i look for &lt;code&gt;CONTRIBUTING.md&lt;&#x2F;code&gt; files, and if i don&#x27;t find them i fall back to skimming the readme. sometimes there are is also a &lt;code&gt;README.md&lt;&#x2F;code&gt; in the folder where the tests are located, although these tend to be somewhat out of date.&lt;&#x2F;p&gt;
&lt;p&gt;i care a lot about iteration times, so i try and find how to run individual tests. that info is usually in the README, or sometime you can figure it out from the test command&#x27;s &lt;code&gt;--help&lt;&#x2F;code&gt; output.&lt;&#x2F;p&gt;
&lt;p&gt;run your tests! ideally, create and run your tests &lt;em&gt;before&lt;&#x2F;em&gt; modifying the code so that you can see that they start to pass after your change. tests are extra important when you don&#x27;t already understand the code, because they help you verify that your new theory is correct. run existing tests as well; run those before you make changes so you know which failures are spurious (a surprisingly high number of codebases have flaky or environment-dependent tests).&lt;&#x2F;p&gt;
&lt;aside role=note class=note-container&gt;&lt;details class=note-content&gt;&lt;summary&gt;&lt;code&gt;:drop&lt;&#x2F;code&gt;&lt;&#x2F;summary&gt;
&lt;p&gt;i started by looking for existing tests for &lt;code&gt;:drop&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; rg :drop test&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;test&#x2F;functional&#x2F;ex_cmds&#x2F;drop_spec.lua:8:describe&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;(&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;:drop&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, function(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;test&#x2F;functional&#x2F;ex_cmds&#x2F;drop_spec.lua:75:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;      :drop Xdrop_modified.txt&lt;&#x2F;span&gt;           &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;test&#x2F;old&#x2F;testdir&#x2F;test_winfixbuf.vim:1094:&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt; Fail :drop but :drop! is allowed
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;test&#x2F;old&#x2F;testdir&#x2F;test_excmd.vim:92:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; Test for the :drop command&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;test&#x2F;old&#x2F;testdir&#x2F;test_excmd.vim:775:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;  call term_sendkeys(buf, &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;:drop Xdrop_modified.txt\&amp;lt;CR&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;fortunately this had results right away and i was able to start adding my new test. &lt;code&gt;CONTRIBUTING.md&lt;&#x2F;code&gt; had a pointer to &lt;code&gt;test&#x2F;README.md&lt;&#x2F;code&gt; which documented &lt;code&gt;TEST_FILE&lt;&#x2F;code&gt; and &lt;code&gt;mak functionaltest&lt;&#x2F;code&gt;. neovim has very good internal tooling and when my &lt;code&gt;screen:expect()&lt;&#x2F;code&gt; call failed it gave me a very helpful pointer to &lt;code&gt;screen:snapshot_util&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;details&gt;&lt;&#x2F;aside&gt;
&lt;h2 id=&quot;what-have-we-learned&quot;&gt;what have we learned?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-have-we-learned&quot; aria-label=&quot;Anchor link for: what-have-we-learned&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;onlurking&#x2F;fc5c81d18cfce9ff81bc968a7f342fb1&quot;&gt;programming is theory building&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;recovering a theory from code and docs alone is hard, but possible.&lt;&#x2F;li&gt;
&lt;li&gt;most programs are too large for you to understand them all at once. decide on your goal and learn just enough to accomplish it.&lt;&#x2F;li&gt;
&lt;li&gt;reading source code is surprisingly rewarding.&lt;&#x2F;li&gt;
&lt;li&gt;match the existing code as closely as you can until you are sure you have a working theory.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;hopefully this was helpful! i am told by my friends that i am unusually good at this skill, so i am interested whether this post was effective at teaching it. if you have any questions, or if you just want to get in contact, feel free to reach out &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;via email&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;!--say you want to change the output (e.g. you are adding a new field to JSON emitted by the program). i like to start by breaking it down along interface boundaries: finding the code that creates the JSON, then breaking it down into smaller and smaller pieces, ideally to a single function. if there are multiple possible places that could have emitted it, see if you can determine which of them are reachable from your input. you can usually get an idea of which parts of the program are reachable statically just by reading the source code, even if you have no trace and aren&#x27;t able to replicate locally.--&gt;
</content>
    </entry><entry xml:lang="en">
        <title>technical debt is different from technical risk</title>
        <published>2025-05-23T00:00:00+00:00</published>
        <updated>2025-05-23T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/technical-debt-is-different-from-technical-risk/"/>
        <id>https://jyn.dev/technical-debt-is-different-from-technical-risk/</id>
        
        <summary type="html">&quot;technical debt&quot; is about updating your understanding of the program over time. &quot;technical risk&quot; is about sacrificing your ability to make changes for speed of development in the short term.</summary>
        
        <content type="html" xml:base="https://jyn.dev/technical-debt-is-different-from-technical-risk/">&lt;h2 id=&quot;technical-debt-is-commonly-misunderstood&quot;&gt;technical debt is commonly misunderstood&lt;a class=&quot;zola-anchor&quot; href=&quot;#technical-debt-is-commonly-misunderstood&quot; aria-label=&quot;Anchor link for: technical-debt-is-commonly-misunderstood&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;the phrase &quot;technical debt&quot; at this point is very common in programming circles. however, i think the way this phrase is commonly used is misleading and in some cases actively harmful. here is a statement of the common usage by &lt;a href=&quot;https:&#x2F;&#x2F;mastodon.pub.solar&#x2F;@mezza&#x2F;114219114805175449&quot;&gt;a random commenter on my fediverse posts&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;tech debt is [...] debt in the literal sense that you took a shortcut to get to your product state. You&#x27;ve saved time by moving quick, and are now paying interest by development slowing down.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;contrast this to the original statement of technical debt in &lt;a href=&quot;https:&#x2F;&#x2F;c2.com&#x2F;doc&#x2F;oopsla92.html&quot;&gt;Ward Cunningham&#x27;s paper from 1992&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Shipping first time code is like going into debt. A little debt speeds development so long as it is paid back promptly with a rewrite. [...] The danger occurs when the debt is not repaid. Every minute spent on not-quite-right code counts as interest on that debt. Entire engineering organizations can be brought to a stand-still under the debt load of an unconsolidated implementation.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Ward isn&#x27;t comparing &quot;shortcuts&quot; or &quot;move fast and break things&quot; to &quot;good code&quot;—he&#x27;s comparing iterative design (often called &quot;agile&quot;) to the waterfall method &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-smalltalk-1&quot;&gt;&lt;a href=&quot;#fn-smalltalk&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;The traditional waterfall development cycle has endeavored to avoid programming catastrophy by working out a program in detail before programming begins. [...] However, using our debt analogy, we recognize this amounts to preserving the concept of payment up-front and in-full.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Finally, I want to quote a &lt;a href=&quot;https:&#x2F;&#x2F;wiki.c2.com&#x2F;?WardExplainsDebtMetaphor&quot;&gt;follow-up statement from Ward&lt;&#x2F;a&gt; in 2006, which is closely related to &lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;onlurking&#x2F;fc5c81d18cfce9ff81bc968a7f342fb1&quot;&gt;Programming As Theory Building&lt;&#x2F;a&gt; by Peter Naur:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;A lot of bloggers at least have explained the debt metaphor and confused it, I think, with the idea that you could write code poorly with the intention of doing a good job later and thinking that that was the primary source of debt. I&#x27;m never in favor of writing code poorly, but I am in favor of writing code to reflect your current understanding of a problem even if that understanding is partial.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;It seems pretty clear at this point that Ward is describing something different from the common usage (I think &quot;technical debt&quot; is a good term for Ward&#x27;s original idea). What then can we call the common usage? I like &lt;em&gt;technical risk&lt;&#x2F;em&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;technical-risk-means-a-program-is-hard-to-modify&quot;&gt;technical risk means a program is hard to modify&lt;a class=&quot;zola-anchor&quot; href=&quot;#technical-risk-means-a-program-is-hard-to-modify&quot; aria-label=&quot;Anchor link for: technical-risk-means-a-program-is-hard-to-modify&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Whenever you modify a program&#x27;s behavior, you incur a risk that you introduce a bug. Over time, as the code is used more, the number of bugs tends to decrease as you fix them. &lt;a href=&quot;https:&#x2F;&#x2F;security.googleblog.com&#x2F;2024&#x2F;09&#x2F;eliminating-memory-safety-vulnerabilities-Android.html#:~:text=the%20math&quot;&gt;Two studies in 2021 and 2022&lt;&#x2F;a&gt; (one by the Android security team, one by Usenix security) found empirically that memory vulnerabilities decay &lt;em&gt;exponentially&lt;&#x2F;em&gt; over time. So you have an inherent tension between minimizing your changes so that your code gets less buggy over time and modifying your code so that your program becomes more useful.&lt;&#x2F;p&gt;
&lt;p&gt;When people talk about &quot;technical debt&quot;, what I am calling &quot;technical risk&quot;, they mean &quot;modifying the code has a very high risk&quot;—any kind of modification has a high chance of introducing bugs, not only when adding new features but also when doing refactors and bug fixes. Even the most trivial changes become painful and time-consuming, and the right tail of your time distribution increases dramatically.&lt;&#x2F;p&gt;
&lt;p&gt;Furthermore, when we say &quot;this program has a lot of tech debt&quot;, we are implicitly arguing &quot;the risk of a refactor is lower than the risk of it eventually breaking when we make &lt;em&gt;some other change&lt;&#x2F;em&gt;&quot;. We are &lt;em&gt;gambling&lt;&#x2F;em&gt; that the risk of a refactor (either in time or breakage) is worth the decreased risk going forward.&lt;&#x2F;p&gt;
&lt;p&gt;Note that you cannot overcome technical risk simply by spending more time; in this way it is unlike technical debt. With sufficient technical risk, simply predicting how long a change will take becomes hard. Due to the risk of regressions you must spend more time testing; but because of the complexity of the program, creating tests is also time-consuming, and it is less likely that you can test exhaustively, so there is a higher risk that your tests don&#x27;t catch all regressions. Eventually changing the program without regressions becomes nearly impossible, and people fork or reimplement the program from scratch (what Ward describes as &quot;the interest is total&quot;).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;all-programs-have-risk&quot;&gt;all programs have risk&lt;a class=&quot;zola-anchor&quot; href=&quot;#all-programs-have-risk&quot; aria-label=&quot;Anchor link for: all-programs-have-risk&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The common understanding of &quot;tech debt&quot; is that it only applies to programs that were built hastily or without planning. &quot;tech risk&quot; is much more broad than that, though.
It also applies to old programs which no longer have anyone that &lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;onlurking&#x2F;fc5c81d18cfce9ff81bc968a7f342fb1&quot;&gt;understands their theory&lt;&#x2F;a&gt;; new code if it&#x27;s sufficiently complicated (stateful, non-local, &quot;just a complicated algorithm&quot;, etc); and large programs that are too big for any one person to understand in full.
In fact, most code has some amount of risk, simply because it isn&#x27;t usually worth making readability the number 1 priority (and readability differs from programmer to programmer).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bad-code-misses-the-point&quot;&gt;&quot;bad code&quot; misses the point&lt;a class=&quot;zola-anchor&quot; href=&quot;#bad-code-misses-the-point&quot; aria-label=&quot;Anchor link for: bad-code-misses-the-point&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Hillel Wayne recently wrote a post titled &lt;a href=&quot;https:&#x2F;&#x2F;buttondown.com&#x2F;hillelwayne&#x2F;archive&#x2F;write-the-most-clever-code-you-possibly-can&#x2F;&quot;&gt;Write the most clever code you possibly can&lt;&#x2F;a&gt;. At one point he says this:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;I&#x27;ve also talked to people who think that datatypes besides lists and hashmaps are too clever to use, that most optimizations are too clever to bother with, and even that functions and classes are too clever and code should be a linear script.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;This is an extreme example, but it reflects a pattern I often see: people think any code that uses complicated features is &quot;too clever&quot; and therefore bad.
This comes up a lot for &quot;weird&quot; syscalls or libc functions, like &lt;code&gt;setjmp&lt;&#x2F;code&gt;&#x2F;&lt;code&gt;longjmp&lt;&#x2F;code&gt; and &lt;code&gt;fork&lt;&#x2F;code&gt;.
I think this misses the point. What makes something technical risk is the &lt;em&gt;risk&lt;&#x2F;em&gt;, the inertia when you try to modify it, the likelihood of bugs.
Having a steep learning curve is not the same as being hard to modify, because once you learn it once, future changes become easier.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;feature-flags-are-the-taste-of-the-lotus&quot;&gt;feature flags are the taste of the lotus&lt;a class=&quot;zola-anchor&quot; href=&quot;#feature-flags-are-the-taste-of-the-lotus&quot; aria-label=&quot;Anchor link for: feature-flags-are-the-taste-of-the-lotus&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Once your risk is high enough, and if you don&#x27;t have the option of reducing complexity, people tend to work around the risk with feature flags or configuration options. These flags avoid the new behavior altogether in the default case, such that &quot;changing the program&quot; is decoupled from &quot;changing the behavior&quot;.&lt;&#x2F;p&gt;
&lt;p&gt;In my experience this can be good in moderation—but if every new change requires a feature flag, and you never go back and remove old flags, then you&#x27;re in trouble, because the flags themselves are adding complexity and risk. Each new change has to consider not just the default case, but all possible combinations of flags in a combinatorial explosion. You see this with things like tmux, OracleDB, and vim, all of which tend to accumulate options without removing them. Consider &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=18442941&quot;&gt;this quote&lt;&#x2F;a&gt; from someone who claimed to work at Oracle:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Sometimes one needs to understand the values and the effects of 20 different flag to predict how the code would behave in different situations. Sometimes 100s too! I am not exaggerating. The only reason why this product is still surviving and still works is due to literally millions of tests!&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;This is an extreme case, but in my experience it is absolutely representative of what happens to sufficiently large codebases over time. Once things are this bad you are &quot;locked in&quot; to the feature flag model—there&#x27;s too many to remove (and your users may be depending on them!), but you cannot understand the interactions of all their combinations, so you gate new changes behind more new flags just to be sure.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-to-do-about-risk&quot;&gt;what to do about risk?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-to-do-about-risk&quot; aria-label=&quot;Anchor link for: what-to-do-about-risk&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;this post is kinda scary! it tells a story of codebases that grow more and more bogged down over time, despite people&#x27;s best efforts, until they eventually die because they can&#x27;t be modified.&lt;&#x2F;p&gt;
&lt;p&gt;i think things are not actually so dire as they seem. firstly, you always have the option to do ongoing refactors, reducing the risk of changes. with ongoing maintenance like this, even extremely complex programs can be maintained for years or decades; i think &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;about-this-guide.html#constant-change&quot;&gt;the rust compiler&lt;&#x2F;a&gt; is a good example of such a program.&lt;&#x2F;p&gt;
&lt;p&gt;secondly, rebuilding systems is good, actually, because it lets us learn from the lessons of the past. oracledb, tmux, and vim all have younger competitors (e.g. sqlite, zellij, and helix) that are more nimble. even more than that, new systems have the opportunity to be built on a different paradigm (e.g. sqlite runs in-process instead of as a daemon) with different tradeoffs. this is the classic case of &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Disruptive_innovation&quot;&gt;disruptive innovation&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;to some extent, people or teams can get &quot;locked in&quot; to existing systems, especially if they are highly configurable or changing to a new system would be high risk for the organization (e.g. migrating to a new database is extremely high risk for almost anyone), but this can be mitigated by open file formats (such as &lt;a href=&quot;https:&#x2F;&#x2F;www.sqlite.org&#x2F;fileformat2.html&quot;&gt;sqlite&#x27;s database file&lt;&#x2F;a&gt;) and backwards compatibility for the old options (such as in neovim).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;in-conclusion&quot;&gt;in conclusion&lt;a class=&quot;zola-anchor&quot; href=&quot;#in-conclusion&quot; aria-label=&quot;Anchor link for: in-conclusion&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&quot;technical debt&quot; as commonly understood is different from its origins.&lt;&#x2F;li&gt;
&lt;li&gt;the original &quot;technical debt&quot; referred to iterative design.&lt;&#x2F;li&gt;
&lt;li&gt;the common meaning is about programs that are hard to change, and i refer to it as &quot;technical risk&quot;.&lt;&#x2F;li&gt;
&lt;li&gt;all programs have technical risk to greater or lesser degree; you can decrease it but never eliminate it altogether.&lt;&#x2F;li&gt;
&lt;li&gt;once risk grows sufficiently high, changes become hard enough that they have to be gated behind feature flags. the program eventually stagnates and is rewritten.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-smalltalk&quot;&gt;
&lt;p&gt;Actually, if you read the post more closely, he is saying something even more interesting: iterative development is only possible &lt;em&gt;because&lt;&#x2F;em&gt; his company is using a language (smalltalk) that has privacy boundaries. &lt;a href=&quot;#fr-smalltalk-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>sftp sandboxing</title>
        <published>2025-05-05T00:00:00+00:00</published>
        <updated>2025-05-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/sftp-sandboxing/"/>
        <id>https://jyn.dev/sftp-sandboxing/</id>
        
        <summary type="html">unix sure is a system</summary>
        
        <content type="html" xml:base="https://jyn.dev/sftp-sandboxing/">&lt;p&gt;consider the following problem:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;you want to share a 300 MB directory&lt;&#x2F;li&gt;
&lt;li&gt;with a single other person, not publicly&lt;&#x2F;li&gt;
&lt;li&gt;over a public network&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;any hosting service that lets you serve 300 MB costs money. also, for sufficient file sizes the wasted upload becomes noticeable. it would be much nicer if we could peer-to-peer this.&lt;&#x2F;p&gt;
&lt;p&gt;sftp to the rescue!&lt;&#x2F;p&gt;
&lt;p&gt;small problem: sftp shows you a &lt;em&gt;lot&lt;&#x2F;em&gt; of the system state. for one thing, you have read access to basically every file on the system, and write access to anything owned by your user. for another, the easiest way to set up sftp is through an ssh server, which is. well. it has &quot;shell&quot; in the name for a reason.&lt;&#x2F;p&gt;
&lt;p&gt;so! here is how to set up a read-only sftp server which doesn&#x27;t allow any other kind of access.&lt;&#x2F;p&gt;
&lt;p&gt;First, add the following to &lt;code&gt;&#x2F;etc&#x2F;ssh&#x2F;sshd_config&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sshd&quot; class=&quot;language-sshd z-code&quot;&gt;&lt;code class=&quot;language-sshd&quot; data-lang=&quot;sshd&quot;&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Subsystem       sftp    internal-sftp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Match User myuser
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	ChrootDirectory %h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	ForceCommand internal-sftp -R
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	DisableForwarding yes
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Then run the following commands in a root shell (e.g. with &lt;code&gt;sudo -i&lt;&#x2F;code&gt;):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;mkdir&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &#x2F;empty&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;chmod&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; a-w &#x2F;empty&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;useradd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;s&lt;&#x2F;span&gt; &#x2F;usr&#x2F;sbin&#x2F;nologin&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;m&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;skel&lt;&#x2F;span&gt; &#x2F;empty myuser&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;chown&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; root:root &#x2F;home&#x2F;myuser&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;chmod&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; a+rx &#x2F;home&#x2F;myuser&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Finally, create &lt;code&gt;&#x2F;home&#x2F;myuser&#x2F;.ssh&#x2F;authorized_keys&lt;&#x2F;code&gt; in any way you wish&lt;&#x2F;p&gt;
&lt;p&gt;This creates a sftp session that looks like this:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ ssh myuser@localhost
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;This service allows sftp connections only.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Connection to localhost closed.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ sftp myuser@localhost
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Connected to localhost.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; pwd
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Remote working directory: &#x2F;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; ls
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; ls ..
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;..&#x2F;myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; ls ..&#x2F;..&#x2F;..
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;..&#x2F;..&#x2F;..&#x2F;myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; mkdir x
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;remote mkdir &amp;quot;&#x2F;x&amp;quot;: Permission denied
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; chmod 644	myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Changing mode on &#x2F;myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;remote setstat &amp;quot;&#x2F;myfile&amp;quot;: Permission denied
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;sftp&amp;gt; get myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Fetching &#x2F;myfile to myfile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;myfile       100%   46MB 899.5MB&#x2F;s   00:00
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;Some explanations and references:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;cgi-bin&#x2F;man.cgi&#x2F;OpenBSD-current&#x2F;man5&#x2F;sshd_config.5#Subsystem&quot;&gt;&lt;code&gt;Subsystem&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; is documented as follows:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Configures an external subsystem (e.g. file transfer daemon). [...] the name &lt;code&gt;internal-sftp&lt;&#x2F;code&gt; implements an in-process SFTP server. [...] It accepts the same command line arguments as &lt;code&gt;sftp-server&lt;&#x2F;code&gt; [...]&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;what arguments can we pass to &lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;sftp-server#R&quot;&gt;&lt;code&gt;sftp-server&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;?&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;-R&lt;&#x2F;code&gt;	Places this instance of &lt;code&gt;sftp-server&lt;&#x2F;code&gt; into a read-only mode. Attempts to open files for writing, as well as other operations that change the state of the filesystem, will be denied.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;just what we want!&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;cgi-bin&#x2F;man.cgi&#x2F;OpenBSD-current&#x2F;man5&#x2F;sshd_config.5#ForceCommand&quot;&gt;&lt;code&gt;ForceCommand internal-sftp&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; is a cute little feature of openssh:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Specifying a command of &lt;code&gt;internal-sftp&lt;&#x2F;code&gt; will force the use of an in-process SFTP server that requires no support files when used with &lt;code&gt;ChrootDirectory&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;In particular, this denies shell and command access.&lt;&#x2F;p&gt;
&lt;p&gt;What is &lt;code&gt;ChrootDirectory&lt;&#x2F;code&gt;?&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Specifies the pathname of a directory to &lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;chroot.2&quot;&gt;chroot(2)&lt;&#x2F;a&gt; to after authentication. At session startup &lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;sshd.8&quot;&gt;sshd(8)&lt;&#x2F;a&gt; checks that all components of the pathname are root-owned directories which are not writable by group or others. After the chroot, &lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;sshd.8&quot;&gt;sshd(8)&lt;&#x2F;a&gt; changes the working directory to the user&#x27;s home directory. [...] For file transfer sessions using SFTP no additional configuration of the environment is necessary if the in-process sftp-server is used [...]&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;cute! an easy way to deny even reading other parts of the rest of the system.&lt;&#x2F;p&gt;
&lt;p&gt;why does it require the path to be owned by root? &lt;a href=&quot;https:&#x2F;&#x2F;lists.mindrot.org&#x2F;pipermail&#x2F;openssh-unix-dev&#x2F;2009-May&#x2F;027651.html&quot;&gt;https:&#x2F;&#x2F;lists.mindrot.org&#x2F;pipermail&#x2F;openssh-unix-dev&#x2F;2009-May&#x2F;027651.html&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you ever let the user chroot to this directory and execute his
hard-linked &#x2F;bin&#x2F;su, he can become root within that directory and then
escape the chroot. Even if you could prevent him from escaping chroot,
he can create device nodes and operate directly on filesystems, mount
&#x2F;proc and operate on external processes, etc. It should be clear that
this is Very Bad (tm).&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;cool cool cool. love unix. this sure is a tool we use to build software.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;cgi-bin&#x2F;man.cgi&#x2F;OpenBSD-current&#x2F;man5&#x2F;sshd_config.5#Match&quot;&gt;&lt;code&gt;Match&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; is surprisingly complicated in the general case but simple enough here.
&lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;cgi-bin&#x2F;man.cgi&#x2F;OpenBSD-current&#x2F;man5&#x2F;sshd_config.5#DisableForwarding&quot;&gt;&lt;code&gt;DisableForwarding&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; is probably not &lt;em&gt;strictly&lt;&#x2F;em&gt; necessary but we don&#x27;t want people using this file server as a jumpbox to whatever other networks it&#x27;s connected to, nor as e.g. a tor exit node.&lt;&#x2F;p&gt;
&lt;p&gt;lastly i want to point out that &lt;code&gt;useradd&lt;&#x2F;code&gt; by default creates a user with no login password, which takes care of people guessing passwords for this without the proper ssh public key. i have &lt;code&gt;PasswordAuthentication no&lt;&#x2F;code&gt; set in &lt;code&gt;sshd_config&lt;&#x2F;code&gt;, but this allows disabling the password for just your sftp access without disabling it altogether. alternatively you could put it under the &lt;code&gt;Match User&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;&lt;strong&gt;NOTE:&lt;&#x2F;strong&gt; an earlier version of this post suggested &lt;code&gt;Subsystem sftp internal-sftp -R&lt;&#x2F;code&gt; and &lt;code&gt;ForceCommand internal-sftp&lt;&#x2F;code&gt;. that disables write access for &lt;em&gt;all&lt;&#x2F;em&gt; users, not just the selected user. the new version only disables it for the selected user.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>tools</title>
        <published>2025-05-03T00:00:00+00:00</published>
        <updated>2025-05-03T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/tools/"/>
        <id>https://jyn.dev/tools/</id>
        
        <summary type="html">tools i use or want to use</summary>
        
        <content type="html" xml:base="https://jyn.dev/tools/">&lt;p&gt;i care a lot about my tools. i have very high standards for tools along some axes, and low standards along others—but that&#x27;s the topic of a different blog post. this post is about the tools i &lt;em&gt;do&lt;&#x2F;em&gt; use, and about tools i have my eye on and may use in the future. hopefully it will be useful to other people, such as programmers, sysadmins, etc.&lt;&#x2F;p&gt;
&lt;p&gt;this is also not a description of &lt;em&gt;how&lt;&#x2F;em&gt; i use these tools, which also deserves its own blog post (i pride myself on integrating tools that were not designed to integrate with each other). this is just a list of the tools themselves.&lt;&#x2F;p&gt;
&lt;p&gt;i have a version of &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;tools&#x2F;#tools-i-have-my-eye-on&quot;&gt;tools i have my eye on&lt;&#x2F;a&gt; for myself that i keep regularly updated. i will probably not keep this public copy updated, unless i find a tool that&#x27;s sufficiently good i want to tell people about it.&lt;&#x2F;p&gt;
&lt;p&gt;i&#x27;m always on the lookout for more useful tools. if you have a tool you use regularly that&#x27;s not on this list (and not specific to a single language ecosystem), please &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;let me know&lt;&#x2F;a&gt;. the one exception is containerization software. i am interested in tools to &lt;em&gt;interact&lt;&#x2F;em&gt; with containers, but at this time i am not looking for more container hosts (podman, kubernetes, vagrant, lxc, systemd-nspawn, firejail, chroot, etc).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;tools-i-use&quot;&gt;tools i use&lt;a class=&quot;zola-anchor&quot; href=&quot;#tools-i-use&quot; aria-label=&quot;Anchor link for: tools-i-use&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;basics&quot;&gt;basics&lt;a class=&quot;zola-anchor&quot; href=&quot;#basics&quot; aria-label=&quot;Anchor link for: basics&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;you have probably seen someone else recommend these tools. it&#x27;s not just hype. they are useful.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;BurntSushi&#x2F;ripgrep&quot;&gt;ripgrep&lt;&#x2F;a&gt;: file contents searching&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;fd&quot;&gt;fd&lt;&#x2F;a&gt;: file name searching&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jqlang.org&#x2F;&quot;&gt;jq&lt;&#x2F;a&gt;: json processing. note that most data formats can be converted to json, which i recommend over &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mikefarah&#x2F;yq&quot;&gt;yq&lt;&#x2F;a&gt; or other format-specific filtering tools; the exception is XML and things isomorphic to it, which &lt;a href=&quot;https:&#x2F;&#x2F;fwslc.blogspot.com&#x2F;2014&#x2F;10&#x2F;json-m.html&quot;&gt;cannot be represented in json with fidelity&lt;&#x2F;a&gt;. i tried a rewrite, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;01mf02&#x2F;jaq&quot;&gt;jaq&lt;&#x2F;a&gt;, that promised to be faster, but it had fewer features and it turns out that i rarely care about the speed of jq.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;killall.1.html&quot;&gt;&lt;code&gt;killall&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: kill matching processes&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;1&#x2F;pkill&quot;&gt;&lt;code&gt;pkill&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: kill specific matching process&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;shell&quot;&gt;shell&lt;a class=&quot;zola-anchor&quot; href=&quot;#shell&quot; aria-label=&quot;Anchor link for: shell&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.jade.fyi&#x2F;zsh&#x2F;zsh.html#Introduction-1&quot;&gt;zsh&lt;&#x2F;a&gt;. i cannot in good conscience recommend this to anyone else; most people will be better served by &lt;a href=&quot;https:&#x2F;&#x2F;fishshell.com&#x2F;&quot;&gt;fish&lt;&#x2F;a&gt;. i just have sunk cost from learning entirely too much bash syntax in my misspent youth.&lt;&#x2F;p&gt;
&lt;p&gt;i tried &lt;a href=&quot;https:&#x2F;&#x2F;xon.sh&#x2F;&quot;&gt;xonsh&lt;&#x2F;a&gt; and was annoyed by how poorly python variables interact with regular shell variables.&lt;&#x2F;p&gt;
&lt;p&gt;i was very pleasantly surprised by &lt;a href=&quot;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;&quot;&gt;powershell&lt;&#x2F;a&gt;, which it turns out runs on linux these days. it has actual data types instead of just strings, which means you aren&#x27;t constantly doing string munging in a language not designed for it. i would probably use it interactively if i were willing to give up my sunk cost on bash syntax.&lt;&#x2F;p&gt;
&lt;p&gt;i tried &lt;a href=&quot;https:&#x2F;&#x2F;www.nushell.sh&#x2F;&quot;&gt;nushell&lt;&#x2F;a&gt;, which is like powershell but not made by microsoft and without the .NET integration. i found it extremely verbose - it&#x27;s a good scripting language but not a good interactive shell. also it breaks a bunch of bash syntax for no reason, even when the syntax is unambiguous. (much of bash&#x27;s syntax &lt;em&gt;is&lt;&#x2F;em&gt; ambiguous and i can forgive breaking that.)&lt;&#x2F;p&gt;
&lt;h3 id=&quot;editor&quot;&gt;editor&lt;a class=&quot;zola-anchor&quot; href=&quot;#editor&quot; aria-label=&quot;Anchor link for: editor&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;i use &lt;a href=&quot;https:&#x2F;&#x2F;neovim.io&#x2F;&quot;&gt;neovim&lt;&#x2F;a&gt; with a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;dotfiles&#x2F;blob&#x2F;master&#x2F;config&#x2F;nvim.lua&quot;&gt;truly absurd amount of custom configuration&lt;&#x2F;a&gt;. i cannot in good conscience recommend this to anyone else; most people will be better served by vscode and a few plugins.&lt;&#x2F;p&gt;
&lt;p&gt;i tried various other editors and was disappointed by all of them. &lt;code&gt;kakoune&lt;&#x2F;code&gt; required more configuration than i was willing to put in to just to get a &quot;basic&quot; experience. &lt;code&gt;helix&lt;&#x2F;code&gt; was extraordinarily resistant to being configured past very basic key remapping (for a while i forked it, but this didn&#x27;t scale very well for the amount of configuration i wanted). VSCode dropped keystrokes and was generally laggy, both of which got worse when i installed a vim plugin. &lt;code&gt;zed&lt;&#x2F;code&gt; had various issues with the integrated terminal and window management (although this may have changed since i tried it in mid-2024). i have not tried &lt;code&gt;emacs&lt;&#x2F;code&gt; and dread the day i do because it will probably suck up weeks of my time.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;terminal-multiplexing&quot;&gt;terminal multiplexing&lt;a class=&quot;zola-anchor&quot; href=&quot;#terminal-multiplexing&quot; aria-label=&quot;Anchor link for: terminal-multiplexing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;i use &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;tmux&#x2F;tree&#x2F;working&quot;&gt;a fork&lt;&#x2F;a&gt; of tmux with &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;dotfiles&#x2F;blob&#x2F;master&#x2F;config&#x2F;tmux.conf&quot;&gt;more absurd amounts of configuration&lt;&#x2F;a&gt;. again, i cannot in good conscience recommend this to anyone else. most people will be better served by the integrated terminal in vscode (i spent a couple weeks on trying to get back ctrl-click for filepaths alone). vscode also works on windows MSVC, unlike terminal multiplexers.&lt;&#x2F;p&gt;
&lt;p&gt;various people have recommended &lt;a href=&quot;https:&#x2F;&#x2F;zellij.dev&#x2F;&quot;&gt;zellij&lt;&#x2F;a&gt; to me. i think zellij is good if you like the default keybinds, or if you use a terminal multiplexer infrequently enough that having the basic commands on-screen is helpful for you. i found that the default keybinds interfered with a bunch of programs and didn&#x27;t look further into it.&lt;&#x2F;p&gt;
&lt;p&gt;wezterm and kitty are not really in the running because they don&#x27;t have session save&#x2F;resume.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;debugging&quot;&gt;debugging&lt;a class=&quot;zola-anchor&quot; href=&quot;#debugging&quot; aria-label=&quot;Anchor link for: debugging&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.jade.fyi&#x2F;zsh&#x2F;zsh.html#index-XTRACE&quot;&gt;&lt;code&gt;set -x&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: trace shell programs&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Environment-Variables#_debugging&quot;&gt;&lt;code&gt;GIT_TRACE&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: trace git commands&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;strace.io&#x2F;&quot;&gt;strace&lt;&#x2F;a&gt;: trace system calls. this doesn&#x27;t exist on macOS; it has a counterpart, dtruss, which &lt;a href=&quot;https:&#x2F;&#x2F;poweruser.blog&#x2F;using-dtrace-with-sip-enabled-3826a352e64b&quot;&gt;kinda sorta mostly works&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rr-project.org&#x2F;&quot;&gt;rr&lt;&#x2F;a&gt;: time travel debugging. this doesn&#x27;t exist on macOS; if you know a counterpart &lt;em&gt;please&lt;&#x2F;em&gt; &lt;a href=&quot;mailto:blog@jyn.dev&quot;&gt;let me know&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;c-c-tools&quot;&gt;C&#x2F;C++ tools&lt;a class=&quot;zola-anchor&quot; href=&quot;#c-c-tools&quot; aria-label=&quot;Anchor link for: c-c-tools&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;for cmake projects: &lt;a href=&quot;https:&#x2F;&#x2F;cmake.org&#x2F;cmake&#x2F;help&#x2F;latest&#x2F;manual&#x2F;cmake.1.html#cmdoption-cmake-G&quot;&gt;&lt;code&gt;cmake -G Ninja&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. uses &lt;a href=&quot;https:&#x2F;&#x2F;ninja-build.org&#x2F;manual.html#_comparison_to_make&quot;&gt;&lt;code&gt;ninja&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; instead of &lt;code&gt;make&lt;&#x2F;code&gt;, improving compile times and with a much nicer progress bar.&lt;&#x2F;li&gt;
&lt;li&gt;for cmake projects: &lt;a href=&quot;https:&#x2F;&#x2F;cmake.org&#x2F;cmake&#x2F;help&#x2F;latest&#x2F;variable&#x2F;CMAKE_EXPORT_COMPILE_COMMANDS.html&quot;&gt;&lt;code&gt;cmake -D CMAKE_EXPORT_COMPILE_COMMANDS=On&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. Generates a &lt;code&gt;compile_commands.json&lt;&#x2F;code&gt; file that most LSPs know how to read.&lt;&#x2F;li&gt;
&lt;li&gt;for everything else: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rizsotto&#x2F;Bear&quot;&gt;&lt;code&gt;bear&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. like above, but works for arbitrary build systems.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;rust-tools&quot;&gt;rust tools&lt;a class=&quot;zola-anchor&quot; href=&quot;#rust-tools&quot; aria-label=&quot;Anchor link for: rust-tools&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Canop&#x2F;bacon&#x2F;&quot;&gt;&lt;code&gt;bacon&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: background code checker&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;commands&#x2F;cargo-tree.html#tree-options&quot;&gt;&lt;code&gt;cargo tree -i&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: figure out why a package was built&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.crates.io&#x2F;contrib&#x2F;implementation&#x2F;debugging.html#logging&quot;&gt;&lt;code&gt;CARGO_LOG&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: trace &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;&quot;&gt;&lt;code&gt;cargo&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; commands&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;tracing.html&quot;&gt;&lt;code&gt;RUSTC_LOG&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: trace &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustc&#x2F;&quot;&gt;&lt;code&gt;rustc&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; commands&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;cargo-bisect-rustc&quot;&gt;&lt;code&gt;cargo bisect-rustc&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: figure out when a compiler regression happened&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;everything-else&quot;&gt;&quot;everything else&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#everything-else&quot; aria-label=&quot;Anchor link for: everything-else&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;watchexec&#x2F;watchexec&#x2F;&quot;&gt;&lt;code&gt;watchexec&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: bacon but generalized to arbitrary files and commands. i find this quite useful for a variety of tasks, including minimizing bugs.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aristocratos&#x2F;btop&quot;&gt;btop&lt;&#x2F;a&gt;: like top but easier to use and easier to understand the output&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;tailscale.com&#x2F;&quot;&gt;tailscale&lt;&#x2F;a&gt;: software-defined networking. i mainly use it for easy NAT punching and DDNS, but it&#x27;s much more flexible than that.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;obsidian.md&#x2F;&quot;&gt;obsidian&lt;&#x2F;a&gt;: flexible and pretty markdown editor. i use it for journaling and drafting blog posts. &lt;a href=&quot;https:&#x2F;&#x2F;obsidian.md&#x2F;sync&quot;&gt;obsidian sync&lt;&#x2F;a&gt; is not required but &quot;just works&quot; and makes it much more convenient; it&#x27;s nice to have access to the same files everywhere.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;URI&#x2F;Reference&#x2F;Fragment&#x2F;Text_fragments&quot;&gt;&lt;code&gt;#:~:text=xyz&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: link to specifically the text &quot;xyz&quot; on a web page. works in firefox since around the end of 2024, and in chrome since a lot earlier.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;tools-i-have-my-eye-on&quot;&gt;tools i have my eye on&lt;a class=&quot;zola-anchor&quot; href=&quot;#tools-i-have-my-eye-on&quot; aria-label=&quot;Anchor link for: tools-i-have-my-eye-on&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;i either use these occasionally enough i need a reference, or haven&#x27;t used them yet but want to.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;debugging-1&quot;&gt;debugging&lt;a class=&quot;zola-anchor&quot; href=&quot;#debugging-1&quot; aria-label=&quot;Anchor link for: debugging-1&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;strace.1.html#:~:text=y,decode-fds&quot;&gt;&lt;code&gt;strace -y&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: show absolute paths&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;strace.1.html#:~:text=summary-only&quot;&gt;&lt;code&gt;strace -c&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: show performance stats&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;elf-info&quot;&gt;&lt;code&gt;elf-info&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: ELF inspector&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;binsider.dev&#x2F;blog&#x2F;v020&#x2F;&quot;&gt;&lt;code&gt;binsider&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: another ELF inspector&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.racket-lang.org&#x2F;zordoz&#x2F;index.html&quot;&gt;&lt;code&gt;zordoz&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: racket decompiler&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;dnSpyEx&#x2F;dnSpy&quot;&gt;&lt;code&gt;dnSpyEx&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: .NET disassembler&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Syllo&#x2F;nvtop&quot;&gt;&lt;code&gt;nvtop&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: gpu monitoring&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;1&#x2F;xdpyinfo&quot;&gt;&lt;code&gt;xdpyinfo&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: X11 debugging&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;operating-systems&quot;&gt;operating systems&lt;a class=&quot;zola-anchor&quot; href=&quot;#operating-systems&quot; aria-label=&quot;Anchor link for: operating-systems&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;pop-os&#x2F;launcher&#x2F;blob&#x2F;master&#x2F;plugins&#x2F;src&#x2F;web&#x2F;config.ron&quot;&gt;popos launcher config&lt;&#x2F;a&gt;, since i couldn&#x27;t find docs for it (local copy in &lt;code&gt;&#x2F;usr&#x2F;lib&#x2F;pop-launcher&#x2F;plugins&#x2F;web&#x2F;config.ron&lt;&#x2F;code&gt;). this is what runs custom searches when you hit Super-R on PopOS 22.04.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;uobikiemukot&#x2F;yaft?tab=readme-ov-file&quot;&gt;yaft&lt;&#x2F;a&gt;: linux framebuffer terminal&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;kellyjonbrazil&#x2F;jc&quot;&gt;jc&lt;&#x2F;a&gt;: structured parsing for unix tools&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.fedoraproject.org&#x2F;en-US&#x2F;quick-docs&#x2F;cups-debug-scanning-issues&#x2F;&quot;&gt;CUPS debugging&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;yggdrasil-network.github.io&#x2F;about.html&quot;&gt;yggrasil-network&lt;&#x2F;a&gt;: &quot;ipv6 for everyone&quot;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;containers&quot;&gt;containers&lt;a class=&quot;zola-anchor&quot; href=&quot;#containers&quot; aria-label=&quot;Anchor link for: containers&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;containers&#x2F;bubblewrap&quot;&gt;bubblewrap&lt;&#x2F;a&gt;: flexible adhoc sandboxing&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Mic92&#x2F;cntr&quot;&gt;cntr&lt;&#x2F;a&gt;: overlayfs that works with a running container&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;development&quot;&gt;development&lt;a class=&quot;zola-anchor&quot; href=&quot;#development&quot; aria-label=&quot;Anchor link for: development&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;cargo-bounds&quot;&gt;&lt;code&gt;cargo-bounds&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: check your crate semver bounds are correct&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;victoriametrics.com&#x2F;products&#x2F;victorialogs&#x2F;&quot;&gt;VictoriaLogs&lt;&#x2F;a&gt;: structured database for logs&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;cron.help&#x2F;&quot;&gt;cron.help&lt;&#x2F;a&gt;: crontab reference&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;hurl.dev&quot;&gt;hurl.dev&lt;&#x2F;a&gt;: HTTP test assertion framework
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.racket-lang.org&#x2F;riposte&#x2F;&quot;&gt;riposte&lt;&#x2F;a&gt;: similar for &lt;a href=&quot;https:&#x2F;&#x2F;racket-lang.org&#x2F;&quot;&gt;racket&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rosie-lang.org&#x2F;&quot;&gt;rosie-lang&lt;&#x2F;a&gt;: maintainable, composable regexes. really these are PEG parsers but they are designed to look similar to regex.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;brushtechnology&#x2F;fabricate&quot;&gt;fabricate&lt;&#x2F;a&gt;: &lt;a href=&quot;https:&#x2F;&#x2F;gittup.org&#x2F;tup&#x2F;&quot;&gt;tup&lt;&#x2F;a&gt; but python&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;spoofax.dev&#x2F;&quot;&gt;spoofax&lt;&#x2F;a&gt;: dsl builder&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Ericsson&#x2F;codechecker&quot;&gt;codechecker&lt;&#x2F;a&gt;: advanced static analysis for c&#x2F;c++&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;google.github.io&#x2F;zx&#x2F;getting-started&quot;&gt;zx&lt;&#x2F;a&gt;: terse process spawning in js&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jsonnet.org&quot;&gt;jsonnet&lt;&#x2F;a&gt;: like &lt;a href=&quot;https:&#x2F;&#x2F;dhall-lang.org&#x2F;&quot;&gt;dhall&lt;&#x2F;a&gt; but lua-coded instead of haskell-coded&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;sql.datapage.app&#x2F;&quot;&gt;generate a webpage from an sql query&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;editing-and-diffing&quot;&gt;editing and diffing&lt;a class=&quot;zola-anchor&quot; href=&quot;#editing-and-diffing&quot; aria-label=&quot;Anchor link for: editing-and-diffing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;ast-grep.github.io&#x2F;&quot;&gt;ast-grep&lt;&#x2F;a&gt;. language-aware structured search and replace.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;diffoscope.org&#x2F;&quot;&gt;diffoscope&lt;&#x2F;a&gt;: recursive diffing&lt;&#x2F;li&gt;
&lt;li&gt;fix tabs and spaces: &lt;code&gt;unexpand -t 4 foo.c | sponge foo.c&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;graphics&quot;&gt;graphics&lt;a class=&quot;zola-anchor&quot; href=&quot;#graphics&quot; aria-label=&quot;Anchor link for: graphics&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;typst.app&#x2F;&quot;&gt;typst&lt;&#x2F;a&gt;: &lt;a href=&quot;https:&#x2F;&#x2F;www.latex-project.org&#x2F;&quot;&gt;latex&lt;&#x2F;a&gt; but not evil&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;excalidraw.com&#x2F;&quot;&gt;excalidraw&lt;&#x2F;a&gt;: online diagram editor&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Aloxaf&#x2F;silicon&quot;&gt;silicon&lt;&#x2F;a&gt;: pretty screenshots of source code&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;benchmarking&quot;&gt;benchmarking&lt;a class=&quot;zola-anchor&quot; href=&quot;#benchmarking&quot; aria-label=&quot;Anchor link for: benchmarking&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;andrewrk&#x2F;poop&quot;&gt;&lt;code&gt;poop&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;hyperfine&quot;&gt;hyperfine&lt;&#x2F;a&gt; but also reports memory usage&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;hyperfine#parameterized-benchmarks&quot;&gt;&lt;code&gt;hyperfine --parameter-list&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: parameterized benchmarking&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;strace.1.html#:~:text=summary-wall-clock&quot;&gt;&lt;code&gt;strace -wc&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: measure syscall timing&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;ltrace.1.html#:~:text=count%20time&quot;&gt;&lt;code&gt;ltrace -c&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: measure library call timing&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;1&#x2F;x11perf&quot;&gt;&lt;code&gt;x11perf&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: X11 performance testing&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;manpages.debian.org&#x2F;testing&#x2F;freetype2-demos&#x2F;ftbench.1.en.html&quot;&gt;&lt;code&gt;ftbench&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: font performance testing&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;ts#i&quot;&gt;&lt;code&gt;ts -i&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: show the elapsed time between each line of output in a pipe. useful with &lt;code&gt;bash -x&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.jade.fyi&#x2F;zsh&#x2F;zsh.html#The-zsh_002fzprof-Module&quot;&gt;&lt;code&gt;zmodload zsh&#x2F;zprof; zprof&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;: benchmark zsh startup&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Terrible Horrible No Good Very Bad Python</title>
        <published>2025-03-28T00:00:00+00:00</published>
        <updated>2025-03-28T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/terrible-horrible-no-good-very-bad-python/"/>
        <id>https://jyn.dev/terrible-horrible-no-good-very-bad-python/</id>
        
        <summary type="html">new and exciting ways to write buggy code</summary>
        
        <content type="html" xml:base="https://jyn.dev/terrible-horrible-no-good-very-bad-python/">&lt;p&gt;time for everyone&#x27;s favorite game!!&lt;&#x2F;p&gt;
&lt;p&gt;what does this code do?&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-python&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;foo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-function z-begin z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-statement z-exception z-try z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-exception z-try z-python&quot;&gt;try&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-exception z-try z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;os&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;_exit&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-statement z-exception z-finally z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-exception z-finally z-python&quot;&gt;finally&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-exception z-finally z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-python&quot;&gt;False&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;os&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;foo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;style type=&quot;text&#x2F;css&quot;&gt;
    ol { list-style-type: upper-alpha; }
&lt;&#x2F;style&gt;
&lt;p&gt;does it:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;return None&lt;&#x2F;li&gt;
&lt;li&gt;return False&lt;&#x2F;li&gt;
&lt;li&gt;throw an exception&lt;&#x2F;li&gt;
&lt;li&gt;exit the process without printing anything&lt;&#x2F;li&gt;
&lt;li&gt;something even more devious&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;sit with it. have a good think. explain your answers.&lt;&#x2F;p&gt;
&lt;p&gt;ready?&lt;&#x2F;p&gt;
&lt;details&gt;&lt;summary&gt;ok fine what does it do&lt;&#x2F;summary&gt;
&lt;p&gt;returns &lt;code&gt;False&lt;&#x2F;code&gt;. want to know why?&lt;&#x2F;p&gt;
&lt;details&gt;&lt;summary&gt;yes just tell me already &gt;:(&lt;&#x2F;summary&gt;
&lt;p&gt;normally, &lt;code&gt;os._exit&lt;&#x2F;code&gt; exits the process without running &quot;cleanup handlers&quot; (&lt;code&gt;finally&lt;&#x2F;code&gt; blocks). however, it takes one argument. this snippet forgets to pass in the exit code, so instead of exiting, it throws &lt;code&gt;TypeError&lt;&#x2F;code&gt;. then the &lt;code&gt;finally&lt;&#x2F;code&gt; block silently swallows the exception because of the &lt;code&gt;return&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;return&lt;&#x2F;code&gt; from a &lt;code&gt;finally&lt;&#x2F;code&gt; block is in fact so commonly misused that the python developers &lt;a href=&quot;https:&#x2F;&#x2F;discuss.python.org&#x2F;t&#x2F;pep-765-disallow-return-break-continue-that-exit-a-finally-block&#x2F;71348&quot;&gt;plan&lt;&#x2F;a&gt; to make it emit a &lt;code&gt;SyntaxWarning&lt;&#x2F;code&gt; in a future release.&lt;&#x2F;p&gt;
&lt;p&gt;one might be mislead that &lt;code&gt;import os&lt;&#x2F;code&gt; comes after the function is defined. but python has dynamic scoping, so that&#x27;s fine.&lt;&#x2F;p&gt;
&lt;p&gt;one might also mix up &lt;code&gt;sys.exit&lt;&#x2F;code&gt; with &lt;code&gt;os._exit&lt;&#x2F;code&gt;. &lt;code&gt;sys.exit&lt;&#x2F;code&gt; works by raising a &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;exceptions.html#SystemExit&quot;&gt;&lt;code&gt;SystemExit&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; exception, which would be caught and swallowed by the &lt;code&gt;finally&lt;&#x2F;code&gt; block. but &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;os.html#os._exit&quot;&gt;&lt;code&gt;_exit&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; directly exits the process:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Exit the process with status n, without calling cleanup handlers, flushing stdio buffers, etc.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;in fact, it doesn&#x27;t even call atexit handlers, not even if we directly use libc:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; import atexit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; atexit.register(lambda: print(&amp;#39;hi&amp;#39;))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;lt;function &amp;lt;lambda&amp;gt; at 0x73c740cf2830&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; from ctypes import *
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; libc = cdll.LoadLibrary(&amp;quot;libc.so.6&amp;quot;)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; libc.on_exit(CFUNCTYPE(c_int, c_voidp)(lambda status, _: print(status)))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; import os
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; os._exit(1)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;# no output
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;details&gt;
&lt;&#x2F;details&gt;
&lt;p&gt;yes someone did write this code by accident and yes they were very confused. i thought it was a bug in cpython until i figured it out.&lt;&#x2F;p&gt;
&lt;p&gt;you&#x27;re welcome!!&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Scheduling Do-Not-Disturb in GNOME</title>
        <published>2025-02-22T00:00:00+00:00</published>
        <updated>2025-02-22T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/do-not-disturb-in-gnome/"/>
        <id>https://jyn.dev/do-not-disturb-in-gnome/</id>
        
        <content type="html" xml:base="https://jyn.dev/do-not-disturb-in-gnome/">&lt;h2 id=&quot;do-not-disturb&quot;&gt;Do Not Disturb&lt;a class=&quot;zola-anchor&quot; href=&quot;#do-not-disturb&quot; aria-label=&quot;Anchor link for: do-not-disturb&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;GNOME has a little button that lets you turn on Do-Not-Disturb for notifications:&lt;&#x2F;p&gt;
&lt;img src=&quot;&amp;#x2F;assets&amp;#x2F;Pasted image 20250222135047.png&quot;
	 alt=&quot;Gnome notifications menu&quot;
	
&gt;
&lt;p&gt;Unfortunately, it has &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.gnome.org&#x2F;GNOME&#x2F;gnome-control-center&#x2F;-&#x2F;issues&#x2F;2200&quot;&gt;no way of scheduling DnD&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Good news, though! It does support turning on DnD through the CLI: &lt;code&gt;gsettings set org.gnome.desktop.notifications show-banners false&lt;&#x2F;code&gt;. I put that in a script named &lt;code&gt;toggle-dnd&lt;&#x2F;code&gt; in my dotfiles:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; cat bin&#x2F;toggle-dnd&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;!&#x2F;bin&#x2F;sh&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-case z-shell&quot;&gt;case&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;:-&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-in z-shell&quot;&gt;in&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;	&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; &amp;quot;show-banners&amp;quot; is reversed from what you would expect &amp;quot;do not disturb&amp;quot; to mean&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;	&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;true&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-patterns z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;new&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;false&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-case z-clause z-shell&quot;&gt;;;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;	&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;false&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-patterns z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;new&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;true&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-case z-clause z-shell&quot;&gt;;;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;	&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-patterns z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-conditional z-if z-shell&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-function z-test z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gsettings&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; get org.gnome.desktop.notifications show-banners&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-shell&quot;&gt;=&lt;&#x2F;span&gt; true &lt;span class=&quot;z-support z-function z-test z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;		&lt;span class=&quot;z-keyword z-control z-conditional z-then z-shell&quot;&gt;then&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;new&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;false&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;		&lt;span class=&quot;z-keyword z-control z-conditional z-else z-shell&quot;&gt;else&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;new&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;true&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-conditional z-end z-shell&quot;&gt;fi&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;	&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-case z-clause z-shell&quot;&gt;;;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-end z-shell&quot;&gt;esac&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gsettings&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; set org.gnome.desktop.notifications show-banners &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;new&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;scheduling&quot;&gt;scheduling&lt;a class=&quot;zola-anchor&quot; href=&quot;#scheduling&quot; aria-label=&quot;Anchor link for: scheduling&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I tried putting that in cron&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-1-1&quot;&gt;&lt;a href=&quot;#fn-1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, had a sneaking suspicion it wouldn&#x27;t work, set it to run every minute, and saw this very unhelpful line of logging:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;journalctl&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;unit&lt;&#x2F;span&gt; cron&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;since&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;5m ago&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Feb 22 12:00:01 pop-os CRON[1623131]: (CRON) info (No MTA installed, discarding output)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ok, fine. Let&#x27;s pipe the output to the system log&lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-2-1&quot;&gt;&lt;a href=&quot;#fn-2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, since clearly cron can&#x27;t handle that itself.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;crontab&quot; class=&quot;language-crontab z-code&quot;&gt;&lt;code class=&quot;language-crontab&quot; data-lang=&quot;crontab&quot;&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;* * * * * bash -lc &amp;#39;org.gnome.desktop.notifications show-banners false 2&amp;gt;&amp;amp;1 | logger -t toggle-dnd&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;That at least shows more useful output.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;journalctl&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;t&lt;&#x2F;span&gt; toggle-dnd&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Feb 22 05:59:01 pop-os toggle-dnd[1376772]: &#x2F;bin&#x2F;sh: 1: toggle-dnd: not found
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Oh right. Cron is running things with a default PATH. Technically there are ways to configure this &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-3-1&quot;&gt;&lt;a href=&quot;#fn-3&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;, but the simple solution is just to run a bash login shell which sources all the directories i would normally have in a shell. at this point, however, it is getting somewhat annoying to test via cron, so let&#x27;s replicate cron&#x27;s environment:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;env&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; HOME=&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;HOME&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; TERM=&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;TERM&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; PS1=&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;$ &lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; HISTSIZE=-1 HISTFILE= bash&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;norc&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;noprofile&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;bash&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;l&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&#x2F;home&#x2F;jyn&#x2F;Documents&#x2F;node-v20.12.2-linux-x64&#x2F;bin:&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;bin:&#x2F;home&#x2F;jyn&#x2F;src&#x2F;dotfiles&#x2F;bin:&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;bin:&#x2F;snap&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;home&#x2F;jyn&#x2F;perl5&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;snap&#x2F;bin
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;neat. let&#x27;s run  make sure our command runs.
before:&lt;&#x2F;p&gt;
&lt;img src=&quot;&amp;#x2F;assets&amp;#x2F;Pasted image 20250222141930.png&quot;
	 alt=&quot;Left side of the Gnome topbar&quot;
	
&gt;
&lt;p&gt;after running &lt;code&gt;toggle-dnd&lt;&#x2F;code&gt; in our login shell:&lt;&#x2F;p&gt;
&lt;img src=&quot;&amp;#x2F;assets&amp;#x2F;Pasted image 20250222141930.png&quot;
	 alt=&quot;Still the left side of the gnome topbar. In fact this is the exact same image as before.&quot;
	
&gt;
&lt;p&gt;... nothing happened.
we can confirm this on the CLI:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gsettings&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; get org.gnome.desktop.notifications show-banners&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gsettings&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; set org.gnome.desktop.notifications show-banners false&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gsettings&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; get org.gnome.desktop.notifications show-banners&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;true
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;dbus&quot;&gt;DBUS&lt;a class=&quot;zola-anchor&quot; href=&quot;#dbus&quot; aria-label=&quot;Anchor link for: dbus&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;at this point i started to get annoyed and ran &lt;code&gt;systemctl --user status&lt;&#x2F;code&gt; in hopes of writing a systemd timer instead. fortunately, i did that inside the bash login shell, which gave me this helpful error message:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;systemctl&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;user&lt;&#x2F;span&gt; status&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;Failed to connect to bus: $DBUS_SESSION_BUS_ADDRESS and $XDG_RUNTIME_DIR not defined (consider using --machine=&amp;lt;user&amp;gt;@.host --user to connect to bus of other user)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;It turns out that both &lt;code&gt;gsettings&lt;&#x2F;code&gt; and &lt;code&gt;systemctl&lt;&#x2F;code&gt; are trying to communicate over DBUS, and DBUS is linked to your &quot;user session&quot;, set when you login. Unsetting environment variables disables DBUS &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-4-1&quot;&gt;&lt;a href=&quot;#fn-4&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I found a helpful &lt;a href=&quot;https:&#x2F;&#x2F;askubuntu.com&#x2F;a&#x2F;1468012&quot;&gt;stackoverflow post&lt;&#x2F;a&gt; that helps us reconnect to DBUS &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-5-1&quot;&gt;&lt;a href=&quot;#fn-5&quot;&gt;5&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-shell&quot;&gt;export&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;XDG_RUNTIME_DIR&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&#x2F;run&#x2F;user&#x2F;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;UID&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-shell&quot;&gt;export&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;DBUS_SESSION_BUS_ADDRESS&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;unix:path=&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;XDG_RUNTIME_DIR&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;bus&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Let&#x27;s write a little abstraction for that, too &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-6-1&quot;&gt;&lt;a href=&quot;#fn-6&quot;&gt;6&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;!&#x2F;usr&#x2F;bin&#x2F;env bash&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; Run a command in an environment where DBUS commands (e.g. `systemd --user`, `gsettings`) are available&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-colon z-shell&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;XDG_RUNTIME_DIR&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;:=&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&#x2F;run&#x2F;user&#x2F;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;UID&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-colon z-shell&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;DBUS_SESSION_BUS_ADDRESS&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;:=&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;unix:path=&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;XDG_RUNTIME_DIR&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;bus&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-expansion z-parameter z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-shell&quot;&gt;export&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;XDG_RUNTIME_DIR&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;DBUS_SESSION_BUS_ADDRESS&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-exec z-shell&quot;&gt;exec&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-shell&quot;&gt;@&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now, finally, we can put the pieces together:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;crontab&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;l&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;0 20 * * * bash -lc &amp;#39;dbus-run-user toggle-dnd true  2&amp;gt;&amp;amp;1 | logger -t toggle-dnd&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;0 8  * * * bash -lc &amp;#39;dbus-run-user toggle-dnd false 2&amp;gt;&amp;amp;1 | logger -t toggle-dnd&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;p-s&quot;&gt;P.S.&lt;a class=&quot;zola-anchor&quot; href=&quot;#p-s&quot; aria-label=&quot;Anchor link for: p-s&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;x11&quot;&gt;X11&lt;a class=&quot;zola-anchor&quot; href=&quot;#x11&quot; aria-label=&quot;Anchor link for: x11&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;just setting up DBUS doesn&#x27;t set up our X11 environment again. I didn&#x27;t happen to need that. but now that we have DBUS, you can retrieve it pretty easily:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;console&quot; class=&quot;language-console z-code&quot;&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;$&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;dbus-run-user&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; systemctl&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;user&lt;&#x2F;span&gt; show-environment&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;grep&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ^DISPLAY&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-console&quot;&gt;DISPLAY=:1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;You can do something similar for &lt;code&gt;XAUTHORITY&lt;&#x2F;code&gt;, &lt;code&gt;TMUX*&lt;&#x2F;code&gt;, and &lt;code&gt;XDG_*&lt;&#x2F;code&gt; environment variables. Note that &lt;code&gt;systemctl --user&lt;&#x2F;code&gt; may be using a tmux session or pane that no longer exists; use caution.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;why-were-you-doing-this-in-the-first-place&quot;&gt;why were you doing this in the first place&lt;a class=&quot;zola-anchor&quot; href=&quot;#why-were-you-doing-this-in-the-first-place&quot; aria-label=&quot;Anchor link for: why-were-you-doing-this-in-the-first-place&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;hahahaha so i had the foolish idea that this would get discord to silence notifications at night. &lt;a href=&quot;https:&#x2F;&#x2F;support.discord.com&#x2F;hc&#x2F;en&#x2F;community&#x2F;posts&#x2F;22549582088343-Respect-desktop-s-Do-Not-Disturb-mode-for-desktop-notifications&quot;&gt;it does not do that&lt;&#x2F;a&gt;. i ended up just turning off desktop notification sounds altogether.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;&quot;why not a systemd user timer&quot; because i don&#x27;t know a helper that lets you write the timer schedule interactively, the way that &lt;a href=&quot;https:&#x2F;&#x2F;cron.help&#x2F;&quot;&gt;https:&#x2F;&#x2F;cron.help&#x2F;&lt;&#x2F;a&gt; works for crontabs, and because systemd&#x27;s documentation is smeared across a ton of different man pages. cron is just &lt;code&gt;crontab -e&lt;&#x2F;code&gt;. &lt;a href=&quot;#fr-1-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;&quot;why not set cron to automatically write output to the system log&quot; hahahahaha there&#x27;s no way to do that. unless you&#x27;re using specifically &lt;a href=&quot;https:&#x2F;&#x2F;man.archlinux.org&#x2F;man&#x2F;extra&#x2F;cronie&#x2F;cron.8.en#OPTIONS&quot;&gt;&lt;code&gt;cronie&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, which isn&#x27;t packaged in Ubuntu 22.04. &lt;a href=&quot;#fr-2-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;see &lt;a href=&quot;https:&#x2F;&#x2F;manpages.ubuntu.com&#x2F;manpages&#x2F;trusty&#x2F;man5&#x2F;crontab.5.html&quot;&gt;&lt;code&gt;man 5 crontab&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;; also this differs depending which version of cron you have installed. this link for instance does not match the man page i have installed locally for &lt;code&gt;man 5 crontab&lt;&#x2F;code&gt;. &lt;a href=&quot;#fr-3-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-4&quot;&gt;
&lt;p&gt;it&#x27;s almost like &lt;a href=&quot;https:&#x2F;&#x2F;blog.sunfishcode.online&#x2F;no-ghosts&#x2F;&quot;&gt;using environment variables to communicate data through a system is a bad idea&lt;&#x2F;a&gt;! &lt;a href=&quot;#fr-4-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-5&quot;&gt;
&lt;p&gt;note that recommends using &lt;code&gt;machinectl&lt;&#x2F;code&gt; or &lt;code&gt;systemctl --machine=$USER@localhost --user&lt;&#x2F;code&gt; instead. but both of those don&#x27;t work in this environment: &lt;code&gt;machinectl&lt;&#x2F;code&gt; requires interactive login, and &lt;code&gt;--machine&lt;&#x2F;code&gt; just doesn&#x27;t work at all:
&lt;code&gt;Failed to connect to bus: Host is down&lt;&#x2F;code&gt;
&lt;code&gt;Failed to list units: Transport endpoint is not connected&lt;&#x2F;code&gt; &lt;a href=&quot;#fr-5-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-6&quot;&gt;
&lt;p&gt;This uses bash because that sets &lt;code&gt;$UID&lt;&#x2F;code&gt; for us automatically. Theoretically we could do this with sh and &lt;code&gt;id -u&lt;&#x2F;code&gt;, but it&#x27;s more of a pain than it&#x27;s worth. &lt;a href=&quot;#fr-6-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>building your own <code>rustc_driver</code></title>
        <published>2024-10-24T00:00:00+00:00</published>
        <updated>2024-10-24T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/rustc-driver/"/>
        <id>https://jyn.dev/rustc-driver/</id>
        
        <summary type="html">what happens when you run &lt;code&gt;cargo clippy&lt;&#x2F;code&gt;?</summary>
        
        <content type="html" xml:base="https://jyn.dev/rustc-driver/">&lt;h2 id=&quot;a-deeper-rabbit-hole-than-expected&quot;&gt;a deeper rabbit hole than expected&lt;a class=&quot;zola-anchor&quot; href=&quot;#a-deeper-rabbit-hole-than-expected&quot; aria-label=&quot;Anchor link for: a-deeper-rabbit-hole-than-expected&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;what happens when you run &lt;code&gt;cargo clippy&lt;&#x2F;code&gt;?&lt;&#x2F;p&gt;
&lt;p&gt;well, we can ask cargo what it does:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cargo clippy -v
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    Checking example v0.1.0 (&#x2F;home&#x2F;jyn&#x2F;src&#x2F;example)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     Running `&#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;clippy-driver &#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;rustc --crate-name example --edition=2021 src&#x2F;main.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --diagnostic-width=124 --crate-type bin --emit=dep-info,metadata -C embed-bitcode=no -C debuginfo=2 --check-cfg &amp;#39;cfg(docsrs)&amp;#39; --check-cfg &amp;#39;cfg(feature, values())&amp;#39; -C metadata=f3baefdd4f0d88a8 -C extra-filename=-f3baefdd4f0d88a8 --out-dir &#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;target&#x2F;debug&#x2F;deps -C incremental=&#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;target&#x2F;debug&#x2F;incremental -L dependency=&#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;target&#x2F;debug&#x2F;deps`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.67s
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;that&#x27;s kinda weird! it&#x27;s running something called &lt;code&gt;clippy-driver&lt;&#x2F;code&gt;? and passing &lt;code&gt;bin&#x2F;rustc&lt;&#x2F;code&gt; as an argument to it? what&#x27;s going on there? is it running any other programs afterwards?&lt;&#x2F;p&gt;
&lt;p&gt;we can find that out too:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; strace -f -e execve cargo clippy
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;details&gt;&lt;summary&gt;all of strace&#x27;s output&lt;&#x2F;summary&gt;
&lt;p&gt;note this is massaged slightly for clarity; the actual command i ran was&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cargo clean; strace -f -e execve,clone3 -s 100 cargo clippy 2&amp;gt;&amp;amp;1 | sed &amp;#39;s&#x2F;Process &#x2F;\nProcess &#x2F;; s&#x2F;execve([^,]*, \([^]]*\).*&#x2F;execve(\1])&#x2F;&amp;#39; | rg -v &amp;#39;resumed&amp;gt;&amp;#39; | rg &amp;#39;(\[pid[^]]*\] )?(execve.*|clone3|Process.*)&amp;#39; -o | sed &amp;#39;s&#x2F;clone3&#x2F;clone3()&#x2F;&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;followed by some manual cleanup.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;execve([&amp;quot;cargo&amp;quot;, &amp;quot;clippy&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;cargo&amp;quot;, &amp;quot;clippy&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;bin&#x2F;cargo-clippy&amp;quot;, &amp;quot;clippy&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;cargo-clippy&amp;quot;, &amp;quot;clippy&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;clone3(): Process 6125 attached
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6125] execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;cargo&amp;quot;, &amp;quot;check&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6125] clone3(): Process 6126 attached
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6126] execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;clippy-driver&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;rustc&amp;quot;, &amp;quot;-vV&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6125] clone3(): Process 6127 attached
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6127] execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;clippy-driver&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;rustc&amp;quot;, &amp;quot;-&amp;quot;, &amp;quot;--crate-name&amp;quot;, &amp;quot;___&amp;quot;, &amp;quot;--print=file-names&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;bin&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;rlib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;dylib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;cdylib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;staticlib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;proc-macro&amp;quot;, &amp;quot;--check-cfg&amp;quot;, &amp;quot;cfg()&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6125] clone3(): Process 6129 attached
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6129] execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;clippy-driver&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;rustc&amp;quot;, &amp;quot;-&amp;quot;, &amp;quot;--crate-name&amp;quot;, &amp;quot;___&amp;quot;, &amp;quot;--print=file-names&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;bin&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;rlib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;dylib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;cdylib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;staticlib&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;proc-macro&amp;quot;, &amp;quot;--print=sysroot&amp;quot;, &amp;quot;--print=split-debuginfo&amp;quot;, &amp;quot;--print=crate-name&amp;quot;, &amp;quot;--print=cfg&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6125] clone3(): Process 6131 attached
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6131] execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;clippy-driver&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;rustc&amp;quot;, &amp;quot;-vV&amp;quot;])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6125] clone3(): Process 6134 attached
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;[pid  6134] execve([&amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;clippy-driver&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;rustc&amp;quot;, &amp;quot;--crate-name&amp;quot;, &amp;quot;example&amp;quot;, &amp;quot;--edition=2021&amp;quot;, &amp;quot;src&#x2F;main.rs&amp;quot;, &amp;quot;--error-format=json&amp;quot;, &amp;quot;--json=diagnostic-rendered-ansi,artifacts,future-incompat&amp;quot;, &amp;quot;--crate-type&amp;quot;, &amp;quot;bin&amp;quot;, &amp;quot;--emit=dep-info,metadata&amp;quot;, &amp;quot;-C&amp;quot;, &amp;quot;embed-bitcode=no&amp;quot;, &amp;quot;-C&amp;quot;, &amp;quot;debuginfo=2&amp;quot;, &amp;quot;--check-cfg&amp;quot;, &amp;quot;cfg(docsrs)&amp;quot;, &amp;quot;--check-cfg&amp;quot;, &amp;quot;cfg(feature, values())&amp;quot;, &amp;quot;-C&amp;quot;, &amp;quot;metadata=f3baefdd4f0d88a8&amp;quot;, &amp;quot;-C&amp;quot;, &amp;quot;extra-filename=-f3baefdd4f0d88a8&amp;quot;, &amp;quot;--out-dir&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;target&#x2F;debug&#x2F;deps&amp;quot;, &amp;quot;-C&amp;quot;, &amp;quot;incremental=&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;target&#x2F;debug&#x2F;incremental&amp;quot;, &amp;quot;-L&amp;quot;, &amp;quot;dependency=&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;target&#x2F;debug&#x2F;deps&amp;quot;])
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;details&gt;
&lt;p&gt;wow, we have like 10 different commands running here! &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-paths-1&quot;&gt;&lt;a href=&quot;#fn-paths&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.cargo&#x2F;bin&#x2F;cargo clippy -v&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;cargo clippy -v&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.cargo&#x2F;bin&#x2F;cargo-clippy -v&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;cargo-clippy clippy -v&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;cargo check -v&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;clippy-driver ~&#x2F;.rustup&#x2F;...&#x2F;rustc -vV&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;clippy-driver ~&#x2F;.rustup&#x2F;..&#x2F;rustc - --print=file-names&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;clippy-driver ~&#x2F;.rustup&#x2F;...&#x2F;rustc -- --print=sysroot&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;clippy-driver ~&#x2F;.rustup&#x2F;...&#x2F;rustc -vV&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;~&#x2F;.rustup&#x2F;...&#x2F;clippy-driver ~&#x2F;.rustup&#x2F;..&#x2F;rustc src&#x2F;main.rs&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;that&#x27;s a lot of indirection to compile a simple hello world! let&#x27;s dig into why it happens.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;rustup-toolchain-proxies&quot;&gt;Rustup toolchain proxies&lt;a class=&quot;zola-anchor&quot; href=&quot;#rustup-toolchain-proxies&quot; aria-label=&quot;Anchor link for: rustup-toolchain-proxies&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;twice, we see the same binary executed first from &lt;code&gt;~&#x2F;.cargo&lt;&#x2F;code&gt;, then again from &lt;code&gt;~&#x2F;.rustup&lt;&#x2F;code&gt;: for &lt;code&gt;cargo&lt;&#x2F;code&gt; and for &lt;code&gt;cargo-clippy&lt;&#x2F;code&gt;. what&#x27;s the difference between these?&lt;&#x2F;p&gt;
&lt;p&gt;let&#x27;s take a look at the first one that runs:&lt;&#x2F;p&gt;
&lt;details&gt;&lt;summary&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; strace -e readlink,openat -z ~&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;bin&#x2F;cargo
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;readlink(&amp;quot;&#x2F;proc&#x2F;self&#x2F;exe&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;bin&#x2F;cargo&amp;quot;, 256) = 36
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;settings.toml&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;summary&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; strace -e readlink,openat -s 100 -z ~&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;bin&#x2F;cargo 2&amp;gt;&amp;amp;1| rg &amp;#39;readlink|openat&amp;#39; | rg -v &amp;#39;&amp;quot;&#x2F;(lib|etc)&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;proc&#x2F;self&#x2F;maps&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;readlink(&amp;quot;&#x2F;proc&#x2F;self&#x2F;exe&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;cargo&#x2F;bin&#x2F;cargo&amp;quot;, 256) = 36
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;settings.toml&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(3, &amp;quot;nightly-x86_64-unknown-linux-gnu&amp;quot;, O_RDONLY|O_NOCTTY|O_CLOEXEC) = 4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;rustlib&#x2F;rust-installer-version&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;rustlib&#x2F;multirust-channel-manifest.toml&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;rustlib&#x2F;multirust-config.toml&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;readlink(&amp;quot;&#x2F;proc&#x2F;self&#x2F;exe&amp;quot;, &amp;quot;&#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;cargo&amp;quot;, 4096) = 81
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;openat(AT_FDCWD, &amp;quot;&#x2F;proc&#x2F;self&#x2F;maps&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;details&gt;
&lt;p&gt;it turns out this is something called a &lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.github.io&#x2F;rustup&#x2F;concepts&#x2F;proxies.html&quot;&gt;rustup proxy&lt;&#x2F;a&gt;. this is a little shim that &lt;a href=&quot;https:&#x2F;&#x2F;blog.axo.dev&#x2F;2024&#x2F;07&#x2F;an-app-by-any-other-name&quot;&gt;hardlinks&lt;&#x2F;a&gt; from the proxy (in this case &lt;code&gt;cargo&lt;&#x2F;code&gt;) to rustup. rustup then looks at its own executable name, notices that it&#x27;s cargo, and picks the right toolchain to run the actual cargo binary.&lt;&#x2F;p&gt;
&lt;p&gt;you can actually ask rustup to just find the path without running it:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; rustup which cargo
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;bin&#x2F;cargo
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and you can see that the real cargo doesn&#x27;t support rustup features like toolchain selectors:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; cargo +nightly --version
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cargo 1.81.0-nightly (4dcbca118 2024-06-11)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; $(rustup which cargo) +nightly --version
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: no such command: `+nightly`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        Cargo does not handle `+toolchain` directives.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        Did you mean to invoke `cargo` through `rustup` instead?
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;you can even verify for yourself that &lt;code&gt;~&#x2F;.cargo&#x2F;bin&#x2F;cargo&lt;&#x2F;code&gt; is just a hardlink by comparing the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Inode&quot;&gt;inodes&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; ls -i &#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;bin&#x2F;rustup
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;32294517 &#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;bin&#x2F;rustup
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; ls -i &#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;bin&#x2F;rustc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;32294517 &#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;bin&#x2F;rustc
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;cargo-extensions&quot;&gt;cargo extensions&lt;a class=&quot;zola-anchor&quot; href=&quot;#cargo-extensions&quot; aria-label=&quot;Anchor link for: cargo-extensions&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;ok, we&#x27;ve figured out 2&#x2F;10 of the processes. what are the other 8?&lt;&#x2F;p&gt;
&lt;p&gt;the first one that runs after &lt;code&gt;cargo clippy&lt;&#x2F;code&gt; is ... &lt;code&gt;cargo-clippy&lt;&#x2F;code&gt; (with a &lt;em&gt;-&lt;&#x2F;em&gt; dash, not a space). this is a &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;external-tools.html#custom-subcommands&quot;&gt;cargo extension&lt;&#x2F;a&gt;; &lt;code&gt;cargo clippy&lt;&#x2F;code&gt; is doing very little here other than setting &lt;code&gt;CARGO&lt;&#x2F;code&gt; in the environment to point back to itself. why does it need to do that? because &lt;code&gt;cargo-clippy&lt;&#x2F;code&gt; is about to call back to cargo: that&#x27;s process 5, &lt;code&gt;cargo check&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;what&#x27;s changed is that &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust-clippy&#x2F;blob&#x2F;cefa31a5243b90c0c606e2fdb3fc3e036a8bec16&#x2F;src&#x2F;main.rs#L109-L126&quot;&gt;&lt;code&gt;cargo-clippy&lt;&#x2F;code&gt; has set&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;config.html#buildrustc-workspace-wrapper&quot;&gt;&lt;code&gt;RUSTC_WORKSPACE_WRAPPER&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; to &lt;code&gt;clippy-driver&lt;&#x2F;code&gt;. that means that instead of invoking rustc on each crate, it&#x27;s going to invoke clippy-driver. and because it&#x27;s a &lt;code&gt;WRAPPER&lt;&#x2F;code&gt;, it gets passed &lt;code&gt;rustc&lt;&#x2F;code&gt; as an argument. the intended use-case is for tools like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mozilla&#x2F;sccache&quot;&gt;&lt;code&gt;sccache&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; that transparently wrap rustc before invoking it; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust-clippy&#x2F;blob&#x2F;9cf416dc6ec9d7ebc8df299ca970e4a92efa2596&#x2F;src&#x2F;driver.rs#L229-L255&quot;&gt;clippy never invokes rustc as a process&lt;&#x2F;a&gt;, but there&#x27;s no equivalent of &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;config.html#buildrustc&quot;&gt;&lt;code&gt;RUSTC&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; that&#x27;s only used for workspaces.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;sysroots-and-dynamic-libraries&quot;&gt;sysroots and dynamic libraries&lt;a class=&quot;zola-anchor&quot; href=&quot;#sysroots-and-dynamic-libraries&quot; aria-label=&quot;Anchor link for: sysroots-and-dynamic-libraries&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;now, at this point you might imagine that we have enough info to write our own clippy-like tool that gets invoked instead of rustc. if we look at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;blob&#x2F;b8bb2968ce1e44d01520c9d59ee6299ed66df3f9&#x2F;compiler&#x2F;rustc&#x2F;src&#x2F;main.rs&quot;&gt;&lt;code&gt;compiler&#x2F;rustc&#x2F;src&#x2F;main.rs&lt;&#x2F;code&gt; in rust-lang&#x2F;rust&lt;&#x2F;a&gt;, other than some weird jemalloc stuff, all it does is call &lt;code&gt;rustc_driver::main&lt;&#x2F;code&gt;. let&#x27;s write a toy program that does that.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; cargo new driver
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; cd driver
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; echo &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-annotation z-rust&quot;&gt;#!&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-annotation z-rust&quot;&gt;feature&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;rustc_private&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_driver&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;  &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;this is a custom driver!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;  &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_driver&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;#39;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; src&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;rs
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; cargo &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;+&lt;&#x2F;span&gt;nightly run
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;error&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-rust&quot;&gt;E0463&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; can&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;t&lt;&#x2F;span&gt; find &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; `rustc_driver`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; src&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;rs&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;  &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_driver&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;  &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt; ^^^^^^^^^^^^^^^^^^^^^^^^^^ can&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;t&lt;&#x2F;span&gt; find crate&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;  &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; help&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; maybe you need to install the missing components with&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; `rustup component add rust&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;src rustc&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;dev llvm&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;tools&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;preview`
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;oh. huh. that&#x27;s kinda weird. let&#x27;s follow those instructions for now though.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; rustup component add rust-src rustc-dev llvm-tools-preview
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; cargo +nightly run
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   Compiling driver v0.1.0 (&#x2F;home&#x2F;jyn&#x2F;src&#x2F;driver)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.08s
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     Running `&#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;target&#x2F;debug&#x2F;driver`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;this is a custom driver!
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Usage: rustc [OPTIONS] INPUT
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;this is pretty cool! let&#x27;s install it for our user and see if we can run it on a rust file.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; cargo install --path . --debug
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Installing driver v0.1.0 (&#x2F;home&#x2F;jyn&#x2F;src&#x2F;driver)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.01s
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Installing &#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;bin&#x2F;driver
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   Installed package `driver v0.1.0 (&#x2F;home&#x2F;jyn&#x2F;src&#x2F;driver)` (executable `driver`)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; driver src&#x2F;main.rs
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;driver: error while loading shared libraries: librustc_driver-5396912e8af1f65d.so: cannot open shared object file: No such file or directory
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;well that&#x27;s unfortunate. what happened here?&lt;&#x2F;p&gt;
&lt;p&gt;when we use &lt;code&gt;cargo run&lt;&#x2F;code&gt; for our driver, it sets some environment variables. in particular, it sets a variable called &lt;code&gt;LD_LIBRARY_PATH&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; strace -s 1000 -v -e execve cargo run 2&amp;gt;&amp;amp;1 &amp;gt;&#x2F;dev&#x2F;null | rg debug&#x2F;driver | rg -o &amp;#39;LD_LIBRARY_PATH=[^&amp;quot;]*&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;LD_LIBRARY_PATH=&#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;target&#x2F;debug&#x2F;deps:&#x2F;home&#x2F;jyn&#x2F;.cargo&#x2F;target&#x2F;debug:&#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;rustlib&#x2F;x86_64-unknown-linux-gnu&#x2F;lib:&#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and indeed if we set that variable, our driver works again:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; env &amp;quot;$(strace -s 1000 -v -e execve cargo run 2&amp;gt;&amp;amp;1 &amp;gt;&#x2F;dev&#x2F;null | rg debug&#x2F;driver | rg -o &amp;#39;LD_LIBRARY_PATH=[^&amp;quot;]*&amp;#39;)&amp;quot; driver src&#x2F;main.rs
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;this is a custom driver!
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;what does it do?&lt;&#x2F;p&gt;
&lt;p&gt;well, &lt;a href=&quot;https:&#x2F;&#x2F;tldp.org&#x2F;HOWTO&#x2F;Program-Library-HOWTO&#x2F;shared-libraries.html#AEN80&quot;&gt;the linux documentation project&lt;&#x2F;a&gt; documents it as follows:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can temporarily substitute a different library for this particular execution. In Linux, the environment variable LD_LIBRARY_PATH is a colon-separated set of directories where libraries should be searched for first, before the standard set of directories; this is useful when debugging a new library or using a nonstandard library for special purposes&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&quot;library&quot; here means a shared object library. on linux, these files end with &lt;code&gt;.so&lt;&#x2F;code&gt;; on Windows, &lt;code&gt;.dll&lt;&#x2F;code&gt; (for &quot;dynamic-link library&quot;) ; on MacOS, &lt;code&gt;.dylib&lt;&#x2F;code&gt;. these are object files that contain code (&quot;symbols&quot; in linker terms) that are loaded by the linker at runtime, after the rest of your program is loaded into memory. for example, if we look at the rustc binary we copied our driver&#x27;s code from, it&#x27;s almost empty:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; stat -c %s $(rustup which rustc) | numfmt --to=iec
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2.6M
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;instead, almost all the code is in a shared object:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; stat -c %s &#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;librustc_driver-5396912e8af1f65d.so | numfmt --to=iec
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;136M
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;that shared object gets loaded at runtime by every rustc_driver: &lt;code&gt;rustc&lt;&#x2F;code&gt;, &lt;code&gt;clippy&lt;&#x2F;code&gt;, &lt;code&gt;rustdoc&lt;&#x2F;code&gt;, &lt;code&gt;miri&lt;&#x2F;code&gt; - and our new &lt;code&gt;driver&lt;&#x2F;code&gt; tool. it&#x27;s actually shipped with every toolchain; if you look at the stable toolchain in &lt;code&gt;.rustup&lt;&#x2F;code&gt; you&#x27;ll see it there too. however, what you &lt;em&gt;won&#x27;t&lt;&#x2F;em&gt; see is the &lt;code&gt;.rmeta&lt;&#x2F;code&gt; files in the toolchain directory: &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-target-libdir-1&quot;&gt;&lt;a href=&quot;#fn-target-libdir&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; ls &#x2F;home&#x2F;jyn&#x2F;.rustup&#x2F;toolchains&#x2F;nightly-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;rustlib&#x2F;x86_64-unknown-linux-gnu&#x2F;lib&#x2F;*.rmeta | wc -l
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;228
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;those are the files we just installed with &lt;code&gt;rustup component add rustc-dev&lt;&#x2F;code&gt;. they give rustc the type information it needs to check our &lt;code&gt;driver&lt;&#x2F;code&gt; code against the type signatures of all the &lt;code&gt;rustc_private&lt;&#x2F;code&gt; internal crates.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;building-a-driver&quot;&gt;building a driver&lt;a class=&quot;zola-anchor&quot; href=&quot;#building-a-driver&quot; aria-label=&quot;Anchor link for: building-a-driver&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;so! we have learned a bunch of stuff:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;when we run &lt;code&gt;cargo&lt;&#x2F;code&gt; or &lt;code&gt;rustc&lt;&#x2F;code&gt;, that&#x27;s actually running a &quot;rustup proxy&quot; that picks the toolchain version to use&lt;&#x2F;li&gt;
&lt;li&gt;when we run &lt;code&gt;cargo clippy&lt;&#x2F;code&gt;, that&#x27;s doing a complicated back and forth between cargo and various clippy executables&lt;&#x2F;li&gt;
&lt;li&gt;when we run &lt;code&gt;rustc&lt;&#x2F;code&gt; or &lt;code&gt;clippy-driver&lt;&#x2F;code&gt;, that&#x27;s loading a shared object called &lt;code&gt;librustc_driver.so&lt;&#x2F;code&gt; at runtime&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;that&#x27;s enough info we can now build our own driver!&lt;&#x2F;p&gt;
&lt;p&gt;first, let&#x27;s make sure we can always run our driver even if we&#x27;re not going through cargo. it turns out there&#x27;s a linker flag for this called &lt;a href=&quot;https:&#x2F;&#x2F;man.openbsd.org&#x2F;man1&#x2F;ld.bfd.1#rpath&quot;&gt;&lt;code&gt;-rpath&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, which does essentially the same thing as &lt;code&gt;LD_LIBRARY_PATH&lt;&#x2F;code&gt; but at link time instead of at runtime. to get the path we need, we can use &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;stable&#x2F;rustc&#x2F;command-line-arguments.html#--print-print-compiler-information&quot;&gt;&lt;code&gt;rustc --print=sysroot&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; (we can get the right version of &lt;code&gt;rustc&lt;&#x2F;code&gt; from an env variable cargo sets, &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;environment-variables.html#environment-variables-cargo-sets-for-build-scripts&quot;&gt;&lt;code&gt;RUSTC&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;). and finally, to tell cargo to pass that flag to the linker, we can write a build script that uses &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;build-scripts.html#rustc-link-arg&quot;&gt;&lt;code&gt;cargo:rustc-link-arg&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-rpath-origin-1&quot;&gt;&lt;a href=&quot;#fn-rpath-origin&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; build.rs
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; rustc &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;env&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;var&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;RUSTC&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; output &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;process&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;Command&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;rustc&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;arg&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;--print=sysroot&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;output&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; stdout &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-rust&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;from_utf8&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;output&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;stdout&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; sysroot &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; stdout&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;trim_end&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;cargo:rustc-link-arg=-Wl,-rpath=&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{sysroot}&lt;&#x2F;span&gt;&#x2F;lib&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;next, we want to be able to invoke this as &lt;code&gt;cargo driver&lt;&#x2F;code&gt;, so we need to write a &lt;code&gt;cargo-driver&lt;&#x2F;code&gt; program.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; src&#x2F;bin&#x2F;cargo-driver.rs
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;env&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;, &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; cargo &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;env&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;var&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;CARGO&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap_or&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;cargo&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;into&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; cmd &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;process&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;Command&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;cargo&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; driver &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;env&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;current_exe&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;with_file_name&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;driver&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; status &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; cmd&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;arg&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;build&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;env&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;RUSTC&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; driver&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;status&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;match&lt;&#x2F;span&gt; status&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;code&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Ok&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;other&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Err&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;other&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-type z-rust&quot;&gt;None&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Err&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;note that this works fine when using &lt;code&gt;cargo install&lt;&#x2F;code&gt;, but when using &lt;code&gt;cargo run --bin cargo-driver&lt;&#x2F;code&gt; locally, cargo doesn&#x27;t rebuild all your binaries automatically - you need to manually run &lt;code&gt;cargo build&lt;&#x2F;code&gt; first to make sure both executables are updated. &lt;sup class=&quot;footnote-reference&quot; id=&quot;fr-bindeps-1&quot;&gt;&lt;a href=&quot;#fn-bindeps&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;we-get-a-little-silly-with-it-3&quot;&gt;we get a little silly with it :3&lt;a class=&quot;zola-anchor&quot; href=&quot;#we-get-a-little-silly-with-it-3&quot; aria-label=&quot;Anchor link for: we-get-a-little-silly-with-it-3&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;now let&#x27;s make a program that does something fun! i&#x27;m going to disable the &lt;code&gt;unsafe&lt;&#x2F;code&gt; checker, so that we can write unsafe programs in &quot;safe&quot; rust.&lt;&#x2F;p&gt;
&lt;p&gt;first, let&#x27;s tell rust-analyzer that we&#x27;re using rustc internals in this crate, so we get go-to-definition and other nice things:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;toml&quot; class=&quot;language-toml z-code&quot;&gt;&lt;code class=&quot;language-toml&quot; data-lang=&quot;toml&quot;&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-toml&quot;&gt;#&lt;&#x2F;span&gt; Cargo.toml&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-table z-begin z-toml&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-tag z-table z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;package&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-table z-toml&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-table z-toml&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;rust-analyzer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-table z-end z-toml&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-toml&quot;&gt;#&lt;&#x2F;span&gt; This package uses #[feature(rustc_private)]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-meta z-tag z-key z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;rustc_private&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-key-value z-toml&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-toml&quot;&gt;true&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;we also have to configure this per-editor - i use &lt;a href=&quot;https:&#x2F;&#x2F;helix-editor.com&#x2F;&quot;&gt;helix&lt;&#x2F;a&gt; so i&#x27;m going to configure &lt;code&gt;.helix&#x2F;languages.toml&lt;&#x2F;code&gt;. for vscode you&#x27;d use &lt;code&gt;.vscode&#x2F;settings.json&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;toml&quot; class=&quot;language-toml z-code&quot;&gt;&lt;code class=&quot;language-toml&quot; data-lang=&quot;toml&quot;&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-toml&quot;&gt;#&lt;&#x2F;span&gt; .helix&#x2F;languages.toml&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-table z-begin z-toml&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-tag z-table z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;language-server&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-table z-toml&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;rust-analyzer&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-table z-toml&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;config&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-table z-end z-toml&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-meta z-tag z-key z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;rust-analyzer&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-key z-toml&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;rustc&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-key z-toml&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;source&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-key-value z-toml&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;discover&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;i&#x27;m also going to pin a version of the nightly toolchain, since the internal APIs change quite frequently.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;toml&quot; class=&quot;language-toml z-code&quot;&gt;&lt;code class=&quot;language-toml&quot; data-lang=&quot;toml&quot;&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-toml&quot;&gt;#&lt;&#x2F;span&gt; rust-toolchain.toml&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-table z-begin z-toml&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-tag z-table z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-table z-toml&quot;&gt;toolchain&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-table z-end z-toml&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-meta z-tag z-key z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;channel&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-key-value z-toml&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;nightly-2024-10-20&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-meta z-tag z-key z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;components&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-key-value z-toml&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-array z-begin z-toml&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;cargo&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-array z-toml&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;llvm-tools&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-array z-toml&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;rust-src&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-array z-toml&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;rust-std&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-array z-toml&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;rustc&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-array z-toml&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;rustc-dev&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-array z-toml&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;rustfmt&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-array z-end z-toml&quot;&gt;]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-toml&quot;&gt;&lt;span class=&quot;z-meta z-tag z-key z-toml&quot;&gt;&lt;span class=&quot;z-entity z-name z-tag z-toml&quot;&gt;profile&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-key-value z-toml&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-basic z-toml&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;minimal&lt;span class=&quot;z-punctuation z-definition z-string z-end z-toml&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;finally, let&#x27;s write our program.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; src&#x2F;main.rs
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-annotation z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-annotation z-rust&quot;&gt;#!&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-annotation z-rust&quot;&gt;feature&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;rustc_private&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-annotation z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_driver&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_errors&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_hir&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_interface&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_middle&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;extern&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;crate&lt;&#x2F;span&gt; rustc_session&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_driver&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Callbacks&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_errors&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;emitter&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;HumanReadableErrorType&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; ColorConfig&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_interface&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;interface&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_session&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;config&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;ErrorOutputType&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_session&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;EarlyDiagCtxt&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;DisableSafetyChecks&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-impl z-rust&quot;&gt;impl&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;Callbacks &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;for&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt; &lt;span class=&quot;z-entity z-name z-impl z-rust&quot;&gt;DisableSafetyChecks&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;config&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;self&lt;&#x2F;span&gt;, &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;config&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;interface&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Config&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        config&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;override_queries &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;            &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;_session&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;queries&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;queries&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;check_unsafety&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;_tcx&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;_def_id&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_driver&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;install_ice_hook&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;        &lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;jyn514.github.io&#x2F;issues&#x2F;new&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;        &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;_&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; handler &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;EarlyDiagCtxt&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;ErrorOutputType&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;HumanReadable&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;        &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;HumanReadableErrorType&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Default&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;        &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;ColorConfig&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;Auto&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_driver&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;init_rustc_env_logger&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;handler&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;process&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;exit&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_driver&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;catch_with_exit_code&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;move&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-rust&quot;&gt;||&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; args&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;env&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;args&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;collect&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;rustc_driver&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;RunCompiler&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;args&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; DisableSafetyChecks&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;run&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;there&#x27;s a lot here. i&#x27;m not going to cover it all - see &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;&quot;&gt;the rustc dev guide&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nightly&#x2F;nightly-rustc&#x2F;&quot;&gt;generated documentation&lt;&#x2F;a&gt; for that - but i want to call out two things in particular:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;we had to explicitly use &lt;code&gt;extern crate&lt;&#x2F;code&gt; to load the rustc_private crates. normally, cargo will pass (e.g.) &lt;code&gt;--extern cfg-if=~&#x2F;.cargo&#x2F;debug&#x2F;deps&#x2F;libcfg-if.rmeta&lt;&#x2F;code&gt;, so rustc loads our dependencies automatically. these crates are being loaded from the &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#what-is-a-sysroot&quot;&gt;sysroot&lt;&#x2F;a&gt;, though, so cargo doesn&#x27;t know about them.&lt;&#x2F;li&gt;
&lt;li&gt;the bit of this driver we actually care about is in &lt;code&gt;queries.check_unsafety = |...| {}&lt;&#x2F;code&gt;. that says &quot;override the default function that checks unsafety with our own function&quot;. rustc is built on a &quot;query&quot; model where information is pulled instead of pushed - see the dev guide section on &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;overview.html#queries&quot;&gt;queries&lt;&#x2F;a&gt; for more information.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;let&#x27;s test out our driver and make sure it works. we&#x27;ll install it, create a new project that uses unsafe code without an &lt;code&gt;unsafe&lt;&#x2F;code&gt; block, and make sure that project compiles.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-cd z-shell&quot;&gt;cd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; driver&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; install&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;path&lt;&#x2F;span&gt; .&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-cd z-shell&quot;&gt;cd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; ..&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; new safe-rust&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-cd z-shell&quot;&gt;cd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; safe-rust&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;fn main() { println!(&amp;quot;{}&amp;quot;, *std::ptr::null::&amp;lt;usize&amp;gt;()); }&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; src&#x2F;main.rs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; driver&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;   &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Compiling&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; safe-rust v0.1.0 (&#x2F;home&#x2F;jyn&#x2F;src&#x2F;safe-rust&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;warning:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; dereferencing a null pointer&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;--&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; src&#x2F;main.rs:1:28&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;fn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; main(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-punctuation z-definition z-compound z-braces z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;println!&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;(&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;{}&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;std::ptr::null::&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;usize&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-process z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-compound z-braces z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;^^^^^^^^^^^^^^^^^^^^^^^^^^&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; this code causes undefined behavior when executed&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;  &lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;note:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-command z-backticks z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-shell&quot;&gt;`&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;#[warn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;(deref_nullptr&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-shell&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; on by default&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;warning:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-command z-backticks z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-shell&quot;&gt;`&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;safe-rust&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-shell&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; (bin &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;safe-rust&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;generated&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1 warning&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Finished&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-command z-backticks z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-shell&quot;&gt;`&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;dev&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-shell&quot;&gt;`&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; profile &lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;unoptimized + debuginfo&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt; target(s&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 0.06s&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;tada!&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;h3 id=&quot;a-digression-more-about-rustup-proxies&quot;&gt;a digression: more about rustup proxies&lt;a class=&quot;zola-anchor&quot; href=&quot;#a-digression-more-about-rustup-proxies&quot; aria-label=&quot;Anchor link for: a-digression-more-about-rustup-proxies&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;when we built our custom driver, we wrote &lt;code&gt;driver.rs&lt;&#x2F;code&gt; and &lt;code&gt;cargo-driver.rs&lt;&#x2F;code&gt;, but we never wrote a rustup proxy. how was it picking the right version to run?&lt;&#x2F;p&gt;
&lt;p&gt;well, it was always picking the same version. if we explicitly use a different toolchain - e.g. &lt;code&gt;stable&lt;&#x2F;code&gt; - it will still run our custom driver, which uses the nightly toolchain.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;RUSTFLAGS&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;--version&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cargo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; +stable driver&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;---&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; stdout&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;rustc&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1.84.0-nightly (662180b34 2024-10-20&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ideally, we would instead have our driver respect the version we&#x27;re passed. that would also mean stuff like &lt;code&gt;driver +stable&lt;&#x2F;code&gt; would give a nice error when that version isn&#x27;t installed, instead of what it currently does:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: couldn&amp;#39;t read +stable: No such file or directory (os error 2)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;here is a toy shell script that does that, using the same &quot;read my own process name&quot; trick to dispatch to the right binary:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; ~&#x2F;.cargo&#x2F;bin&#x2F;driver&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; ~&#x2F;.cargo&#x2F;bin&#x2F;cargo-driver&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;!&#x2F;bin&#x2F;sh&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-case z-shell&quot;&gt;case&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-in z-shell&quot;&gt;in&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;+&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-patterns z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;RUSTUP_TOOLCHAIN&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cut&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;c&lt;&#x2F;span&gt; 1-&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-shift z-shell&quot;&gt;shift&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-terminator z-case z-clause z-shell&quot;&gt;;;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-patterns z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-assignment z-shell&quot;&gt;RUSTUP_TOOLCHAIN&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-shell&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-unquoted z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;rustup&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; default&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-pipe z-shell&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cut&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;d&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;f&lt;&#x2F;span&gt; 1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-commands z-shell&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-conditional z-case z-clause z-patterns z-shell&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-end z-shell&quot;&gt;esac&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-exec z-shell&quot;&gt;exec&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; rustup run &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;RUSTUP_TOOLCHAIN&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;basename&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-shell&quot;&gt;@&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-exit z-shell&quot;&gt;exit&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1 &lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt; unreachable&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;the other advantage of this shell script is it will let you version your tool. for example, you could install it into &lt;code&gt;$(rustc --print sysroot)&#x2F;bin&lt;&#x2F;code&gt; instead of &lt;code&gt;~&#x2F;.cargo&#x2F;bin&lt;&#x2F;code&gt;, and have multiple versions depending on what version of rustc it was built with. this is how clippy and the other tools packaged by rustup work, but rustup doesn&#x27;t support arbitrary drivers, only the hard-coded ones it knows about.&lt;&#x2F;p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn-paths&quot;&gt;
&lt;p&gt;you may have noticed that i have changed the strace output from &lt;code&gt;~&#x2F;.local&#x2F;lib&#x2F;rustup&lt;&#x2F;code&gt; to &lt;code&gt;~&#x2F;.rustup&lt;&#x2F;code&gt;, and likewise for &lt;code&gt;~&#x2F;.cargo&lt;&#x2F;code&gt;. &lt;code&gt;~&#x2F;.rustup&lt;&#x2F;code&gt; and &lt;code&gt;~&#x2F;.cargo&lt;&#x2F;code&gt; are the default locations for rustup and cargo respectively, but i&#x27;ve manually changed them with &lt;code&gt;CARGO_HOME&lt;&#x2F;code&gt; and &lt;code&gt;RUSTUP_HOME&lt;&#x2F;code&gt; environment variables. the difference doesn&#x27;t matter for the purpose of this post. &lt;a href=&quot;#fr-paths-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-target-libdir&quot;&gt;
&lt;p&gt;unlike before, these aren&#x27;t in &lt;code&gt;nightly&#x2F;lib&lt;&#x2F;code&gt;, they&#x27;re in &lt;code&gt;nightly&#x2F;lib&#x2F;rustlib&#x2F;x86_64-unknown-linux-gnu&#x2F;lib&lt;&#x2F;code&gt;. the difference between these is a little out of scope for this post; basically the former is target-independent and the latter is target-specific. see &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#what-is-a-sysroot&quot;&gt;what is a sysroot?&lt;&#x2F;a&gt; for more information. &lt;a href=&quot;#fr-target-libdir-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-rpath-origin&quot;&gt;
&lt;p&gt;this strategy embeds an absolute path in our binary. that&#x27;s fine when running locally, but clippy and other tools want to work on any machine. instead, they use &lt;code&gt;-Wl,-rpath=$ORIGIN&#x2F;..&#x2F;lib&lt;&#x2F;code&gt;, which says &quot;the lib dir relative to the path to the binary that&#x27;s currently running&quot;. we can&#x27;t use that here because it only works if our binary is in the sysroot, not if it&#x27;s installed to &lt;code&gt;~&#x2F;.cargo&#x2F;bin&lt;&#x2F;code&gt;. &lt;a href=&quot;#fr-rpath-origin-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li id=&quot;fn-bindeps&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;cargo&#x2F;issues&#x2F;9096&quot;&gt;artifact dependencies&lt;&#x2F;a&gt; don&#x27;t actually help here. they require that the binary you&#x27;re using come from another crate; they can&#x27;t be used to specify a target inside the current package. &lt;a href=&quot;#fr-bindeps-1&quot;&gt;↩&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;&#x2F;section&gt;
</content>
    </entry><entry xml:lang="en">
        <title>the rust project has a burnout problem</title>
        <published>2024-01-16T00:00:00+00:00</published>
        <updated>2024-01-16T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/the-rust-project-has-a-burnout-problem/"/>
        <id>https://jyn.dev/the-rust-project-has-a-burnout-problem/</id>
        
        <content type="html" xml:base="https://jyn.dev/the-rust-project-has-a-burnout-problem/">&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;burned%20out%20rust%20club.png&quot; alt=&quot;a melting, smiling, ferris. it&amp;#39;s surrounded by the cursive text &amp;quot;burned out rust kid club&amp;quot;.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;the number of people who have left the rust project due to burnout is shockingly high. the number of people in the project who are close to burnout is also shockingly high.&lt;&#x2F;p&gt;
&lt;p&gt;this post is about myself, but it&#x27;s not just about myself. i&#x27;m not going to name names because either you know what i&#x27;m talking about, in which case you know &lt;em&gt;at least&lt;&#x2F;em&gt; five people matching this description, or you don&#x27;t, in which case sorry but you&#x27;re not the target audience. consider, though, that the project has been around for 15 years, and compare that to the average time a maintainer has been active ...&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-does-this-look-like&quot;&gt;what does this look like&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-this-look-like&quot; aria-label=&quot;Anchor link for: what-does-this-look-like&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;(i apologize in advance if this story does not match your experience; hopefully the suggestions on what to do about burnout will still be helpful to you.)&lt;&#x2F;p&gt;
&lt;p&gt;the pattern usually goes something like this:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;you want to work on rust. you go to look at the issue tracker. you find something &lt;em&gt;you&lt;&#x2F;em&gt; care about, since the easy&#x2F;mentored issues are taken. it&#x27;s hard to find a mentor because all the experienced people are overworked and burned out, so you end up doing a lot of the work independently.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;guess what you&#x27;ve already learned at this point: work in this project doesn&#x27;t happen unless &lt;em&gt;you personally&lt;&#x2F;em&gt; drive it forward. that issue you fixed was opened for years; the majority of issues you will work on as you start will have been open for months.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;you become a more active contributor. the existing maintainer is too burned out to do regular triage, so you end up going through the issue backlog (usually, you&#x27;re the first person to have done so in years). this reinforces the belief work doesn&#x27;t happen unless &lt;em&gt;you&lt;&#x2F;em&gt; do it &lt;em&gt;personally&lt;&#x2F;em&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;the existing maintainer recognizes your work and turns over a lot of the responsibilities to you, especially reviews. new contributors make PRs. they make silly simple mistakes due to lack of experience; you point them out and they get fixed. this can be fun, for a time. what it&#x27;s teaching you is that &lt;em&gt;you personally&lt;&#x2F;em&gt; are responsible for catching mistakes.&lt;&#x2F;li&gt;
&lt;li&gt;you get tired. you&#x27;ve been doing this for a while. people keep making the same mistakes, and you&#x27;re afraid to trust other reviewers; perhaps you&#x27;re the &lt;em&gt;only&lt;&#x2F;em&gt; reviewer, or other reviewers have let things slip before and you don&#x27;t trust their judgement as much as you used to. perhaps you&#x27;re assigned too many PRs and you can&#x27;t keep up. you haven&#x27;t worked on the things you &lt;em&gt;want&lt;&#x2F;em&gt; to work on in weeks, and no one else is working on them because you said you were going to (&quot;they won&#x27;t happen unless &lt;em&gt;you do them personally&lt;&#x2F;em&gt;&quot;, a voice says). you want a break, but you have a voice in the back of your head: &quot;the project would be worse without you&quot;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;i&#x27;m going to stop here; i think everyone gets the idea.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-can-i-do-about-it&quot;&gt;what can i do about it&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-can-i-do-about-it&quot; aria-label=&quot;Anchor link for: what-can-i-do-about-it&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&quot;it won&#x27;t get done if i don&#x27;t do it&quot; and &quot;i need to review everything or stuff will slip through&quot; is exactly the mindset of my own burnout from rust. it doesn&#x27;t matter if it&#x27;s true, it will cause you pain. if the project cannot survive without &lt;em&gt;you personally&lt;&#x2F;em&gt; putting in unpaid overtime, perhaps it does not deserve to survive.&lt;&#x2F;p&gt;
&lt;p&gt;if you are paid to work on rust, you likely started as an unpaid contributor and got the job later. &lt;em&gt;treat it like a job now&lt;&#x2F;em&gt;. do not work overtime; do not volunteer at every turn; do not work on things far outside your job description.&lt;&#x2F;p&gt;
&lt;p&gt;the best way to help the project is to keep contributing for it for years. to do that, you have to avoid burning out, which means you have to &lt;em&gt;treat yourself well&lt;&#x2F;em&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-can-team-leads-do-about-it&quot;&gt;what can team leads do about it&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-can-team-leads-do-about-it&quot; aria-label=&quot;Anchor link for: what-can-team-leads-do-about-it&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;have documentation for &quot;what to do about burnout&quot;; give it just as much priority as technical issues or moderation conflicts.&lt;&#x2F;p&gt;
&lt;p&gt;rotate responsibilities. don&#x27;t have the same person assigned to the majority of PRs. if they review other people&#x27;s PRs unsolicited, talk to them 1-1 about why they feel the need to do so. if someone is assigned to the review queue and never reviews PRs, talk to them; take them off the queue; give them a vacation or different responsibilities as appropriate.&lt;&#x2F;p&gt;
&lt;p&gt;ask people why they leave. i know at least one person whose burnout story does not match the one in this post. i am sure there are others. you cannot solve a problem if you don&#x27;t understand what causes it.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;take these problems seriously&lt;&#x2F;em&gt;. &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;2023&#x2F;12&#x2F;04&#x2F;How-to-maintain-an-open-source-project.html&quot;&gt;prioritize growing the team and creating a healthy environment over solving technical issues&lt;&#x2F;a&gt;. &lt;strong&gt;the issues will still be there in a few months; your people may not be&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-can-the-rust-project-do-about-it&quot;&gt;what can the rust project do about it&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-can-the-rust-project-do-about-it&quot; aria-label=&quot;Anchor link for: what-can-the-rust-project-do-about-it&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;one thing bothering me as i wrote this post is how much of this still falls on individuals within the project. i don&#x27;t think this is an individual problem; i think it is a cultural, organizational, and resource problem. i may write more about this once i have concrete ideas about what the project could do.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;be-well-be-kind-to-each-other-i-love-you&quot;&gt;be well. be kind to each other. i love you.&lt;a class=&quot;zola-anchor&quot; href=&quot;#be-well-be-kind-to-each-other-i-love-you&quot; aria-label=&quot;Anchor link for: be-well-be-kind-to-each-other-i-love-you&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;remember:&lt;&#x2F;p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;EMPATHY WITHOUT BOUNDARIES IS SELF DESTRUCTION &lt;a href=&quot;https:&#x2F;&#x2F;t.co&#x2F;HbBwEj4hc3&quot;&gt;pic.twitter.com&#x2F;HbBwEj4hc3&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;&amp;mdash; 𖤐ARCH BUDZAR𖤐 (@ArchBudzar) &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;ArchBudzar&#x2F;status&#x2F;1313572660048269315?ref_src=twsrc%5Etfw&quot;&gt;October 6, 2020&lt;&#x2F;a&gt;&lt;&#x2F;blockquote&gt; &lt;script async src=&quot;https:&#x2F;&#x2F;platform.twitter.com&#x2F;widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;&#x2F;script&gt; 
&lt;h3 id=&quot;acknowledgements&quot;&gt;acknowledgements&lt;a class=&quot;zola-anchor&quot; href=&quot;#acknowledgements&quot; aria-label=&quot;Anchor link for: acknowledgements&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;thank you &lt;strong&gt;@QuietMisdreavus&lt;&#x2F;strong&gt; for the &lt;em&gt;burned out rust kid club&lt;&#x2F;em&gt; art.&lt;&#x2F;p&gt;
&lt;p&gt;thank you &lt;strong&gt;@Gankra&lt;&#x2F;strong&gt;, &lt;strong&gt;@QuietMisdreavus&lt;&#x2F;strong&gt;, &lt;strong&gt;@alercah&lt;&#x2F;strong&gt;, &lt;strong&gt;@ManishEarth&lt;&#x2F;strong&gt;, &lt;strong&gt;@estebank&lt;&#x2F;strong&gt;, &lt;strong&gt;@workingjubilee&lt;&#x2F;strong&gt; and &lt;strong&gt;@yaahc&lt;&#x2F;strong&gt; for discussion and feedback on early drafts of this post. any errors are my own.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>wonder</title>
        <published>2023-12-20T00:00:00+00:00</published>
        <updated>2023-12-20T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/wonder/"/>
        <id>https://jyn.dev/wonder/</id>
        
        <summary type="html">a sense of wonder is a wonderful thing</summary>
        
        <content type="html" xml:base="https://jyn.dev/wonder/">&lt;p&gt;this is a list of the times this year i felt wonder or joy. it&#x27;s not exhaustive.
it&#x27;s mostly for me. but it&#x27;s also for others, because i think a sense of wonder is a wonderful thing,
and i wish it were valued more highly.&lt;&#x2F;p&gt;
&lt;p&gt;i want to give a very special thanks to my friends Nori, Kate Crane, and Kate F, for showing me how much beauty there is in the world.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;wonder&quot;&gt;wonder&lt;a class=&quot;zola-anchor&quot; href=&quot;#wonder&quot; aria-label=&quot;Anchor link for: wonder&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;things-i-have-seen&quot;&gt;things i have seen&lt;a class=&quot;zola-anchor&quot; href=&quot;#things-i-have-seen&quot; aria-label=&quot;Anchor link for: things-i-have-seen&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;lightning.jpg&quot; alt=&quot;lightning striking. the timing is perfect such that half the night sky is illuminated by the bolt and half is not.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;i took this photo in east austin, walking home from the last dinner i would have with my friends at my old company. it started pouring rain shortly afterwards.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;angel%20in%20the%20garden.jpg&quot; alt=&quot;a small square black block, with the engraved text: in the land of gods and monsters, i was an angel living in the garden of evil&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;i got this at a magic sale on Airport Boulevard in austin. it immediately spoke to me, for reasons that don&#x27;t belong on a blog post.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;austin%20from%20office.jpg&quot; alt=&quot;a blurry, distorted picture of a city. in the foreground is an apartment building. in the background is a set of sky scrapers. the sky above is dark, but no stars are visible.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;i took this photo from a company office at night. the photo is not very good, but it reminds me of the vast emptiness i felt, the hum of the city, the ten hundred thousand people around me.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;mlk%20library.jpg&quot; alt=&quot;a picture of a city, taken from a tall rooftop. there is a glass building to the right and ornate architectures to the left. the street is filled with lights. far above, the clouds are dark grey against a bright setting sun.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;i took this photo from the roof of MLK library in DC. i felt like the city was alive around me. i still do.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;30000%20feet.jpg&quot; alt=&quot;a picture taken from an airplane windows. in the top left is the sun, blurred into an incomprehensible shape by the window pane. to the right is empty space. below are layered clouds, that look almost like ocean waves.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;this is the closest i will come to visiting space.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;things-i-have-heard&quot;&gt;things i have heard&lt;a class=&quot;zola-anchor&quot; href=&quot;#things-i-have-heard&quot; aria-label=&quot;Anchor link for: things-i-have-heard&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=q71LaWSSQ7M&quot;&gt;The Art Teacher&lt;&#x2F;a&gt;, by Rufus Wainwright. somehow this condenses a lifetime of regret and longing into four minutes.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=KIBKbhrniUQ&quot;&gt;Rachel&#x27;s Song&lt;&#x2F;a&gt;, from Blade Runner. for all the entities who miss a life that was never their own.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=9LcxSuZY024&quot;&gt;I Want To Live&lt;&#x2F;a&gt;, from Baldur&#x27;s Gate.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;things-i-have-read&quot;&gt;things i have read&lt;a class=&quot;zola-anchor&quot; href=&quot;#things-i-have-read&quot; aria-label=&quot;Anchor link for: things-i-have-read&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;weirdfictionreview.com&#x2F;2014&#x2F;06&#x2F;lull&#x2F;&quot;&gt;Lull&lt;&#x2F;a&gt;, by Kelly Link. i cannot describe it and i will not try. it takes half an hour to read; more, if you are a fast reader.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;annleckie.com&#x2F;novel&#x2F;ancillary-justice&#x2F;&quot;&gt;Ancillary Justice&lt;&#x2F;a&gt;, by Ann Leckie. it dares to ask: what if a ship were a person, and not a person, and both at once? and it dares to imagine: what if there were a choir that sang with many bodies and voices, but only one mind? what kind of world could create such beauty?&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jana-h-s.itch.io&#x2F;untitled-crab-project&quot;&gt;Untitled Crab Project&lt;&#x2F;a&gt;, by Jana H-S. &lt;em&gt;I am going to tell you about some crabs&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;things-i-have-created&quot;&gt;things i have created&lt;a class=&quot;zola-anchor&quot; href=&quot;#things-i-have-created&quot; aria-label=&quot;Anchor link for: things-i-have-created&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;cohost.org&#x2F;jyn&#x2F;post&#x2F;3933390-a-collection-of-date&quot;&gt;a collection of date ideas&lt;&#x2F;a&gt;. you can only read it in reverse, and that&#x27;s intentional.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;joy&quot;&gt;joy&lt;a class=&quot;zola-anchor&quot; href=&quot;#joy&quot; aria-label=&quot;Anchor link for: joy&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;things-i-have-seen-1&quot;&gt;things i have seen&lt;a class=&quot;zola-anchor&quot; href=&quot;#things-i-have-seen-1&quot; aria-label=&quot;Anchor link for: things-i-have-seen-1&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;nils%20meow.jpg&quot; alt=&quot;a github comment by @Nilstrieb: hello can anyone review my code please :ferrisClueless: please i have been waiting for weeks now all you do is meow please just one approval please&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;i burst into laughter every time i see this.&lt;&#x2F;p&gt;
&lt;video controls&gt;
    &lt;source src=&quot;&#x2F;assets&#x2F;fuck%20you%20chicago%20and%20northwestern%20railroad%20company.mp4&quot;&gt;
&lt;&#x2F;video&gt;
&lt;p&gt;FUCK YOU CHICAGO AND NORTHWESTERN RAILROAD COMPANY&lt;&#x2F;p&gt;
&lt;h3 id=&quot;things-i-have-created-1&quot;&gt;things i have created&lt;a class=&quot;zola-anchor&quot; href=&quot;#things-i-have-created-1&quot; aria-label=&quot;Anchor link for: things-i-have-created-1&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;118756&quot;&gt;use bold magenta instead of bold white for highlighting&lt;&#x2F;a&gt;. this is both very gay and legitimately useful. i would like more of my life to be like this, please.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;triagebot&#x2F;pull&#x2F;1756&quot;&gt;make triagebot cuter&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;assets&#x2F;pendant-selfie.jpg&quot; alt=&quot;mirror selfie!! i&amp;#39;m wearing a long sleeved burgundy shirt that hugs my curves and jeans that are just visible at the waist. my nails are painted glossy black. i&amp;#39;m wearing a bronze-ish metal watch, a brown bracelet, and a delicate necklace with a picture of a flower. my hair is half up and drapes over my left shoulder. i&amp;#39;m smiling wide, bringing out my laugh lines, although my mouth is closed.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;this is the first time i felt like a woman.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>How to maintain an Open Source project</title>
        <published>2023-12-04T00:00:00+00:00</published>
        <updated>2023-12-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/how-to-maintain-an-open-source-project/"/>
        <id>https://jyn.dev/how-to-maintain-an-open-source-project/</id>
        
        <summary type="html">How to maintain a project without burning yourself out</summary>
        
        <content type="html" xml:base="https://jyn.dev/how-to-maintain-an-open-source-project/">&lt;p&gt;Open source is unique in that &lt;em&gt;energy&lt;&#x2F;em&gt;, not time or money, is the limiting factor. The existential threats are maintainer burnout and an imploding community, not failing to make payroll. As a result, it’s very important to do three things:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Recruit new maintainers as frequently as possible.&lt;&#x2F;li&gt;
&lt;li&gt;Ruthlessly prioritize the energy of existing maintainers.&lt;&#x2F;li&gt;
&lt;li&gt;Be kind to your users.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;All other concerns are in some sense secondary; it doesn’t matter if a project has lots of useful features if it’s been abandoned for 4 years and no longer compiles, or if it has no users.&lt;&#x2F;p&gt;
&lt;p&gt;Note that &quot;be kind to your users&quot; is not the same as doing everything they ask for. You can and should say no to features. Being kind is really more simple stuff – don’t be rude in discussions, don’t make breaking changes unless there’s a good reason (there’s tools for this, like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;obi1kenobi&#x2F;cargo-semver-checks#cargo-semver-checks&quot;&gt;cargo-semver-checks&lt;&#x2F;a&gt;!), make it easy for people to submit bug reports and ask questions. If you close an issue as WONTFIX, tell them why; if it&#x27;s not too much effort, perhaps say the circumstances under which you might change your mind, or give an example of another way to solve their problem.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;balancing-priorities&quot;&gt;Balancing priorities&lt;a class=&quot;zola-anchor&quot; href=&quot;#balancing-priorities&quot; aria-label=&quot;Anchor link for: balancing-priorities&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;One might notice that all three of those bullets are contradictory: recruiting new maintainers takes energy from existing maintainers; a feature that’s fun for a developer to write may not be useful for users, or vice versa; the more features a project has, the more complicated it gets and the harder it is to onboard new maintainers. Balancing these concerns is the cornerstone of an open source project.&lt;&#x2F;p&gt;
&lt;p&gt;Here are a few concrete examples of how to meet those goals:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Automate everything you find boring. CI, releases, updating dependencies, formatting, documentation are all good candidates here. Remember that it’s better to e.g. have a release that’s missing pre-compiled binaries than no release at all. There are many tools that can do this for you; a few examples in the rust ecosystem are Github Actions, &lt;a href=&quot;https:&#x2F;&#x2F;opensource.axo.dev&#x2F;cargo-dist&#x2F;&quot;&gt;cargo-dist&lt;&#x2F;a&gt;, dependabot, rustfmt, and rustdoc.&lt;&#x2F;li&gt;
&lt;li&gt;Post about the project frequently on social media or other platforms. This is both a good motivator for you to see what you’ve accomplished and a great way to get other people’s interest, either as users or maintainers. Don’t wait until you have something polished, a half-baked post is better than no post at all. Start a platform dedicated to your project where you can talk with users and contributors; this can be as simple as a Discord server or as complicated as a self-hosted Zulip instance. The important thing is, again, that it should be fun for you to set up.&lt;&#x2F;li&gt;
&lt;li&gt;Document how to develop the project, and how to write documentation. The former pays dividends – not just for recruiting new maintainers, but also for reminding yourself how the project works when you come back from vacation in two weeks. The latter reduces your burden for writing documentation by making it easy for other people to help you write it.&lt;&#x2F;li&gt;
&lt;li&gt;Take vacations, even extended vacations. If you know you&#x27;ll be on vacation ahead of time, be kind to your users or fellow maintainers by telling them you&#x27;re gone. If you have automated review assignments, set it up to allow people to take breaks.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;culture&quot;&gt;Culture&lt;a class=&quot;zola-anchor&quot; href=&quot;#culture&quot; aria-label=&quot;Anchor link for: culture&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Past those concrete things, though, it’s important to set a culture for the project that makes you eager to work on it.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Develop a taste for when to say no to features. This is especially hard because it changes as a project grows. Early on, features are easy and fun to add, and open up lots of possibilities for your users. Later, they get harder to add, and new features make the tool more complicated for your existing users (who after all, started using your tool when it was more simpler) and new users (who have to read through all your documentation); and you have enough users it becomes less important to grow your user base.&lt;&#x2F;li&gt;
&lt;li&gt;Find people who are as excited about the project as you are. Invite constructive criticism – it’s a great way for you to learn and improve the project at the same time! – but at the same time make sure you balance it with positive feedback so you don’t get overwhelmed.&lt;&#x2F;li&gt;
&lt;li&gt;Don’t let yourself get burned out. This is in some ways the hardest part. There is only so much work you can do every week before you get tired. Pushing yourself past that will work, temporarily, but at the cost of draining your energy and making you less willing to work on the project in the future. You are not a company and do not have an SLA to your users; if they are really harmed they can use an older release or submit a patch themselves.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;recruiting-maintainers&quot;&gt;Recruiting maintainers&lt;a class=&quot;zola-anchor&quot; href=&quot;#recruiting-maintainers&quot; aria-label=&quot;Anchor link for: recruiting-maintainers&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Most people will never ask to be maintainers. Either they don&#x27;t want to be presumptuous, or they don&#x27;t feel experienced enough, or it just won&#x27;t occur to them. Instead, you should reach out to them.&lt;&#x2F;p&gt;
&lt;p&gt;As a general rule, I suggest leaning towards trusting people with merge privileges early. Anyone who&#x27;s active in the project is likely going to stick around for a while; you can always revert code they merge, and you don&#x27;t have to give them publish access. This is a great way to make people feel like part of the project, which in turns makes them more likely to keep contributing.&lt;&#x2F;p&gt;
&lt;p&gt;I have a lot more to say on this, but most of it has already been said by my friend Alice Cecile in &lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=xM7bI2OPPLQ&quot;&gt;this wonderful talk&lt;&#x2F;a&gt;. Go watch it. Seriously, go watch it, it&#x27;s only 20 minutes and none of them are wasted.&lt;&#x2F;p&gt;
&lt;p&gt;Projects can become self-sustaining rather quickly – you really only need to recruit one or two other people, get five or ten users, and have a decent codebase to expand on. Once you’ve done that, you can mentor your other contributors into taking a leading role, and, eventually, step back from your role as the founder.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Why is Rust's build system uniquely hard to use?</title>
        <published>2023-01-12T00:00:00+00:00</published>
        <updated>2023-01-12T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/bootstrapping-rust-in-2023/"/>
        <id>https://jyn.dev/bootstrapping-rust-in-2023/</id>
        
        <summary type="html">Goals for improving Rust&#x27;s build system and making it easier to understand</summary>
        
        <content type="html" xml:base="https://jyn.dev/bootstrapping-rust-in-2023/">&lt;p&gt;&lt;em&gt;This post will assume you have watched &lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=oUIjG-y4zaA&quot;&gt;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=oUIjG-y4zaA&lt;&#x2F;a&gt;.
You may also find it helpful to read &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#stages-of-bootstrapping&quot;&gt;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#stages-of-bootstrapping&lt;&#x2F;a&gt;, but I won&#x27;t assume prior knowledge of the information there.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;!-- This is a post about how I would like Rust&#x27;s bootstrapping system to work in an ideal world. --&gt;
&lt;!-- I am not sure all these changes are feasible - they certainly can be done at a technical --&gt;
&lt;!-- blah blah coordination is hard --&gt;
&lt;h2 id=&quot;why-is-bootstrap-confusing&quot;&gt;Why is bootstrap confusing?&lt;a class=&quot;zola-anchor&quot; href=&quot;#why-is-bootstrap-confusing&quot; aria-label=&quot;Anchor link for: why-is-bootstrap-confusing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;People get confused by Rust&#x27;s build system a lot. I have been trying for a while to figure out what
makes Rust uniquely hard here, as a lot of the people who are confused are experienced compiler
engineers who have used staged compilers in the past. Here are some theories I have.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;is-stage-0-is-uniquely-confusing&quot;&gt;Is &quot;stage 0&quot; is uniquely confusing?&lt;a class=&quot;zola-anchor&quot; href=&quot;#is-stage-0-is-uniquely-confusing&quot; aria-label=&quot;Anchor link for: is-stage-0-is-uniquely-confusing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;what-do-other-compilers-call-stage-0&quot;&gt;What do other compilers call &quot;stage 0&quot;?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-do-other-compilers-call-stage-0&quot; aria-label=&quot;Anchor link for: what-do-other-compilers-call-stage-0&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;install&#x2F;build.html&quot;&gt;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;install&#x2F;build.html&lt;&#x2F;a&gt; refers to a &quot;3-stage&quot; build, and names the stages &quot;stage1&quot;, &quot;stage2&quot;, &quot;stage3&quot;.
It also references a &quot;native compiler&quot;. As far as I can tell, &quot;native compiler&quot; corresponds to what Rust calls &quot;stage 0&quot;, and stage 1&#x2F;2&#x2F;3 are all exactly equivalent, i.e:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;stage0 is a pre-existing compiler, which is assumed to already exist (or in rust&#x27;s case, a downloaded beta compiler).&lt;&#x2F;li&gt;
&lt;li&gt;stage1 is the sources from latest master, built by stage0, and has a different ABI from stage2 and stage3.&lt;&#x2F;li&gt;
&lt;li&gt;stage2 is the same sources, built by stage1.&lt;&#x2F;li&gt;
&lt;li&gt;stage3 is byte-for-byte identical with stage2, only useful for verifying reproducible builds.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;AdvancedBuilds.html#bootstrap-builds&quot;&gt;https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;AdvancedBuilds.html#bootstrap-builds&lt;&#x2F;a&gt; says &quot;In a simple two-stage bootstrap build, we build clang using the system compiler, then use that just-built clang to build clang again.&quot; which again seems to match GCC and Rust.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gitlab.haskell.org&#x2F;ghc&#x2F;ghc&#x2F;blob&#x2F;master&#x2F;hadrian&#x2F;README.md#staged-compilation&quot;&gt;https:&#x2F;&#x2F;gitlab.haskell.org&#x2F;ghc&#x2F;ghc&#x2F;blob&#x2F;master&#x2F;hadrian&#x2F;README.md#staged-compilation&lt;&#x2F;a&gt; seems to match GCC, Clang, and Rust.&lt;&#x2F;p&gt;
&lt;!-- TOOD: mention that there are other self-hosted compilers that don&#x27;t use stages? would make it clear that having &quot;too close&quot; a model to other compilers is confusing --&gt;
&lt;h4 id=&quot;why-would-stage-0-be-confusing&quot;&gt;Why would &quot;stage 0&quot; be confusing?&lt;a class=&quot;zola-anchor&quot; href=&quot;#why-would-stage-0-be-confusing&quot; aria-label=&quot;Anchor link for: why-would-stage-0-be-confusing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;Maybe treating this as &quot;just&quot; another stage, rather than naming it &quot;native compiler&quot; or &quot;system compiler&quot;, is confusing.
That alone seems unlikely though; &quot;0&quot; at least to me seems like a good indication that it&#x27;s not being built from source.
So renaming stage 0 to &quot;bootstrap compiler&quot; or &quot;pre-compiled compiler&quot;, while helpful, seems unlikely to clear up the confusion.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;is-building-the-standard-library-confusing&quot;&gt;Is building the standard library confusing?&lt;a class=&quot;zola-anchor&quot; href=&quot;#is-building-the-standard-library-confusing&quot; aria-label=&quot;Anchor link for: is-building-the-standard-library-confusing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;what-do-other-compilers-do&quot;&gt;What do other compilers do?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-do-other-compilers-do&quot; aria-label=&quot;Anchor link for: what-do-other-compilers-do&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;GCC and Clang do not build their standard libraries from source. Instead, they use the same dynamically linked system standard library for all stages, including the &quot;stage 0&quot; or &quot;system compiler&quot; stage.&lt;&#x2F;p&gt;
&lt;p&gt;(As an aside, that&#x27;s &lt;em&gt;horrifying&lt;&#x2F;em&gt;, C doesn&#x27;t have a standardized ABI and so this can cause miscompilations even if there are no bugs in the standard library or gcc itself: &lt;a href=&quot;https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;c-isnt-a-language&#x2F;#c-doesnt-actually-have-an-abi&quot;&gt;https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;c-isnt-a-language&#x2F;#c-doesnt-actually-have-an-abi&lt;&#x2F;a&gt;)&lt;&#x2F;p&gt;
&lt;p&gt;GHC &lt;em&gt;does&lt;&#x2F;em&gt; build its standard library from source. It has two parts to its standard library:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;GHC.Base&lt;&#x2F;code&gt;, which can only be compiled by exactly one version of GHC. This is a runtime, analogous to &lt;code&gt;crt0.o&lt;&#x2F;code&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;stdrs.dev&#x2F;nightly&#x2F;x86_64-unknown-linux-gnu&#x2F;std&#x2F;rt&#x2F;index.html&quot;&gt;&lt;code&gt;std::rt&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Everything else in the &lt;code&gt;GHC.*&lt;&#x2F;code&gt; namespace. This can be compiled by any version of GHC.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h4 id=&quot;what-does-rust-do&quot;&gt;What does Rust do?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-rust-do&quot; aria-label=&quot;Anchor link for: what-does-rust-do&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;Rust also builds its standard library from source. It has three parts:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;core&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;alloc&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;std&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;All three can be built by exactly &lt;em&gt;two&lt;&#x2F;em&gt; versions of &lt;code&gt;rustc&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;The previous beta compiler.&lt;&#x2F;li&gt;
&lt;li&gt;The in-tree sources, versioned in the same git repo.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;As discussed in my RustConf talk, they distinguish the two with &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt;; when set, we&#x27;re using beta, when unset, we&#x27;re using the in-tree sources.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;why-would-this-be-confusing&quot;&gt;Why would this be confusing?&lt;a class=&quot;zola-anchor&quot; href=&quot;#why-would-this-be-confusing&quot; aria-label=&quot;Anchor link for: why-would-this-be-confusing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;Having to support two versions of the compiler seems to be unique to Rust&#x27;s standard library. C bypasses the question altogether by not having language intrinsics in the standard library and supporting any compiler version; Haskell only requires one version of the compiler to be supported.&lt;&#x2F;p&gt;
&lt;p&gt;Having to support two versions is in fact the original motivation for this post, since it causes
lots of pain for changes that modify both the compiler and standard library; see
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;84863&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;84863&lt;&#x2F;a&gt; for an example that modifies both in the same PR and
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;99917&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;99917&lt;&#x2F;a&gt; for an example that depends on changes to the
compiler that haven&#x27;t yet landed on beta.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;what-can-we-do-about-it&quot;&gt;What can we do about it?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-can-we-do-about-it&quot; aria-label=&quot;Anchor link for: what-can-we-do-about-it&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Supporting two versions is not an intrinsic requirement. We do it for two reasons:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;It allows testing changes to the standard library without having to first build the compiler.
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;65031&quot;&gt;Building the compiler is painfully slow&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;It allows &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#complications-of-bootstrapping&quot;&gt;using nightly standard library features&lt;&#x2F;a&gt; in the compiler before they land on beta.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;1 is &quot;just&quot; implementation work to fix: if there are no changes to the compiler, we can download CI artifacts for that commit and use those instead. There are &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;81930&quot;&gt;a few bugs to fix&lt;&#x2F;a&gt; but they&#x27;re surmountable.&lt;&#x2F;p&gt;
&lt;p&gt;2 is harder. Either we add &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; to the compiler to use a different implementation when building with stage0 than stage1, or we stop using nightly standard library features until they reach beta. See &lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;131828-t-compiler&#x2F;topic&#x2F;Building.20rustc.20with.20beta.20libstd&#x2F;near&#x2F;209899890&quot;&gt;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;131828-t-compiler&#x2F;topic&#x2F;Building.20rustc.20with.20beta.20libstd&#x2F;near&#x2F;209899890&lt;&#x2F;a&gt; for a very (very) long discussion of the tradeoffs here.&lt;&#x2F;p&gt;
&lt;p&gt;There are some more benefits to supporting a single version not discussed there:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Rebasing over master recompiles much less code. Modifying a single line in &lt;code&gt;core&lt;&#x2F;code&gt; no longer requires rebuilding the world; only changes to the compiler require the compiler to be rebuilt.&lt;&#x2F;li&gt;
&lt;li&gt;Modifying the standard library locally don&#x27;t require rebuilding the compiler. This is especially relevant to people who are changing how the standard library interacts with the compiler; we would be able to remove &lt;code&gt;--keep-stage-std 0&lt;&#x2F;code&gt; and all associated footguns as a workflow altogether.&lt;&#x2F;li&gt;
&lt;li&gt;Creating a new Rust release requires touching &lt;em&gt;drastically&lt;&#x2F;em&gt; less &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; since lang items no longer need to be modified, only small parts of the compiler.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I&#x27;ve put together some data on how often using those features before they hit beta happens in
practice, and - at least from 1.61.0 onwards - it appears it &lt;em&gt;never&lt;&#x2F;em&gt; happens. See
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;rust&#x2F;tree&#x2F;versions-used&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;rust&#x2F;tree&#x2F;versions-used&lt;&#x2F;a&gt; for how that data was gathered (run
&lt;code&gt;.&#x2F;collect_new_versions.sh&lt;&#x2F;code&gt;). What&#x27;s more common is renaming a method before it&#x27;s stable; see
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;79805&#x2F;files&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;79805&#x2F;files&lt;&#x2F;a&gt; for an example. The &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; code to
handle this in the compiler should be pretty simple.&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;ve talked to people on both T-libs and T-compiler and they say that removing &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; would be an &lt;em&gt;enormous&lt;&#x2F;em&gt; help. Some testimonials:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;thomcc&quot;&gt;@thomcc&lt;&#x2F;a&gt;: Yes please. It&#x27;s a huge headache. It also frequently comes up as a reason not to let the const-eval team experiment with stuff, since we know &lt;code&gt;~const&lt;&#x2F;code&gt; is likely going away and don&#x27;t want to deal with the &quot;lol we &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt;ed off all of core::iter&quot;.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;fee1-dead&quot;&gt;@fee1-dead&lt;&#x2F;a&gt;: Working on const traits makes the bootstrap issue very apparent because almost all bugs would be found from attempting to use the feature in the standard library. Fixes for those bugs would need to wait six weeks before finally released as the beta compiler, which slows down development and evolution of the feature.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;m-ou-se&quot;&gt;@m-ou-se&lt;&#x2F;a&gt;: Sometimes it gets super messy with all the &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; stuff for things relying on built-in macros or new lang items. Please fix cfg bootstrap hell :D&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;workingjubilee&quot;&gt;@workingjubilee&lt;&#x2F;a&gt;: Using beta stdlib would make it much easier to experiment outside the compiler&#x2F;stdlib proper.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nilstrieb&quot;&gt;@Nilstrieb&lt;&#x2F;a&gt;: I&#x27;d rather have a few cfgs in the compiler when necessary instead of cfgs in std all the time.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h4 id=&quot;but-that-just-moves-the-cfg-bootstrap-to-the-compiler&quot;&gt;&quot;But that just moves the cfg(bootstrap) to the compiler!&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#but-that-just-moves-the-cfg-bootstrap-to-the-compiler&quot; aria-label=&quot;Anchor link for: but-that-just-moves-the-cfg-bootstrap-to-the-compiler&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;A common (incorrect) objection is that, after this change, adding new language items would require adding &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; to the compiler.
This is false. The compiler &lt;em&gt;also&lt;&#x2F;em&gt; only has to support building one version of &lt;code&gt;std&lt;&#x2F;code&gt; after this change. The only time the bootstrap standard library is involved is when &lt;em&gt;building the compiler&lt;&#x2F;em&gt;. Unlike how &lt;code&gt;std&lt;&#x2F;code&gt; is intrinsically tied to the compiler due to lang items, the compiler doesn&#x27;t intrinsically depend on implementation details of the standard library; it only uses them for dogfooding.&lt;&#x2F;p&gt;
&lt;p&gt;(I don&#x27;t want to hear about how &lt;code&gt;lang&lt;&#x2F;code&gt; items are ideologically impure. I don&#x27;t care. It&#x27;s not changing.)&lt;&#x2F;p&gt;
&lt;p&gt;Here is a graph of what the build would like before:&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;component&lt;&#x2F;th&gt;&lt;th&gt;built-by&lt;&#x2F;th&gt;&lt;th&gt;building&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;compiler&lt;&#x2F;td&gt;&lt;td&gt;1 std&lt;&#x2F;td&gt;&lt;td&gt;1 std&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;std&lt;&#x2F;td&gt;&lt;td&gt;2 compilers&lt;&#x2F;td&gt;&lt;td&gt;NA&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;and after:&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;component&lt;&#x2F;th&gt;&lt;th&gt;built-by&lt;&#x2F;th&gt;&lt;th&gt;building&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;compiler&lt;&#x2F;td&gt;&lt;td&gt;2 std&lt;&#x2F;td&gt;&lt;td&gt;1 std&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;std&lt;&#x2F;td&gt;&lt;td&gt;1 compiler&lt;&#x2F;td&gt;&lt;td&gt;NA&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;h3 id=&quot;is-the-stage-terminology-itself-confusing&quot;&gt;Is the &quot;stage&quot; terminology itself confusing?&lt;a class=&quot;zola-anchor&quot; href=&quot;#is-the-stage-terminology-itself-confusing&quot; aria-label=&quot;Anchor link for: is-the-stage-terminology-itself-confusing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;what-do-other-compilers-do-1&quot;&gt;What do other compilers do?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-do-other-compilers-do-1&quot; aria-label=&quot;Anchor link for: what-do-other-compilers-do-1&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;For GHC, &lt;code&gt;build stage1:exe:ghc-bin&lt;&#x2F;code&gt; builds stage1 GHC with the stage0 compiler.&lt;&#x2F;p&gt;
 &lt;!-- https:&#x2F;&#x2F;discourse.llvm.org&#x2F;t&#x2F;how-to-run-individual-phases-of-a-2-or-3-stage-build&#x2F;2596&#x2F;2 --&gt;
&lt;p&gt;For Clang, &lt;code&gt;ninja stage2&lt;&#x2F;code&gt; builds the stage2 clang with the stage1 compiler and &lt;code&gt;ninja clang-bootstrap-deps&lt;&#x2F;code&gt; builds the stage1 clang with the stage0 compiler.&lt;&#x2F;p&gt;
&lt;!-- https:&#x2F;&#x2F;github.com&#x2F;ocaml&#x2F;ocaml&#x2F;blob&#x2F;64ef2d0ce1eb7d5f09ac6cde1a78f74b62804cc6&#x2F;Makefile#L698-L702 --&gt;
&lt;!-- https:&#x2F;&#x2F;github.com&#x2F;ocaml&#x2F;ocaml&#x2F;blob&#x2F;64ef2d0ce1eb7d5f09ac6cde1a78f74b62804cc6&#x2F;Makefile#L833-L841 --&gt;
&lt;p&gt;OCaml uses &lt;code&gt;make coreall&lt;&#x2F;code&gt; to build the stage1 OCaml with the bootstrap compiler and &lt;code&gt;make bootstrap&lt;&#x2F;code&gt; to build a full bootstrap compiler.&lt;&#x2F;p&gt;
&lt;!-- zig is a pain in the ass to build on windows because it needs llvm installed --&gt;
&lt;!-- pypy doesn&#x27;t have stages --&gt;
&lt;!-- swift isn&#x27;t self-hosted https:&#x2F;&#x2F;github.com&#x2F;apple&#x2F;swift&#x2F;blob&#x2F;2c7b0b22831159396fe0e98e5944e64a483c356e&#x2F;www&#x2F;FAQ.rst --&gt;
&lt;!-- http:&#x2F;&#x2F;www.sbcl.org&#x2F;porting.html is unclear and I don&#x27;t feel like building it --&gt;
&lt;h4 id=&quot;what-does-rust-do-1&quot;&gt;What does Rust do?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-does-rust-do-1&quot; aria-label=&quot;Anchor link for: what-does-rust-do-1&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;code&gt;x build --stage 0 rustc&lt;&#x2F;code&gt; builds stage1 rustc with the stage0 compiler.
&lt;code&gt;x build --stage 1 rustc&lt;&#x2F;code&gt; builds stage2 rustc with the stage1 compiler.&lt;&#x2F;p&gt;
&lt;p&gt;This is off-by-one from how &lt;em&gt;every other modern compiler&lt;&#x2F;em&gt; counts stages.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#understanding-stages-of-bootstrap&quot;&gt;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;bootstrapping&#x2F;what-bootstrapping-does.html#understanding-stages-of-bootstrap&lt;&#x2F;a&gt;
spends several paragraphs talking about how &lt;code&gt;build --stage N&lt;&#x2F;code&gt; means &quot;build with stage N&quot;, not &quot;create the
compiler that lives in the stage N sysroot&quot;.  All the people I&#x27;ve talked to who say this
meaning of &lt;code&gt;--stage N&lt;&#x2F;code&gt; is intuitive have been using &lt;code&gt;x.py&lt;&#x2F;code&gt; for several years and are experts in the
system. Nearly all the people I&#x27;ve talked to who find it confusing are either new to the compiler,
or contribute regularly but aren&#x27;t experts in Rust&#x27;s build system - even those who are experienced
in bootstrapping compilers for other languages!&lt;&#x2F;p&gt;
&lt;p&gt;In the words of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nilstrieb&quot;&gt;@Nilstrieb&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;You build a &lt;em&gt;target&lt;&#x2F;em&gt;. The focus is always &lt;em&gt;what&lt;&#x2F;em&gt; you build.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;!-- TODO: talk with manish about how to make this less combative --&gt;
&lt;p&gt;We are not meeting that intuition today with x.py.  It seems unfortunate to have a system that only
makes sense if you&#x27;ve used it for a long time and are accustomed to it. If you&#x27;re using it for
several years, you have time to relearn the system.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;what-can-we-do-instead&quot;&gt;What can we do instead?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-can-we-do-instead&quot; aria-label=&quot;Anchor link for: what-can-we-do-instead&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;I would like to introduce four new flags:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--bootstrap-sysroot&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;--dev-sysroot&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;--dist-sysroot&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;--reproducible-sysroot&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This correspond closely, but not exactly, to &lt;code&gt;--stage 0&#x2F;1&#x2F;2&#x2F;3&lt;&#x2F;code&gt; (respectively).
Here is a conversion guide between the two: &lt;img src=&quot;&#x2F;assets&#x2F;bootstrap-sysroot-conversion.png&quot; alt=&quot;conversion guide (see &#x2F;assets&#x2F;bootstrapping.tex for source)&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;I propose &lt;em&gt;not&lt;&#x2F;em&gt; putting this in the dev-guide, but creating an inside-rust post which we link to in bootstrap&#x27;s changelog.
The idea is for people who&#x27;ve already been using x.py to see the guide, but not people learning the tool for the first time.
We would keep &lt;code&gt;--stage&lt;&#x2F;code&gt; for a time, but eventually deprecate it.&lt;&#x2F;p&gt;
&lt;p&gt;I want to call out a few interesting properties of these flags:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;build --bootstrap-sysroot std&lt;&#x2F;code&gt; makes it more clear how &lt;em&gt;strange&lt;&#x2F;em&gt; it is that &lt;code&gt;std&lt;&#x2F;code&gt; is built before rustc. This isn&#x27;t something people will need to think about if we change &lt;code&gt;std&lt;&#x2F;code&gt; to only need to support one compiler.&lt;&#x2F;li&gt;
&lt;li&gt;The names are self-describing. People don&#x27;t have to wonder whether &lt;code&gt;--stage 1&lt;&#x2F;code&gt; is the flag they want or not; &lt;code&gt;--dev-sysroot&lt;&#x2F;code&gt; makes it clear it is.&lt;&#x2F;li&gt;
&lt;li&gt;The only times &lt;code&gt;--bootstrap-sysroot&lt;&#x2F;code&gt; will be used is for
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;doc&lt;&#x2F;code&gt; &#x2F; &lt;code&gt;clippy&lt;&#x2F;code&gt; (to use the beta tools instead of recompiling, although &lt;code&gt;--dev-sysroot&lt;&#x2F;code&gt; will still be supported). Given that &lt;code&gt;download-rustc&lt;&#x2F;code&gt; will be a blessed workflow, we may want to drop support for this in the future.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;build expand-yaml-anchors&lt;&#x2F;code&gt; (or other bootstrap tools); &lt;em&gt;not&lt;&#x2F;em&gt; the standard library or compiler.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;check&lt;&#x2F;code&gt; will only ever support one stage (&lt;code&gt;--dev-sysroot&lt;&#x2F;code&gt; for the compiler and std; &lt;code&gt;--bootstrap-sysroot&lt;&#x2F;code&gt; for bootstrap tools)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;test --dev-sysroot ui&lt;&#x2F;code&gt; now matches the sysroot of &lt;code&gt;build compiler&lt;&#x2F;code&gt; (!). I am planning to make &lt;code&gt;test rustc_data_structures --dev-sysroot&lt;&#x2F;code&gt; compile &lt;code&gt;rustc_data_strucutres&lt;&#x2F;code&gt; (like &lt;code&gt;--stage 0&lt;&#x2F;code&gt; today) for consistency, and so that we are always testing the compiler &lt;em&gt;that will end up&lt;&#x2F;em&gt; in the given sysroot.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;build --dev-sysroot rustdoc&lt;&#x2F;code&gt; now matches the sysroot of &lt;code&gt;build --dev-sysroot compiler&lt;&#x2F;code&gt; (!). Hopefully we can also do this for clippy and miri.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;To make the new flags easier to learn, we can name the sysroots directories after the flags: &lt;code&gt;build&#x2F;host&#x2F;{bootstrap,dev,dist}-sysroot&lt;&#x2F;code&gt;.
I have not yet decided if we should introduce a &lt;code&gt;reproducible-sysroot&lt;&#x2F;code&gt; or not; see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;90244#issuecomment-1120649548&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;90244#issuecomment-1120649548&lt;&#x2F;a&gt; for some of the difficulties involved.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;misc-breaking-changes&quot;&gt;&quot;Misc breaking changes&quot;&lt;a class=&quot;zola-anchor&quot; href=&quot;#misc-breaking-changes&quot; aria-label=&quot;Anchor link for: misc-breaking-changes&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Skimmed over in the previous sections is how to get people to use &lt;code&gt;download-rustc&lt;&#x2F;code&gt;.
If we enable it unconditionally for everyone, distros will get very upset.
If we don&#x27;t enable it, people working on the standard library will have horrifically long compile times.&lt;&#x2F;p&gt;
&lt;p&gt;To avoid this, we could &lt;em&gt;require&lt;&#x2F;em&gt; people to set a profile for &lt;code&gt;config.toml&lt;&#x2F;code&gt;. To avoid making distros
hate us too much, &lt;code&gt;.&#x2F;configure&lt;&#x2F;code&gt; would set the &lt;code&gt;user&lt;&#x2F;code&gt; profile; running &lt;code&gt;.&#x2F;x.py build&lt;&#x2F;code&gt; without
creating a profile would give a hard error pointing you to &lt;code&gt;x.py setup&lt;&#x2F;code&gt;. We would still treat an
empty config.toml as opting-in to no profile.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;summary-of-future-work&quot;&gt;Summary of future work&lt;a class=&quot;zola-anchor&quot; href=&quot;#summary-of-future-work&quot; aria-label=&quot;Anchor link for: summary-of-future-work&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Here are all the proposed changes in this post, gathered in one place:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Change &lt;code&gt;.&#x2F;configure&lt;&#x2F;code&gt; to set &lt;code&gt;profile = &quot;user&quot;&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Make &lt;code&gt;profile&lt;&#x2F;code&gt; required in config.toml.&lt;&#x2F;li&gt;
&lt;li&gt;Fix the existing bugs in &lt;code&gt;download-rustc&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Enable &lt;code&gt;download-rustc = &quot;if-unchanged&quot;&lt;&#x2F;code&gt; by default for the &lt;code&gt;library&lt;&#x2F;code&gt; profile.&lt;&#x2F;li&gt;
&lt;li&gt;Get rid of &lt;code&gt;build --stage 0 std&lt;&#x2F;code&gt;. The compiler will be unconditionally built with beta std, not nightly std.
&lt;ul&gt;
&lt;li&gt;Get rid of &lt;code&gt;stage0-sysroot&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Make sure &lt;code&gt;download-rustc&lt;&#x2F;code&gt; doesn&#x27;t build the compiler from source if there are only library changes; this needs to be careful to still rebuild stage 2 rustc if there are library changes.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Rename &lt;code&gt;build&#x2F;host&#x2F;stage{0,1,2}&lt;&#x2F;code&gt; to &lt;code&gt;build&#x2F;host&#x2F;{bootstrap,dev,dist}-sysroot&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Add &lt;code&gt;--{bootstrap,dev,dist}-sysroot&lt;&#x2F;code&gt; flags.
&lt;ul&gt;
&lt;li&gt;When doing this, clippy and miri will start using the same flags as rustdoc. See &lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;326414-t-infra.2Fbootstrap&#x2F;topic&#x2F;Stage.20numbering.20for.20tools&#x2F;near&#x2F;298189698&quot;&gt;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;326414-t-infra.2Fbootstrap&#x2F;topic&#x2F;Stage.20numbering.20for.20tools&#x2F;near&#x2F;298189698&lt;&#x2F;a&gt; for how tool flags are numbered today; after this change, both &lt;code&gt;build --dev-sysroot rustdoc&lt;&#x2F;code&gt; and &lt;code&gt;build --dev-sysroot clippy&lt;&#x2F;code&gt; will build rustc once, as a library.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;That&#x27;s a lot of breaking changes and a lot of work, for things we are not sure will make the user
experience easier.  To avoid multiple breaking changes in short succession, I propose making all the
changes at once, and inviting people to try out the changes from a branch before merging them. If we
have trouble getting user feedback, I could create a standalone binary which uses the new
&lt;code&gt;*-sysroot&lt;&#x2F;code&gt; flags even on the master branch. Note that this will not be possible for the changes
removing &lt;code&gt;cfg(bootstrap)&lt;&#x2F;code&gt; from std, since that requires changes outside of bootstrap.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;questions-concerns-hate-mail&quot;&gt;Questions? Concerns? Hate mail?&lt;a class=&quot;zola-anchor&quot; href=&quot;#questions-concerns-hate-mail&quot; aria-label=&quot;Anchor link for: questions-concerns-hate-mail&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Feel free to contact me (&lt;code&gt;@jyn&lt;&#x2F;code&gt;) in &lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;326414-t-infra.2Fbootstrap&quot;&gt;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;326414-t-infra.2Fbootstrap&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Git cheats</title>
        <published>2022-09-02T00:00:00+00:00</published>
        <updated>2022-09-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/git-cheats/"/>
        <id>https://jyn.dev/git-cheats/</id>
        
        <summary type="html">tips and tricks for dealing with git&#x27;s horrible error messages</summary>
        
        <content type="html" xml:base="https://jyn.dev/git-cheats/">&lt;p&gt;A small note: this will be much less organized and thought out than my other blog posts because I have been unable to convince myself to write a blog in about 2 years. Instead these are some notes to myself that happen to be public for anyone who finds them useful.&lt;&#x2F;p&gt;
&lt;p&gt;A small note written after spending 5 minutes on this post: holy shit this is so deranged I&#x27;m turning into Gankra lmao&lt;&#x2F;p&gt;
&lt;h1 id=&quot;git&quot;&gt;Git&lt;a class=&quot;zola-anchor&quot; href=&quot;#git&quot; aria-label=&quot;Anchor link for: git&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;big fan of the data model.
not a fan of the UI.&lt;&#x2F;p&gt;
&lt;p&gt;Ok so before anything else, don&#x27;t panic. Your code is probably still there somewhere you just can&#x27;t find it. If you &lt;em&gt;stop running commands&lt;&#x2F;em&gt; right now, you can probably get it back.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;i-had-a-commit-and-then-i-checked-out-a-different-branch-and-now-i-can-t-find-the-commit-again-sob&quot;&gt;I had a commit and then I checked out a different branch and now I can&#x27;t find the commit again 😭&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-had-a-commit-and-then-i-checked-out-a-different-branch-and-now-i-can-t-find-the-commit-again-sob&quot; aria-label=&quot;Anchor link for: i-had-a-commit-and-then-i-checked-out-a-different-branch-and-now-i-can-t-find-the-commit-again-sob&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Run &lt;code&gt;git reflog&lt;&#x2F;code&gt;, it shows you all the recent commits you were on.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;someone-told-me-to-rebase-and-i-did-that-but-now-git-says-failed-to-push-some-refs-why-is-this-happening&quot;&gt;someone told me to rebase and I did that but now git says &quot;failed to push some refs&quot;??? why is this happening&lt;a class=&quot;zola-anchor&quot; href=&quot;#someone-told-me-to-rebase-and-i-did-that-but-now-git-says-failed-to-push-some-refs-why-is-this-happening&quot; aria-label=&quot;Anchor link for: someone-told-me-to-rebase-and-i-did-that-but-now-git-says-failed-to-push-some-refs-why-is-this-happening&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The error probably looks like this:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ git push
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;To github.com:jyn514&#x2F;rust.git
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; ! [rejected]                simplify-storage -&amp;gt; simplify-storage (non-fast-forward)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: failed to push some refs to &amp;#39;git@github.com:jyn514&#x2F;rust.git&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: Updates were rejected because the tip of your current branch is behind
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: its remote counterpart. Integrate the remote changes (e.g.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: &amp;#39;git pull ...&amp;#39;) before pushing again.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: See the &amp;#39;Note about fast-forwards&amp;#39; in &amp;#39;git push --help&amp;#39; for details.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This is totally normal. Git just gives absolutely awful error messages. Run &lt;code&gt;git push --force-with-lease&lt;&#x2F;code&gt; and it should work fine.&lt;&#x2F;p&gt;
&lt;p&gt;Be careful using &lt;code&gt;--force&lt;&#x2F;code&gt;. 99% of the time it works. The other 1% someone else pushed to your branch and you just deleted their work. They will not be happy.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;wait-but-i-ran-git-pull-before-i-looked-at-your-blog-now-what-do-i-do&quot;&gt;wait but I ran git pull before I looked at your blog now what do I do???&lt;a class=&quot;zola-anchor&quot; href=&quot;#wait-but-i-ran-git-pull-before-i-looked-at-your-blog-now-what-do-i-do&quot; aria-label=&quot;Anchor link for: wait-but-i-ran-git-pull-before-i-looked-at-your-blog-now-what-do-i-do&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Your latest commit probably looks like this:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;commit 88fdea3dd2e876a92960601c019e729401e832ab (HEAD -&amp;gt; simplify-storage)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Merge: d6bd3ef8662 6b22a42e011
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Author: jyn &amp;lt;github@jyn.dev&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Date:   Fri Sep 2 19:24:33 2022 -0500
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    Merge github.com:jyn514&#x2F;rust into simplify-storage
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Get rid of it. We don&#x27;t want it. If you have changes since the latest commit, save them somewhere (e.g. &lt;code&gt;git stash&lt;&#x2F;code&gt;).
Then run &lt;code&gt;git reset --hard HEAD~&lt;&#x2F;code&gt;. Now go to the step above about &lt;code&gt;--force-with-lease&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;i-have-a-detached-head&quot;&gt;I have a detached HEAD&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-have-a-detached-head&quot; aria-label=&quot;Anchor link for: i-have-a-detached-head&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;wtf-does-that-mean&quot;&gt;WTF does that mean&lt;a class=&quot;zola-anchor&quot; href=&quot;#wtf-does-that-mean&quot; aria-label=&quot;Anchor link for: wtf-does-that-mean&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;You have turned into the Nick the Headless Horseman. Have fun trying to join the Headless Hunt.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;no-stop-i-came-here-for-help&quot;&gt;No stop I came here for help&lt;a class=&quot;zola-anchor&quot; href=&quot;#no-stop-i-came-here-for-help&quot; aria-label=&quot;Anchor link for: no-stop-i-came-here-for-help&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Git doesn&#x27;t think you&#x27;re on a branch or tag.&lt;&#x2F;p&gt;
&lt;p&gt;This is &lt;em&gt;not&lt;&#x2F;em&gt; the same as being on a commit that&#x27;s not in any branch or tag. It&#x27;s perfectly possible
to be on the same commit as the latest &lt;code&gt;main&lt;&#x2F;code&gt; and still have a detached HEAD. It just means that
any new commit you make in this state won&#x27;t be on a branch.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;how-does-this-help-me-i-don-t-understand&quot;&gt;How does this help me I don&#x27;t understand&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-does-this-help-me-i-don-t-understand&quot; aria-label=&quot;Anchor link for: how-does-this-help-me-i-don-t-understand&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Everything is fine. All your work is still here. You just need to figure out what you want to do next.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;i-don-t-care-about-any-of-the-work-i-ve-done-in-the-last-day-i-just-want-a-git-repo-that-works-i-will-wipe-this-directory-if-you-don-t-help&quot;&gt;I don&#x27;t care about any of the work I&#x27;ve done in the last day I just want a git repo that works I will wipe this directory if you don&#x27;t help&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-don-t-care-about-any-of-the-work-i-ve-done-in-the-last-day-i-just-want-a-git-repo-that-works-i-will-wipe-this-directory-if-you-don-t-help&quot; aria-label=&quot;Anchor link for: i-don-t-care-about-any-of-the-work-i-ve-done-in-the-last-day-i-just-want-a-git-repo-that-works-i-will-wipe-this-directory-if-you-don-t-help&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;strong&gt;DO NOT DO THIS IF YOU HAVE WORK YOU WANT TO SAVE!!!&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Run &lt;code&gt;git checkout --force $(git rev-parse --abbrev-ref origin&#x2F;HEAD)&lt;&#x2F;code&gt;. If that gives an error for any reason try &lt;code&gt;git checkout --force origin&#x2F;master &lt;&#x2F;code&gt;or &lt;code&gt;origin&#x2F;main&lt;&#x2F;code&gt; instead. If none of those work IDK what to tell you maybe wiping the repo is the best idea after all. Good luck.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;i-have-work-i-want-to-save-please-help-me-fix-this-i-have-a-deadline-in-an-hour&quot;&gt;I have work I want to save please help me fix this I have a deadline in an hour&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-have-work-i-want-to-save-please-help-me-fix-this-i-have-a-deadline-in-an-hour&quot; aria-label=&quot;Anchor link for: i-have-work-i-want-to-save-please-help-me-fix-this-i-have-a-deadline-in-an-hour&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h4&gt;
&lt;p&gt;Ok. Pick which branch you want to put your work on. I&#x27;m going to pick &lt;code&gt;bark&lt;&#x2F;code&gt; because branches have bark. haha&lt;&#x2F;p&gt;
&lt;p&gt;Does the commit you&#x27;re on have the work you want to save?&lt;&#x2F;p&gt;
&lt;h5 id=&quot;yes-how-do-i-get-it-to-work&quot;&gt;yes how do I get it to work&lt;a class=&quot;zola-anchor&quot; href=&quot;#yes-how-do-i-get-it-to-work&quot; aria-label=&quot;Anchor link for: yes-how-do-i-get-it-to-work&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h5&gt;
&lt;p&gt;Run &lt;code&gt;git branch --delete bark &amp;amp;&amp;amp; git checkout --branch bark&lt;&#x2F;code&gt;. This is the least invasive way to fix things;
whatever untracked code is in your working directory won&#x27;t be modified, and the old branch will still be in your reflog if you really need it. If you don&#x27;t know what that means, that&#x27;s ok, you&#x27;re on the right branch now and you can push it wherever you need.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;no-please-i-don-t-know-how-i-got-into-this-state-i-really-hate-git-right-now&quot;&gt;no please I don&#x27;t know how I got into this state I really hate git right now&lt;a class=&quot;zola-anchor&quot; href=&quot;#no-please-i-don-t-know-how-i-got-into-this-state-i-really-hate-git-right-now&quot; aria-label=&quot;Anchor link for: no-please-i-don-t-know-how-i-got-into-this-state-i-really-hate-git-right-now&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h5&gt;
&lt;p&gt;Figure out which commit has the work you want to save. Then run &lt;code&gt;git checkout &amp;lt;that commit&amp;gt;&lt;&#x2F;code&gt; and then follow the steps about branches immediately above.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;git-tells-me-something-about-would-overwrite-untracked-files-idk-what-that-means-i-just-want-to-pull-the-latest-branch&quot;&gt;Git tells me something about &quot;would overwrite untracked files&quot;? idk what that means I just want to pull the latest branch&lt;a class=&quot;zola-anchor&quot; href=&quot;#git-tells-me-something-about-would-overwrite-untracked-files-idk-what-that-means-i-just-want-to-pull-the-latest-branch&quot; aria-label=&quot;Anchor link for: git-tells-me-something-about-would-overwrite-untracked-files-idk-what-that-means-i-just-want-to-pull-the-latest-branch&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I&#x27;m going to assume the error looks something like this:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: The following untracked working tree files would be overwritten by reset:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        src&#x2F;tools&#x2F;rls&#x2F;Cargo.toml
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        src&#x2F;tools&#x2F;rls&#x2F;README.md
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Please move or remove them before you reset.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Aborting
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;fatal: could not move back to 9ba169a73acfa9c9875b76eec09e9a91cc6246df
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There are three things I can think of that could be going wrong here:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;You made some changes and didn&#x27;t commit them. Commit them now. Go. Do it. &lt;code&gt;git add src&#x2F;tools&#x2F;rls &amp;amp;&amp;amp; git commit&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;This is in a submodule and git got confused. If you don&#x27;t know what a submodule is, mentally replace it with &quot;code I have never modified and will never want to modify&quot;. You can ignore this by running &lt;code&gt;git submodule deinit -f src&#x2F;tools&#x2F;rls&lt;&#x2F;code&gt; (or whichever directory the submodule starts in - you can check with &lt;code&gt;git submodule status&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;DO NOT DO THIS&lt;&#x2F;strong&gt; if you have made changes to that directory you want to save. Git will destroy all you hold dear. It is a sharp and powerful tool. You might call it ... a subtle knife.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;This used to be a submodule and it&#x27;s no longer a submodule. You tried the &lt;code&gt;deinit&lt;&#x2F;code&gt; thing above and it didn&#x27;t help. Try &lt;code&gt;rm -rf src&#x2F;tools&#x2F;rls&lt;&#x2F;code&gt;. This does exactly what it looks like, don&#x27;t do it if you want to save your work.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;If none of those fix it, glhf sucks to be you&lt;&#x2F;p&gt;
&lt;h2 id=&quot;i-m-in-rust-lang-rust-and-cargo-lock-keeps-showing-modifications-but-i-definitely-didn-t-touch-anything&quot;&gt;I&#x27;m in rust-lang&#x2F;rust and Cargo.lock keeps showing modifications but I definitely didn&#x27;t touch anything ???&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-m-in-rust-lang-rust-and-cargo-lock-keeps-showing-modifications-but-i-definitely-didn-t-touch-anything&quot; aria-label=&quot;Anchor link for: i-m-in-rust-lang-rust-and-cargo-lock-keeps-showing-modifications-but-i-definitely-didn-t-touch-anything&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;yes this is a very specific problem. no I&#x27;m not going to take it out of the blog.&lt;&#x2F;p&gt;
&lt;p&gt;This happens because your submodules are out of date. Run &lt;code&gt;.&#x2F;x.py --help&lt;&#x2F;code&gt;, which updates submodules for you.
Under the hood this is running the equivalent of &lt;code&gt;git submodule update --init --recursive&lt;&#x2F;code&gt; which makes sure all the rust tool submodules are up to date.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;that-didn-t-help&quot;&gt;that didn&#x27;t help.&lt;a class=&quot;zola-anchor&quot; href=&quot;#that-didn-t-help&quot; aria-label=&quot;Anchor link for: that-didn-t-help&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;sucks to be you&lt;&#x2F;p&gt;
&lt;h2 id=&quot;i-made-a-commit-and-then-i-realized-i-want-to-make-more-changes-but-also-people-getting-annoyed-when-i-add-lots-of-commits-what-do-i-do&quot;&gt;I made a commit and then I realized I want to make more changes but also people getting annoyed when I add lots of commits what do I do&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-made-a-commit-and-then-i-realized-i-want-to-make-more-changes-but-also-people-getting-annoyed-when-i-add-lots-of-commits-what-do-i-do&quot; aria-label=&quot;Anchor link for: i-made-a-commit-and-then-i-realized-i-want-to-make-more-changes-but-also-people-getting-annoyed-when-i-add-lots-of-commits-what-do-i-do&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;First make your changes. Then run &lt;code&gt;git add .&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If you want to change the latest commit you made, run &lt;code&gt;git commit --amend&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;If you want to change an earlier commit, run &lt;code&gt;git commit --fixup &amp;lt;earlier commit&amp;gt; &amp;amp;&amp;amp; git rebase -i --autosquash &amp;lt;earlier commit&amp;gt;~&lt;&#x2F;code&gt;. Type the &lt;code&gt;~&lt;&#x2F;code&gt; literally but remove the &lt;code&gt;&amp;lt;&amp;gt;&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;If you don&#x27;t know which commit you want to change, but you know it&#x27;s a commit you made since you made this branch, install
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tummychow&#x2F;git-absorb&#x2F;&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;tummychow&#x2F;git-absorb&#x2F;&lt;&#x2F;a&gt; then run the &lt;code&gt;autosquash&lt;&#x2F;code&gt; command from above. Absorb does magic to pick the right commits.&lt;&#x2F;p&gt;
&lt;p&gt;If you want to change a commit that&#x27;s already on master, don&#x27;t. Just don&#x27;t.
If you&#x27;re &lt;em&gt;really&lt;&#x2F;em&gt;, &lt;em&gt;truly&lt;&#x2F;em&gt; convinced you need to, and you&#x27;re &lt;em&gt;sure&lt;&#x2F;em&gt; no one else minds (which in practice is probably never true), you can use &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;newren&#x2F;git-filter-repo&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;newren&#x2F;git-filter-repo&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;i-made-a-merge-commit-but-now-someone-is-telling-me-merge-commits-aren-t-allowed-how-do-i-fix-this-please-i-already-spent-3-hours-on-this-i-don-t-want-to-spend-3-more&quot;&gt;I made a merge commit but now someone is telling me merge commits aren&#x27;t allowed how do I fix this?? please I already spent 3 hours on this I don&#x27;t want to spend 3 more&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-made-a-merge-commit-but-now-someone-is-telling-me-merge-commits-aren-t-allowed-how-do-i-fix-this-please-i-already-spent-3-hours-on-this-i-don-t-want-to-spend-3-more&quot; aria-label=&quot;Anchor link for: i-made-a-merge-commit-but-now-someone-is-telling-me-merge-commits-aren-t-allowed-how-do-i-fix-this-please-i-already-spent-3-hours-on-this-i-don-t-want-to-spend-3-more&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Run &lt;code&gt;git rebase -i $(git rev-parse --abbrev-ref origin&#x2F;HEAD)&lt;&#x2F;code&gt; (or whatever your default branch is). Then go up to the bit about &quot;failed to push some refs&quot; above.&lt;&#x2F;p&gt;
&lt;p&gt;Yes this will probably cause conflicts. No I don&#x27;t know how to avoid that, probably some nonsense with &lt;code&gt;git reset $(git merge-base $(git rev-parse --abbrev-ref origin&#x2F;HEAD)) &amp;amp;&amp;amp; git add . &amp;amp;&amp;amp; git commit&lt;&#x2F;code&gt; or whatever. Don&#x27;t blame me if that doesn&#x27;t work, I didn&#x27;t test it. Also it throws away all the history, you keep the work but not the commit messages, you have to fish them up again with &lt;code&gt;git reflog&lt;&#x2F;code&gt; or &lt;code&gt;git for-each-ref --sort=committerdate refs&#x2F;heads&#x2F; | tail -n1 | cut -d&#x27; &#x27; -f1 | xargs git log&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;aaa&quot;&gt;AAA&lt;a class=&quot;zola-anchor&quot; href=&quot;#aaa&quot; aria-label=&quot;Anchor link for: aaa&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;yeah no that&#x27;s it have fun kid&lt;&#x2F;p&gt;
&lt;p&gt;ok no actually one more thing —&lt;&#x2F;p&gt;
&lt;p&gt;can I talk for a second about how absolutely &lt;em&gt;awful&lt;&#x2F;em&gt; every error message I&#x27;ve quoted here is. they are so bad I don&#x27;t even refer to them when explaining what went wrong.
half the time they point you to completely the wrong solution; the other half they give no indication at all of why something went wrong.&lt;&#x2F;p&gt;
&lt;p&gt;this is not how it should be. things can be better. here is an error message for the &quot;push after rebase&quot; that is actually useful:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ git push
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;To git@github.com:jyn514&#x2F;rust.git (simplify-storage -&amp;gt; origin&#x2F;simplify-storage)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: failed to push 1 commit to &amp;#39;origin&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: Both your current branch and the remote branch have changed since the last time you pushed changes.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: The commits locally and in your remote have the same descriptions, and you just finished a rebase.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;hint: If you want to overwrite the commits on the remote, use &amp;#39;git push --force-with-lease&amp;#39; to push.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;note: See https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Branching-Rebasing for more information about rebasing.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;See how that&#x27;s helpful? see how you understand more after reading it than before? unlike the absolutely useless error before&lt;&#x2F;p&gt;
&lt;p&gt;god ok that&#x27;s it for real I&#x27;m done now&lt;&#x2F;p&gt;
&lt;h3 id=&quot;update-now-that-this-is-apparently-popular&quot;&gt;update now that this is apparently popular&lt;a class=&quot;zola-anchor&quot; href=&quot;#update-now-that-this-is-apparently-popular&quot; aria-label=&quot;Anchor link for: update-now-that-this-is-apparently-popular&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;go read https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;git.html too, it&#x27;s the most comprehensive document on rebase workflows that I&#x27;ve seen. no the official docs don&#x27;t count, if you don&#x27;t explain the common errors you run into it&#x27;s not comprehensive. also the manpages are useless unless you already know what the command does in which case WHAT WAS THE POINT OF THE MAN PAGE&lt;&#x2F;p&gt;
&lt;p&gt;also go read my twitter where you can read more nonsense like me complaining about how I can&#x27;t convince myself to go to sleep &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;jynelson514&#x2F;&quot;&gt;https:&#x2F;&#x2F;twitter.com&#x2F;jynelson514&#x2F;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>bootstrapping: the once and future compiler</title>
        <published>2022-08-05T00:00:00+00:00</published>
        <updated>2022-08-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/talks/bootstrapping/"/>
        <id>https://jyn.dev/talks/bootstrapping/</id>
        
        <content type="html" xml:base="https://jyn.dev/talks/bootstrapping/"></content>
    </entry><entry xml:lang="en">
        <title>async() => { await }</title>
        <published>2022-02-09T00:00:00+00:00</published>
        <updated>2022-02-09T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/talks/async-await/"/>
        <id>https://jyn.dev/talks/async-await/</id>
        
        <content type="html" xml:base="https://jyn.dev/talks/async-await/"></content>
    </entry><entry xml:lang="en">
        <title>I'll Rust With You: the song</title>
        <published>2021-09-10T00:00:00+00:00</published>
        <updated>2021-09-10T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/i-ll-rust-with-you-the-song/"/>
        <id>https://jyn.dev/i-ll-rust-with-you-the-song/</id>
        
        <content type="html" xml:base="https://jyn.dev/i-ll-rust-with-you-the-song/">&lt;h1 id=&quot;i-ll-rust-with-you-the-song&quot;&gt;I&#x27;ll Rust With You: the song&lt;a class=&quot;zola-anchor&quot; href=&quot;#i-ll-rust-with-you-the-song&quot; aria-label=&quot;Anchor link for: i-ll-rust-with-you-the-song&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;Niko Matsakis, co-lead for the Rust language team, recently published a song titled &lt;a href=&quot;https:&#x2F;&#x2F;smallcultfollowing.com&#x2F;babysteps&#x2F;blog&#x2F;2021&#x2F;05&#x2F;26&#x2F;edition-the-song&#x2F;&quot;&gt;&quot;Edition: the
song&quot;&lt;&#x2F;a&gt;. I decided I was not to be outdone and sang a cover of &quot;I&#x27;ll Rust With You&quot;, by
&lt;a href=&quot;https:&#x2F;&#x2F;steampoweredgiraffe.com&#x2F;&quot;&gt;Steam Powered Giraffe&lt;&#x2F;a&gt;. The song has absolutely no relation to the Rust language other than
the title, I just think it&#x27;s fun.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;video&quot;&gt;Video&lt;a class=&quot;zola-anchor&quot; href=&quot;#video&quot; aria-label=&quot;Anchor link for: video&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;chqv-MY1PGQ&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;&#x2F;iframe&gt;
</content>
    </entry><entry xml:lang="en">
        <title>borrow-checker FAQs</title>
        <published>2021-03-20T00:00:00+00:00</published>
        <updated>2021-03-20T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/borrow-checker-faqs/"/>
        <id>https://jyn.dev/borrow-checker-faqs/</id>
        
        <summary type="html">tips and tricks for dealing with the borrow-checker</summary>
        
        <content type="html" xml:base="https://jyn.dev/borrow-checker-faqs/">&lt;p&gt;I got lots of positive feedback about &lt;a href=&quot;https:&#x2F;&#x2F;jyn514.github.io&#x2F;2020&#x2F;09&#x2F;05&#x2F;Rust-in-2021.html#faq&quot;&gt;the FAQ
section&lt;&#x2F;a&gt; in my Rust 2020 blog post, so
I&#x27;m trying that format again for another topic that&#x27;s been requested a lot: How to fix common
borrow-checker issues. This isn&#x27;t meant to explain how or why the borrow checker works the way it
does (see &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nomicon&#x2F;lifetimes.html&quot;&gt;The Nomicon&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;matklad.github.io&#x2F;2020&#x2F;07&#x2F;15&#x2F;two-beautiful-programs.html&quot;&gt;Two Beautiful Rust
Programs&lt;&#x2F;a&gt; for that), just how
to work around some of its current limitations.&lt;&#x2F;p&gt;
&lt;p&gt;In a small break from the format, the &#x27;questions&#x27; will instead be Rust code and the accompanying
compiler error. I make no pretense that the code is doing useful work, it&#x27;s just meant to give
examples of errors.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;faq&quot;&gt;FAQ&lt;a class=&quot;zola-anchor&quot; href=&quot;#faq&quot; aria-label=&quot;Anchor link for: faq&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;blockquote&gt;
&lt;p&gt;How do I modify elements in a collection while also modifying the collection?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=90cf38acb25060d159d46933ba3a0608&quot;&gt;Playground&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; queue &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; elem &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; queue&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;iter_mut&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;*&lt;&#x2F;span&gt;elem &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    queue&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;push&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;*&lt;&#x2F;span&gt;elem &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0499]: cannot borrow `queue` as mutable more than once at a time
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; --&amp;gt; src&#x2F;main.rs:5:9
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;3 |     for elem in queue.iter_mut() {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |                 ----------------
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |                 |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |                 first mutable borrow occurs here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |                 first borrow later used here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;4 |         *elem += 2;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;5 |         queue.push(*elem + 1);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  |         ^^^^^ second mutable borrow occurs here
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This happens because for-loops borrow the iterator for the &lt;em&gt;whole&lt;&#x2F;em&gt; loop, not just for a single
iteration. You can work around it by using &lt;code&gt;while let&lt;&#x2F;code&gt; instead:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; queue &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;while&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; elem&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; queue&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;pop&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    elem &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    queue&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;push&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;elem &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note that this has a behavior change: unlike the previous loop, this removes the element from the
queue before modifying it. You can get the behavior from before back by adding &lt;code&gt;queue.insert(0, elem)&lt;&#x2F;code&gt; (although at that point you may want to use a
&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;std&#x2F;collections&#x2F;struct.VecDeque.html&quot;&gt;&lt;code&gt;VecDeque&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;I have disjoint fields in a struct, but because I use one in a closure, I can&#x27;t use the other.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;S&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;elems&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    elems&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    metadata&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;thread&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;spawn&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; x&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0382]: borrow of moved value: `s`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  --&amp;gt; src&#x2F;main.rs:18:16
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;8  | let s = S {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |     - move occurs because `s` has type `S`, which does not implement the `Copy` trait
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;12 | std::thread::spawn(|| {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |                    -- value moved into closure here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;13 |     for x in s.elems {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |              ------- variable moved due to use in closure
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;18 | println!(&amp;quot;{}&amp;quot;, s.metadata);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |                ^^^^^^^^^^ value borrowed here after move
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This happens because the closure captures the whole &lt;code&gt;s&lt;&#x2F;code&gt; struct, not just the fields it needs.
You can explicitly say which fields to capture by adding a &lt;code&gt;let&lt;&#x2F;code&gt; statement:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; elems &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;thread&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;spawn&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; elems &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; x&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This is done automatically for you with &lt;code&gt;#![feature(capture_disjoint_fields)]&lt;&#x2F;code&gt;, which will
hopefully be &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;project-rfc-2229&#x2F;milestones&quot;&gt;enabled by default&lt;&#x2F;a&gt; in the 2021 edition.&lt;&#x2F;p&gt;
&lt;p&gt;Similar issues happen for structs that aren&#x27;t &lt;code&gt;Send&lt;&#x2F;code&gt; or &lt;code&gt;Sync&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;cell&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;RefCell&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;S&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;elems&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;RefCell&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    elems&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    metadata&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;RefCell&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;new&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;thread&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;spawn&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; x&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;borrow&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0277]: `RefCell&amp;lt;i32&amp;gt;` cannot be shared between threads safely
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   --&amp;gt; src&#x2F;main.rs:16:1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;16  | std::thread::spawn(|| {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    | ^^^^^^^^^^^^^^^^^^ `RefCell&amp;lt;i32&amp;gt;` cannot be shared between threads safely
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    = help: within `S`, the trait `Sync` is not implemented for `RefCell&amp;lt;i32&amp;gt;`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    = note: required because it appears within the type `S`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    = note: required because of the requirements on the impl of `Send` for `&amp;amp;S`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    = note: required because it appears within the type `[closure@src&#x2F;main.rs:16:20: 20:2]`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: aborting due to previous error
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If you only need a few of the fields, you can add explicit &lt;code&gt;let&lt;&#x2F;code&gt; statements in the same way.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; elems &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;std&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-path z-rust&quot;&gt;thread&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;spawn&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; elems &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; x&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-support z-macro z-rust&quot;&gt;println!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-placeholder z-rust&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;borrow&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;blockquote&gt;
&lt;p&gt;Moving a line of code into a separate function makes it fail to compile.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;There are actually quite a few things that will cause this. The most common are:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;The compiler can no longer tell you&#x27;re using disjoint fields.&lt;&#x2F;li&gt;
&lt;li&gt;You wrote the wrong lifetimes (or the elided lifetimes are wrong).&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;An example of 1 (&lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=2f84148a276b0c8595a8023363f2f6a7&quot;&gt;Playground&lt;&#x2F;a&gt;):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;S&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;elems&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-impl z-rust&quot;&gt;impl&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-impl z-rust&quot;&gt;S&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;set_metadata&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;self&lt;&#x2F;span&gt;, &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;val&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-variable z-language z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; val&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    elems&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    metadata&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; _elems &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; moves out of `elems`
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; works fine
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;set_metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; breaks because `elems` is moved
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0382]: borrow of partially moved value: `s`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  --&amp;gt; src&#x2F;main.rs:22:1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;20 | let elems = s.elems; &#x2F;&#x2F; moves out of `elems`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |             ------- value partially moved here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;21 | s.metadata = 1; &#x2F;&#x2F; works fine
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;22 | s.set_metadata(1); &#x2F;&#x2F; breaks because `elems` is moved
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   | ^ value borrowed here after partial move
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   = note: partial move occurs because `s.elems` has type `Vec&amp;lt;i32&amp;gt;`, which does not implement the `Copy` trait
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There is no simple fix for this; this is the main reason getters and setters are discouraged in
Rust. You can either manually inline the code, or change your struct so that the relevant parts
use composition instead of all being in the same struct:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;S&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;elems&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; Inner,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;Inner&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-impl z-rust&quot;&gt;impl&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-impl z-rust&quot;&gt;Inner&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;set_metadata&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;self&lt;&#x2F;span&gt;, &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;val&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-rust&quot;&gt;self&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; Inner&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;val&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    elems&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    metadata&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; Inner&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; _elems &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; moves out of `elems`
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; Inner&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; works fine
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;set_metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; works fine
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;An example of 2 (&lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=99a4597a50b4c7915325ef1caa287040&quot;&gt;Playground&lt;&#x2F;a&gt;):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;S&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-impl z-rust&quot;&gt;impl&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-impl z-rust&quot;&gt;S&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&amp;#39;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;inner&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-variable z-language z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; _p &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;x&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; _q &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;x&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;inner&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; error: does not live long enough
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This one is tricky to spot: the issue isn&#x27;t the code you wrote, but rather the code you &lt;em&gt;didn&#x27;t&lt;&#x2F;em&gt; write.
If you desugar &lt;code&gt;inner()&lt;&#x2F;code&gt;, it would be something like&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;inner&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;s&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;s&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;s&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-language z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;But this is unnecessarily restrictive - &lt;code&gt;self.0&lt;&#x2F;code&gt; lives longer than &lt;code&gt;self&lt;&#x2F;code&gt;. The fix is to write the lifetime yourself:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-impl z-rust&quot;&gt;impl&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt; &lt;span class=&quot;z-entity z-name z-impl z-rust&quot;&gt;S&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;inner&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;        &lt;span class=&quot;z-variable z-language z-rust&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-impl z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There are a lot more variants of this. I might publish a follow-up post with more.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How can I use an iterator from a struct when I also need mutable access? I know that my changes won&#x27;t affect the iterator.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;play.rust-lang.org&#x2F;?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=d5324bfe8d3429c6f40fe09bd52c7d04&quot;&gt;Playground&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; same `s` from earlier example
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;S&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;elems&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; s &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; S &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    elems&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-macro z-rust&quot;&gt;vec!&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    metadata&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-function z-rust&quot;&gt;takes_s&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;*&lt;&#x2F;span&gt;x&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; s&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;takes_s&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;x&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;i32&lt;&#x2F;span&gt;, &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;s&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; S&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;metadata &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; x&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  --&amp;gt; src&#x2F;main.rs:13:17
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;12 | for x in s.elems.iter() {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |          --------------
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |          |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |          immutable borrow occurs here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |          immutable borrow later used here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;13 |     takes_s(*x, &amp;amp;mut s);
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   |                 ^^^^^^ mutable borrow occurs here
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;You can &lt;code&gt;.collect&lt;&#x2F;code&gt; the iterator before using it:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-rust&quot;&gt;let&lt;&#x2F;span&gt; iter&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Vec&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; s&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;elems&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;iter&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;copied&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;collect&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; x &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; iter &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-function z-rust&quot;&gt;takes_s&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;x&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; s&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note that this isn&#x27;t ideal in several ways:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;If you&#x27;re wrong that &lt;code&gt;takes_s&lt;&#x2F;code&gt; doesn&#x27;t affect the iterator, it changes the behavior.&lt;&#x2F;li&gt;
&lt;li&gt;It makes the iterator eager instead of lazy, which means you have to allocate a new collection
(you don&#x27;t strictly have to use &lt;code&gt;Vec&lt;&#x2F;code&gt;, but there&#x27;s no reason to use anything else).&lt;&#x2F;li&gt;
&lt;li&gt;It requires either copying or cloning the elements.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;However, in some cases, there&#x27;s no alternative. See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;82020#discussion_r575905338&quot;&gt;this Rustdoc
PR&lt;&#x2F;a&gt; for a real-world example.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title><pre><code>&amp;'borrow mut dyn FnMut(BrokenLink&lt;'input&gt;) -> CowStr&lt;'input&gt;</code></pre> and other valid rust programs</title>
        <published>2020-12-08T00:00:00+00:00</published>
        <updated>2020-12-08T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/borrow-mut-dyn-fnmut-brokenlink-cowstring-and-other-valid-rust-programs/"/>
        <id>https://jyn.dev/borrow-mut-dyn-fnmut-brokenlink-cowstring-and-other-valid-rust-programs/</id>
        
        <summary type="html">Why HRTB are my least-favorite part of Rust</summary>
        
        <content type="html" xml:base="https://jyn.dev/borrow-mut-dyn-fnmut-brokenlink-cowstring-and-other-valid-rust-programs/">&lt;p&gt;This is a story about type signatures, Higher Ranked Trait Bounds (&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nomicon&#x2F;hrtb.html&quot;&gt;HRTB&lt;&#x2F;a&gt;), and the most
confusing diagnostics bug I&#x27;ve seen in the Rust compiler. Along the way we&#x27;ll learn how
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;raphlinus&#x2F;pulldown-cmark&quot;&gt;&lt;code&gt;pulldown-cmark&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; has been trying to fix the same API for 3 different releases, and discover
that some bugs only appear at the compile time of downstream crates.&lt;&#x2F;p&gt;
&lt;p&gt;If you don&#x27;t know what some of the words mean, there is &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;borrow-mut-dyn-fnmut-brokenlink-cowstring-and-other-valid-rust-programs&#x2F;#appendix&quot;&gt;an appendix&lt;&#x2F;a&gt;. Unfortunately,
this article needs too much background knowledge to fit all of it in a blog post.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;a class=&quot;zola-anchor&quot; href=&quot;#background&quot; aria-label=&quot;Anchor link for: background&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Our story starts with a simple change to rustdoc: It wants to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;79781&quot;&gt;hide the &lt;code&gt;[]&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; around &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustdoc&#x2F;linking-to-items-by-name.html&quot;&gt;intra-doc links&lt;&#x2F;a&gt; in search results.
(For context, search results have links stripped since otherwise the relative links would be broken, which means rustdoc needs to do some preprocessing of the markdown.)
That would turn screenshots like this:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;user-images.githubusercontent.com&#x2F;37223377&#x2F;101309556-92908680-3801-11eb-8420-0609e7af4e92.png&quot; alt=&quot;Before&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;into this:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;user-images.githubusercontent.com&#x2F;37223377&#x2F;101309591-a0dea280-3801-11eb-85e1-620549f64bf6.png&quot; alt=&quot;After&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Rustdoc does this in several &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;blob&#x2F;d32c80467db39672fa612e1519564ad5fd473e91&#x2F;src&#x2F;librustdoc&#x2F;html&#x2F;markdown.rs#L1066&quot;&gt;different&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;blob&#x2F;d32c80467db39672fa612e1519564ad5fd473e91&#x2F;src&#x2F;librustdoc&#x2F;html&#x2F;markdown.rs#L1151&quot;&gt;places&lt;&#x2F;a&gt;, so
naturally this should be pulled out into a single function that can be reused. This is a callback
to pulldown&#x27;s markdown &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;pulldown-cmark&#x2F;0.8.0&#x2F;pulldown_cmark&#x2F;struct.Parser.html&quot;&gt;&lt;code&gt;Parser&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; Omitted: in real life, this would only mark intra-doc links as valid, not all broken links.
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;summary_broken_link_callback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;link&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;BrokenLink&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;#&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;into&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; link&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;reference&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;to_owned&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;into&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Except that doesn&#x27;t work:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0621]: explicit lifetime required in the type of `md`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    --&amp;gt; src&#x2F;librustdoc&#x2F;html&#x2F;markdown.rs:1065:9
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;1050 | fn markdown_summary_with_limit(md: &amp;amp;str, length_limit: usize) -&amp;gt; (String, bool) {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |                                    ---- help: add explicit lifetime `&amp;#39;static` to the type of `md`: `&amp;amp;&amp;#39;static str`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;1065 |         Parser::new_with_broken_link_callback(md, summary_opts(), Some(&amp;amp;mut summary_broken_link_callback))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ lifetime `&amp;#39;static` required
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: higher-ranked subtype error
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    --&amp;gt; src&#x2F;librustdoc&#x2F;html&#x2F;markdown.rs:1065:72
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;1065 |         Parser::new_with_broken_link_callback(md, summary_opts(), Some(&amp;amp;mut summary_broken_link_callback))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |                                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error[E0716]: temporary value dropped while borrowed
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    --&amp;gt; src&#x2F;librustdoc&#x2F;html&#x2F;markdown.rs:1065:77
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;1065 |         Parser::new_with_broken_link_callback(md, summary_opts(), Some(&amp;amp;mut summary_broken_link_callback))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |         --------------------------------------------------------------------^^^^^^^^^^^^^^^^^^^^^^^^^^^^--
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |         |                                                                   |                            |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |         |                                                                   |                            temporary value is freed at the end of this statement
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |         |                                                                   creates a temporary which is freed while still in use
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     |         argument requires that borrow lasts for `&amp;#39;static`
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;lifetime-annotations-action-at-a-distance&quot;&gt;Lifetime annotations: action at a distance&lt;a class=&quot;zola-anchor&quot; href=&quot;#lifetime-annotations-action-at-a-distance&quot; aria-label=&quot;Anchor link for: lifetime-annotations-action-at-a-distance&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;What on earth is going on here? We have a simple function that takes a link and returns it, right?
What does that have to do with &quot;higher-ranked subtypes&quot; and &lt;code&gt;&#x27;static&lt;&#x2F;code&gt;? To find out, we have to look
at the definition of &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;pulldown-cmark&#x2F;0.8.0&#x2F;pulldown_cmark&#x2F;struct.Parser.html#method.new_with_broken_link_callback&quot;&gt;&lt;code&gt;new_with_broken_link_callback()&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;pub&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;new_with_broken_link_callback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;text&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;str&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;options&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; Options,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;broken_link_callback&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; dyn &lt;span class=&quot;z-support z-type z-rust&quot;&gt;FnMut&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;BrokenLink&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&amp;#39;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-generic z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;Parser&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;*&lt;&#x2F;span&gt; ... &lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;*&#x2F;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Wow! There&#x27;s a lot going on here, especially in &lt;code&gt;broken_link_callback&lt;&#x2F;code&gt;. Let&#x27;s take that type apart a little:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Option&lt;&#x2F;code&gt; means the callback is optional; if you pass in &lt;code&gt;None&lt;&#x2F;code&gt; it will just do nothing.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;&amp;amp;&#x27;a mut&lt;&#x2F;code&gt; is a mutable reference.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;FnMut(BrokenLink&amp;lt;&#x27;_&amp;gt;) -&amp;gt; Option&amp;lt;(CowStr&amp;lt;&#x27;a&amp;gt;, CowStr&amp;lt;&#x27;a&amp;gt;)&amp;gt;&lt;&#x2F;code&gt; is a trait for &#x27;functions taking &lt;code&gt;BrokenLink&lt;&#x2F;code&gt; and returning a tuple of &lt;code&gt;CowStr&lt;&#x2F;code&gt;&#x27;.&lt;&#x2F;li&gt;
&lt;li&gt;Because &lt;code&gt;FnMut&lt;&#x2F;code&gt; is a &lt;em&gt;trait&lt;&#x2F;em&gt; and not a type, &lt;code&gt;dyn&lt;&#x2F;code&gt; turns it into a type (i.e. this is &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;28961957&#x2F;example-of-runtime-polymorphism-in-java&quot;&gt;runtime polymorphism&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;But there&#x27;s something funny here - the &lt;em&gt;same&lt;&#x2F;em&gt; lifetime &lt;code&gt;&#x27;a&lt;&#x2F;code&gt; is used for both the reference to the
function, and the types it outputs. That&#x27;s what made our function break: since
&lt;code&gt;summary_broken_link_callback&lt;&#x2F;code&gt; is a function, any reference to it has a &lt;code&gt;&#x27;static&lt;&#x2F;code&gt; lifetime.
Fortunately, Rust will implicitly &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nomicon&#x2F;lifetimes.html#the-area-covered-by-a-lifetime&quot;&gt;reborrow&lt;&#x2F;a&gt; the reference if it lives too long. Unfortunately,
we don&#x27;t know how long it &lt;em&gt;should&lt;&#x2F;em&gt; live. That&#x27;s why the error is mentioning &lt;code&gt;&#x27;static&lt;&#x2F;code&gt;; since it can&#x27;t figure out the right lifetime, it falls back to the longest possible.
By looking at the definition of &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;pulldown-cmark&#x2F;0.8.0&#x2F;src&#x2F;pulldown_cmark&#x2F;parse.rs.html#2051-2062&quot;&gt;&lt;code&gt;Parser&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, we can see why that gives an error about &lt;code&gt;md&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;pub&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;Parser&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;md&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;str&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;broken_link_callback&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;BrokenLinkCallback&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; ... some fields omitted
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;pub&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-type z-rust&quot;&gt;type&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-type z-rust&quot;&gt;BrokenLinkCallback&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; dyn &lt;span class=&quot;z-support z-type z-rust&quot;&gt;FnMut&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;BrokenLink&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-generic z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;So there&#x27;s &lt;em&gt;many&lt;&#x2F;em&gt; lifetimes that have been tied together here:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;The lifetime of the input, &lt;code&gt;md&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;The lifetime of the borrow, &lt;code&gt;&amp;amp;mut broken_link_callback&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;The lifetime of the function &lt;em&gt;outputs&lt;&#x2F;em&gt;, which are unnamed here (pulldown &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;pulldown-cmark&#x2F;0.8.0&#x2F;src&#x2F;pulldown_cmark&#x2F;parse.rs.html#2380&quot;&gt;calls them&lt;&#x2F;a&gt; &lt;code&gt;url&lt;&#x2F;code&gt; and &lt;code&gt;title&lt;&#x2F;code&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;And that explains all the errors:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;md&lt;&#x2F;code&gt; is a temporary, but &lt;code&gt;&amp;amp;mut broken_link_callback&lt;&#x2F;code&gt; is &lt;code&gt;&#x27;static&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;&amp;amp;mut broken_link_callback&lt;&#x2F;code&gt; can&#x27;t find an appropriate lifetime for the borrow, so it gives up altogether with &quot;higher-ranked subtype error&quot;&lt;&#x2F;li&gt;
&lt;li&gt;The arguments are temporaries, so the outputs are temporaries too (because we declared &lt;code&gt;broken_link_callback&lt;&#x2F;code&gt; as &lt;code&gt;fn summary_broken_link_callback&amp;lt;&#x27;a&amp;gt;(link: BrokenLink&amp;lt;&#x27;a&amp;gt;) -&amp;gt; Option&amp;lt;(CowStr&amp;lt;&#x27;a&amp;gt;, CowStr&amp;lt;&#x27;a&amp;gt;)&amp;gt;&lt;&#x2F;code&gt;), but &lt;code&gt;&amp;amp;mut broken_link_callback&lt;&#x2F;code&gt; is &lt;code&gt;&#x27;static&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;how-do-you-solve-a-problem-like-a-lifetime&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=s-VRyQprlu8&quot;&gt;How do you solve a problem like a lifetime?&lt;&#x2F;a&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-do-you-solve-a-problem-like-a-lifetime&quot; aria-label=&quot;Anchor link for: how-do-you-solve-a-problem-like-a-lifetime&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Notice that the bug here is &lt;em&gt;not&lt;&#x2F;em&gt; in &lt;code&gt;broken_link_callback&lt;&#x2F;code&gt; - it&#x27;s in the API itself, which is
tying the lifetimes together unnecessarily. If you write &lt;code&gt;broken_link_callback&lt;&#x2F;code&gt; on its own, it
will compile and run just fine, it&#x27;s only the way that it interacts with &lt;code&gt;Parser&lt;&#x2F;code&gt; that breaks
things. The fix is not to tie the lifetimes together:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;pub&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-struct z-rust&quot;&gt;struct&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-entity z-name z-struct z-rust&quot;&gt;Parser&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt;, &lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;callback&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;text&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-rust&quot;&gt;str&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;    &lt;span class=&quot;z-variable z-other z-member z-rust&quot;&gt;broken_link_callback&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-type z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;BrokenLinkCallback&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt;, &lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;callback&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;,
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-struct z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;pub&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-type z-rust&quot;&gt;type&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-type z-rust&quot;&gt;BrokenLinkCallback&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;borrow&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;    &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;borrow&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; dyn &lt;span class=&quot;z-support z-type z-rust&quot;&gt;FnMut&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;BrokenLink&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-separator z-generic z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;input&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Notice that 1. and 3. are still tied together; this is because pulldown has an API that yields
&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;pulldown-cmark&#x2F;0.8.0&#x2F;pulldown_cmark&#x2F;struct.Parser.html#associatedtype.Item&quot;&gt;events with the lifetime of the input&lt;&#x2F;a&gt;. To use the output of the callback in the
&lt;code&gt;Iterator&lt;&#x2F;code&gt; implementation, the outputs have to live as long as the full markdown input, not just
the current link.&lt;&#x2F;p&gt;
&lt;p&gt;An interesting note is that &lt;code&gt;broken_link_callback&lt;&#x2F;code&gt; had a similar issue over overspecifying lifetimes:
if you change the type signature to&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;summary_broken_link_callback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;	&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;link&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;BrokenLink&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&amp;#39;&lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;_&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-support z-type z-rust&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;CowStr&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;  &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;#&lt;span class=&quot;z-punctuation z-definition z-string z-end z-rust&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;into&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; link&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;reference&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;to_owned&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;into&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;it will suddenly compile. In particular, the lifetime of the input is no longer tied to the lifetime of the output,
which works because &lt;code&gt;link.reference&lt;&#x2F;code&gt; is copied, not borrowed.&lt;&#x2F;p&gt;
&lt;p&gt;For more information about this problem, including strange and disconcerting errors that show up
if you give lifetimes the wrong annotations, see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;raphlinus&#x2F;pulldown-cmark&#x2F;issues&#x2F;509&quot;&gt;the issue&lt;&#x2F;a&gt; against pulldown, as well as &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;raphlinus&#x2F;pulldown-cmark&#x2F;pull&#x2F;510&quot;&gt;the
PR&lt;&#x2F;a&gt; I made fixing it.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bonus-wait-where-s-my-diagnostics-bug-i-was-promised-a-diagnostics-bug&quot;&gt;Bonus: Wait, where&#x27;s my diagnostics bug? I was promised a diagnostics bug!&lt;a class=&quot;zola-anchor&quot; href=&quot;#bonus-wait-where-s-my-diagnostics-bug-i-was-promised-a-diagnostics-bug&quot; aria-label=&quot;Anchor link for: bonus-wait-where-s-my-diagnostics-bug-i-was-promised-a-diagnostics-bug&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;For some reason, the error in a stand-alone program is different from the one when you compile &lt;code&gt;broken_link_callback&lt;&#x2F;code&gt; as part of rustdoc:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;error: implementation of `FnOnce` is not general enough
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   --&amp;gt; src&#x2F;lib.rs:8:80
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;8   |       for _ in Parser::new_with_broken_link_callback(txt, Options::empty(), Some(&amp;amp;mut callback)) {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    |                                                                                  ^^^^^^^^^^^^^ implementation of `FnOnce` is not general enough
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    | 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   ::: &#x2F;home&#x2F;jyn&#x2F;.local&#x2F;lib&#x2F;rustup&#x2F;toolchains&#x2F;stable-x86_64-unknown-linux-gnu&#x2F;lib&#x2F;rustlib&#x2F;src&#x2F;rust&#x2F;library&#x2F;core&#x2F;src&#x2F;ops&#x2F;function.rs:219:1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;219 | &#x2F; pub trait FnOnce&amp;lt;Args&amp;gt; {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;220 | |     &#x2F;&#x2F;&#x2F; The returned type after the call operator is used.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;221 | |     #[lang = &amp;quot;fn_once_output&amp;quot;]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;222 | |     #[stable(feature = &amp;quot;fn_once_output&amp;quot;, since = &amp;quot;1.12.0&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...   |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;227 | |     extern &amp;quot;rust-call&amp;quot; fn call_once(self, args: Args) -&amp;gt; Self::Output;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;228 | | }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    | |_- trait `FnOnce` defined here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    |
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    = note: `for&amp;lt;&amp;#39;a&amp;gt; fn(pulldown_cmark::BrokenLink&amp;lt;&amp;#39;a&amp;gt;) -&amp;gt; Option&amp;lt;(pulldown_cmark::CowStr&amp;lt;&amp;#39;a&amp;gt;, pulldown_cmark::CowStr&amp;lt;&amp;#39;a&amp;gt;)&amp;gt; {callback}` must implement `FnOnce&amp;lt;(pulldown_cmark::BrokenLink&amp;lt;&amp;#39;_&amp;gt;,)&amp;gt;`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    = note: ...but `FnOnce&amp;lt;(pulldown_cmark::BrokenLink&amp;lt;&amp;#39;_&amp;gt;,)&amp;gt;` is actually implemented for the type `for&amp;lt;&amp;#39;a&amp;gt; fn(pulldown_cmark::BrokenLink&amp;lt;&amp;#39;a&amp;gt;) -&amp;gt; Option&amp;lt;(pulldown_cmark::CowStr&amp;lt;&amp;#39;a&amp;gt;, pulldown_cmark::CowStr&amp;lt;&amp;#39;a&amp;gt;)&amp;gt; {callback}`
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;In particular, the &lt;code&gt;note:&lt;&#x2F;code&gt; makes no sense: it shows the same types above and below!
This is a long-lived &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;79643&quot;&gt;diagnostics issue&lt;&#x2F;a&gt; with the compiler itself, going back &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;41078&quot;&gt;at least until 2017&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nomicon&#x2F;hrtb.html&quot;&gt;HRTB&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustdoc&#x2F;&quot;&gt;Rustdoc&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustdoc&#x2F;linking-to-items-by-name.html&quot;&gt;intra-doc links&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;nomicon&#x2F;lifetimes.html#the-area-covered-by-a-lifetime&quot;&gt;reborrowing&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;I wrote more about &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;28961957&#x2F;example-of-runtime-polymorphism-in-java&quot;&gt;runtime polymorphism&lt;&#x2F;a&gt; (which is like &lt;code&gt;virtual&lt;&#x2F;code&gt; in C++ or any method call in Python) in an &lt;a href=&quot;https:&#x2F;&#x2F;acm.cse.sc.edu&#x2F;assets&#x2F;2020-09-09&quot;&gt;ACM talk&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>The intra-doc links saga</title>
        <published>2020-10-23T00:00:00+00:00</published>
        <updated>2020-10-23T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/the-intra-doc-links-saga/"/>
        <id>https://jyn.dev/the-intra-doc-links-saga/</id>
        
        <summary type="html">How I helped stabilize intra-doc links</summary>
        
        <content type="html" xml:base="https://jyn.dev/the-intra-doc-links-saga/">&lt;p&gt;One of my projects for the last 4 months or so has been working on
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;43466&quot;&gt;&#x27;intra-doc links&#x27;&lt;&#x2F;a&gt;, a feature of &lt;code&gt;rustdoc&lt;&#x2F;code&gt;
that lets you link to items by name. That feature will be stable in 4 weeks in
Rust 1.48.0!&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;@Manishearth&lt;&#x2F;strong&gt; and I wrote a longer blog post about intra-doc links which you
can read on &lt;a href=&quot;https:&#x2F;&#x2F;blog.rust-lang.org&#x2F;inside-rust&#x2F;2020&#x2F;09&#x2F;17&#x2F;stabilizing-intra-doc-links.html&quot;&gt;the official Rust blog&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Rust in 2021</title>
        <published>2020-09-05T00:00:00+00:00</published>
        <updated>2020-09-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/rust-in-2021/"/>
        <id>https://jyn.dev/rust-in-2021/</id>
        
        <summary type="html">Rust in 2021 should focus on discoverability</summary>
        
        <content type="html" xml:base="https://jyn.dev/rust-in-2021/">&lt;h2 id=&quot;who-is-this-guy-anyway&quot;&gt;Who is this guy anyway?&lt;a class=&quot;zola-anchor&quot; href=&quot;#who-is-this-guy-anyway&quot; aria-label=&quot;Anchor link for: who-is-this-guy-anyway&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Hello, it&#x27;s me! I&#x27;m a somewhat new contributor to Rust and I&#x27;m about three blog posts behind. Here they are all at once:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;building-docs-rs&#x2F;&quot;&gt;I work on docs.rs!&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;saltwater&#x2F;&quot;&gt;I wrote a C compiler in Rust&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;I spend way too much time &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pulls?q=is%3Apr+label%3AA-intra-doc-links+author%3Ajyn514+&quot;&gt;working on intra-doc links&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;I &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;compiler-team&#x2F;issues&#x2F;326&quot;&gt;help&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rustc-dev-guide&#x2F;pulls?q=+is%3Apr+author%3Ajyn514+&quot;&gt;make&lt;&#x2F;a&gt; it easier to contribute to the Rust compiler&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;wait-we-re-writing-a-blog-post-here&quot;&gt;Wait, we&#x27;re writing a blog post here.&lt;a class=&quot;zola-anchor&quot; href=&quot;#wait-we-re-writing-a-blog-post-here&quot; aria-label=&quot;Anchor link for: wait-we-re-writing-a-blog-post-here&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In particular I want to talk about that last point.
I spend way too much time on Discord and I commonly run into questions like this:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How do I get the first element of a vector if I don&#x27;t care about the rest? &lt;code&gt;vec[0]&lt;&#x2F;code&gt; gives me a reference.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;How does docs.rs calculate the percentage of items documented in a crate?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Why doesn&#x27;t &lt;code&gt;async || { ... }&lt;&#x2F;code&gt; work? The compiler told me to add &lt;code&gt;async&lt;&#x2F;code&gt; if I want to use &lt;code&gt;await&lt;&#x2F;code&gt;!&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Why am I getting a borrow check error when I try to add something to a map if it&#x27;s not yet there?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;How can I use generic types in an &lt;code&gt;extern &quot;C&quot;&lt;&#x2F;code&gt; function? Is this even possible? (This one I asked!)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;How do I link to the latest version of a subpage of my docs on docs.rs?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Is there a guide on how to add a new target or promote a target to tier 2?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;How can I use C or C++ functions from Rust? (not just the C standard library, but other libraries)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Can I have an API that takes either a value or a reference?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Can I have a logging function that will print then return a value?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Where did &lt;code&gt;arg_enum!&lt;&#x2F;code&gt; end up in clap 3? It&#x27;s not at &lt;code&gt;clap::arg_enum&lt;&#x2F;code&gt; like it was before.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Is there a way to do this with iterator methods instead?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;All of these have &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;rust-in-2021&#x2F;#faq&quot;&gt;answers&lt;&#x2F;a&gt; that are simple to understand after the fact, but
are very hard to figure out if you don&#x27;t already know them.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;discoverability&quot;&gt;Discoverability&lt;a class=&quot;zola-anchor&quot; href=&quot;#discoverability&quot; aria-label=&quot;Anchor link for: discoverability&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;As a frequent contributor to the compiler, the theme I want to focus on in 2021 is &lt;strong&gt;discoverability&lt;&#x2F;strong&gt;.
Rust and the Rust ecosystem have a lot of features, but it can be hard to find them all,
or even to know that they exist - you can&#x27;t search if you don&#x27;t know what to search for!&lt;&#x2F;p&gt;
&lt;h3 id=&quot;in-the-compiler&quot;&gt;In the compiler&lt;a class=&quot;zola-anchor&quot; href=&quot;#in-the-compiler&quot; aria-label=&quot;Anchor link for: in-the-compiler&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Rust has a well-earned reputation for good error messages.
I want to continue to expand those to catch more common errors and guide you
in the right direction. There is a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;73996&quot;&gt;lot&lt;&#x2F;a&gt; of
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;76171&quot;&gt;great&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;75931&quot;&gt;work&lt;&#x2F;a&gt; going on this area:
A giant thank you to &lt;strong&gt;@estebank&lt;&#x2F;strong&gt;, &lt;strong&gt;@da-x&lt;&#x2F;strong&gt;, and everyone else working on improving diagnostics!&lt;&#x2F;p&gt;
&lt;h3 id=&quot;in-libraries&quot;&gt;In libraries&lt;a class=&quot;zola-anchor&quot; href=&quot;#in-libraries&quot; aria-label=&quot;Anchor link for: in-libraries&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This one is harder - libraries can&#x27;t give error messages,
the best they can do is write documentation.
I want to see more examples of ways to solve errors &lt;em&gt;using the library&lt;&#x2F;em&gt;.
For example, imagine if this error:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;error&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-rust&quot;&gt;E0499&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; cannot borrow `&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;*&lt;&#x2F;span&gt;map` &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;as&lt;&#x2F;span&gt; mutable more than once at a time
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;  &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; src&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;rs&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;14&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;13&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;   &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;6&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;   &lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-rust&quot;&gt;fn&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-function z-rust&quot;&gt;get_default&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;m&lt;&#x2F;span&gt;, K, V&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;map&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;m&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic z-rust&quot;&gt;HashMap&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-rust&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;K, V&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-rust&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; K&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt; &lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;m&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-rust&quot;&gt;mut&lt;&#x2F;span&gt; V
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;   &lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt; lifetime `&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;m&lt;&#x2F;span&gt;` defined here
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-range z-rust&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;11&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;       &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;match&lt;&#x2F;span&gt; map&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;get_mut&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;   &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;       -     --- first mutable borrow occurs here&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;   &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;  &lt;span class=&quot;z-constant z-other z-rust&quot;&gt;_____&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;   &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;12&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;         &lt;span class=&quot;z-support z-type z-rust&quot;&gt;Some&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;value&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; value&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;13&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;         &lt;span class=&quot;z-support z-type z-rust&quot;&gt;None&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;14&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;             map&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;insert&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;key&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;clone&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;V&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;default&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-rust&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;   &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt; &lt;span class=&quot;z-punctuation z-section z-parameters z-end z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt; second mutable borrow occurs here&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;15&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;             map&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;get_mut&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;unwrap&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;16&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;         &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;17&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;     &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-rust&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;   &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-rust&quot;&gt;_____&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt; returning this value requires that `&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;*&lt;&#x2F;span&gt;map` is borrowed &lt;span class=&quot;z-keyword z-control z-rust&quot;&gt;for&lt;&#x2F;span&gt; `&lt;span class=&quot;z-storage z-modifier z-lifetime z-rust&quot;&gt;&amp;#39;m&lt;&#x2F;span&gt;`
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;also said this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;   &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; note&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; this pattern is valid&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; but not currently recognized by the borrow&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;checker&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; https&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-double-slash z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-rust&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt;doc.rust-lang.org&#x2F;nomicon&#x2F;lifetime-mismatch.html#improperly-reduced-borrows
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;   &lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; help&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; try using the `Entry` &lt;span class=&quot;z-constant z-other z-rust&quot;&gt;API&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;   &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;11&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;       map&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;entry&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;key&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-function z-rust&quot;&gt;or_default&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;   &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;       &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;^&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Another example:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;error&lt;span class=&quot;z-meta z-group z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-rust&quot;&gt;E0433&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; failed to resolve&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; could not find `arg_enum` &lt;span class=&quot;z-keyword z-operator z-rust&quot;&gt;in&lt;&#x2F;span&gt; `clap`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; src&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;lib&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;rs&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;10&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;  &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;clap&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;arg_enum&lt;span class=&quot;z-keyword z-operator z-logical z-rust&quot;&gt;!&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;  &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;           ^^^^^^^^ could not find `arg_enum` in `clap`&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Could instead be:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; class=&quot;language-rust z-code&quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;error&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; `arg_enum` is now a derive &lt;span class=&quot;z-invalid z-illegal z-rust&quot;&gt;macro&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-return-type z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt; src&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-rust&quot;&gt;&#x2F;&lt;&#x2F;span&gt;lib&lt;span class=&quot;z-punctuation z-accessor z-dot z-rust&quot;&gt;.&lt;&#x2F;span&gt;rs&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;10&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;  &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-rust&quot;&gt;2&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-bitwise z-rust&quot;&gt;|&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-path z-rust&quot;&gt;clap&lt;span class=&quot;z-punctuation z-accessor z-rust&quot;&gt;::&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;arg_enum&lt;span class=&quot;z-keyword z-operator z-logical z-rust&quot;&gt;!&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-rust&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;  &lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-rust&quot;&gt;|&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-rust&quot;&gt;           ^^^^^^^^ &lt;span class=&quot;z-variable z-parameter z-rust&quot;&gt;note&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; this code was valid in clap 2.0&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;,&lt;&#x2F;span&gt; but has changed in 3.0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-rust&quot;&gt;&lt;span class=&quot;z-meta z-block z-rust&quot;&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;  &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-closure z-rust&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-rust&quot;&gt;=&lt;&#x2F;span&gt; help&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-other z-rust&quot;&gt;use&lt;&#x2F;span&gt; a derive instead&lt;span class=&quot;z-punctuation z-separator z-rust&quot;&gt;:&lt;&#x2F;span&gt; `&lt;span class=&quot;z-meta z-annotation z-rust&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-annotation z-rust&quot;&gt;#&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-rust&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-annotation z-rust&quot;&gt;clap&lt;&#x2F;span&gt;::&lt;span class=&quot;z-variable z-annotation z-rust&quot;&gt;arg_enum&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-rust&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;`&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Not only would it help fix the code, but it would help you learn more about the library and the Rust language!
I&#x27;m sure there&#x27;s many things making this difficult, but I think it&#x27;s a great goal to reach for.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;in-devtools&quot;&gt;In devtools&lt;a class=&quot;zola-anchor&quot; href=&quot;#in-devtools&quot; aria-label=&quot;Anchor link for: in-devtools&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This one I think has both the most room for improvement and needs the least effort to fix.
Currently, a lot of functionality is &#x27;hidden&#x27; behind &lt;code&gt;cargo&lt;&#x2F;code&gt; subcommands.
For examples, &lt;code&gt;cargo test -- --ignored&lt;&#x2F;code&gt; and &lt;code&gt;cargo test -- --test-threads 1&lt;&#x2F;code&gt;
are very difficult to find unless you see existing examples online.
Even experienced rustaceans don&#x27;t know about many rustdoc options because they need
&lt;code&gt;cargo rustdoc -- -h&lt;&#x2F;code&gt;, not &lt;code&gt;cargo doc -h&lt;&#x2F;code&gt; or &lt;code&gt;cargo doc -- -h&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I think we should both document these options better and make them easier to find
by experimenting.&lt;&#x2F;p&gt;
&lt;p&gt;Another improvement I see in devtools is distinguishing between stable and unstable features.
Right now the way to do this is different for every tool:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cargo&lt;&#x2F;code&gt; has &lt;code&gt;cargo-features = [&quot;...&quot;]&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;rustfmt&lt;&#x2F;code&gt; has &lt;code&gt;unstable_features = true&lt;&#x2F;code&gt;, including on the stable channel&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;rustdoc&lt;&#x2F;code&gt; enables most features by default, even without &lt;code&gt;#![feature(...)]&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This causes confusion: In the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;63305&quot;&gt;words of &lt;strong&gt;@abonader&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;,&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;I assume it works on stable if there&#x27;s no feature flags.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;I think there should be a consistent story here that makes it easier to see
what&#x27;s nightly and what isn&#x27;t (even I &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;pull&#x2F;75953&quot;&gt;got confused&lt;&#x2F;a&gt; by this!).&lt;&#x2F;p&gt;
&lt;h3 id=&quot;in-the-community&quot;&gt;In the community&lt;a class=&quot;zola-anchor&quot; href=&quot;#in-the-community&quot; aria-label=&quot;Anchor link for: in-the-community&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;It can be difficult to know where discussions take place.
There are many different places:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Zulip&lt;&#x2F;li&gt;
&lt;li&gt;Discord&lt;&#x2F;li&gt;
&lt;li&gt;rustc-dev-guide&lt;&#x2F;li&gt;
&lt;li&gt;Forge&lt;&#x2F;li&gt;
&lt;li&gt;Blog posts (usually discussed on reddit)&lt;&#x2F;li&gt;
&lt;li&gt;internals.rust-lang.org&lt;&#x2F;li&gt;
&lt;li&gt;users.rust-lang.org&lt;&#x2F;li&gt;
&lt;li&gt;MCPs in rust-lang&#x2F;compiler&lt;&#x2F;li&gt;
&lt;li&gt;MCPs in rust-lang&#x2F;lang&lt;&#x2F;li&gt;
&lt;li&gt;RFCs in rust-lang&#x2F;rfcs&lt;&#x2F;li&gt;
&lt;li&gt;FCPs in rust-lang&#x2F;rust&lt;&#x2F;li&gt;
&lt;li&gt;Various READMEs in the compiler itself (although most of those point to external links now)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This makes it hard for new contributors to find information
and hard for frequent contributors to stay up to date on the current status of issues.&lt;&#x2F;p&gt;
&lt;p&gt;I think we should consolidate documentation into fewer places and discussion
into fewer channels. This would make it easier to understand what&#x27;s going on
without having to spend lots of time chasing down leads (in both senses 😉).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-do-you-think-could-be-more-discoverable&quot;&gt;What do &lt;em&gt;you&lt;&#x2F;em&gt; think could be more discoverable?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-do-you-think-could-be-more-discoverable&quot; aria-label=&quot;Anchor link for: what-do-you-think-could-be-more-discoverable&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Is there a feature of Rust you really enjoy that people don&#x27;t know about?
Are you looking for a feature that &lt;em&gt;seems&lt;&#x2F;em&gt; like it should exist but you haven&#x27;t been able to find?
Please let me know! Good ways to bring this up are writing other blog posts or opening an issue.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;a class=&quot;zola-anchor&quot; href=&quot;#summary&quot; aria-label=&quot;Anchor link for: summary&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I think Rust is a great language with a bright future.
I want to make it easier not just to get started, but to
explore and learn more about Rust and the Rust community.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;faq&quot;&gt;FAQ&lt;a class=&quot;zola-anchor&quot; href=&quot;#faq&quot; aria-label=&quot;Anchor link for: faq&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;You can&#x27;t have questions without answers!&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How do I get the first element of a vector if I don&#x27;t care about the rest? &lt;code&gt;vec[0]&lt;&#x2F;code&gt; gives me a reference.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;code&gt;vec.into_iter().next()&lt;&#x2F;code&gt; or &lt;code&gt;vec.truncate(1); vec.pop()&lt;&#x2F;code&gt; depending on when you want to drop the items (&lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.zulipchat.com&#x2F;#narrow&#x2F;stream&#x2F;219381-t-libs&#x2F;topic&#x2F;Eager.20skipping.20for.20iterators&#x2F;near&#x2F;209045693&quot;&gt;discussion&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How does docs.rs calculate the percentage of items documented in a crate?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;rustdoc&#x2F;unstable-features.html#--show-coverage-calculate-the-percentage-of-items-with-documentation&quot;&gt;&lt;code&gt;rustdoc --show-coverage&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Why doesn&#x27;t &lt;code&gt;async || { ... }&lt;&#x2F;code&gt; work? The compiler told me to add &lt;code&gt;async&lt;&#x2F;code&gt; if I want to use &lt;code&gt;await&lt;&#x2F;code&gt;!&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Use &lt;code&gt;async { ... }&lt;&#x2F;code&gt; instead. I opened &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;76011&quot;&gt;an issue&lt;&#x2F;a&gt; to add a suggestion for this.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Why am I getting a borrow check error when I try to add something to a map if it&#x27;s not yet there?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;This is a limitation of the borrow checker; use &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;std&#x2F;collections&#x2F;hash_map&#x2F;enum.Entry.html&quot;&gt;&lt;code&gt;entry()&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; instead.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How can I use generic types in an &lt;code&gt;extern &quot;C&quot;&lt;&#x2F;code&gt; function? Is this even possible? (This one I asked!)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;It works like a normal function pointer! You can simply use &lt;code&gt;my_c_func(my_callback::&amp;lt;T&amp;gt; as fn()&lt;&#x2F;code&gt;,
and declare &lt;code&gt;my_callback&lt;&#x2F;code&gt; like a normal generic function that happens to have &lt;code&gt;extern &quot;C&quot;&lt;&#x2F;code&gt; at the front.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How do I link to the latest version of a subpage of my docs on docs.rs?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;code&gt;&#x2F;my-crate&#x2F;latest&#x2F;my_crate&#x2F;module&#x2F;kind.name.html&lt;&#x2F;code&gt;; &lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;about&#x2F;redirections&quot;&gt;docs&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Is there a guide on how to add a new target or promote a target to tier 2?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;There is an &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rfcs&#x2F;pull&#x2F;2803&quot;&gt;RFC in progress&lt;&#x2F;a&gt; and docs for &lt;a href=&quot;https:&#x2F;&#x2F;rustc-dev-guide.rust-lang.org&#x2F;building&#x2F;new-target.html&quot;&gt;adding a new target&lt;&#x2F;a&gt;.
However I&#x27;m not aware of any documentation for promoting a target from tier 3 to tier 2,
or from &#x27;tier 2 cross-compiled&#x27; to &#x27;tier 2 hosted&#x27; (see the RFC).&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;How can I use C or C++ functions from Rust? (not just the C standard library, but other libraries)&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;You probably want either &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;dtolnay&#x2F;cxx&#x2F;&quot;&gt;bindgen&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;dtolnay&#x2F;cxx&#x2F;&quot;&gt;cxx&lt;&#x2F;a&gt;. For the reverse, calling Rust from C or C++,
take a look at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;eqrion&#x2F;cbindgen&quot;&gt;cbindgen&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Can I have an API that takes either a value or a reference?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Yes, &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;std&#x2F;borrow&#x2F;trait.Borrow.html&quot;&gt;&lt;code&gt;Borrow&amp;lt;T&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;NOTE: this answer originally said &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;std&#x2F;convert&#x2F;trait.AsRef.html&quot;&gt;&lt;code&gt;AsRef&amp;lt;T&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;,
which doesn&#x27;t always work - there&#x27;s no blanket &lt;code&gt;impl AsRef&amp;lt;T&amp;gt; for &amp;amp;T&lt;&#x2F;code&gt;
like there is for &lt;code&gt;Borrow&lt;&#x2F;code&gt;. This difference is itself a discoverability problem! Thanks to &lt;strong&gt;@raphlinus&lt;&#x2F;strong&gt; for pointing out the difference.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Can I have a logging function that will print then return a value?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Yes, and it&#x27;s even in the standard library: &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;std&#x2F;macro.dbg.html&quot;&gt;&lt;code&gt;dbg!&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.
Unfortunately it doesn&#x27;t work with &lt;code&gt;log&lt;&#x2F;code&gt; or &lt;code&gt;tracing&lt;&#x2F;code&gt;,
but it&#x27;s not too hard to write your own wrapper around those.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Where did &lt;code&gt;arg_enum!&lt;&#x2F;code&gt; end up in clap 3? It&#x27;s not at &lt;code&gt;clap::arg_enum&lt;&#x2F;code&gt; like it was before.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;It&#x27;s now a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;clap-rs&#x2F;clap&#x2F;blob&#x2F;master&#x2F;clap_derive&#x2F;examples&#x2F;arg_enum.rs&quot;&gt;derive macro&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Is there a way to do this with iterator methods instead?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Yes.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;updates&quot;&gt;Updates!&lt;a class=&quot;zola-anchor&quot; href=&quot;#updates&quot; aria-label=&quot;Anchor link for: updates&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;This was surprisingly popular &lt;a href=&quot;https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;rust&#x2F;comments&#x2F;inxwka&#x2F;rust_in_2021_discoverability&#x2F;&quot;&gt;on reddit&lt;&#x2F;a&gt;! I&#x27;m answering a few of the most relevant questions here so everyone can see them.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Is there a way a library can give a custom message on trait errors?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Yes, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;29628&quot;&gt;&lt;code&gt;rustc_on_unimplemented&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;. Unfortunately it&#x27;s not intended to be stabilized,
but I&#x27;d be happy to see an RFC for it!&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Is there something like Hoogle for Rust, where you give it a type signature and it suggests possible implementations?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Yes, rustdoc has &lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;std&#x2F;rc&#x2F;struct.Rc.html?search=*%20-%3E%20String&quot;&gt;&#x27;type-based search&#x27;&lt;&#x2F;a&gt;. Press &lt;code&gt;?&lt;&#x2F;code&gt; in any rustdoc page for more information about it.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Couldn&#x27;t the maintainers of clap make &lt;code&gt;arg_enum!&lt;&#x2F;code&gt; deprecated and point to the derive macro?&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;No, because both the old and new macro have the same name in the same namespace.
So adding both would be a compile error. Fortunately this means the compiler can help out, I &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;76429&quot;&gt;opened an issue&lt;&#x2F;a&gt; for it to do so.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Building Docs.rs</title>
        <published>2019-11-26T00:00:00+00:00</published>
        <updated>2019-11-26T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/building-docs-rs/"/>
        <id>https://jyn.dev/building-docs-rs/</id>
        
        <summary type="html">How I because the 2nd-most prolific contributor to docs.rs</summary>
        
        <content type="html" xml:base="https://jyn.dev/building-docs-rs/">&lt;h2 id=&quot;what-is-docs-rs&quot;&gt;What is docs.rs?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-is-docs-rs&quot; aria-label=&quot;Anchor link for: what-is-docs-rs&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;&quot;&gt;docs.rs&lt;&#x2F;a&gt; is a site dedicated to hosting documentation for Rust projects.
It automatically builds documentation for every package published to
&lt;a href=&quot;https:&#x2F;&#x2F;crates.io&#x2F;&quot;&gt;crates.io&lt;&#x2F;a&gt; using &lt;code&gt;cargo&lt;&#x2F;code&gt; and &lt;code&gt;rustdoc&lt;&#x2F;code&gt;.
Unfortunately, because &lt;code&gt;rustdoc&lt;&#x2F;code&gt; is tied so closely to the compiler,
this requires building every package from source using &lt;code&gt;cargo doc&lt;&#x2F;code&gt;.
As a result, I&#x27;ve heard several members of the docs.rs team describe it as
&#x27;Remote Code Execution as a Service&#x27; (since &lt;code&gt;build.rs&lt;&#x2F;code&gt; files can
&lt;a href=&quot;https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;build-scripts.html&quot;&gt;execute arbitrary code&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Just from this description you can see that hosting docs.rs is an enormous job
and requires a ton of compute resources. It gets worse when you consider that
docs.rs has to &lt;em&gt;store&lt;&#x2F;em&gt; all this documentation somewhere. In fact, it&#x27;s in
an AWS storage bucket and gets uploaded after every build.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-did-i-get-involved&quot;&gt;How did I get involved?&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-did-i-get-involved&quot; aria-label=&quot;Anchor link for: how-did-i-get-involved&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;My main rust project is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;rcc&quot;&gt;rcc&lt;&#x2F;a&gt;, a C compiler written in Rust.
I use &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;CraneStation&#x2F;cranelift&quot;&gt;Cranelift&lt;&#x2F;a&gt; to generate the assembly
code; Cranelift is a code generator like &lt;a href=&quot;https:&#x2F;&#x2F;llvm.org&#x2F;&quot;&gt;LLVM&lt;&#x2F;a&gt;.
Cranelift releases very quickly - I first started using it in version
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;rcc&#x2F;commit&#x2F;9f5573d&quot;&gt;&lt;code&gt;0.36&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; and it&#x27;s currently on
&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;cranelift-codegen&#x2F;0.51.0&#x2F;cranelift_codegen&#x2F;&quot;&gt;&lt;code&gt;0.51&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.
Because I used the docs so much when I was getting started,
Firefox got convinced that I always wanted to visit &lt;code&gt;0.36&lt;&#x2F;code&gt; - see also the
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;rust&#x2F;issues&#x2F;9461&quot;&gt;rustdoc issue&lt;&#x2F;a&gt; about canonical URLs.&lt;&#x2F;p&gt;
&lt;p&gt;Fortunately, docs.rs has a little link you can click to go to the latest version.
Unfortunately, docs.rs used to redirect you to the home page whenever you clicked that link,
so if you were looking up
&lt;a href=&quot;https:&#x2F;&#x2F;docs.rs&#x2F;cranelift-codegen&#x2F;0.42.0&#x2F;cranelift_codegen&#x2F;ir&#x2F;trait.InstBuilder.html&quot;&gt;&lt;code&gt;cranelift_codegen::ir::InstBuilder&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;
before, you&#x27;d have to click through 3 links to get back there on the latest version.
This has made a lot of people very angry and been widely regarded as a bad move.
There had actually been &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;issues&#x2F;200&quot;&gt;an issue open&lt;&#x2F;a&gt;
for about a year and a half at this point, although it wasn&#x27;t getting much attention.&lt;&#x2F;p&gt;
&lt;p&gt;I decided since I was running into the issue so much, I may as well contribute a patch.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-happened&quot;&gt;What happened?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-happened&quot; aria-label=&quot;Anchor link for: what-happened&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;At that point, docs.rs was using &lt;a href=&quot;https:&#x2F;&#x2F;www.vagrantup.com&#x2F;&quot;&gt;Vagrant&lt;&#x2F;a&gt; to run
builds locally, because it needed to have a sandboxed environment to execute
arbitrary code on. When I tried using it, it took about 20 minutes and then I
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;issues&#x2F;200#issuecomment-539771094&quot;&gt;got an ugly error&lt;&#x2F;a&gt; without any explanation.
Remember, this isn&#x27;t even the hard part of the change, I just wanted to get it running from master.&lt;&#x2F;p&gt;
&lt;p&gt;I chatted with &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;pietroalbini&quot;&gt;Pietro&lt;&#x2F;a&gt; on Discord
and it turns out that docs.rs had recently
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;407&quot;&gt;switched to a different sandbox&lt;&#x2F;a&gt;,
but the Vagrantfile never got updated. Since I don&#x27;t know really how to use Vagrant
or Ruby (and no one was volunteering to fix it), I didn&#x27;t have any hope of getting
that working. I asked what I could do and someone pointed me to
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;wiki&#x2F;Self-hosting-outside-the-Vagrant-VM&quot;&gt;the wiki&lt;&#x2F;a&gt;.
I took one look and knew there was no way I wanted to do this - it&#x27;s about 5 pages,
and 30 manually steps, most of which have to be done in order.
So I figured, hey, I&#x27;m a developer, let&#x27;s automate this!&lt;&#x2F;p&gt;
&lt;p&gt;Long story short, I ended up &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;432&quot;&gt;writing a &lt;code&gt;Dockerfile&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;
and Pietro was so impressed that he started &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;455&quot;&gt;using it in production&lt;&#x2F;a&gt; :D&lt;&#x2F;p&gt;
&lt;p&gt;After a month and what has been called&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;users.rust-lang.org&#x2F;t&#x2F;rust-2020-growth&#x2F;34956&#x2F;43&quot;&gt;Unprecedented (but greatly appreciated) levels of yak shaving&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;I finally &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;454&quot;&gt;got the original change merged&lt;&#x2F;a&gt; :)&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-next&quot;&gt;What next?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-next&quot; aria-label=&quot;Anchor link for: what-next&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Pietro and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;QuietMisdreavus&quot;&gt;QuietMisdreavus&lt;&#x2F;a&gt; were so impressed
with my work that they invited me to the team! As of November 1st, I have push access
to &lt;code&gt;docs.rs&lt;&#x2F;code&gt; :) (Pietro still handles the deploys)&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;ve been helping with &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;487&quot;&gt;a&lt;&#x2F;a&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;485&quot;&gt;few&lt;&#x2F;a&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;476&quot;&gt;other&lt;&#x2F;a&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;468&quot;&gt;PRs&lt;&#x2F;a&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;docs.rs&#x2F;pull&#x2F;460&quot;&gt;since&lt;&#x2F;a&gt;
and plan to contribute for the foreseeable future!&lt;&#x2F;p&gt;
&lt;h2 id=&quot;acknowledgments&quot;&gt;Acknowledgments&lt;a class=&quot;zola-anchor&quot; href=&quot;#acknowledgments&quot; aria-label=&quot;Anchor link for: acknowledgments&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Thank you so much to Pietro and QuietMisdreavus for helping me get started with
the project! My favorite part of working on docs.rs is giving and receiving feedback
from my friends.&lt;&#x2F;p&gt;
&lt;p&gt;Thank you to &lt;a href=&quot;https:&#x2F;&#x2F;users.rust-lang.org&#x2F;u&#x2F;17cupsofcoffee&quot;&gt;&#x2F;u&#x2F;17cupsofcoffee&lt;&#x2F;a&gt;
for prompting me to write this blog post!&lt;&#x2F;p&gt;
&lt;p&gt;And finally, thanks to everyone in the Rust community for making this an awesome
language to work on :D&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Intro to Reverse Engineering</title>
        <published>2019-11-11T00:00:00+00:00</published>
        <updated>2019-11-11T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/talks/assembly/"/>
        <id>https://jyn.dev/talks/assembly/</id>
        
        <content type="html" xml:base="https://jyn.dev/talks/assembly/"></content>
    </entry><entry xml:lang="en">
        <title>Intro to C</title>
        <published>2019-11-05T00:00:00+00:00</published>
        <updated>2019-11-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/talks/c/"/>
        <id>https://jyn.dev/talks/c/</id>
        
        <content type="html" xml:base="https://jyn.dev/talks/c/"></content>
    </entry><entry xml:lang="en">
        <title>Intro to Linux</title>
        <published>2019-09-16T00:00:00+00:00</published>
        <updated>2019-09-16T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/talks/linux/"/>
        <id>https://jyn.dev/talks/linux/</id>
        
        <content type="html" xml:base="https://jyn.dev/talks/linux/"></content>
    </entry><entry xml:lang="en">
        <title>Intro to Python</title>
        <published>2019-09-11T00:00:00+00:00</published>
        <updated>2019-09-11T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/talks/python/"/>
        <id>https://jyn.dev/talks/python/</id>
        
        <content type="html" xml:base="https://jyn.dev/talks/python/"></content>
    </entry><entry xml:lang="en">
        <title>Fun with gaming on Linux</title>
        <published>2019-08-04T00:00:00+00:00</published>
        <updated>2019-08-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/fun-with-gaming-on-linux/"/>
        <id>https://jyn.dev/fun-with-gaming-on-linux/</id>
        
        <summary type="html">How I got Multiplayer Civilization 5 to work on Linux</summary>
        
        <content type="html" xml:base="https://jyn.dev/fun-with-gaming-on-linux/">&lt;h2 id=&quot;the-problem&quot;&gt;The Problem&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-problem&quot; aria-label=&quot;Anchor link for: the-problem&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;As my family frequently reminds me, most of my tech problems are of my own making.&lt;&#x2F;p&gt;
&lt;p&gt;For instance, I wanted to play &lt;a href=&quot;https:&#x2F;&#x2F;civilization.com&#x2F;civilization-5&#x2F;&quot;&gt;Civilization 5&lt;&#x2F;a&gt; with a friend of mine through Steam.
I have a Linux&#x2F;Windows dual-boot with a shared
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;NTFS&quot;&gt;NTFS&lt;&#x2F;a&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Disk_partitioning&quot;&gt;partition&lt;&#x2F;a&gt; so that I can share files between the operating systems.
I run Linux by default.
I also have Hibernate disabled on Windows because I can&#x27;t use the shared partition
from Linux if Windows is hibernated -
Windows &lt;a href=&quot;https:&#x2F;&#x2F;www.tuxera.com&#x2F;community&#x2F;ntfs-3g-faq&#x2F;#fullyshut&quot;&gt;doesn&#x27;t see the new changes&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;This led to a perfect storm of interactions, since running Civ required&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Rebooting the machine&lt;&#x2F;li&gt;
&lt;li&gt;Waiting about 10 minutes for Windows to cold-start from a HDD (remember that Hibernate is disabled)&lt;&#x2F;li&gt;
&lt;li&gt;Waiting another 5-10 minutes for Steam and Civ to launch&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Needless to say, this was frustrating for both my friend and I.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;trying-new-things&quot;&gt;Trying new things&lt;a class=&quot;zola-anchor&quot; href=&quot;#trying-new-things&quot; aria-label=&quot;Anchor link for: trying-new-things&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I found recently that &lt;a href=&quot;https:&#x2F;&#x2F;fosspost.org&#x2F;tutorials&#x2F;enable-steam-play-on-linux-to-run-windows-games&quot;&gt;Steam has a compatibility layer&lt;&#x2F;a&gt;
for playing Windows games from other OSs.
I downloaded it and gave it a try on a single-player game.
It works great, I have no complaints.&lt;&#x2F;p&gt;
&lt;p&gt;The first time I tried to play with my friend, though, I got repeated issues saying
&#x27;Could not connect to host&#x27;.
Related, I block outgoing network traffic by default at the firewall level.
Unfortunately, Civ uses random ports to connect, so I can&#x27;t whitelist it like I do for HTTP, SSH, etc.
My normal solution here is to have a group called &lt;code&gt;internet&lt;&#x2F;code&gt; which is whitelisted by
IPTables (the native firewall software on Linux, similar to Windows Firewall).
If I want to, for example, chat via Discord, I run &lt;code&gt;sg internet discord&lt;&#x2F;code&gt;
which allows unrestricted network traffic for that single Discord instance.&lt;&#x2F;p&gt;
&lt;p&gt;When I tried this with Steam, however, I ran into all sorts of strange errors.
Sometimes Civ would launch but show network errors when I tried to connect.
Sometimes Steam wouldn&#x27;t recognize my game library, mounted on the NTFS partition so I don&#x27;t have to redownload 5 GB of assets when I reboot.
I tried re-adding the library but got the message &#x27;The partition where the game library is mounted must allow programs to be executed&#x27;.
This was exceedingly odd because I execute programs on that partition all the time.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;strange-and-maddening-rules&quot;&gt;Strange and Maddening Rules&lt;a class=&quot;zola-anchor&quot; href=&quot;#strange-and-maddening-rules&quot; aria-label=&quot;Anchor link for: strange-and-maddening-rules&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I finally tracked the error down to Steam trying to create and run a shell script unsuccessfully.
Fun fact: &lt;code&gt;strings steamclient.so&lt;&#x2F;code&gt; shows, among other things, a complete shell script:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;.steam_exec_test.sh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;#!&#x2F;bin&#x2F;sh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;exit 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Couldn&amp;#39;t write %s: %s
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The issue was that my NTFS drive only recognized me, UID 1000 and GID 1000, as a user.
Any file written by any other user or group would have the ownership set to &lt;code&gt;root:root&lt;&#x2F;code&gt;.
Worse yet, the OS would then deny all permissions to you (since you&#x27;re not root).&lt;&#x2F;p&gt;
&lt;p&gt;I spent about a half hour reading through lots of manuals about Linux &amp;lt;=&amp;gt; Windows permissions
(here&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;www.tuxera.com&#x2F;community&#x2F;ntfs-3g-advanced&#x2F;ownership-and-permissions&#x2F;#usermapping&quot;&gt;the manual&lt;&#x2F;a&gt; if you&#x27;re looking for it).
The solution I came up with was to explicitly add the &lt;code&gt;internet&lt;&#x2F;code&gt; group as me in &lt;code&gt;&amp;lt;mountpoint&amp;gt;&#x2F;.NTFS-3G&#x2F;UserMapping&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Now everything works!&lt;&#x2F;p&gt;
&lt;h2 id=&quot;even-more-info&quot;&gt;Even more info&lt;a class=&quot;zola-anchor&quot; href=&quot;#even-more-info&quot; aria-label=&quot;Anchor link for: even-more-info&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;dotfiles&#x2F;blob&#x2F;master&#x2F;lib&#x2F;iptables&quot;&gt;My IPTables configuration file&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;assets&#x2F;UserMapping.txt&quot;&gt;My &lt;code&gt;UserMapping&lt;&#x2F;code&gt; file&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Buffer Overflows and Stacks and Assembly, Oh My!</title>
        <published>2019-04-29T00:00:00+00:00</published>
        <updated>2019-04-29T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/buffer-overflows-and-stacks-and-assembly-oh-my/"/>
        <id>https://jyn.dev/buffer-overflows-and-stacks-and-assembly-oh-my/</id>
        
        <content type="html" xml:base="https://jyn.dev/buffer-overflows-and-stacks-and-assembly-oh-my/">&lt;p&gt;Google has a &#x27;Intro&#x27; Capture The Flag competition at
&lt;a href=&quot;https:&#x2F;&#x2F;capturetheflag.withgoogle.com&#x2F;#beginners&#x2F;&quot;&gt;https:&#x2F;&#x2F;capturetheflag.withgoogle.com&#x2F;#beginners&#x2F;&lt;&#x2F;a&gt;.
I&#x27;ve been trying it out because, why not?
The challenges aren&#x27;t easy by any means - they range from javascript crypto
(let me know if you find out how to break JS Safe!) to SQL injections to steganography.
The challenge this post about, however, is a reverse engineering challenge: three, in fact.&lt;&#x2F;p&gt;
&lt;p&gt;10-second summary of reverse engineering: you have a binary and no source code,
and you want to exploit it somehow. In this case, the binary is across a network
connection, so you can&#x27;t modify the code, you have to use what&#x27;s there already.
If you want to try it yourself, the binary is &lt;a href=&quot;&#x2F;assets&#x2F;mngmnt&quot;&gt;here&lt;&#x2F;a&gt;,
it runs on 64-bit Linux 2.4+ (but may work on other machines, I haven&#x27;t tried).
I highly recommend going through the whole CTF first, though.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;challenge-1&quot;&gt;Challenge 1&lt;a class=&quot;zola-anchor&quot; href=&quot;#challenge-1&quot; aria-label=&quot;Anchor link for: challenge-1&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Do some black box testing here, it&#x27;ll go well with your hat.
&lt;code&gt;nc mngmnt-iface.ctfcompetition.com 1337&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;When you connect, you get a screen saying&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Let&#x27;s read the patchnotes!&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;The following patchnotes were found:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Which patchnotes should be shown?
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Version0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;# Release 0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Updated library X to version 0.Y
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Fixed path traversal bug
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Improved the UX
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;The following patchnotes were found:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Which patchnotes should be shown?
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Version0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;# Version 0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Rollback of version 0.2 because of random reasons
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Blah Blah
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Fix random reboots at 2:32 every second Friday when it&amp;#39;s new-moon.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Well, look at that. There&#x27;s a path traversal bug:
fixed in .2 and rolled back in .3 for &#x27;random reasons&#x27;.
A path traversal bug is when you have a public server which is meant to serve
files in the starting directory, but instead servers files from the whole machine if
you use relative paths. An example:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;The following patchnotes were found:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Which patchnotes should be shown?
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;user:x:1337:1337::&#x2F;home&#x2F;user:
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;From here you have a couple options to get the flag: you can either guess
(&#x27;fuzz&#x27;) the filename, or you can download the binary and see what file it&#x27;s
trying to open. Let&#x27;s do the second.&lt;&#x2F;p&gt;
&lt;p&gt;But wait, how do we get the binary? It turns out on linux there&#x27;s a &lt;code&gt;proc&lt;&#x2F;code&gt; filesystem
which &lt;em&gt;looks&lt;&#x2F;em&gt; like it has a bunch of files but really is a bunch of kernel info about
the running system. What that means for us is we can get the program without knowing the filename or current directory.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;The following patchnotes were found:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Which patchnotes should be shown?
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;proc&#x2F;self&#x2F;exe
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ELF&amp;gt;PAAA@X�@8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;... more binary follows ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;&#x2F;proc&lt;&#x2F;code&gt; is the start of the filesystem, &lt;code&gt;self&lt;&#x2F;code&gt; is the directory for the currently running process
(in this case the vulnerable program), and &lt;code&gt;exe&lt;&#x2F;code&gt; is the executable file as it was
when the process started running. So now that we&#x27;ve got the binary, we can take a look at what it&#x27;s doing.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;enter-gdb&quot;&gt;Enter GDB&lt;a class=&quot;zola-anchor&quot; href=&quot;#enter-gdb&quot; aria-label=&quot;Anchor link for: enter-gdb&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;If you don&#x27;t know how to use GDB, I highly recommend learning. Not only will it
be useful for debugging your own code, but it&#x27;s the main way I know of to
reverse engineer executables.&lt;&#x2F;p&gt;
&lt;p&gt;The first thing I normally do is look at the main function:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;gdb -q .&#x2F;mngmnt
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Reading symbols from .&#x2F;mngmnt...done.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) break main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 1 at 0x41414660: file main.cpp, line 133.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) run
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Starting program: &#x2F;home&#x2F;jyn&#x2F;Documents&#x2F;Programming&#x2F;challenges&#x2F;googlectf&#x2F;mngmnt
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 1, main (argc=1, argv=0x7fffffffdc28) at main.cpp:133
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;133     main.cpp: No such file or directory.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) disas
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Dump of assembler code for function main(int, char**):
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414648 &amp;lt;+0&amp;gt;:     push   %rbp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414649 &amp;lt;+1&amp;gt;:     mov    %rsp,%rbp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141464c &amp;lt;+4&amp;gt;:     sub    $0x1e0,%rsp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414653 &amp;lt;+11&amp;gt;:    mov    %edi,-0x1d4(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414659 &amp;lt;+17&amp;gt;:    mov    %rsi,-0x1e0(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=&amp;gt; 0x0000000041414660 &amp;lt;+24&amp;gt;:    mov    0x201a99(%rip),%rax        # 0x41616100 &amp;lt;stdin@@GLIBC_2.2.5&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;... lots of assembly follows, about 600 lines ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Well that&#x27;s a lot to look at. There&#x27;s a function called &lt;code&gt;primary_login&lt;&#x2F;code&gt;
about halfway down though, that looks promising.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) break primary_login()
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 2 at 0x41414576: file main.cpp, line 112.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) continue
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Continuing.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 2, primary_login () at main.cpp:112
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;112     in main.cpp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) disas
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Dump of assembler code for function primary_login():
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141456b &amp;lt;+0&amp;gt;:     push   %rbp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141456c &amp;lt;+1&amp;gt;:     mov    %rsp,%rbp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141456f &amp;lt;+4&amp;gt;:     sub    $0x110,%rsp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=&amp;gt; 0x0000000041414576 &amp;lt;+11&amp;gt;:    lea    0x62b(%rip),%rdi        # 0x41414ba8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141457d &amp;lt;+18&amp;gt;:    callq  0x400a90 &amp;lt;puts@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414582 &amp;lt;+23&amp;gt;:    mov    $0x0,%esi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414587 &amp;lt;+28&amp;gt;:    lea    0x49e(%rip),%rdi        # 0x41414a2c &amp;lt;_ZL9FLAG_FILE&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141458e &amp;lt;+35&amp;gt;:    mov    $0x0,%eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414593 &amp;lt;+40&amp;gt;:    callq  0x400be0 &amp;lt;open@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;... about 200 more lines of assembly ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;What&#x27;s &lt;code&gt;_ZL9FLAG_FILE&lt;&#x2F;code&gt;?&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) printf &amp;quot;%s\n&amp;quot;, 0x41414a2c
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;flag
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;After all that, that was it? Well, at least we know how to get the flag now.
One last trick - we can get the current directory of the running process with
&lt;code&gt;&#x2F;proc&#x2F;self&#x2F;cwd&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;nc mngmnt-iface.ctfcompetition.com 1337
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;The following patchnotes were found:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; - Version0.3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Which patchnotes should be shown?
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;CTF{I_luv_buggy_sOFtware}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;challenge-2&quot;&gt;Challenge 2&lt;a class=&quot;zola-anchor&quot; href=&quot;#challenge-2&quot; aria-label=&quot;Anchor link for: challenge-2&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;That got our feet wet. The next challenge is a bit trickier.
Can we get through the login screen?&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;nc mngmnt-iface.ctfcompetition.com 1337&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;=== Management Interface ===
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 1) Service access
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 2) Read EULA&#x2F;patch notes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 3) Quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Please enter the backdoo^Wservice password:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;CTF{I_luv_buggy_sOFtware}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;! Two factor authentication required !
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Please enter secret secondary password:
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Oh boy, what now? Let&#x27;s look at the program again.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;gdb .&#x2F;mngmnt
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Reading symbols from .&#x2F;mngmnt...done.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) disas primary_login
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Dump of assembler code for function primary_login():
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;... lots of code ...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414627 &amp;lt;+188&amp;gt;:   jne    0x41414630 &amp;lt;primary_login()+197&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414629 &amp;lt;+190&amp;gt;:   callq  0x41414446 &amp;lt;secondary_login()&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141462e &amp;lt;+195&amp;gt;:   jmp    0x41414646 &amp;lt;primary_login()+219&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414630 &amp;lt;+197&amp;gt;:   lea    0x5b9(%rip),%rdi        # 0x41414bf0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414637 &amp;lt;+204&amp;gt;:   callq  0x400a90 &amp;lt;puts@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141463c &amp;lt;+209&amp;gt;:   mov    $0x1,%edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;---Type &amp;lt;return&amp;gt; to continue, or q &amp;lt;return&amp;gt; to quit---
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414641 &amp;lt;+214&amp;gt;:   callq  0x400aa0 &amp;lt;exit@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414646 &amp;lt;+219&amp;gt;:   leaveq
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414647 &amp;lt;+220&amp;gt;:   retq
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;End of assembler dump.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;secondary_login&lt;&#x2F;code&gt; looks promising, what&#x27;s that look like?
Note: this is really long because we do need to read it this time.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) disas secondary_login
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Dump of assembler code for function secondary_login():
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414446 &amp;lt;+0&amp;gt;:     push   %rbp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414447 &amp;lt;+1&amp;gt;:     mov    %rsp,%rbp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141444a &amp;lt;+4&amp;gt;:     sub    $0x90,%rsp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414451 &amp;lt;+11&amp;gt;:    lea    0x6d8(%rip),%rdi        # 0x41414b30
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414458 &amp;lt;+18&amp;gt;:    callq  0x400a90 &amp;lt;puts@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141445d &amp;lt;+23&amp;gt;:    lea    0x6f4(%rip),%rdi        # 0x41414b58
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414464 &amp;lt;+30&amp;gt;:    callq  0x400a90 &amp;lt;puts@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414469 &amp;lt;+35&amp;gt;:    lea    -0x90(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414470 &amp;lt;+42&amp;gt;:    mov    %rax,%rsi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414473 &amp;lt;+45&amp;gt;:    lea    0x706(%rip),%rdi        # 0x41414b80
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141447a &amp;lt;+52&amp;gt;:    mov    $0x0,%eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141447f &amp;lt;+57&amp;gt;:    callq  0x400b00 &amp;lt;scanf@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414484 &amp;lt;+62&amp;gt;:    lea    -0x90(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141448b &amp;lt;+69&amp;gt;:    mov    %rax,%rdi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141448e &amp;lt;+72&amp;gt;:    callq  0x400b10 &amp;lt;strlen@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414493 &amp;lt;+77&amp;gt;:    mov    %rax,-0x10(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414497 &amp;lt;+81&amp;gt;:    movq   $0x0,-0x8(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141449f &amp;lt;+89&amp;gt;:    mov    -0x8(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144a3 &amp;lt;+93&amp;gt;:    cmp    -0x10(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144a7 &amp;lt;+97&amp;gt;:    jae    0x414144d6 &amp;lt;secondary_login()+144&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144a9 &amp;lt;+99&amp;gt;:    lea    -0x90(%rbp),%rdx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144b0 &amp;lt;+106&amp;gt;:   mov    -0x8(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144b4 &amp;lt;+110&amp;gt;:   add    %rdx,%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144b7 &amp;lt;+113&amp;gt;:   movzbl (%rax),%eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144ba &amp;lt;+116&amp;gt;:   xor    $0xffffffc7,%eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144bd &amp;lt;+119&amp;gt;:   mov    %eax,%ecx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144bf &amp;lt;+121&amp;gt;:   lea    -0x90(%rbp),%rdx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144c6 &amp;lt;+128&amp;gt;:   mov    -0x8(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144ca &amp;lt;+132&amp;gt;:   add    %rdx,%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144cd &amp;lt;+135&amp;gt;:   mov    %cl,(%rax)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144cf &amp;lt;+137&amp;gt;:   addq   $0x1,-0x8(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144d4 &amp;lt;+142&amp;gt;:   jmp    0x4141449f &amp;lt;secondary_login()+89&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144d6 &amp;lt;+144&amp;gt;:   cmpq   $0x23,-0x10(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144db &amp;lt;+149&amp;gt;:   jne    0x41414537 &amp;lt;secondary_login()+241&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144dd &amp;lt;+151&amp;gt;:   mov    0x55c(%rip),%rax        # 0x41414a40 &amp;lt;_ZL4FLAG&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144e4 &amp;lt;+158&amp;gt;:   mov    0x55d(%rip),%rdx        # 0x41414a48 &amp;lt;_ZL4FLAG+8&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144eb &amp;lt;+165&amp;gt;:   mov    %rax,-0x90(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144f2 &amp;lt;+172&amp;gt;:   mov    %rdx,-0x88(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x00000000414144f9 &amp;lt;+179&amp;gt;:   mov    0x550(%rip),%rax        # 0x41414a50 &amp;lt;_ZL4FLAG+16&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414500 &amp;lt;+186&amp;gt;:   mov    0x551(%rip),%rdx        # 0x41414a58 &amp;lt;_ZL4FLAG+24&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414507 &amp;lt;+193&amp;gt;:   mov    %rax,-0x80(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141450b &amp;lt;+197&amp;gt;:   mov    %rdx,-0x78(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141450f &amp;lt;+201&amp;gt;:   movzwl 0x54a(%rip),%eax        # 0x41414a60 &amp;lt;_ZL4FLAG+32&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414516 &amp;lt;+208&amp;gt;:   mov    %ax,-0x70(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141451a &amp;lt;+212&amp;gt;:   movzbl 0x541(%rip),%eax        # 0x41414a62 &amp;lt;_ZL4FLAG+34&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414521 &amp;lt;+219&amp;gt;:   mov    %al,-0x6e(%rbp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414524 &amp;lt;+222&amp;gt;:   lea    -0x90(%rbp),%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;---Type &amp;lt;return&amp;gt; to continue, or q &amp;lt;return&amp;gt; to quit---
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141452b &amp;lt;+229&amp;gt;:   test   %rax,%rax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141452e &amp;lt;+232&amp;gt;:   je     0x41414537 &amp;lt;secondary_login()+241&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414530 &amp;lt;+234&amp;gt;:   mov    $0x1,%eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414535 &amp;lt;+239&amp;gt;:   jmp    0x4141453c &amp;lt;secondary_login()+246&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414537 &amp;lt;+241&amp;gt;:   mov    $0x0,%eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141453c &amp;lt;+246&amp;gt;:   test   %al,%al
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141453e &amp;lt;+248&amp;gt;:   je     0x41414553 &amp;lt;secondary_login()+269&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414540 &amp;lt;+250&amp;gt;:   lea    0x63f(%rip),%rdi        # 0x41414b86
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414547 &amp;lt;+257&amp;gt;:   callq  0x400a90 &amp;lt;puts@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141454c &amp;lt;+262&amp;gt;:   callq  0x4141428e &amp;lt;command_line()&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414551 &amp;lt;+267&amp;gt;:   jmp    0x41414569 &amp;lt;secondary_login()+291&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414553 &amp;lt;+269&amp;gt;:   lea    0x63a(%rip),%rdi        # 0x41414b94
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141455a &amp;lt;+276&amp;gt;:   callq  0x400a90 &amp;lt;puts@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141455f &amp;lt;+281&amp;gt;:   mov    $0x1,%edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414564 &amp;lt;+286&amp;gt;:   callq  0x400aa0 &amp;lt;exit@plt&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x0000000041414569 &amp;lt;+291&amp;gt;:   leaveq
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   0x000000004141456a &amp;lt;+292&amp;gt;:   retq
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There&#x27;s a few things of note here. First is the &lt;code&gt;command_line&lt;&#x2F;code&gt; function,
which looks promising. Next is &lt;code&gt;_ZL4FLAG&lt;&#x2F;code&gt;, which seems useful. What&#x27;s there?&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) printf &amp;quot;%s\n&amp;quot;, 0x41414a40
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;�����������������������������������&#x2F;bin&#x2F;sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;That&#x27;s not helpful, it&#x27;s binary data. And why does it have a shell at the end there?
And finally, how do we get to &lt;code&gt;command_line&lt;&#x2F;code&gt;? Let&#x27;s trace the execution.
If you&#x27;ve heard of &#x27;basic blocks&#x27; in compilers, that&#x27;s basically what we&#x27;re going
to do now: split up the code into segments divided by jumps.&lt;&#x2F;p&gt;
&lt;p&gt;First we start at +0. Then execution is linear until line +93, where there&#x27;s a
&lt;code&gt;cmp&lt;&#x2F;code&gt; (compare) and a &lt;code&gt;jae&lt;&#x2F;code&gt; (jump above equal) to +144. At 144, it compares
-0x10(%rbp) to 0x23, or 35 in decimal.&lt;&#x2F;p&gt;
&lt;p&gt;That&#x27;s funny, the number of &lt;code&gt;�&lt;&#x2F;code&gt; characters in the data above is 35.
Coincidence? I think not. What happens if we just put in a string with 35 characters?&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;! Two factor authentication required !
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Please enter secret secondary password:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Authenticated
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Wait, what? That&#x27;s it? Where&#x27;s the flag?
It turns out this program forgot to check that you had the right password.
I couldn&#x27;t figure out what was going on, so I cheated and looked at
https:&#x2F;&#x2F;jhalon.github.io&#x2F;2018-google-ctf-beginners-pwn-solutions-1&#x2F;
(which is a much better writeup). Long story short, there&#x27;s an inner loop
doing funny things with &lt;code&gt;xor&lt;&#x2F;code&gt;. If we xor the binary at &lt;code&gt;_ZL4FLAG&lt;&#x2F;code&gt; with
&lt;code&gt;0xc7&lt;&#x2F;code&gt;, we get back the flag. GDB and python will both be helpful here.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) print&#x2F;x _ZL4FLAG
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$5 = {0x84, 0x93, 0x81, 0xbc, 0x93, 0xb0, 0xa8, 0x98, 0x97, 0xa6, 0xb4, 0x94, 0xb0, 0xa8,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  0xb5, 0x83, 0xbd, 0x98, 0x85, 0xa2, 0xb3, 0xb3, 0xa2, 0xb5, 0x98, 0xb3, 0xaf, 0xf3, 0xa9,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  0x98, 0xf6, 0x98, 0xac, 0xf8, 0xba}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(gdb) quit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ python -q
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; import re
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; hexes = &amp;quot;&amp;quot;&amp;quot;0x84, 0x93, 0x81, 0xbc, 0x93, 0xb0, 0xa8, 0x98, 0x97, 0xa6, 0xb4, 0x94, 0xb0, 0xa8,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...   0xb5, 0x83, 0xbd, 0x98, 0x85, 0xa2, 0xb3, 0xb3, 0xa2, 0xb5, 0x98, 0xb3, 0xaf, 0xf3, 0xa9,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...   0x98, 0xf6, 0x98, 0xac, 0xf8, 0xba&amp;quot;&amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; chars = &amp;#39;&amp;#39;.join(hexes.split()).replace(&amp;#39;,&amp;#39;, &amp;#39;&amp;#39;).replace(&amp;#39;0x&amp;#39;, &amp;#39;&amp;#39;)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; chars
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;#39;849381bc93b0a89897a6b494b0a8b583bd9885a2b3b3a2b598b3aff3a998f698acf8ba&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &amp;#39;&amp;#39;.join([chr(int(c, 16) ^ 0xc7) for c in re.findall(&amp;#39;..&amp;#39;, chars)])
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;#39;CTF{Two_PasSworDz_Better_th4n_1_k?}&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Quick explanation of that awful and hacky code:
&lt;code&gt;print&#x2F;x&lt;&#x2F;code&gt; means print as hexidecimal instead of decimal or binary.
&lt;code&gt;&#x27;&#x27;.join(hexes.split())&lt;&#x2F;code&gt; is a hacky way of removing whitespace.
The &lt;code&gt;replace&lt;&#x2F;code&gt; calls are just getting rid of formatting we don&#x27;t care about.
&lt;code&gt;re.findall(&#x27;..&#x27;, chars)&lt;&#x2F;code&gt; splits the strings into 2-character sequences.
The rest is a list comprehesion which converts each string to an int,
xors it with hexidecimal c7, then finally joins the whole list into a string.&lt;&#x2F;p&gt;
&lt;p&gt;Side note: originally this was even more hacky - I used gdb&#x27;s &lt;code&gt;&amp;lt;address&amp;gt;@n&lt;&#x2F;code&gt; syntax
which gives you back the memory in architecture-endian order. 1&#x2F;10 do not recommend.&lt;&#x2F;p&gt;
&lt;!--

## Challenge 3
&gt; It&#x27;s a sure bet that they can&#x27;t handle their memory properly

The last challenge was also the hardest to exploit. Once you enter the second flag,
you get a shell without any instructions:

```
$  .&#x2F;mngmnt
=== Management Interface ===
 1) Service access
 2) Read EULA&#x2F;patch notes
 3) Quit
1
Please enter the backdoo^Wservice password:
flag
! Two factor authentication required !
Please enter secret secondary password:
CTF{Two_PasSworDz_Better_th4n_1_k?}
Authenticated
&gt; help
Unknown command &#x27;help&#x27;
&gt; ls
Unknown command &#x27;ls&#x27;
&gt; whoami
Unknown command &#x27;whoami&#x27;
```

Let&#x27;s see if we can find what&#x27;s going on. Looking back up at the assembly,
we see that it calls `command_line` once you put in the second password.
What&#x27;s that doing?

```
gdb .&#x2F;mngmnt
Reading symbols from .&#x2F;mngmnt...done.
(gdb) disas command_line
Dump of assembler code for function command_line():
   0x000000004141428e &lt;+0&gt;:     push   %rbp
   0x000000004141428f &lt;+1&gt;:     mov    %rsp,%rbp
   0x0000000041414292 &lt;+4&gt;:     push   %rbx
   0x0000000041414293 &lt;+5&gt;:     sub    $0x128,%rsp
   0x000000004141429a &lt;+12&gt;:    lea    0x7ca(%rip),%rdi        # 0x41414a6b
   0x00000000414142a1 &lt;+19&gt;:    mov    $0x0,%eax
   0x00000000414142a6 &lt;+24&gt;:    callq  0x400a70 &lt;printf@plt&gt;
   0x00000000414142ab &lt;+29&gt;:    lea    -0x30(%rbp),%rax
   0x00000000414142af &lt;+33&gt;:    mov    %rax,%rdi
   0x00000000414142b2 &lt;+36&gt;:    callq  0x4141423a &lt;getsx(char*)&gt;
   0x00000000414142b7 &lt;+41&gt;:    mov    0x201e77(%rip),%eax        # 0x41616134 &lt;_ZL13cmds_executed&gt;
   0x00000000414142bd &lt;+47&gt;:    add    $0x1,%eax
   0x00000000414142c0 &lt;+50&gt;:    mov    %eax,0x201e6e(%rip)        # 0x41616134 &lt;_ZL13cmds_executed&gt;
   0x00000000414142c6 &lt;+56&gt;:    lea    -0x30(%rbp),%rax
   0x00000000414142ca &lt;+60&gt;:    lea    0x79d(%rip),%rsi        # 0x41414a6e
   0x00000000414142d1 &lt;+67&gt;:    mov    %rax,%rdi
   0x00000000414142d4 &lt;+70&gt;:    callq  0x400ba0 &lt;strcmp@plt&gt;
   0x00000000414142d9 &lt;+75&gt;:    test   %eax,%eax
   0x00000000414142db &lt;+77&gt;:    jne    0x414142ee &lt;command_line()+96&gt;
   0x00000000414142dd &lt;+79&gt;:    lea    0x78f(%rip),%rdi        # 0x41414a73
   0x00000000414142e4 &lt;+86&gt;:    callq  0x400a90 &lt;puts@plt&gt;
   0x00000000414142e9 &lt;+91&gt;:    jmpq   0x4141443c &lt;command_line()+430&gt;
   0x00000000414142ee &lt;+96&gt;:    lea    -0x30(%rbp),%rax
   0x00000000414142f2 &lt;+100&gt;:   lea    0x77f(%rip),%rsi        # 0x41414a78
   0x00000000414142f9 &lt;+107&gt;:   mov    %rax,%rdi
   0x00000000414142fc &lt;+110&gt;:   callq  0x400ba0 &lt;strcmp@plt&gt;
   0x0000000041414301 &lt;+115&gt;:   test   %eax,%eax
   0x0000000041414303 &lt;+117&gt;:   jne    0x41414313 &lt;command_line()+133&gt;
   0x0000000041414305 &lt;+119&gt;:   lea    0x774(%rip),%rdi        # 0x41414a80
   0x000000004141430c &lt;+126&gt;:   callq  0x400a90 &lt;puts@plt&gt;
... snip ...
   0x00000000414143ff &lt;+369&gt;:   lea    0x708(%rip),%rdi        # 0x41414b0e
   0x0000000041414406 &lt;+376&gt;:   callq  0x400a90 &lt;puts@plt&gt;
   0x000000004141440b &lt;+381&gt;:   lea    -0x130(%rbp),%rax
   0x0000000041414412 &lt;+388&gt;:   mov    %rax,%rdi
   0x0000000041414415 &lt;+391&gt;:   callq  0x400ae0 &lt;system@plt&gt;
   0x000000004141441a &lt;+396&gt;:   jmpq   0x4141429a &lt;command_line()+12&gt;
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
   0x000000004141441f &lt;+401&gt;:   lea    -0x30(%rbp),%rax
   0x0000000041414423 &lt;+405&gt;:   mov    %rax,%rsi
   0x0000000041414426 &lt;+408&gt;:   lea    0x6ec(%rip),%rdi        # 0x41414b19
   0x000000004141442d &lt;+415&gt;:   mov    $0x0,%eax
   0x0000000041414432 &lt;+420&gt;:   callq  0x400a70 &lt;printf@plt&gt;
   0x0000000041414437 &lt;+425&gt;:   jmpq   0x4141429a &lt;command_line()+12&gt;
   0x000000004141443c &lt;+430&gt;:   add    $0x128,%rsp
   0x0000000041414443 &lt;+437&gt;:   pop    %rbx
   0x0000000041414444 &lt;+438&gt;:   pop    %rbp
   0x0000000041414445 &lt;+439&gt;:   retq
```

This looks long and compilicated, but it&#x27;s really doing the same thing
over and over: comparing a string to a bunch of other strings.
That begs the question: What other strings?

```
(gdb) printf &quot;%s\n&quot;, 0x41414a6e
quit
(gdb) printf &quot;%s\n&quot;, 0x41414a78
version
(gdb) printf &quot;%s\n&quot;, 0x41414a8c
shell
(gdb) printf &quot;%s\n&quot;, 0x41414ac3
echo
(gdb) printf &quot;%s\n&quot;, 0x41414ac8
debug
```

Let&#x27;s see what these do.

```
&gt; version
Version 0.3
&gt; shell
Security made us disable the shell, sorry!
&gt; echo hi
hi
&gt; debug
Debug data dump:
 pid=30575 cmds executed=0x41616134-&gt;8 Mappings:
───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: &#x2F;proc&#x2F;30575&#x2F;maps
───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ 00400000-00401000 r-xp 00000000 08:04 315016                             &#x2F;home&#x2F;jyn&#x2F;Documents&#x2F;Programming&#x2F;challenges&#x2F;googlectf&#x2F;mngmnt
   2   │ 41414000-41415000 r-xp 00014000 08:04 315016                             &#x2F;home&#x2F;jyn&#x2F;Documents&#x2F;Programming&#x2F;challenges&#x2F;googlectf&#x2F;mngmnt
   3   │ 41615000-41616000 r--p 00015000 08:04 315016                             &#x2F;home&#x2F;jyn&#x2F;Documents&#x2F;Programming&#x2F;challenges&#x2F;googlectf&#x2F;mngmnt
   4   │ 41616000-41617000 rw-p 00016000 08:04 315016                             &#x2F;home&#x2F;jyn&#x2F;Documents&#x2F;Programming&#x2F;challenges&#x2F;googlectf&#x2F;mngmnt
   5   │ 41617000-41638000 rw-p 00000000 00:00 0                                  [heap]
   6   │ 7ffff70a5000-7ffff728c000 r-xp 00000000 08:05 1840331                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc-2.27.so
   7   │ 7ffff728c000-7ffff748c000 ---p 001e7000 08:05 1840331                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc-2.27.so
   8   │ 7ffff748c000-7ffff7490000 r--p 001e7000 08:05 1840331                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc-2.27.so
   9   │ 7ffff7490000-7ffff7492000 rw-p 001eb000 08:05 1840331                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc-2.27.so
  10   │ 7ffff7492000-7ffff7496000 rw-p 00000000 00:00 0 
  11   │ 7ffff7496000-7ffff74ad000 r-xp 00000000 08:05 1840694                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libgcc_s.so.1
  12   │ 7ffff74ad000-7ffff76ac000 ---p 00017000 08:05 1840694                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libgcc_s.so.1
  13   │ 7ffff76ac000-7ffff76ad000 r--p 00016000 08:05 1840694                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libgcc_s.so.1
  14   │ 7ffff76ad000-7ffff76ae000 rw-p 00017000 08:05 1840694                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libgcc_s.so.1
  15   │ 7ffff76ae000-7ffff784b000 r-xp 00000000 08:05 1840394                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libm-2.27.so
  16   │ 7ffff784b000-7ffff7a4a000 ---p 0019d000 08:05 1840394                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libm-2.27.so
  17   │ 7ffff7a4a000-7ffff7a4b000 r--p 0019c000 08:05 1840394                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libm-2.27.so
  18   │ 7ffff7a4b000-7ffff7a4c000 rw-p 0019d000 08:05 1840394                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libm-2.27.so
  19   │ 7ffff7a4c000-7ffff7bc5000 r-xp 00000000 08:05 1706663                    &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6.0.25
  20   │ 7ffff7bc5000-7ffff7dc5000 ---p 00179000 08:05 1706663                    &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6.0.25
  21   │ 7ffff7dc5000-7ffff7dcf000 r--p 00179000 08:05 1706663                    &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6.0.25
  22   │ 7ffff7dcf000-7ffff7dd1000 rw-p 00183000 08:05 1706663                    &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6.0.25
  23   │ 7ffff7dd1000-7ffff7dd5000 rw-p 00000000 00:00 0 
  24   │ 7ffff7dd5000-7ffff7dfc000 r-xp 00000000 08:05 1840303                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-2.27.so
  25   │ 7ffff7fc4000-7ffff7fca000 rw-p 00000000 00:00 0 
  26   │ 7ffff7ff7000-7ffff7ffa000 r--p 00000000 00:00 0                          [vvar]
  27   │ 7ffff7ffa000-7ffff7ffc000 r-xp 00000000 00:00 0                          [vdso]
  28   │ 7ffff7ffc000-7ffff7ffd000 r--p 00027000 08:05 1840303                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-2.27.so
  29   │ 7ffff7ffd000-7ffff7ffe000 rw-p 00028000 08:05 1840303                    &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-2.27.so
  30   │ 7ffff7ffe000-7ffff7fff000 rw-p 00000000 00:00 0 
  31   │ 7ffffffdd000-7ffffffff000 rw-p 00000000 00:00 0                          [stack]
  32   │ ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
&gt; quit
Bye!
```

Well, no dice. That debug info is a little strange.
And why have a shell option if it&#x27;s disabled?
Let&#x27;s look at that more closely.

```
   0x0000000041414317 &lt;+137&gt;:   lea    0x76e(%rip),%rsi        # 0x41414a8c
   0x000000004141431e &lt;+144&gt;:   mov    %rax,%rdi
   0x0000000041414321 &lt;+147&gt;:   callq  0x400ba0 &lt;strcmp@plt&gt;
   0x0000000041414326 &lt;+152&gt;:   test   %eax,%eax
   0x0000000041414328 &lt;+154&gt;:   jne    0x41414353 &lt;command_line()+197&gt;
   0x000000004141432a &lt;+156&gt;:   movzbl 0x201e07(%rip),%eax        # 0x41616138 &lt;_ZL13shell_enabled&gt;
   0x0000000041414331 &lt;+163&gt;:   xor    $0x1,%eax
   0x0000000041414334 &lt;+166&gt;:   test   %al,%al
   0x0000000041414336 &lt;+168&gt;:   je     0x41414349 &lt;command_line()+187&gt;
   0x0000000041414338 &lt;+170&gt;:   lea    0x759(%rip),%rdi        # 0x41414a98
   0x000000004141433f &lt;+177&gt;:   callq  0x400a90 &lt;puts@plt&gt;
   0x0000000041414344 &lt;+182&gt;:   jmpq   0x4141429a &lt;command_line()+12&gt;
   0x0000000041414349 &lt;+187&gt;:   callq  0x41414227 &lt;debug_shell()&gt;
```

This is basically doing three things - checking if we input &#x27;shell&#x27;,
checking if `_ZL13shell_enabled` is 0, and if so launching a shell on the host.
Unfortunately, `_ZL13shell_enabled` is _always_ 0. What can we do?

Well, the challenge description mentioned memory.
Could there be a buffer overrun somewhere? Let&#x27;s open gdb and check it out.
For this bit I&#x27;m actually going to use a gdb addon called
[peda](https:&#x2F;&#x2F;github.com&#x2F;longld&#x2F;peda) which makes debugging much nicer
without changing any behaviour.

What happens if we put in a really long string?

```

!--&gt;
&lt;p&gt;(Challenge 3 will probably not be forthcoming, I finished it but never got around to writing it up.)&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Reverse Engineering x86 assembly</title>
        <published>2018-09-29T00:00:00+00:00</published>
        <updated>2018-09-29T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/reverse-engineering-x86-assembly/"/>
        <id>https://jyn.dev/reverse-engineering-x86-assembly/</id>
        
        <summary type="html">Basics of decompiling binaries on linux with GDB</summary>
        
        <content type="html" xml:base="https://jyn.dev/reverse-engineering-x86-assembly/">&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;a class=&quot;zola-anchor&quot; href=&quot;#intro&quot; aria-label=&quot;Anchor link for: intro&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;For those of you not familiar with the C toolchain, it goes something like this:&lt;&#x2F;p&gt;
&lt;p&gt;Source -&amp;gt; preprocessed source -&amp;gt; assembly -&amp;gt; object file -&amp;gt; binary&lt;&#x2F;p&gt;
&lt;p&gt;The second step (preprocessed -&amp;gt; assembly) is the hardest to undo.
It removes labels, debug symbols, and turns a high-level control flow into assembly instructions.
However, since you &lt;em&gt;need&lt;&#x2F;em&gt; a binary to run a program, if you can undo that step,
you can see what&#x27;s going on.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;gdb-basics&quot;&gt;GDB Basics&lt;a class=&quot;zola-anchor&quot; href=&quot;#gdb-basics&quot; aria-label=&quot;Anchor link for: gdb-basics&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;GDB is a debugger. It steps through a compiled program, line by line, and shows you
the changes after every step.&lt;&#x2F;p&gt;
&lt;p&gt;Let&#x27;s take a simple hello-world program and step through it.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;C&quot; class=&quot;language-C z-code&quot;&gt;&lt;code class=&quot;language-C&quot; data-lang=&quot;C&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-include z-c&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-include z-c&quot;&gt;#include&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-other z-lt-gt z-include z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;stdio.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;void&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-support z-function z-C99 z-c&quot;&gt;puts&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Hello, world!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-keyword z-control z-flow z-return z-c&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Passing &lt;code&gt;-g&lt;&#x2F;code&gt; to &lt;code&gt;gcc&lt;&#x2F;code&gt; means preserve debug symbols, so we know where we are in the original source code.
Passing &lt;code&gt;-q&lt;&#x2F;code&gt; to &lt;code&gt;gdb&lt;&#x2F;code&gt; means don&#x27;t print 10 lines of copyright info.
Note that we have to add a breakpoint in the main function, or it will run without ever stopping.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; gcc&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;g&lt;&#x2F;span&gt; hello_world.c&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;o&lt;&#x2F;span&gt; hello&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; gdb&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt; hello&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Reading&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; symbols from hello...done.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; list&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;1       &lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-shell&quot;&gt;#&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;include &amp;lt;stdio.h&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-shell&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;3&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;       int main(void&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-punctuation z-definition z-compound z-braces z-begin z-shell&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;4&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         puts(&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Hello, world!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;5&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         return 0&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;6&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;       &lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-braces z-end z-shell&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;7&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; break main&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Breakpoint&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1 at 0x4004db: file hello_world.c, line 4.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; run&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Starting&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; program: &#x2F;home&#x2F;jyn&#x2F;hello&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Breakpoint&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1, main (&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;at&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; tmp.c:4&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;4&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         puts(&lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Hello, world!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; next&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Hello,&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; world!&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;5&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         return 0&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;6&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;       &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; continue&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Continuing.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;[Inferior&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1 (process 28690&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;exited&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; normally]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;You can also show variables as you step through.
(Note that &lt;code&gt;return 0&lt;&#x2F;code&gt; is optional in the main function)&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;C&quot; class=&quot;language-C z-code&quot;&gt;&lt;code class=&quot;language-C&quot; data-lang=&quot;C&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-include z-c&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-include z-c&quot;&gt;#include&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-other z-lt-gt z-include z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;stdio.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;void&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;var &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Hello, world!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  var &lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;changed my mind&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-support z-function z-C99 z-c&quot;&gt;puts&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;var&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; gcc&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;g&lt;&#x2F;span&gt; var.c&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;o&lt;&#x2F;span&gt; var&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; gdb&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt; var&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Reading&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; symbols from var...done.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; break main&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Breakpoint&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1 at 0x4004df: file var.c, line 4.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; run&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Starting&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; program: &#x2F;home&#x2F;jyn&#x2F;var&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Breakpoint&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1, main (&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;at&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; var.c:4&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;4&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         char &lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt;var = &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Hello, world!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; print var&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 0x0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; n&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;5&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         var = &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;changed my mind&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; print var&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 0x4005a0 &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Hello, world!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; n&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;6&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;         puts(var&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; print var&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-shell&quot;&gt;3&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; = 0x4005ae &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;changed my mind&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; n&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;changed&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; my mind&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;7&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;       &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gdb&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-compound z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; c&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Continuing.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;[Inferior&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; 1 (process 29542&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;) &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;exited&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; normally]&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This post is continued in &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;buffer-overflows-and-stacks-and-assembly-oh-my&#x2F;&quot;&gt;Buffer Overflows and Stacks and Assembly, Oh My&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Keepass on Linux and Android</title>
        <published>2018-08-24T00:00:00+00:00</published>
        <updated>2018-08-24T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/keepass-on-linux-and-android/"/>
        <id>https://jyn.dev/keepass-on-linux-and-android/</id>
        
        <summary type="html">File synchronization on Linux</summary>
        
        <content type="html" xml:base="https://jyn.dev/keepass-on-linux-and-android/">&lt;p&gt;Previously, I wrote about
&lt;a href=&quot;&#x2F;2018-02-24-Password-Safety.html&quot;&gt;using a password manager&lt;&#x2F;a&gt;.
However, the disadvantage of using an audited, local manager like
&lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&quot;&gt;Keepass&lt;&#x2F;a&gt; is that it&#x27;s hard to share passwords between devices.
You can put the encrypted database in a file-sharing service like Google Drive,
but that means you need a sync client on all of your devices, and Google
&lt;a href=&quot;https:&#x2F;&#x2F;abevoelker.github.io&#x2F;how-long-since-google-said-a-google-drive-linux-client-is-coming&#x2F;&quot;&gt;doesn&#x27;t have one for Linux&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Fortunately, it&#x27;s Linux, so there are alternatives.&lt;&#x2F;p&gt;
&lt;p&gt;My current favorite sync client is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;astrada&#x2F;google-drive-ocamlfuse&quot;&gt;google-drive-ocamlfuse&lt;&#x2F;a&gt;.
Although it&#x27;s annoying to have to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;astrada&#x2F;google-drive-ocamlfuse&#x2F;wiki&#x2F;Installation&quot;&gt;build from source&lt;&#x2F;a&gt;
and is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;astrada&#x2F;google-drive-ocamlfuse#usage&quot;&gt;command-line only&lt;&#x2F;a&gt;,
it lets you treat Drive as a user-land file system using &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;libfuse&#x2F;libfuse&quot;&gt;FUSE&lt;&#x2F;a&gt;,
which is particularly nice for clients that aren&#x27;t web-aware (like keepass).
It also has an excellent &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;astrada&#x2F;google-drive-ocamlfuse&#x2F;wiki&#x2F;Automounting&quot;&gt;walkthrough&lt;&#x2F;a&gt; on how to automount on boot
(this is Linux, nothing is automatic).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Why not just use Dropbox? It doesn&#x27;t support NTFS drives
(or anything other than &lt;a href=&quot;https:&#x2F;&#x2F;www.dropbox.com&#x2F;help&#x2F;desktop-web&#x2F;system-requirements#desktop&quot;&gt;ext4&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Why not use an encrypted service, like &lt;a href=&quot;https:&#x2F;&#x2F;mega.nz&#x2F;&quot;&gt;MEGA&lt;&#x2F;a&gt;
or &lt;a href=&quot;https:&#x2F;&#x2F;spideroak.com&#x2F;&quot;&gt;Spideroak&lt;&#x2F;a&gt;? They don&#x27;t support WebDAV,
and I don&#x27;t feel like going through a file system every time I update passwords
(most phone clients only allow file access through a specific app).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Why not use &amp;lt;some other service&amp;gt; that (supports WebDAV or syncs automatically on phones) and has a Linux client? I haven&#x27;t heard of &amp;lt;some other service&amp;gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Rewriting Jython</title>
        <published>2018-06-09T00:00:00+00:00</published>
        <updated>2018-06-09T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/rewriting-jython/"/>
        <id>https://jyn.dev/rewriting-jython/</id>
        
        <summary type="html">I got bored one day and started rewriting Jython</summary>
        
        <content type="html" xml:base="https://jyn.dev/rewriting-jython/">&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;a class=&quot;zola-anchor&quot; href=&quot;#intro&quot; aria-label=&quot;Anchor link for: intro&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Have you heard of Jython? It&#x27;s a variant of Python written in Java instead of C;
it lets you use native Java classes in python code.
The most common use case is integration with large existing Java codebases:
You can reuse Java code and still get the readability and conciseness of python.&lt;&#x2F;p&gt;
&lt;p&gt;I was thinking about types in Python, particularly how it allows
primitive operators to be overridden (+-&#x2F;*%). For those unfamiliar with Python classes,
check out my &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;object-oriented-python&#x2F;&quot;&gt;previous post&lt;&#x2F;a&gt;;
essentially it uses methods like &lt;code&gt;__add__&lt;&#x2F;code&gt;, &lt;code&gt;__sub__&lt;&#x2F;code&gt;, etc. as interfaces.
This lets you do things like&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;which would throw nasty exceptions in most other languages.&lt;&#x2F;p&gt;
&lt;p&gt;Because python allows any type to be called with these methods, it&#x27;s the
responsibility of the class implementing the interface to ensure type safety,
for example &lt;code&gt;42 - &#x27;2&#x27;&lt;&#x2F;code&gt; will throw &lt;code&gt;TypeError: unsupported operand type(s) for -: &#x27;int&#x27; and &#x27;str&#x27;&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I thought to myself, this looks doable.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;reflections&quot;&gt;Reflections&lt;a class=&quot;zola-anchor&quot; href=&quot;#reflections&quot; aria-label=&quot;Anchor link for: reflections&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Java has a rarely-used but very powerful &lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;tutorial&#x2F;reflect&#x2F;&quot;&gt;reflection API&lt;&#x2F;a&gt;.
This allows you to do anything from get the class of a variable at runtime
(and do different things depending on which class it is)
to get the methods and constructors of an unknown class.
My (primitive) implementation of Jython make heavy use of reflections to use the
builtin Java classes and avoiding writing an interpreter from scratch.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;duck-typing&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Duck_typing&quot;&gt;Duck Typing&lt;&#x2F;a&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#duck-typing&quot; aria-label=&quot;Anchor link for: duck-typing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Since python doesn&#x27;t enforce types, we won&#x27;t either. That means we have to call
methods at runtime, without knowing the class of the variable.
&lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;8&#x2F;docs&#x2F;api&#x2F;java&#x2F;lang&#x2F;Class.html#getMethods--&quot;&gt;Java lets you do this!&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;[&#x2F;&#x2F;]: # Secondly, since we want to allow inheritance, we have to find the constructors at runtime.
[&#x2F;&#x2F;]: # This &lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;8&#x2F;docs&#x2F;api&#x2F;java&#x2F;lang&#x2F;Class.html#getConstructors--&quot;&gt;can be done&lt;&#x2F;a&gt; as well,
[&#x2F;&#x2F;]: # but since we want the types to match, we have to iterate all the constructors until we find one that&#x27;s compatible.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;api&quot;&gt;API&lt;a class=&quot;zola-anchor&quot; href=&quot;#api&quot; aria-label=&quot;Anchor link for: api&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;The current API is exactly one class, &lt;code&gt;NumberWrapper&lt;&#x2F;code&gt;, which does nothing more than
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Type_conversion#Type_promotion&quot;&gt;type promotion&lt;&#x2F;a&gt; (and demotion).
I&#x27;m currently working on a &lt;code&gt;ListWrapper&lt;&#x2F;code&gt; which would demonstrate the power of
duck typing more clearly.
Because this is a toy project (and because parsing is hard), I have not implemented
an interpreter; the sample usage would be &lt;code&gt;add(new NumberWrapper(5), new NumberWrapper(-.14))&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The full code is available &lt;a href=&quot;&#x2F;assets&#x2F;jython.java&quot;&gt;here&lt;&#x2F;a&gt;.
Its output is as follows:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ javac jython.java -Xlint:unchecked
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ java main
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;3.5
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note that despite the extensive use of duck typing there are no type warnings;
&lt;code&gt;javac&lt;&#x2F;code&gt; emits warnings only for casts, not calls to the reflection API.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Copying Generic Arrays in Java</title>
        <published>2018-03-29T00:00:00+00:00</published>
        <updated>2018-03-29T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/copying-generic-arrays-in-java/"/>
        <id>https://jyn.dev/copying-generic-arrays-in-java/</id>
        
        <summary type="html">The problem that&#x27;s been bothering me for a week</summary>
        
        <content type="html" xml:base="https://jyn.dev/copying-generic-arrays-in-java/">&lt;h1 id=&quot;intro&quot;&gt;Intro&lt;a class=&quot;zola-anchor&quot; href=&quot;#intro&quot; aria-label=&quot;Anchor link for: intro&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;Copying an array.
It sounds so simple - run a quick &lt;code&gt;for&lt;&#x2F;code&gt; loop,
or better yet, &lt;code&gt;System.arraycopy&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; class=&quot;language-java z-code&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;System&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;arraycopy&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;array&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; tmp&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;What if you need to perform a destructive operation? &lt;sup&gt;&lt;a href=&quot;#1&quot;&gt;[1]&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;
In my Data Structures class, we&#x27;re asked to implement heap sort
without modifying the original array.
This is simple enough: use &lt;code&gt;array.clone&lt;&#x2F;code&gt;.
It preserves the order of the original array while giving you a new instance.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; class=&quot;language-java z-code&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; tmp &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;clone&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Remember that this is a destructive operation, however;
you need a new third array in which to store the result.
Only one problem: Java doesn&#x27;t allow generic arrays to be created.
Trying to do so is a compile-time error:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; class=&quot;language-java z-code&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-identifier z-java&quot;&gt;&lt;span class=&quot;z-storage z-type z-java&quot;&gt;class&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-class z-java&quot;&gt;Generic&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-declaration z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-type z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-java&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-constructor z-java&quot;&gt;Generic&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-support z-class z-java&quot;&gt;System&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;out&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;println&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-array-initialization z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-java&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-java&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-storage z-type z-void z-java&quot;&gt;void&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-java&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-java&quot;&gt;args&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Generic&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-java&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-parens z-constructor-arguments z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; javac Generic.java&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Generic.java:3:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; error: generic array creation&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;System.out.println&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;(new T&lt;span class=&quot;z-keyword z-control z-regexp z-set z-begin z-shell&quot;&gt;[&lt;&#x2F;span&gt;0&lt;span class=&quot;z-keyword z-control z-regexp z-set z-end z-shell&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;                           &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;^&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;1&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; error&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Fine, let&#x27;s do some &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;530289&quot;&gt;ugly casting&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;T[] array = (T[]) new Object[0];&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;strange-happenings&quot;&gt;Strange happenings&lt;a class=&quot;zola-anchor&quot; href=&quot;#strange-happenings&quot; aria-label=&quot;Anchor link for: strange-happenings&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;So far, this has all been pretty standard.
Java has &lt;a href=&quot;https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;tutorial&#x2F;java&#x2F;generics&#x2F;erasure.html&quot;&gt;type erasure&lt;&#x2F;a&gt;, Java generics are a pain, yadda yadda.
Now we get to the strange part of this post.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; class=&quot;language-java z-code&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-identifier z-java&quot;&gt;&lt;span class=&quot;z-storage z-type z-java&quot;&gt;class&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-class z-java&quot;&gt;Copy&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-declaration z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-type z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-java&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;final&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-field z-java&quot;&gt;array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-constructor z-java&quot;&gt;Copy&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-java&quot;&gt;array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-variable z-language z-java&quot;&gt;this&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;array &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-java&quot;&gt;getNew&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; result &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Object&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-array-initialization z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-java&quot;&gt;[&lt;&#x2F;span&gt;array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-java&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-loop z-for z-java&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-primitive z-java&quot;&gt;int&lt;&#x2F;span&gt; i &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt; i &lt;span class=&quot;z-keyword z-operator z-comparison z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt; array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt; i&lt;span class=&quot;z-keyword z-operator z-increment-decrement z-java&quot;&gt;++&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;            result[i] &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; array[i]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;        &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-java&quot;&gt;return&lt;&#x2F;span&gt; result&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-storage z-type z-void z-java&quot;&gt;void&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-java&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-java&quot;&gt;args&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-support z-class z-java&quot;&gt;Integer&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; arr &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Copy&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;Integer&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-java&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-parens z-constructor-arguments z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Integer&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-array-initialization z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-java&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-java&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-braces z-array-initialization z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;getNew&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; javac copy.java&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Note:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; copy.java uses unchecked or unsafe operations.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Note:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; Recompile with&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;Xlint&lt;&#x2F;span&gt;:unchecked for details.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; java copy &lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Exception&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; in thread &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;main&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; java.lang.ClassCastException: [Ljava.lang.Object&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cannot&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; be cast to [Ljava.lang.Integer&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;        &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;at&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; copy.main(copy.java:16&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;What?!‽
Not only are we getting a &lt;code&gt;ClassCastException&lt;&#x2F;code&gt; trying to convert &lt;code&gt;Integer&lt;&#x2F;code&gt; to &lt;code&gt;Integer&lt;&#x2F;code&gt;,
but we&#x27;re getting it at runtime, not compile-time!
Worse yet, there&#x27;s no traceback - the error pointed to &lt;code&gt;main&lt;&#x2F;code&gt;, not to &lt;code&gt;getNew&lt;&#x2F;code&gt;!&lt;&#x2F;p&gt;
&lt;h1 id=&quot;my-solution&quot;&gt;My solution&lt;a class=&quot;zola-anchor&quot; href=&quot;#my-solution&quot; aria-label=&quot;Anchor link for: my-solution&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;What happens when you declare a new array in Java?
You might assume that this is translated directly to Java bytecode, but you would be incorrect.
&lt;code&gt;javac&lt;&#x2F;code&gt; actually translates this to &lt;code&gt;java.lang.reflect.Array.newInstance&lt;&#x2F;code&gt;, which in turn
&lt;a href=&quot;http:&#x2F;&#x2F;hg.openjdk.java.net&#x2F;jdk&#x2F;jdk&#x2F;file&#x2F;1f9dd2360b17&#x2F;src&#x2F;java.base&#x2F;share&#x2F;classes&#x2F;java&#x2F;lang&#x2F;reflect&#x2F;Array.java#l76&quot;&gt;calls&lt;&#x2F;a&gt;
the native method &lt;code&gt;java.lang.reflect.Array.newArray&lt;&#x2F;code&gt;.
In fact, you can call this method yourself, but only if you have the class type.
Type parameters don&#x27;t cut it.&lt;&#x2F;p&gt;
&lt;p&gt;Well, if you have an instance of the class, you can call &lt;code&gt;instance.getClass()&lt;&#x2F;code&gt;.
If you don&#x27;t, you can (in this particular case) return a null pointer,
since the array must be empty.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; class=&quot;language-java z-code&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;z-source z-java&quot;&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-java&quot;&gt;%&lt;&#x2F;span&gt; cat copy&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;java
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-identifier z-java&quot;&gt;&lt;span class=&quot;z-storage z-type z-java&quot;&gt;class&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-class z-java&quot;&gt;Copy&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-declaration z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-type z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-java&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;private&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;final&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-field z-java&quot;&gt;array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-constructor z-java&quot;&gt;Copy&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-java&quot;&gt;array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-variable z-language z-java&quot;&gt;this&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;array &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-java&quot;&gt;getNew&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-conditional z-if z-java&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length &lt;span class=&quot;z-keyword z-operator z-comparison z-java&quot;&gt;==&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-flow z-return z-java&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-java&quot;&gt;null&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; result &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-java&quot;&gt;&lt;span class=&quot;z-support z-type z-package z-java&quot;&gt;java&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-type z-package z-java&quot;&gt;lang&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-type z-package z-java&quot;&gt;reflect&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;Array&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;newInstance&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;array[&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;]&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;getClass&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-loop z-for z-java&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-type z-primitive z-java&quot;&gt;int&lt;&#x2F;span&gt; i &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt; i &lt;span class=&quot;z-keyword z-operator z-comparison z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt; array&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt; i&lt;span class=&quot;z-keyword z-operator z-increment-decrement z-java&quot;&gt;++&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;            result[i] &lt;span class=&quot;z-meta z-assignment z-rhs z-java&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-java&quot;&gt;=&lt;&#x2F;span&gt; array[i]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;        &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-java&quot;&gt;return&lt;&#x2F;span&gt; result&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-storage z-type z-void z-java&quot;&gt;void&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-identifier z-java&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-java&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-parameters z-java&quot;&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-storage z-modifier z-array z-java&quot;&gt;[]&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-java&quot;&gt;args&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;        &lt;span class=&quot;z-support z-class z-java&quot;&gt;System&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;out&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;println&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Copy&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-begin z-java&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;Integer&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-generic z-end z-java&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-parens z-constructor-arguments z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-instantiation z-java&quot;&gt;&lt;span class=&quot;z-keyword z-other z-storage z-new z-java&quot;&gt;new&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Integer&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-array-initialization z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-java&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-java&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-braces z-array-initialization z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-comma z-java&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-java&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-braces z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;getNew&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-java&quot;&gt;&lt;span class=&quot;z-meta z-method z-body z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-java&quot;&gt;&lt;span class=&quot;z-meta z-class z-body z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; javac &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-shell&quot;&gt;_&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Note:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; copy.java uses unchecked or unsafe operations.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Note:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; Recompile with&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;Xlint&lt;&#x2F;span&gt;:unchecked for details.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jyn@debian-thinkpad&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;Documents&#x2F;Programming&#x2F;Java&#x2F;test&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; java copy &lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;[Ljava.lang.Integer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-logical z-continue z-shell&quot;&gt;;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;@28d93b30&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;a class=&quot;zola-anchor&quot; href=&quot;#conclusion&quot; aria-label=&quot;Anchor link for: conclusion&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;I still have no idea what&#x27;s going on here - my best guess is that due to type erasure,
the &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;95679&quot;&gt;JIT compiler&lt;&#x2F;a&gt; doesn&#x27;t know that the objects in
&lt;code&gt;array&lt;&#x2F;code&gt; are actually valid &lt;code&gt;Integer&lt;&#x2F;code&gt;s.&lt;&#x2F;p&gt;
&lt;div class=&quot;footnote&quot; name=&quot;1&quot;&gt;&lt;sup&gt;1&lt;&#x2F;sup&gt;For the purpose of this post, I assume that only a shallow copy is necessary.&lt;&#x2F;div&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Object Oriented Python</title>
        <published>2018-03-03T00:00:00+00:00</published>
        <updated>2018-03-03T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/object-oriented-python/"/>
        <id>https://jyn.dev/object-oriented-python/</id>
        
        <summary type="html">creating classes and objects in Python</summary>
        
        <content type="html" xml:base="https://jyn.dev/object-oriented-python/">&lt;h1 id=&quot;intro&quot;&gt;Intro&lt;a class=&quot;zola-anchor&quot; href=&quot;#intro&quot; aria-label=&quot;Anchor link for: intro&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;Python is a strange language.
You can do a lot with it, up to and including shooting your own foot off.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;python-allows&quot;&gt;Python allows&lt;a class=&quot;zola-anchor&quot; href=&quot;#python-allows&quot; aria-label=&quot;Anchor link for: python-allows&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;array splicing&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;l&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;l&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-slice z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;l&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-slice z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;l&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-slice z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-slice z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;appending lists with the &#x27;+&#x27; operator&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;6&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;6&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;using the first string of a progam as documentation&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;bash&quot; class=&quot;language-bash z-code&quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; cat test.py&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;This is a docstring.&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;(__doc__&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt; &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;&lt;span class=&quot;z-meta z-group z-expansion z-job z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-job z-shell&quot;&gt;%&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; python &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-shell&quot;&gt;_&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;This&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; is a docstring.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;renaming objects as they are imported&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;sys&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;stdin&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-import z-as z-python&quot;&gt;as&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;s&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;s&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;_io&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;TextIOWrapper&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;name&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;mode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;r&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;encoding&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;UTF-8&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;modifying the type of a variable at runtime&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sys&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;hi&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sys&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;stdin&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;_io&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;TextIOWrapper&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;name&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;mode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;r&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;encoding&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;UTF-8&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;within a function, using a variable that has not yet been declared&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;add_global&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-storage z-modifier z-global z-python&quot;&gt;global&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;add_global&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-python&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;br&gt;&lt;br&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;python-disallows&quot;&gt;Python disallows&lt;a class=&quot;zola-anchor&quot; href=&quot;#python-disallows&quot; aria-label=&quot;Anchor link for: python-disallows&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;declaring types&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-python&quot;&gt;int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-python&quot;&gt;int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;^&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-exception z-python&quot;&gt;SyntaxError&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;invalid&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;syntax&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;throwing errors before runtime&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;add_local&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;add_local&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Traceback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;most&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;recent&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;call&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;last&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;, &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;in&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;module&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;, &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;in&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;add_local&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-exception z-python&quot;&gt;UnboundLocalError&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;local&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;variable&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;x&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;referenced&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;before&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;assignment&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;declaring and assigning a global variable in the same statement&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;myfunc&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-storage z-modifier z-global z-python&quot;&gt;global&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt; &lt;span class=&quot;z-invalid z-illegal z-name z-storage z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-invalid z-illegal z-name z-storage z-python&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-global z-python&quot;&gt;global&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;x&lt;&#x2F;span&gt; &lt;span class=&quot;z-invalid z-illegal z-name z-storage z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-invalid z-illegal z-name z-storage z-python&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;             &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;^&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-exception z-python&quot;&gt;SyntaxError&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;invalid&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;syntax&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;bad indentation&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-for z-python&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-for z-in z-python&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt; &lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-loop z-for z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;^&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-exception z-python&quot;&gt;IndentationError&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;expected&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;an&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;indented&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;block&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;13591970&#x2F;&quot;&gt;tail call optimization&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.python.org&#x2F;dev&#x2F;peps&#x2F;pep-3103&#x2F;&quot;&gt;switch statements&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;In this article, I go over some of the things you can do with object-oriented python,
some things you should do, and some you really shouldn&#x27;t.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;objects-in-python&quot;&gt;Objects in python&lt;a class=&quot;zola-anchor&quot; href=&quot;#objects-in-python&quot; aria-label=&quot;Anchor link for: objects-in-python&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;In other object-oriented languages I am familiar with, notably Java,
each object has its own methods you must learn to use.
&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;1965500&#x2F;&quot;&gt;&lt;code&gt;size&lt;&#x2F;code&gt;, &lt;code&gt;length&lt;&#x2F;code&gt;, and &lt;code&gt;length()&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;,
for example, are easily confused even for experienced developers.&lt;&#x2F;p&gt;
&lt;p&gt;In python, there is only one function, and it is not a property of the object.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Similarly, all array-like objects can be treated as arrays:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;135&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;5&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;how-is-this-done&quot;&gt;How is this done?&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-is-this-done&quot; aria-label=&quot;Anchor link for: how-is-this-done&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;In Java, C++, and every other language I can think of,
objects are essentially implemented as very complicated structs:
there are pointers to data and void pointers to functions.
All object pointers are void pointers at runtime;
this is safe because types are checked at compile time.
How would you implement a global type-independent &lt;code&gt;length&lt;&#x2F;code&gt; function
when you don&#x27;t know what length means for that object?
The closest you could get is a wrapper:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; class=&quot;language-java z-code&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;public&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-modifier z-java&quot;&gt;static&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-primitive z-java&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;length&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-support z-class z-java&quot;&gt;T&lt;&#x2F;span&gt; object&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-switch z-java&quot;&gt;switch&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-parens z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;object&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-java&quot;&gt;class&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-java&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-case z-java&quot;&gt;case&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;Array&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-java&quot;&gt;class&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-ternary z-java&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-java&quot;&gt;return&lt;&#x2F;span&gt; object&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;length&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-case z-java&quot;&gt;case&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;List&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-java&quot;&gt;class&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-ternary z-java&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-java&quot;&gt;return&lt;&#x2F;span&gt; object&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;size&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-keyword z-control z-conditional z-case z-java&quot;&gt;case&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-class z-java&quot;&gt;String&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-java&quot;&gt;class&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-ternary z-java&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-java&quot;&gt;return&lt;&#x2F;span&gt; object&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-java&quot;&gt;&lt;span class=&quot;z-variable z-function z-java&quot;&gt;length&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-java&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-java&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-java&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;    &lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-java&quot;&gt;.&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-meta z-block z-java&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-java&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;It&#x27;s a nightmare just to write 3 of those switch cases;
imagine how awful it would be for every object in &lt;code&gt;java.util&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Well, it turns out, that wrapper is essentially what python does.
When you run &lt;code&gt;len(object)&lt;&#x2F;code&gt;, all it does is &lt;code&gt;return object.__len__()&lt;&#x2F;code&gt;!
It&#x27;s the same for every other attribute -
accessing an item, iterating, the whole
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Shebang_(Unix)&quot;&gt;shebang&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;obj&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__len__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;         &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; guarenteed by IEEE to be random
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__getitem__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;index&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;         &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__iter__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;         &lt;span class=&quot;z-keyword z-control z-flow z-yield z-python&quot;&gt;yield&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;obj&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;613&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-for z-python&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-for z-in z-python&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-loop z-for z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We have to &lt;code&gt;yield&lt;&#x2F;code&gt; 1 instead of &lt;code&gt;return&lt;&#x2F;code&gt; because &lt;code&gt;iter&lt;&#x2F;code&gt; takes a
&lt;a href=&quot;https:&#x2F;&#x2F;wiki.python.org&#x2F;moin&#x2F;Generators&quot;&gt;generator&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;using-objects&quot;&gt;Using objects&lt;a class=&quot;zola-anchor&quot; href=&quot;#using-objects&quot; aria-label=&quot;Anchor link for: using-objects&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;So, now we know how objects work -
all we have to do is implement the builtin methods.
How do you extend a class, though?
Java&#x27;s entire paradigm is built around inheritance.&lt;&#x2F;p&gt;
&lt;p&gt;You extend classes in Python by passing them to the constructor:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-python&quot;&gt;list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;             &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;Hello from my_list!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-empty z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-sequence z-list z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-sequence z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Hello&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;my_list&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;!
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;And what&#x27;s up with that pesky &lt;code&gt;self&lt;&#x2F;code&gt;, anyway?&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;             &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;Hello from my_function!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_other_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;             &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;Hello from my_other_function!&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Traceback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;most&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;recent&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;call&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;last&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;, &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;in&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;module&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-exception z-python&quot;&gt;TypeError&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;takes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;positional&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;arguments&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;but&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;was&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;given&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;my_other_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Hello&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;my_other_function&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;!
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;It turns out that Python automatically passes &lt;code&gt;self&lt;&#x2F;code&gt; to each method when it&#x27;s called.
The reason for this is one of my least favorite parts of Python:
there&#x27;s no class namespace. If you want to refer to an attribute of the instance,
you have to use &lt;code&gt;self&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;obj&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__init__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;         &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;num&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;f&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;         &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;num&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;     &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-invalid z-illegal z-name z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;f2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;         &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;num&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;obj&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;num&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;f&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Traceback&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;most&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;recent&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;call&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;last&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;, &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;in&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;module&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;  &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;File&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&amp;lt;stdin&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;line&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;5&lt;&#x2F;span&gt;, &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;in&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;f&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-exception z-python&quot;&gt;NameError&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-annotation z-variable z-python&quot;&gt;:&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;name&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;num&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;is&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-python&quot;&gt;not&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;defined&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;o&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;f2&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;constructors-and-destructors&quot;&gt;Constructors and Destructors&lt;a class=&quot;zola-anchor&quot; href=&quot;#constructors-and-destructors&quot; aria-label=&quot;Anchor link for: constructors-and-destructors&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;So . . . about those.&lt;&#x2F;p&gt;
&lt;p&gt;When you instantiate an object in python, it calls
&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;q&#x2F;674304&quot;&gt;&lt;code&gt;__new__&lt;&#x2F;code&gt; then &lt;code&gt;__init__&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;, in that order.
&lt;code&gt;__init__&lt;&#x2F;code&gt; is &lt;code&gt;None&lt;&#x2F;code&gt; by default; &lt;code&gt;__new__&lt;&#x2F;code&gt; may or may not be.
It&#x27;s considered bad practice to define &lt;code&gt;__new__&lt;&#x2F;code&gt; in your program.&lt;&#x2F;p&gt;
&lt;p&gt;When an object is destroyed through garbage collection,
&lt;code&gt;__del__&lt;&#x2F;code&gt; is called.&lt;&#x2F;p&gt;
&lt;p&gt;This sounds simple enough so far.&lt;&#x2F;p&gt;
&lt;p&gt;If &lt;code&gt;__init__&lt;&#x2F;code&gt; is interrupted, &lt;code&gt;__del__&lt;&#x2F;code&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;2433847&quot;&gt;may or may not be called&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;If you use a &lt;code&gt;with&lt;&#x2F;code&gt; statement, i.e. &lt;code&gt;with open(filename) as f:&lt;&#x2F;code&gt;,
&lt;em&gt;neither &lt;code&gt;__init__&lt;&#x2F;code&gt; nor &lt;code&gt;__del__&lt;&#x2F;code&gt; are called&lt;&#x2F;em&gt;; &lt;code&gt;__enter__&lt;&#x2F;code&gt; and &lt;code&gt;__exit__&lt;&#x2F;code&gt;
are called instead.&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;m still confused by these.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;a class=&quot;zola-anchor&quot; href=&quot;#conclusion&quot; aria-label=&quot;Anchor link for: conclusion&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;While python certainly supports objects,
I think it is harder to create objects in python than in other languages,
especially compared to the simplicity of the rest of the language.
You shouldn&#x27;t have to know how the garbage collector handles references
to create a deconstructor (I haven&#x27;t seen any syntax for deconstructors I liked,
but that&#x27;s a different topic). You especially should &lt;em&gt;not&lt;&#x2F;em&gt; have to create
methods with two underscores before and afterwards to have a useful class.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;&#x2F;rant&amp;gt;&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;example&quot;&gt;Example&lt;a class=&quot;zola-anchor&quot; href=&quot;#example&quot; aria-label=&quot;Anchor link for: example&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;I&#x27;ll leave you with an example from my research project:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;keras&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;utils&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;data_utils&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Sequence&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;pandas&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;read_csv&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-class z-python&quot;&gt;&lt;span class=&quot;z-storage z-type z-class z-python&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-class z-python&quot;&gt;class&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-class z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;FileGenerator&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-class z-inheritance z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-inheritance z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-class z-inheritance z-python&quot;&gt;&lt;span class=&quot;z-entity z-other z-inherited-class z-python&quot;&gt;Sequence&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-inheritance z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-class z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-class z-begin z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;    &lt;span class=&quot;z-storage z-type z-function z-python&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__init__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameters z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;data&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-default-value z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;AmPEP-master&#x2F;combined_sequences.txt&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-parameters z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-default-value z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;128&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-parameters z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;                 &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;ratio&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-default-value z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-separator z-parameters z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;labels&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-default-value z-python&quot;&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;AmPEP-master&#x2F;labels.txt&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-function z-begin z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;positive_matches&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3286&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;filename&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;open&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;filename&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-python&quot;&gt;r&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;length&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;positive_matches&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;positive_matches&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ratio&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;&#x2F;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;&#x2F;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;    &lt;span class=&quot;z-storage z-type z-function z-python&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__len__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-function z-begin z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;length&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;    &lt;span class=&quot;z-storage z-type z-function z-python&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__getitem__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-parameters z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;index&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-function z-begin z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;data&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;read_csv&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;data&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;header&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;None&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;skiprows&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;index&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;                        &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;nrows&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;labels&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;read_csv&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;labels&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;header&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;None&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;skiprows&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;index&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;                        &lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;nrows&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;batch_size&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;data&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;labels&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;    &lt;span class=&quot;z-storage z-type z-function z-python&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-python&quot;&gt;def&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-magic z-python&quot;&gt;__iter__&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-python&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parameters z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-function z-begin z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;        &lt;span class=&quot;z-keyword z-control z-flow z-return z-python&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-python&quot;&gt;[&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-arguments z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-python&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-expression z-generator z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-for z-generator z-python&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;i&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-for z-in z-python&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;range&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-language z-python&quot;&gt;self&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Password Safety</title>
        <published>2018-02-24T00:00:00+00:00</published>
        <updated>2018-02-24T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/password-safety/"/>
        <id>https://jyn.dev/password-safety/</id>
        
        <summary type="html">What a password manager is and how to use one</summary>
        
        <content type="html" xml:base="https://jyn.dev/password-safety/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;a class=&quot;zola-anchor&quot; href=&quot;#introduction&quot; aria-label=&quot;Anchor link for: introduction&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;On the web today, there many different services we use.
We use email, Facebook, GitHub, Google, Twitter, dozens of various services.
Each of these require their own username and password.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;re told, of course, to use a different password for each account.
&lt;a href=&quot;https:&#x2F;&#x2F;www.troyhunt.com&#x2F;science-of-password-selection&#x2F;&quot;&gt;Only 70% of us&lt;&#x2F;a&gt;, however, actually do so.
How are we supposed to remember a &lt;a href=&quot;https:&#x2F;&#x2F;www.nist.gov&#x2F;publications&#x2F;character-strings-memory-and-passwords-what-recall-study-can-tell-us&quot;&gt;dozen random passwords&lt;&#x2F;a&gt;, each different?
Traditionally, we use the same password for each,
perhaps with &lt;a href=&quot;https:&#x2F;&#x2F;reusablesec.blogspot.com&#x2F;2010&#x2F;10&#x2F;new-paper-on-password-security-metrics.html&quot;&gt;slight differences&lt;&#x2F;a&gt;.
This makes it very easy for hackers to &lt;a href=&quot;https:&#x2F;&#x2F;xkcd.com&#x2F;792&#x2F;&quot;&gt;get into your accounts&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;There are very few common remedies for this -
there&#x27;s ways to &lt;a href=&quot;https:&#x2F;&#x2F;haveibeenpwned.com&#x2F;&quot;&gt;check if you&#x27;ve been hacked&lt;&#x2F;a&gt;
and &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Multi-factor_authentication&quot;&gt;multi-factor auth&lt;&#x2F;a&gt;,
but most peoples&#x27; response is to either write sticky notes of passwords,
or ignore the problem altogether.&lt;&#x2F;p&gt;
&lt;p&gt;This does work if you don&#x27;t &lt;a href=&quot;&#x2F;assets&#x2F;password.jpg&quot;&gt;leave your passwords lying around&lt;&#x2F;a&gt;.
It is inconvenient, however, and doesn&#x27;t scale to a large password database.
What you should be using is a &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Password_manager&quot;&gt;password manager&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;password-managers&quot;&gt;Password Managers&lt;a class=&quot;zola-anchor&quot; href=&quot;#password-managers&quot; aria-label=&quot;Anchor link for: password-managers&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;A password manager is an easy way to keep track of passwords.
It can be anything from an &lt;a href=&quot;https:&#x2F;&#x2F;support.office.com&#x2F;en-us&#x2F;article&#x2F;Protect-an-Excel-file-7359d4ae-7213-4ac2-b058-f75e9311b599&quot;&gt;encrypted Excel Spreadsheet&lt;&#x2F;a&gt;
to &lt;a href=&quot;https:&#x2F;&#x2F;duckduckgo.com&#x2F;?q=browser+manage+password+saving&quot;&gt;your browser&#x27;s builtin manager&lt;&#x2F;a&gt;.
It takes one &#x27;master password&#x27;, and in return keeps track of everything else for you.
There&#x27;s no need to remember multiple passwords,
it&#x27;s easy to meet any complexity requirement,
and it doesn&#x27;t matter how often you&#x27;re required to change your passwords
(which is &lt;a href=&quot;http:&#x2F;&#x2F;cs.unc.edu&#x2F;~fabian&#x2F;papers&#x2F;PasswordExpire.pdf&quot;&gt;bad practice&lt;&#x2F;a&gt;, by the way.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-to-use&quot;&gt;What to use&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-to-use&quot; aria-label=&quot;Anchor link for: what-to-use&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Wikipedia has &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;List_of_password_managers&quot;&gt;an extensive list&lt;&#x2F;a&gt;
of password managers.&lt;&#x2F;p&gt;
&lt;p&gt;When choosing a manager, you should consider several things:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;What features are you looking for? What would be a dealbreaker?&lt;&#x2F;li&gt;
&lt;li&gt;How much security are you looking for? What is your
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Threat_model&quot;&gt;threat model&lt;&#x2F;a&gt;?&lt;&#x2F;li&gt;
&lt;li&gt;How much convenience are you willing to sacrifice?&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I recommend &lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&quot;&gt;Keepass&lt;&#x2F;a&gt; because it&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;encrypts your databases with &lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&#x2F;help&#x2F;base&#x2F;security.html&quot;&gt;state of the art encryption&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;organizes your passwords &lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&#x2F;features.html#lnkgroups&quot;&gt;by groups&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;stores usernames, URLs, and
&lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&#x2F;features.html#lnktimes&quot;&gt;arbitrary data&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;randomly &lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&#x2F;help&#x2F;base&#x2F;pwgenerator.html&quot;&gt;generates passwords&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;is &lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&#x2F;download.html&quot;&gt;open source&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;is fully interoperable with many &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;KeePass#Unofficial_KeePass_derivatives&quot;&gt;other programs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;has &lt;a href=&quot;https:&#x2F;&#x2F;keepass.info&#x2F;features.html&quot;&gt;many other features&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Once you start using a password manager, you can start using passwords like
&lt;code&gt;W(xv|u7N&#x27;&#x27;fAs,{t|J&lt;&#x2F;code&gt; for all your accounts.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;If you&#x27;re not on Windows, or just want more features, check out &lt;a href=&quot;https:&#x2F;&#x2F;keepassxc.org&#x2F;&quot;&gt;Keepassxc&lt;&#x2F;a&gt;
(Keepass Cross-Platform Community Edition). It supports global autotype and
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Time-based_One-time_Password_Algorithm&quot;&gt;timed one-time passwords&lt;&#x2F;a&gt;, a.k.a. two-factor auth.&lt;&#x2F;li&gt;
&lt;li&gt;I&#x27;ve written a &lt;a href=&quot;https:&#x2F;&#x2F;drive.google.com&#x2F;open?id=15u4uXxC5K7v2Llsu8L4JVDcFNjyavW4pKBJ2GW5YV5M&quot;&gt;presentation on secure passwords&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;security.stackexchange.com&#x2F;q&#x2F;6682&quot;&gt;StackOverflow on password reuse&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;The figure for reuse &lt;a href=&quot;https:&#x2F;&#x2F;www.lightbluetouchpaper.org&#x2F;2011&#x2F;02&#x2F;09&#x2F;measuring-password-re-use-empirically&#x2F;&quot;&gt;may be lower&lt;&#x2F;a&gt; than I&#x27;ve claimed,
but it&#x27;s still a minimum of 30%&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Speed Up!</title>
        <published>2018-02-14T00:00:00+00:00</published>
        <updated>2018-02-14T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/speed-up/"/>
        <id>https://jyn.dev/speed-up/</id>
        
        <summary type="html">This site is now a lot faster.</summary>
        
        <content type="html" xml:base="https://jyn.dev/speed-up/">&lt;p&gt;Good news! As of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;jyn514.github.io&#x2F;commit&#x2F;525779f74014e46b11d0d035314806fa234a58d4&quot;&gt;today&lt;&#x2F;a&gt;,
my site now takes less than a tenth of the time to load.&lt;&#x2F;p&gt;
&lt;p&gt;I found an excellent &lt;a href=&quot;https:&#x2F;&#x2F;gtmetrix.com&#x2F;&quot;&gt;site&lt;&#x2F;a&gt; which tests page load speeds.
It told me that my site (which is mostly static pages)
was taking a full 4.3 seconds to load.
I was very confused by this - I don&#x27;t have any large pages that I&#x27;m aware of;
the &lt;a href=&quot;https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;CSS&quot;&gt;CSS&lt;&#x2F;a&gt; is &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Minification_(programming)&quot;&gt;minified&lt;&#x2F;a&gt; and there&#x27;s almost no JavaScript.&lt;&#x2F;p&gt;
&lt;p&gt;It turns out that the nifty DNSSEC testers I&#x27;d put in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;jyn514.github.io&#x2F;commit&#x2F;988425efe8b17ea75509f8f940d2db7dd042db4b&quot;&gt;the other day&lt;&#x2F;a&gt;
were taking a second each to load.
Now, a second doesn&#x27;t sound like a lot, but it makes a &lt;a href=&quot;https:&#x2F;&#x2F;developers.google.com&#x2F;web&#x2F;fundamentals&#x2F;performance&#x2F;rail#ux&quot;&gt;big difference&lt;&#x2F;a&gt;
to how users perceive the site. 3.5 seconds - the speed up I&#x27;ve since gotten -
is an eternity on the web.&lt;&#x2F;p&gt;
&lt;p&gt;Honestly, I feel a lot more comfortable without the DNSSEC testers.
They always felt suspiciously like analytics (which I firmly oppose),
even though I didn&#x27;t see the results.&lt;&#x2F;p&gt;
&lt;p&gt;The site is now at 223 milliseconds per load and counting.
The slowest things still present are Open Sans (loaded from Google fonts, nearly half the load time)
and the second DNS tester.
However, I&#x27;ve been told the site looks a lot nicer than before, so I&#x27;m loath to remove the nice fonts.
If I were self-hosting, I could fix this with caching, but I unfortunately don&#x27;t control GitHub&#x27;s servers.
Let me know if you have any suggestions!&lt;&#x2F;p&gt;
&lt;h1 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;Google has a &lt;a href=&quot;https:&#x2F;&#x2F;testmysite.thinkwithgoogle.com&quot;&gt;&#x27;mobile experience&#x27; site&lt;&#x2F;a&gt; that I tried first.
Unfortunately, it kept giving me errors.&lt;&#x2F;li&gt;
&lt;li&gt;Proudly inspired by &lt;a href=&quot;https:&#x2F;&#x2F;danluu.com&#x2F;octopress-speedup&#x2F;&quot;&gt;this post&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Using PGP Keys</title>
        <published>2018-02-11T00:00:00+00:00</published>
        <updated>2018-02-11T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/using-pgp-keys/"/>
        <id>https://jyn.dev/using-pgp-keys/</id>
        
        <summary type="html">Why and How to use encryption</summary>
        
        <content type="html" xml:base="https://jyn.dev/using-pgp-keys/">&lt;h1 id=&quot;what-is-gpg&quot;&gt;What is GPG?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-is-gpg&quot; aria-label=&quot;Anchor link for: what-is-gpg&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gnupg.org&#x2F;&quot;&gt;GPG&lt;&#x2F;a&gt; is a program for encrypting your files, including&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Documents&lt;&#x2F;li&gt;
&lt;li&gt;Music&lt;&#x2F;li&gt;
&lt;li&gt;Programs&lt;&#x2F;li&gt;
&lt;li&gt;Anything else you can store digitally&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.xkcd.com&#x2F;1475&#x2F;&quot;&gt;Technically&lt;&#x2F;a&gt;, GPG implements the &lt;a href=&quot;https:&#x2F;&#x2F;www.openpgp.org&#x2F;&quot;&gt;PGP&lt;&#x2F;a&gt; standard,
which is &lt;a href=&quot;https:&#x2F;&#x2F;www.ietf.org&#x2F;rfc&#x2F;rfc4880.txt&quot;&gt;mandated&lt;&#x2F;a&gt; by the &lt;a href=&quot;https:&#x2F;&#x2F;www.ietf.org&#x2F;&quot;&gt;IETF®&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-is-encryption&quot;&gt;What is encryption?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-is-encryption&quot; aria-label=&quot;Anchor link for: what-is-encryption&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Encryption&quot;&gt;Encryption&lt;&#x2F;a&gt; is a way of ensuring that &lt;em&gt;only&lt;&#x2F;em&gt; people you choose
are able to read your information. Encryption goes back thousands of years
to the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Caesar_cipher&quot;&gt;Roman empire&lt;&#x2F;a&gt;. It is &lt;a href=&quot;https:&#x2F;&#x2F;doesmysiteneedhttps.com&#x2F;&quot;&gt;used every day&lt;&#x2F;a&gt;
in the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;HTTPS&quot;&gt;&lt;code&gt;HTTPS&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; protocol, which ensures that the websites you visit
are only visible to you, and that the site has not &lt;a href=&quot;https:&#x2F;&#x2F;gist.github.com&#x2F;ryankearney&#x2F;4146814&quot;&gt;been changed in transit&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Cryptography therefore has two major functions:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;To encrypt data: to make sure only people you choose can read it, and&lt;&#x2F;li&gt;
&lt;li&gt;To sign data: to ensure that information you read has not been altered by third parties.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;how-do-i-get-gpg&quot;&gt;How do I get GPG?&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-do-i-get-gpg&quot; aria-label=&quot;Anchor link for: how-do-i-get-gpg&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;GPG is only fully-featured when used from the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Command-line_interface&quot;&gt;command line&lt;&#x2F;a&gt;.
If that sounds foreign to you, I have a quick-and-dirty guide on &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;215-resources&#x2F;blob&#x2F;master&#x2F;tutorials&#x2F;ShellIntro.pdf&quot;&gt;GitHub&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Some binary releases:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Debian&#x2F;Ubuntu: &lt;code&gt;sudo apt-get install gnupg&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Windows: &lt;a href=&quot;https:&#x2F;&#x2F;gpg4win.org&#x2F;download.html&quot;&gt;GPG4Win&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;macOS:
&lt;ul&gt;
&lt;li&gt;without brew: &lt;a href=&quot;https:&#x2F;&#x2F;gpgtools.org&#x2F;&quot;&gt;GPGtools.org&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;with &lt;code&gt;brew&lt;&#x2F;code&gt; installed: &lt;code&gt;brew install gnupg &lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;how-do-i-use-gpg&quot;&gt;How do I use GPG?&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-do-i-use-gpg&quot; aria-label=&quot;Anchor link for: how-do-i-use-gpg&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Now we get to the fun stuff! GPG uses what&#x27;s called &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Public-key_cryptography&quot;&gt;asymmetric encryption&lt;&#x2F;a&gt;,
which allows &lt;em&gt;anyone&lt;&#x2F;em&gt; to send secure messages to you, but only you to read them.
In order to take full advantage, you&#x27;ll need to&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Make a key&lt;&#x2F;li&gt;
&lt;li&gt;Publish your key&lt;&#x2F;li&gt;
&lt;li&gt;Start signing things&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;make-a-key&quot;&gt;Make a key&lt;a class=&quot;zola-anchor&quot; href=&quot;#make-a-key&quot; aria-label=&quot;Anchor link for: make-a-key&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;You need a &lt;a href=&quot;https:&#x2F;&#x2F;whatisapassphrase.com&#x2F;&quot;&gt;passphrase&lt;&#x2F;a&gt; to use a GPG key.
This prevents anyone from using your key.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gpg&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;quick-gen-key&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-double z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Joe Shmoe &amp;lt;joe@email.example.com&amp;gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Enter your passphrase into the prompt that pops up.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;publish-your-key&quot;&gt;Publish your key&lt;a class=&quot;zola-anchor&quot; href=&quot;#publish-your-key&quot; aria-label=&quot;Anchor link for: publish-your-key&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gpg&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; --&lt;&#x2F;span&gt;send-keys&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;start-signing-things&quot;&gt;Start signing things&lt;a class=&quot;zola-anchor&quot; href=&quot;#start-signing-things&quot; aria-label=&quot;Anchor link for: start-signing-things&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;Sign things with git:
&lt;code&gt;gpg config --global commit.gpgsign true&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Sign your emails with supporting clients:
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.mozilla.org&#x2F;en-US&#x2F;thunderbird&#x2F;&quot;&gt;Thunderbird&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;www.enigmail.net&#x2F;index.php&#x2F;en&#x2F;&quot;&gt;Enigmail&lt;&#x2F;a&gt; for desktop&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.kde.org&#x2F;applications&#x2F;internet&#x2F;kmail&#x2F;&quot;&gt;Kmail&lt;&#x2F;a&gt; for KDE&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;k9mail.github.io&#x2F;&quot;&gt;K9mail&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;openkeychain.org&#x2F;&quot;&gt;OpenKeychain&lt;&#x2F;a&gt;
for Android&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gnupg.org&#x2F;software&#x2F;swlist.html#mutt&quot;&gt;Mutt&lt;&#x2F;a&gt; for the terminal&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Join &lt;a href=&quot;https:&#x2F;&#x2F;keybase.io&#x2F;&quot;&gt;Keybase&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;more-information&quot;&gt;More information&lt;a class=&quot;zola-anchor&quot; href=&quot;#more-information&quot; aria-label=&quot;Anchor link for: more-information&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.gnupg.org&#x2F;gph&#x2F;en&#x2F;manual&#x2F;book1.html&quot;&gt;GPG handbook&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gnupg.org&#x2F;software&#x2F;frontends.html&quot;&gt;More frontends&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.glump.net&#x2F;howto&#x2F;cryptography&#x2F;practical-introduction-to-gnu-privacy-guard-in-windows&quot;&gt;A much more thorough explanation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.openpgp.org&#x2F;&quot;&gt;Homepage&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gnupg.org&#x2F;&quot;&gt;GPG homepage&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;emailselfdefense.fsf.org&#x2F;en&#x2F;&quot;&gt;FSF&lt;&#x2F;a&gt; on email self-defense&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;prompts-are-repeated&quot;&gt;Prompts are repeated&lt;a class=&quot;zola-anchor&quot; href=&quot;#prompts-are-repeated&quot; aria-label=&quot;Anchor link for: prompts-are-repeated&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Note that the following prompt appears &lt;em&gt;twice&lt;&#x2F;em&gt; when you generate a key:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;We need to generate a lot of random bytes.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;It is a good idea to perform some other action (type on the keyboard,
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;move the mouse, utilize the disks) during the prime generation;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;this gives the random number generator a better chance to gain enough entropy.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This is because there are actually two keys being generated:
1 private key and 1 public. The private you will store on your computer
securely. The public you will upload to a keyserver for anyone to see.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;what-if-i-m-not-comfortable-with-shell-quoting&quot;&gt;What if I&#x27;m not comfortable with shell quoting?&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-if-i-m-not-comfortable-with-shell-quoting&quot; aria-label=&quot;Anchor link for: what-if-i-m-not-comfortable-with-shell-quoting&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Use &lt;code&gt;gpg --gen-key&lt;&#x2F;code&gt; or &lt;code&gt;gpg --full-gen-key&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>THERE IS A CAR IN SPACE</title>
        <published>2018-02-06T00:00:00+00:00</published>
        <updated>2018-02-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/there-is-a-car-in-space/"/>
        <id>https://jyn.dev/there-is-a-car-in-space/</id>
        
        <content type="html" xml:base="https://jyn.dev/there-is-a-car-in-space/">&lt;p&gt;As of today, February 6th 2018, from around 3:50 PM, there is a
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Elon_Musk%27s_Tesla_Roadster&quot;&gt;Tesla Roadster&lt;&#x2F;a&gt;
headed to Mars.&lt;&#x2F;p&gt;
&lt;p&gt;Today marked the first successful launch of the SpaceX
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Falcon_Heavy&quot;&gt;Falcon Heavy&lt;&#x2F;a&gt;, a rocket ship than
can carry other rocket ships.
Not only did the Heavy, which can carry more payload
than any other ship besides the Saturn V, launch successfully,
but its rocket boosters &lt;em&gt;then deattached and landed themselves&lt;&#x2F;em&gt;, successfully,
so that they can be reused for the next launch.&lt;&#x2F;p&gt;
&lt;p&gt;The car is currently in geostationary orbit within the
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Van_Allen_radiation_belt&quot;&gt;Van Allen radiation belt&lt;&#x2F;a&gt;, testing radiation shielding
for &lt;a href=&quot;https:&#x2F;&#x2F;arstechnica.com&#x2F;science&#x2F;2018&#x2F;02&#x2F;at-the-pad-elon-musk-sizes-up-the-falcon-heavys-chance-of-success&#x2F;&quot;&gt;&quot;Air Force intel missions&quot;&lt;&#x2F;a&gt;.
It has &lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=aBr2kKAHN6M&quot;&gt;&lt;em&gt;live&lt;&#x2F;em&gt; coverage&lt;&#x2F;a&gt;
and will launch for Mars within the next 8 hours.&lt;&#x2F;p&gt;
&lt;p&gt;To reiterate:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;THERE IS A CAR IN SPACE.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;That is all.&lt;&#x2F;p&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Using DNSSEC</title>
        <published>2018-01-06T00:00:00+00:00</published>
        <updated>2018-01-06T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/using-dnssec/"/>
        <id>https://jyn.dev/using-dnssec/</id>
        
        <summary type="html">How and why to enable DNSSEC</summary>
        
        <content type="html" xml:base="https://jyn.dev/using-dnssec/">&lt;p&gt;I was on StackOverflow the other day when I saw
&lt;a href=&quot;https:&#x2F;&#x2F;unix.stackexchange.com&#x2F;questions&#x2F;90035&#x2F;how-to-set-dns-resolver-in-fedora-using-network-manager&quot;&gt;a nifty post&lt;&#x2F;a&gt; on using custom DNS servers with
&lt;a href=&quot;https:&#x2F;&#x2F;wiki.gnome.org&#x2F;Projects&#x2F;NetworkManager&quot;&gt;NetworkManager&lt;&#x2F;a&gt;.
As you can see, in the middle of the post there&#x27;s a link to
&lt;a href=&quot;https:&#x2F;&#x2F;dnssec.vs.uni-due.de&quot;&gt;https:&#x2F;&#x2F;dnssec.vs.uni-due.de&lt;&#x2F;a&gt;.
Being a curious sort, I opened it up
and saw that it&#x27;s a DNSSEC tester!&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Domain_Name_System_Security_Extensions&quot;&gt;DNSSEC&lt;&#x2F;a&gt; is a protocol for ensuring that &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Domain_Name_System&quot;&gt;DNS&lt;&#x2F;a&gt; results are accurate,
using &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Public-key_cryptography&quot;&gt;public-key cryptographpy&lt;&#x2F;a&gt;.
It prevents &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;DNS_spoofing&quot;&gt;cache poisoning&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;DNS_hijacking&quot;&gt;dns hijacking&lt;&#x2F;a&gt;.
It also prevents &lt;a href=&quot;https:&#x2F;&#x2F;blog.xs4all.nl&#x2F;xs4all-moet-adressen-pirate-bay-voorlopig-blokkeren&#x2F;&quot;&gt;court-ordered DNS bans&lt;&#x2F;a&gt; and
&lt;a href=&quot;https:&#x2F;&#x2F;blog.wired.com&#x2F;27bstroke6&#x2F;2008&#x2F;04&#x2F;isps-error-page.html&quot;&gt;hidden redirects&lt;&#x2F;a&gt;, both of which violate &lt;a href=&quot;https:&#x2F;&#x2F;www.ietf.org&#x2F;rfc.html&quot;&gt;RFC&lt;&#x2F;a&gt; standards.&lt;&#x2F;p&gt;
&lt;p&gt;Unfortunately, most computers in the world do &lt;em&gt;not&lt;&#x2F;em&gt; use DNSSEC by default.
Most end-users use DNS servers provided by their &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Internet_service_provider&quot;&gt;ISP&lt;&#x2F;a&gt;, which often
don&#x27;t support DNSSEC at all. Fortunately, configuring it is a simple process for which
Google has an &lt;a href=&quot;https:&#x2F;&#x2F;developers.google.com&#x2F;speed&#x2F;public-dns&#x2F;docs&#x2F;using&quot;&gt;extensive walkthrough&lt;&#x2F;a&gt;,
as well as &lt;a href=&quot;https:&#x2F;&#x2F;developers.google.com&#x2F;speed&#x2F;public-dns&#x2F;&quot;&gt;an overview&lt;&#x2F;a&gt; of DNS in general.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;You may also want to &lt;a href=&quot;https:&#x2F;&#x2F;test-ipv6.com&quot;&gt;see if you can access IPv6 sites&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Google has a &lt;a href=&quot;https:&#x2F;&#x2F;dns.google.com&quot;&gt;web interface&lt;&#x2F;a&gt; for DNS lookups&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;jpmens.net&#x2F;2011&#x2F;10&#x2F;21&#x2F;automating-unbound-for-dnssec-on-your-workstation&#x2F;&quot;&gt;Run your own&lt;&#x2F;a&gt; DNS server!&lt;&#x2F;li&gt;
&lt;li&gt;I&#x27;ve included DNSSEC testers in my own site.
Open up the &lt;a href=&quot;https:&#x2F;&#x2F;webmasters.stackexchange.com&#x2F;questions&#x2F;8525&#x2F;&quot;&gt;browser console&lt;&#x2F;a&gt; to take a look!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Setting up Jekyll for GitHub Pages</title>
        <published>2017-12-28T00:00:00+00:00</published>
        <updated>2017-12-28T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/setting-up-jekyll/"/>
        <id>https://jyn.dev/setting-up-jekyll/</id>
        
        <summary type="html">The story of how I set up this site</summary>
        
        <content type="html" xml:base="https://jyn.dev/setting-up-jekyll/">&lt;p&gt;Jekyll is a wonderful program. The more I use it, the more I like it.
It&#x27;s customizable, automatically parses markdown, and uses a template system
that makes it very easy to create a consistent style. Its only flaw is that
it depends on &lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;setting-up-jekyll&#x2F;#appendix&quot;&gt;rubygems&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Jekyll does get a little getting used to, however.
In this article, I&#x27;ll go over the basics:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Installing&lt;&#x2F;li&gt;
&lt;li&gt;Creating a site&lt;&#x2F;li&gt;
&lt;li&gt;Customizing a site&lt;&#x2F;li&gt;
&lt;li&gt;Creating content&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Note that I assume some basic familiarity with &lt;a href=&quot;https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&quot;&gt;Git&lt;&#x2F;a&gt;
and the commandline, which will be covered in another post.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;installing&quot;&gt;Installing&lt;a class=&quot;zola-anchor&quot; href=&quot;#installing&quot; aria-label=&quot;Anchor link for: installing&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;If you don&#x27;t have &lt;a href=&quot;https:&#x2F;&#x2F;www.ruby-lang.org&#x2F;en&#x2F;documentation&#x2F;installation&#x2F;&quot;&gt;rubygems&lt;&#x2F;a&gt;
installed, you&#x27;ll need it. See also
&lt;a href=&quot;https:&#x2F;&#x2F;jyn.dev&#x2F;setting-up-jekyll&#x2F;#appendix&quot;&gt;footnote 1&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;gem&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; install jekyll&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;creating-a-site&quot;&gt;Creating a site&lt;a class=&quot;zola-anchor&quot; href=&quot;#creating-a-site&quot; aria-label=&quot;Anchor link for: creating-a-site&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jekyll&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; new &lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;directory&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-cd z-shell&quot;&gt;cd&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-shell&quot;&gt;_&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jekyll&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; serve&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Congratulations! Your site is now live
(at &lt;a href=&quot;http:&#x2F;&#x2F;localhost:4000&quot;&gt;http:&#x2F;&#x2F;localhost:4000&lt;&#x2F;a&gt; by default).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;customizing-your-site&quot;&gt;Customizing your site&lt;a class=&quot;zola-anchor&quot; href=&quot;#customizing-your-site&quot; aria-label=&quot;Anchor link for: customizing-your-site&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;&quot;Your awesome title&quot; is a pretty terribly name for a site.
Go ahead and edit it in &lt;code&gt;_config.yml&lt;&#x2F;code&gt;.
There&#x27;s lots of other juicy config to change in there,
quick rundown &lt;a href=&quot;https:&#x2F;&#x2F;jekyllrb.com&#x2F;docs&#x2F;configuration&#x2F;&quot;&gt;here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;other-things-to-edit&quot;&gt;Other things to edit&lt;a class=&quot;zola-anchor&quot; href=&quot;#other-things-to-edit&quot; aria-label=&quot;Anchor link for: other-things-to-edit&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Jekyll uses &lt;a href=&quot;https:&#x2F;&#x2F;jekyll.github.io&#x2F;minima&#x2F;&quot;&gt;minima&lt;&#x2F;a&gt;
by default; find where it is with &lt;code&gt;bundle show minima&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cp&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;bundle&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; show minima&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;directory&lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;CSS: &lt;code&gt;_sass&#x2F;minima&#x2F;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Page layouts: &lt;code&gt;_layouts&#x2F;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Headers and footers: &lt;code&gt;_includes&#x2F;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;404 page: &lt;code&gt;404.html&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;creating-content&quot;&gt;Creating content&lt;a class=&quot;zola-anchor&quot; href=&quot;#creating-content&quot; aria-label=&quot;Anchor link for: creating-content&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Jekyll expects a certain format from its templates. I&#x27;ve made an
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;jyn514.github.io&#x2F;blob&#x2F;master&#x2F;scripts&#x2F;new_post&quot;&gt;script&lt;&#x2F;a&gt;
that will handle the metadata automatically.&lt;&#x2F;p&gt;
&lt;p&gt;The content itself can be in one of three formats:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;daringfireball.net&#x2F;projects&#x2F;markdown&#x2F;&quot;&gt;Markdown&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;HTML&lt;&#x2F;li&gt;
&lt;li&gt;Plain text&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;jyn514.github.io&#x2F;&quot;&gt;source&lt;&#x2F;a&gt;
of my site is also available as an example.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;If, like me, you got a permissions error -&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jyn@debian-thinkpad:&#x2F;usr&#x2F;local&#x2F;src&#x2F;second-website$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; gem install jekyll&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ERROR:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;  While executing gem ... (Errno::EACCES&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;&#x2F;span&gt;)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;Permission&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; denied @ dir_s_mkdir - &#x2F;var&#x2F;lib&#x2F;ruby&#x2F;2.3.0&#x2F;gem&#x2F;specs&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;then you probably installed with a package manager. Unfortunately,
you&#x27;ll have to reinstall gem; I&#x27;m not aware of any way around this.
Since installing on a system-wide basis requires root permissions,
&#x2F;var&#x2F;lib&#x2F;ruby is only read&#x2F;writable for root.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;If you want to edit where gems are stored, you&#x27;ll have to edit
the rubygem script itself. Find the ruby library (in my case,
&lt;code&gt;&#x2F;usr&#x2F;lib&#x2F;ruby&lt;&#x2F;code&gt;) and ```sh
cd 2.3.0&#x2F;rubygems
sed -i &quot;s&#x2F;File.join Gem.user_home, &#x27;.gem&#x27;&#x2F;File.join Gem.user_home, &#x27;.local&#x27;, &#x27;lib&#x27;, &#x27;gem&#x27;&#x2F;&quot; **&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Hosting an SSH Server</title>
        <published>2017-12-27T00:00:00+00:00</published>
        <updated>2017-12-27T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/hosting-an-ssh-server/"/>
        <id>https://jyn.dev/hosting-an-ssh-server/</id>
        
        <summary type="html">I decided one day that I really wanted a remote server.</summary>
        
        <content type="html" xml:base="https://jyn.dev/hosting-an-ssh-server/">&lt;p&gt;I decided one day over break that I really wanted a remote server.
I had a spare laptop, a router at home, and far too much free time.
The obvious solution was to combine the three.&lt;&#x2F;p&gt;
&lt;p&gt;It ended up being much simpler than I expected to set up.
On my old laptop, I installed an SSH server:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; apt-get install openssh-server&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I made a few changes to the default config:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sed&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;i&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;s&#x2F;Port: 22&#x2F;Port: 666&#x2F;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;s&#x2F;PermitRootLogin without-password&#x2F;PermitRootLogin no&#x2F;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;s&#x2F;#PasswordAuthentication yes&#x2F;PasswordAuthentication no&#x2F;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;s&#x2F;PrintMotd no&#x2F;PrintMotd yes&#x2F;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &#x2F;etc&#x2F;ssh&#x2F;sshd_config&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Created and added an SSH key:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ssh-keygen&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-eval z-shell&quot;&gt;eval&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-meta z-group z-expansion z-command z-parens z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-begin z-shell&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ssh-agent&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-parens z-end z-shell&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ssh-add&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ssh-copy-id&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; service ssh restart&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;And copied it to my new computer:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jyn@debian-acer:&lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; cp &lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;.ssh&#x2F;id_rsa&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt; &#x2F;media&#x2F;jyn&#x2F;usb&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jyn@debian-acer:&lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; sudo umount &lt;span class=&quot;z-meta z-group z-expansion z-parameter z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-shell&quot;&gt;$&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-shell&quot;&gt;_&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;jyn@debian-thinkpad:&lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; sudo mount &#x2F;dev&#x2F;sdb1 &#x2F;mnt&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;cp&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &#x2F;mnt&#x2F;id_rsa&lt;span class=&quot;z-keyword z-operator z-regexp z-quantifier z-shell&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;.ssh&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;ssh-add&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;SSH now worked perfectly when I typed in the IP address.
I was moving back to USC in a few weeks though,
my server would be behind a firewall.
Not to worry though, with a mutter of approval from my dad,
I forwarded port 666 on the router to 666 on debian-acer.&lt;&#x2F;p&gt;
&lt;p&gt;Worked like a charm.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;appendix&quot;&gt;Appendix&lt;a class=&quot;zola-anchor&quot; href=&quot;#appendix&quot; aria-label=&quot;Anchor link for: appendix&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;If, like me, you have an outdated laptop
which refuses to start networking at boot, try this:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; sh&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;c&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;echo &amp;quot;# Ethernet
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;auto eth0
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;iface eth0 inet dhcp
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&amp;quot; &amp;gt;&amp;gt; &#x2F;etc&#x2F;network&#x2F;interfaces&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;More elegant way to specify ssh ports:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;sh&quot; class=&quot;language-sh z-code&quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-variable z-function z-shell&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; sh&lt;span class=&quot;z-variable z-parameter z-option z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-parameter z-shell&quot;&gt; -&lt;&#x2F;span&gt;c&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;echo &amp;quot;192.168.1.13   home &amp;gt;&amp;gt; &#x2F;etc&#x2F;hosts&amp;quot;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-shell&quot;&gt;&lt;span class=&quot;z-support z-function z-echo z-shell&quot;&gt;echo&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt; &lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;Host home
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-shell z-bash&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-shell&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-shell&quot;&gt;Port 666&lt;span class=&quot;z-punctuation z-definition z-string z-end z-shell&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-redirection z-shell&quot;&gt;&amp;gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-expansion z-tilde&quot;&gt;&lt;span class=&quot;z-variable z-language z-tilde z-shell&quot;&gt;~&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x2F;.ssh&#x2F;config&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
    </entry><entry xml:lang="en">
        <title>Hello, World!</title>
        <published>2017-12-23T00:00:00+00:00</published>
        <updated>2017-12-23T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              jyn
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://jyn.dev/first-post/"/>
        <id>https://jyn.dev/first-post/</id>
        
        <summary type="html">Hello, World!</summary>
        
        <content type="html" xml:base="https://jyn.dev/first-post/">&lt;p&gt;&lt;strong&gt;Hello, World!&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;This is my first post on the new and improved site using &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jekyll&#x2F;jekyll&quot;&gt;jekyll&lt;&#x2F;a&gt;.
It will (hopefully) be the first of many. Feel free to explore the source code &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jyn514&#x2F;second-website&quot;&gt;here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I started this site from an offhand comment by my good friend &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;charlesdaniels&quot;&gt;Charles Daniels&lt;&#x2F;a&gt;.
We were working on a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;charlesdaniels&#x2F;bitshuffle&quot;&gt;side project&lt;&#x2F;a&gt; together when I suggested
signing release commits with &lt;a href=&quot;https:&#x2F;&#x2F;gnupg.org&#x2F;&quot;&gt;GPG&lt;&#x2F;a&gt;.
He was surprised I had experience with PGP keys, and his first question was &quot;Do you have a blog?&quot;&lt;&#x2F;p&gt;
&lt;p&gt;From that simple question sprung this site. I hope you enjoy!&lt;&#x2F;p&gt;
</content>
    </entry>
</feed>
